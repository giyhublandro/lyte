Imports MySql.Data.MySqlClient
Imports System.Configuration
Imports System.Windows.Forms.DataVisualization.Charting
Imports System.Net
Imports System.IO

Imports System.ComponentModel

'-------------------------------
Imports System
Imports System.Text
Imports System.Web


Public Class MainWindow

    'Database connection management
    'Dim connect As New DataBaseManipulation()

    Dim dateDepart As Date
    Dim dateArrivee As Date

    Dim nombreDejour As Integer

    'USED FOR BACKGROUND WORKERS

    Public Class ArgumentType

        'action = 0 : ultrMessageSimpleText
        Public action As Integer
        Public whatsAppMessage As String
        Public mobile_number As String

        '--------------------------------
        'action = 1 : consifirmation resa salle

        Public CODE_RESERVATAION As String
        Public NOM_PRENOM As String
        Public ARRIVAL As Date
        Public DEPART As Date
        Public TEMP_A_FAIRE As Integer
        Public TYPE_CHAMBRE As String
        Public NUM_CHAMBRE As String
        Public MONTANT_PAR_NUITEE As Double
        Public HEURE_ARRIVEE As DateTime
        Public HEURE_DEPART As DateTime
        Public TYPE_CHAMBRE_SALLE As String
        Public EMAIL As String
        Public TELEPHONE_CLIENT As String
        Public WHATSAPP_OU_EMAIL As Integer

        'action = 2 : confirmation resa chambre
        'action = 3 : devis estimatif salle
        'action = 4 : Fiche de police
        'action = 5 : Contrat de location
        'action = 6 :
        'action = 7 :
        'action = 8 :
        'action = 9 :
        'action = 10 :

    End Class

    Private Sub MainWindow_Load(sender As Object, e As EventArgs) Handles MyBase.Load

        'POUT AFFICHAGE DES ICONS DE FACON PAGINEE
        page = 1

        GunaDateTimePickerReportsDate.Value = GlobalVariable.DateDeTravail

        Dim language As New Languages()
        language.receptionReservation(GlobalVariable.actualLanguageValue)

        Dim nombreDeConsingne As Integer = Functions.alerteConsignes()
        GunaLabelNombreDeConsigne.Text = "(" & nombreDeConsingne & ")"

        Functions.retablissementDesPictogrammeCorrecteDuDashBoard(GlobalVariable.DateDeTravail)

        'TimerToRefreshClock.Start()

        'TITRE DE LA FENETRE
        If GlobalVariable.softwareVersion = "lytesoftdbdemo" Then
            StatusBarPanelName.Text = GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR") + " (DEMO) "

        ElseIf GlobalVariable.softwareVersion = "lytesoftdb" Then
            StatusBarPanelName.Text = GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR")
        Else
            'StatusBarPanelName.Text = GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR")
        End If

        'AccueilForm.Hide()

        'GunaLabelDateDeTravail.Text = GlobalVariable.DateDeTravail
        date_travail.Text = GlobalVariable.DateDeTravail
        'GunaLabelTemps.Text = Now().ToLongTimeString()
        StatusBarPanelTime.Text = Now().ToLongTimeString()

        GunaLabel51.Visible = False

        Dim notifications As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.ConnectedUser.Rows(0)("CATEG_UTILISATEUR"), "notification", "CODE_PROFIL", 0, "ETAT_NOTIFCATION")

        If notifications.Rows.Count > 0 Then
            StatusBarPanelNotification.Text = "(" & notifications.Rows.Count & ")"
        Else

            StatusBarPanelNotification.Text = "(" & 0 & ")"

        End If

        GunaLabelSymboleMonnaie.Visible = True

        Dim menuAccess As New AccessRight()

        If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows.Count > 0 Then

            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("MENU_RECEPTION") = 0 Then
                GunaAdvenceButtonRecep.Visible = False
            Else
                GunaAdvenceButtonRecep.Visible = False
            End If

            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("MENU_ECONOMAT") = 0 Then
                GunaAdvenceButtonEco.Visible = False
            End If

            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("MENU_SERVICE_ETAGE") = 0 Then
                GunaAdvenceButtonEtage.Visible = False
            End If

            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("MENU_BAR_RESTAURANT") = 0 Then
                GunaAdvenceButtonBar.Visible = False
            End If

            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("MENU_COMPTABILITE") = 0 Then
                GunaAdvenceButtonCompt.Visible = False
            End If

            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("MENU_TECHNIQUE") = 0 Then
                GunaAdvenceButtonTech.Visible = False
            End If

            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("MENU_CUISINE") = 0 Then
                GunaAdvenceButtonCuis.Visible = False
            End If

        End If

        menuAccess.administrationDuModule(GlobalVariable.DroitAccesDeUtilisateurConnect, ToolStripMenuItemSession, ToolStripMenuItemConfig, ToolStripMenuItemServTech, ToolStripMenuItemSecurite, ClôturerToolStripMenuItem, ToolStripSeparatorCloture, FermerCaisseToolStripMenuItem, OuvrirCaisseToolStripMenuItem, ToolStripSeparator2)

        'elementsDesChambres()

        'StatistiquesDesChambres()

        ''Le statut ne doit être visible que en cas de modification

        If Not GlobalVariable.codeReservationToUpdate = "" Then
            LabelNatureReservation.Visible = True
        Else
            LabelNatureReservation.Visible = False
        End If

        'RAPPORT RECEPTION 
        '--------------------------------------------------------------------

        'Raison reservation business ou loisirs
        GunaComboBoxTypeReservation.SelectedIndex = 0 'Non confirmée

        'ReservationList()

        '----------------------------------------------------------------------------------------
        PanelGraphiques.BringToFront()
        PanelGraphiques.Visible = True

        GunaGroupBoxRoomStatus.Controls.Clear()
        'PanelGraphiques.Controls.Clear()
        GunaGroupBoxStatistiques.Controls.Clear()
        'GESTION DES GRAPHIQUES
        elementsDesChambres()
        'GESTION DES STATS DU PANNEAU LATERAL DROIT
        contenuStatistique()

        StatistiquesDesChambres()
        'GESTION DU PANNEAU DU MILIEU

        'StatusDesChambres(page_origin) 'Icon des chambres au niveau du dashboard

        'On Reinitialise les dates en plus de la date de travail
        ReinitialisationDesDates()

        'GunaTextBoxNumeroChambre.visible = True
        'Initialisation du nombre de personne
        GunaTextBoxNbreAdulte.Text = 0
        GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text

        'GlobalVariable.typeChambreOuSalle = "chambre"

        GlobalVariable.typeChambreOuSalle = "chambre"

        TabControlGestionReservation.TabPages.Item(3).Visible = False

        'IMPRESSION DES DOCS LIES AUX CHAMBRES OU SALLE
        If TabControlHbergement.SelectedIndex = 0 Then

            If GlobalVariable.typeChambreOuSalle = "chambre" Then

                'TabControlGestionReservation.TabPages.RemoveAt(3)

                GunaComboBoxImpressionChambre.Visible = True
                GunaComboBoxImpressionSalle.Visible = False

            Else

                GunaComboBoxImpressionChambre.Visible = False
                GunaComboBoxImpressionSalle.Visible = True

            End If

            ImprimerDocChambreSalle.Visible = True
            GunaButtonEnvoyer.Visible = True


        Else

            GunaComboBoxImpressionChambre.Visible = False
            GunaComboBoxImpressionSalle.Visible = False
            ImprimerDocChambreSalle.Visible = False
            GunaButtonEnvoyer.Visible = False

        End If

        'GESTION DU FORMULAIRE DES CHAMBRES
        GunaRadioButtonChambre.Checked = True

        'We hide the tab of salle de fete of the left tab
        'TabControlGestionReservation.TabPages.Remove(SalleDeFeteRight)

        setTableUsedForAutocompletionToFalse()

        '--------------------------------------------- FRONT OFFICE PANNEL MANEGEMNT -------------------------------------------
        'We charge all the information concerning the agency into a variable that will be used trough out the programme
        'GlobalVariable.AgenceActuelle = Functions.getElementByCode(GlobalVariable.ConnectedUser.Rows(0)("NUM_AGENCE"), "agence", "CODE_AGENCE")


        'Theme color
        If GlobalVariable.AgenceActuelle.Rows.Count > 0 Then

            GlobalVariable.codeAgence = GlobalVariable.AgenceActuelle.Rows(0)("CODE_AGENCE")

            If Not GlobalVariable.AgenceActuelle.Rows(0)("VILLE") = "" Then
                GunaTextBoxSerendantA.Text = GlobalVariable.AgenceActuelle.Rows(0)("VILLE")
                GunaTextBoxVenantDe.Text = ""
            End If

            If GlobalVariable.AgenceActuelle.Rows(0)("TARIFICATION_DYNAMIQUE") = 1 Then
                GunaButtonTarifAppliquable.Visible = True
                GlobalVariable.tarificationDynamiqueActif = True
            ElseIf GlobalVariable.AgenceActuelle.Rows(0)("TARIFICATION_DYNAMIQUE") = 0 Then
                GunaButtonTarifAppliquable.Visible = False
                GlobalVariable.tarificationDynamiqueActif = False
            End If

            If GlobalVariable.AgenceActuelle.Rows(0)("MENSUALITE") = 1 Then
                GunaCheckBoxMensuel.Visible = True
            Else
                GunaCheckBoxMensuel.Visible = False
            End If

        Else

        End If

        contenuStatistique()

        If GlobalVariable.affichageDuStatutsDesCahmbresOuPas Then

            elementsDesChambres()
            StatistiquesDesChambres()
            'contenuStatistique()
            StatusDesChambres(page)
            GlobalVariable.affichageDuStatutsDesCahmbresOuPas = False

        End If

        ''AutoLoad Room for routing
        AutoLoadRoomForRouting()

        'Auload room source
        AutoLoadRoomReservationSource()

        Dim infoSupSource As DataTable

        If GlobalVariable.actualLanguageValue = 0 Then

            infoSupSource = Functions.getElementByCode("WALK IN", "SOURCE_RESERVATION", "SOURCE_RESERVATION")

            If infoSupSource.Rows.Count > 0 Then
                'GunaComboBoxSourceRéservation.SelectedValue = infoSupSource.Rows(0)("CODE_SOURCE_RESERVATION")
            End If

        Else

            infoSupSource = Functions.getElementByCode("COMPTOIR", "SOURCE_RESERVATION", "SOURCE_RESERVATION")

            If infoSupSource.Rows.Count > 0 Then
                'GunaComboBoxSourceRéservation.SelectedValue = infoSupSource.Rows(0)("CODE_SOURCE_RESERVATION")
            End If

        End If

        If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows.Count > 0 Then

            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("CORRECTIONS") = 1 Then
                GunaCheckBoxDateFictive.Visible = True
            Else
                GunaCheckBoxDateFictive.Visible = False
            End If

        End If

        Functions.magasinActuelEtShiftDunUtilisateur()

        affichageParDefautDesReservations()

        GunaDateTimePicker1.Value = GlobalVariable.DateDeTravail
        GunaDateTimePicker2.Value = GlobalVariable.DateDeTravail

        '--------------------------------------------- PLANNING PANNEL MANEGEMNT ----------------------------------------------

        'ENVOI DU LIEN GOOGLE MAP AUX CLIENTS DONT L'ARRIVEE EST PREVUE POUR DEMAIN

        If GlobalVariable.AgenceActuelle.Rows(0)("MESSAGE_WHATSAPP") = 1 Then

            Dim clientDevrantRecevoirLeLien As DataTable = Functions.listeDesReservationQuiRecevrontLeLienGoogleMap(GlobalVariable.DateDeTravail)

            If clientDevrantRecevoirLeLien IsNot Nothing Then

                If clientDevrantRecevoirLeLien.Rows.Count > 0 Then

                    Dim args As ArgumentType = New ArgumentType()
                    Dim clientInfo As DataTable
                    Dim CLIENT_ID As String = ""
                    Dim CODE_RESERVATION As String = ""

                    For i = 0 To clientDevrantRecevoirLeLien.Rows.Count - 1

                        CLIENT_ID = clientDevrantRecevoirLeLien.Rows(i)("CLIENT_ID")
                        CODE_RESERVATION = clientDevrantRecevoirLeLien.Rows(i)("CODE_RESERVATION")
                        clientInfo = Functions.getElementByCode(CLIENT_ID, "client", "CODE_CLIENT")

                        Dim societe As DataTable = Functions.allTableFields("societe")

                        If GlobalVariable.actualLanguageValue = 1 Then
                            whatsAppMessage = Chr(13) & " Recevez nos salutations " & clientInfo.Rows(i)("CIVILITE") & " " & clientInfo.Rows(i)("NOM_CLIENT") & ", " & Chr(13) & Chr(13) & " Merci d'avoir choisi " & GlobalVariable.AgenceActuelle.Rows(0)("NOM_AGENCE") & ", " & Chr(13) & Chr(13) & "Nous sommes heureux de confirmer votre réservation dans nos registres. " & Chr(13) & Chr(13) & "Nous sommes un hôtel situé " & GlobalVariable.AgenceActuelle.Rows(0)("RUE") & " au cœur de " & societe.Rows(0)("VILLE") & ". Vous pouvez cliquer sur le lien ci-dessous pour nous localiser sur Google map et avoir un itinéraire de là ou vous êtes présentement à notre hôtel " & GlobalVariable.AgenceActuelle.Rows(0)("LIEN_GOOGLE_MAP") & Chr(13) & "Quelle sera votre heure probable d'arrivée?" & Chr(13) & "Avez-vous besoin de la navette payante?" & Chr(13) & "Nous restons à votre entière disposition pour toute information complémentaire." & Chr(13) & GlobalVariable.AgenceActuelle.Rows(0)("TELEPHONE")
                        Else
                            whatsAppMessage = Chr(13) & " Receive our greetings " & clientInfo.Rows(i)("CIVILITE") & " " & clientInfo.Rows(i)("NOM_CLIENT") & ", " & Chr(13) & Chr(13) & " Thanks for chosing " & GlobalVariable.AgenceActuelle.Rows(0)("NOM_AGENCE") & ", " & Chr(13) & Chr(13) & "We are happy to confirm your reservation in our books. " & Chr(13) & Chr(13) & "We ara situated at " & GlobalVariable.AgenceActuelle.Rows(0)("RUE") & " " & societe.Rows(0)("VILLE") & ". You can click on the below link to localise us on Google map and see the itinerary from where you are to our hotel " & GlobalVariable.AgenceActuelle.Rows(0)("LIEN_GOOGLE_MAP") & Chr(13) & "What can be your possible arrival time?" & Chr(13) & "Do you need a charged shuttle?" & Chr(13) & "We remain at your entire disposal for any complementary information." & Chr(13) & GlobalVariable.AgenceActuelle.Rows(0)("TELEPHONE")
                        End If

                        args.action = 0
                        args.whatsAppMessage = Chr(13) & whatsAppMessage

                        If (clientInfo.Rows.Count > 0) And Not Trim(clientInfo.Rows(i)("TELEPHONE")).Equals("") Then
                            Dim mobile_number As String = clientInfo.Rows(i)("TELEPHONE")
                            args.mobile_number = mobile_number
                            backGroundWorkerToCall(args)
                            Functions.updateOfFields("reservation", "LIEN_GOOGLE_MAP", 1, "CODE_RESERVATION", CODE_RESERVATION, 0)

                        End If

                    Next

                End If

            End If

        End If

    End Sub

    '------------------------------------- GESTION DU PLANNING----------------------------------
    Public Sub gestionDuPlanning()

        Dim moi As Integer = 0
        Dim annee As Integer = 0
        Integer.TryParse(Month(Now), moi)
        Integer.TryParse(Year(Now), annee)

        nombreDejour = GetDaysInAMonth(annee, moi)

        'GunaDataGridViewPlanning.ColumnCount = nombreDeJour
        Dim halfCalendar As Integer = Math.Ceiling(nombreDejour / 4)

        dateDepart = Now().AddDays(-14)
        dateArrivee = Now().AddDays(nombreDejour - 15)

        Dim chambres As DataTable = Functions.allTableFields("chambre")

        For k As Integer = 0 To nombreDejour - 1

            If k = 0 Then
                Me.GunaDataGridViewPlanning.Columns.Add("Chambres", "CODE")
                Me.GunaDataGridViewPlanning.Columns.Add("Chambres", "ETAT")
            Else
                Me.GunaDataGridViewPlanning.Columns.Add("JanWin", "12H")
                Me.GunaDataGridViewPlanning.Columns.Add("JanLoss", "12H")
            End If

        Next

        'Columns of the days to display
        Me.GunaDataGridViewPlanning.Rows.Add("")
        Me.GunaDataGridViewPlanning.Rows(0).Height = 2

        Dim m As Integer
        For m = 0 To chambres.Rows.Count - 1
            Me.GunaDataGridViewPlanning.Rows.Add(chambres.Rows(m)("CODE_CHAMBRE"), chambres.Rows(m)("ETAT_CHAMBRE_NOTE")) 'Equals the number of columns
        Next

        'Chaning the size - height of the datdgrid 
        For t = 0 To GunaDataGridViewPlanning.Rows.Count - 1

            Dim row As DataGridViewRow = GunaDataGridViewPlanning.Rows(t)
            If t = 0 Then
                row.Height = 1
            Else
                row.Height = 15
            End If

        Next

        Me.GunaDataGridViewPlanning.Rows.Add("")

        For j As Integer = 0 To Me.GunaDataGridViewPlanning.ColumnCount - 1
            Me.GunaDataGridViewPlanning.Columns(j).Width = 40
        Next

        Me.GunaDataGridViewPlanning.ColumnHeadersHeightSizeMode = DataGridViewColumnHeadersHeightSizeMode.EnableResizing
        Me.GunaDataGridViewPlanning.ColumnHeadersHeight = Me.GunaDataGridViewPlanning.ColumnHeadersHeight * 2
        Me.GunaDataGridViewPlanning.ColumnHeadersDefaultCellStyle.Alignment = DataGridViewContentAlignment.BottomCenter

    End Sub

    Public Sub AutoLoadRoomForRouting()

        If GlobalVariable.typeChambreOuSalle = "chambre" Then

            Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

            Dim query As String = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaComboBoxChambreRoutage.DataSource = table
                GunaComboBoxChambreRoutage.ValueMember = "CHAMBRE"
                GunaComboBoxChambreRoutage.DisplayMember = "CHAMBRE"

            End If

        End If

    End Sub

    Public Sub AutoLoadEventList()

        If GlobalVariable.typeChambreOuSalle = "salle" Then

            'Loading other 'article families cureently called article type into a combobox
            Dim existQuery As String = "SELECT * From evenement ORDER BY LIBELLE ASC"

            Dim command As New MySqlCommand(existQuery, GlobalVariable.connect)

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaComboBoxEvenement.DataSource = table
                'GunaComboBoxChambreRoutage.ValueMember = "CODE_FAMILLE"
                GunaComboBoxEvenement.ValueMember = "CODE_EVENEMENT"
                GunaComboBoxEvenement.DisplayMember = "LIBELLE"

            End If

        End If

    End Sub

    Public Sub AutoLoadRoomReservationSource()

        If GlobalVariable.typeChambreOuSalle = "chambre" Or GlobalVariable.typeChambreOuSalle = "salle" Then

            'Loading other 'article families cureently called article type into a combobox
            Dim existQuery As String = "SELECT * From source_reservation ORDER BY SOURCE_RESERVATION ASC"

            Dim command As New MySqlCommand(existQuery, GlobalVariable.connect)

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaComboBoxSourceReservation.DataSource = table
                'GunaComboBoxChambreRoutage.ValueMember = "CODE_FAMILLE"
                GunaComboBoxSourceReservation.ValueMember = "CODE_SOURCE_RESERVATION"
                GunaComboBoxSourceReservation.DisplayMember = "SOURCE_RESERVATION"

                GunaComboBoxSourceResaRapport.ValueMember = "CODE_SOURCE_RESERVATION"
                GunaComboBoxSourceResaRapport.DisplayMember = "SOURCE_RESERVATION"

            End If

        End If

        GunaComboBoxSourceReservation.SelectedIndex = -1

    End Sub

    Public Sub ReinitialisationDesDates()

        GunaCheckBoxDayUse.Checked = False
        GunaCheckBoxMensuel.Checked = False

        If GlobalVariable.AgenceActuelle.Rows.Count > 0 Then
            GunaTextBoxSerendantA.Text = GlobalVariable.AgenceActuelle.Rows(0)("VILLE")
        End If

        GunaComboBoxHeureDepart.Items.Remove(GunaComboBoxHeureDepart.SelectedItem)
        GunaComboBoxHeureDepart.Items.Add("12:00:00")
        GunaComboBoxHeureDepart.SelectedItem = "12:00:00"

        GunaComboBoxHeureArrivee.Items.Remove(GunaComboBoxHeureArrivee.SelectedItem)
        GunaComboBoxHeureArrivee.Items.Add("12:00:00")
        GunaComboBoxHeureArrivee.SelectedItem = "12:00:00"

        GlobalVariable.DateDeTravail = Convert.ToDateTime(Functions.ObtenirDateDeTravail())
        'Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.selectedItem

        GunaDateTimePickerParDateArrivee.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerParDateDepart.Value = GlobalVariable.DateDeTravail

        GunaLabelDateDeTravail.Text = GlobalVariable.DateDeTravail.ToShortDateString

        'Initializing the date of the tab depart
        GunaDateTimePickerArriveeDepart.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDepartDepert.Value = GlobalVariable.DateDeTravail

        GunaLabelDateDepartFin.Text = GunaDateTimePickerDepartDepert.Value.ToShortDateString()
        GunaLabelDateDepartDebut.Text = GunaDateTimePickerArriveeDepart.Value.ToShortDateString()


        'Initializing the date of the tab en chambres
        GunaDateTimePickerDebutEnChambre.Value = GlobalVariable.DateDeTravail
        GunaLabel50.Text = GunaDateTimePickerDebutEnChambre.Value.ToShortDateString()


        'Initializing the dates of the tab attendus
        GunaDateTimePickerDebut.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerFin.Value = GlobalVariable.DateDeTravail

        GunaLabel53.Text = GunaDateTimePickerFin.Value.ToShortDateString()
        GunaLabel54.Text = GunaDateTimePickerDebut.Value.ToShortDateString()


        'GunaDateTimeHeureArrive.Value = Now().ToShortTimeString
        'GunaDateTimePickerHeureDepart.Value = GlobalVariable.DateDeTravail

        'Initializing the time of attendu tab

        GunaDateTimePickerDebut.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerFin.Value = GlobalVariable.DateDeTravail

        GunaTextBoxCodeDeGroupe.Clear()

        GunaCheckBoxReservationDeGroupe.Checked = False

        If GunaRadioButtonSalleFete.Checked Then
            GlobalVariable.typeChambreOuSalle = "salle"
        ElseIf GunaRadioButtonChambre.Checked Then
            GlobalVariable.typeChambreOuSalle = "chambre"
        End If

        'Initializing the arrival and departure date to todays date

        GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail.AddDays(1)

        GlobalVariable.codeReservationToUpdate = ""

    End Sub

    'Managing the selection of the dataagrid cells

    Public Class PlanningDataGrid

        Inherits DataGridView

        Protected Overrides Sub OnCellMouseDown(e As DataGridViewCellMouseEventArgs)
            MyBase.OnCellMouseDown(e)
        End Sub

    End Class

    Private Sub DataGridView1_CellPainting(sender As Object, e As System.Windows.Forms.DataGridViewCellPaintingEventArgs) Handles GunaDataGridViewPlanning.CellPainting
        If e.RowIndex = -1 AndAlso e.ColumnIndex > -1 Then
            Dim r2 As Rectangle = e.CellBounds
            r2.Y += e.CellBounds.Height / 2
            r2.Height = e.CellBounds.Height / 2
            e.PaintBackground(r2, True)
            e.PaintContent(r2)
            e.Handled = True
        End If
    End Sub

    Private Sub DataGridView1_ColumnWidthChanged(sender As Object, e As System.Windows.Forms.DataGridViewColumnEventArgs) Handles GunaDataGridViewPlanning.ColumnWidthChanged
        Dim rtHeader As Rectangle = Me.GunaDataGridViewPlanning.DisplayRectangle
        rtHeader.Height = Me.GunaDataGridViewPlanning.ColumnHeadersHeight / 2
        Me.GunaDataGridViewPlanning.Invalidate(rtHeader)
    End Sub

    Private Sub GunaDataGridViewPlanning_Paint(sender As Object, e As System.Windows.Forms.PaintEventArgs) Handles GunaDataGridViewPlanning.Paint
        'Dim days As String() ' The days to display
        'Dim Monthes As String() = {"CHAMBRES", "Janvier", "Fervrier", "Mars", "Avril", "Mai"}
        Dim Monthes(nombreDejour) As String

        For l = 0 To nombreDejour - 1
            If l = 0 Then
                If GlobalVariable.actualLanguageValue = 1 Then
                    Monthes(l) = "CHAMBRES"
                Else
                    Monthes(l) = "ROOMS"
                End If

            Else
                Monthes(l) = Format(dateDepart.AddDays(l), "dd-MM-yyyy")
            End If

        Next

        'MessageBox.Show(days.Length)

        Dim j As Integer = 0

        While j < nombreDejour * 2 - 1
            Dim r1 As Rectangle = Me.GunaDataGridViewPlanning.GetCellDisplayRectangle(j, -1, True)
            Dim w2 As Integer = Me.GunaDataGridViewPlanning.GetCellDisplayRectangle(j + 1, -1, True).Width
            r1.X += 1
            r1.Y += 1
            r1.Width = r1.Width + w2 - 2
            r1.Height = r1.Height / 2 - 2
            e.Graphics.FillRectangle(New SolidBrush(Me.GunaDataGridViewPlanning.ColumnHeadersDefaultCellStyle.BackColor), r1)
            Dim format As New StringFormat()
            format.Alignment = StringAlignment.Center
            format.LineAlignment = StringAlignment.Center
            e.Graphics.DrawString(Monthes(j \ 2), Me.GunaDataGridViewPlanning.ColumnHeadersDefaultCellStyle.Font, New SolidBrush(Me.GunaDataGridViewPlanning.ColumnHeadersDefaultCellStyle.ForeColor), r1, format)
            j += 2
        End While

    End Sub

    Private Sub GunaDataGridViewPlanning_Scroll(sender As Object, e As System.Windows.Forms.ScrollEventArgs) Handles GunaDataGridViewPlanning.Scroll
        Dim rtHeader As Rectangle = Me.GunaDataGridViewPlanning.DisplayRectangle
        rtHeader.Height = Me.GunaDataGridViewPlanning.ColumnHeadersHeight / 2
        Me.GunaDataGridViewPlanning.Invalidate(rtHeader)
    End Sub

    'Count the number of days in a month so as to know how many columns to create in our datagrid
    Private Function GetDaysInAMonth(ByVal year As Int16, ByVal month As Int16) As Int16

        Dim days As Int16 = 0

        Dim i As Integer = 0

        days += DateTime.DaysInMonth(year, month)

        Return days

    End Function

    Private Sub GunaImageButton1_Click(sender As Object, e As EventArgs)

        Functions.ClosingOpenedConnection()

        Application.ExitThread()
        'Dim dialog As DialogResult

        'Using form = New Form() With {.TopMost = True}
        'dialog = MessageBox.Show("Voulez-vous vraiment fermer", "Fermer lyte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
        'End Using

        'If dialog = DialogResult.Yes Then
        'Application.ExitThread()
        'End If

    End Sub

    Private Sub GunaImageButton2_Click(sender As Object, e As EventArgs)
        Me.WindowState = FormWindowState.Minimized
    End Sub

    '----------------------------------------------------------------------------------------------------------------------
    'We we clck on an element of the menu with icons

    Private Sub GunaAdvenceButton17_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonNouvelleReservation.Click

        GunaDataGridViewResaDashBoard.Columns.Clear()
        VidageDesChampsPourNouvelleReservation()
        TabControlHbergement.SelectedIndex = 0
        GunaLabelNumReservation.Visible = True
        GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()
        GunaTextBoxMontantAccorde.Enabled = True

    End Sub

    Private Sub affichageParDefautDesReservations()

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabel51.Text = "RESERVATIONS"
        Else
            GunaLabel51.Text = "BOOKINGS"
        End If

        GunaLabel51.Visible = True
        'Dim DateDebut As Date = GunaDateTimePickerArriveeDepart.Value.ToString("yyyy-MM-dd")
        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")
        'Dim DateFin As Date = GunaDateTimePickerDepartDepert.Value.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        Dim query As String = ""
        Dim query1 As String = ""
        Dim query01 As String = ""
        Dim table As New DataTable()
        Dim table01 As New DataTable()
        Dim table1 As New DataTable()

        If (DateDebut <= DateFin) Then

            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows.Count > 0 Then


                If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("FISCALITE") = 1 Then

                    query1 = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf, source_reservation WHERE TYPE=@TYPE AND FSC=@FSC AND reserve_conf.SOURCE_RESERVATION = source_reservation.CODE_SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

                    Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
                    command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
                    command1.Parameters.Add("@FSC", MySqlDbType.Int32).Value = 1

                    Dim adapter1 As New MySqlDataAdapter(command1)

                    adapter1.Fill(table1)

                    table.Merge(table1)

                Else

                    query = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', ETAT_NOTE_RESERVATION AS 'ETAT RESERVATION' , CODE_RESERVATION AS 'RESERVATION', NB_PERSONNES As 'PERSONNE(S)' FROM reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION = @ETAT_RESERVATION ORDER BY CHAMBRE_ID ASC"

                    Dim ETAT_RESERVATION As Integer = 0
                    Dim command As New MySqlCommand(query, GlobalVariable.connect)
                    command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
                    command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int64).Value = ETAT_RESERVATION

                    Dim adapter As New MySqlDataAdapter(command)

                    adapter.Fill(table)

                    query01 = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', ETAT_NOTE_RESERVATION AS 'ETAT RESERVATION' , CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

                    Dim command01 As New MySqlCommand(query01, GlobalVariable.connect)
                    command01.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

                    Dim adapter01 As New MySqlDataAdapter(command01)

                    adapter01.Fill(table01)

                    table.Merge(table01)

                End If


                If (table.Rows.Count > 0) Then

                    GunaDataGridViewResaDashBoard.DataSource = table
                    GunaDataGridViewResaDashBoard.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                    GunaDataGridViewResaDashBoard.DefaultCellStyle.SelectionForeColor = Color.White
                    GunaDataGridViewResaDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                    GunaDataGridViewResaDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                    GunaDataGridViewResaDashBoard.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                    GunaDataGridViewResaDashBoard.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                    GunaDataGridViewResaDashBoard.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

                Else

                    GunaDataGridViewResaDashBoard.Columns.Clear()

                End If

            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Vous n'avez pas de droit d'accès", "Droit d'accès", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                Else
                    MessageBox.Show("You don't have the acces right", "Access Right", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                End If

            End If

            'connect.closeConnection()
        End If
    End Sub

    Private Sub GunaAdvenceButtonDashBoard_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonDashBoard.Click

        GunaDataGridViewResaDashBoard.DataSource = Nothing
        GunaLabel51.Visible = False

        GunaDateTimePickerArrivee.Enabled = True
        GunaDateTimePickerDepart.Enabled = True
        GunaButtonReservation.Enabled = True

        GunaDataGridViewResaDashBoard.Columns.Clear()

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()

        ReinitialisationDesDates()

        MainWindowManualActivation()

        GunaGroupBoxRoomStatus.Controls.Clear()
        'PanelGraphiques.Controls.Clear()
        GunaGroupBoxStatistiques.Controls.Clear()
        elementsDesChambres()
        contenuStatistique()
        StatistiquesDesChambres()

        If GunaWinSwitch1.Checked Then
            StatusDesChambres(page)
        End If

        PanelTableauDeBords.Show()
        PanelTableauDeBords.BringToFront()

        PanelEnregistrement.Hide()
        PanelPlanning.Hide()

        affichageParDefautDesReservations()

    End Sub

    Private Sub GunaAdvenceButtonEnregistrement_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonDepartsList.Click
        PanelTableauDeBords.Hide()
        TabControlHbergement.SelectedIndex = 4
        PanelEnregistrement.Show()
        PanelPlanning.Hide()
    End Sub

    Private Sub GunaAdvenceButtonPlanning_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonPlanning.Click

        firstCell = True
        secondCell = True

        GunaDateTimePickerPlanningDebut.Value = GlobalVariable.DateDeTravail.ToShortDateString
        GunaDateTimePickerPlanningFin.Value = GlobalVariable.DateDeTravail.AddDays(15).ToShortDateString

        PanelPlanning.Show()
        PanelPlanning.BringToFront()

        planningReservation(GunaDateTimePickerPlanningDebut.Value, GunaDateTimePickerPlanningFin.Value)

        'gestionDuPlanning()

    End Sub

    '----------------------------------------------------------------------------------------------------------------------


    Private Sub MagasinToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem91.Click
        MAgasinForm.Show()
    End Sub


    '----------------------------SERVICES D'ETAGES -----------------------------------------------------------------

    '------------------------------------------- FILL OF FORM FOR RESERVATION ------------------------------------------------------

    'PERSONNAL AUTOCOMPLETE OF ROOM TYPE

    Private Sub GunaTextBoxCodeType_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxCodeTypeDeChambre.TextChanged

        'Si code de chambre n'existe pas alors on efface toute les informations le concernant
        If Trim(GunaTextBoxCodeTypeDeChambre.Text).Equals("") Then
            'On desactive les informations liéa à la chambre tant que le type de chambre n'est pas rempli
            GunaTextBoxNumeroChambre.Enabled = False
            GunaButtonRoomSearchButton.Enabled = False

            GunaTextBoxLibelleTYpe.Clear()
            GunaTextBoxpPrixAffiche.Text = 0
            GunaTextBoxMontantAccorde.Text = 0
            GunaTextBoxprixRepas.Text = 0
            GunaTextBoxServiceEtProduitSup.Text = 0
            'GunaTextBoxCapacite.Clear()
            'GunaTextBoxSuperficie.Clear()

            If Not GunaCheckBoxGratuitee.Checked Then
                GunaComboBoxCodeTarif.Visible = False
                GunaLabelCodeTarif.Visible = False
            End If

            If GlobalVariable.typeChambreOuSalle = "salle" Then
                GunaTextBoxSuperficie.Clear()
                GunaTextBoxCapacite.Clear()

                GunaTextBoxNbrePersonne.Text = 0
                GunaTextBoxMontantAfficherSalle.Text = 0
                GunaTextBoxDecoration.Text = 0
                GunaTextBoxMontantReelSalle.Text = 0

            End If

            GunaTextBoxNumeroChambre.Clear()
            GunaTextBoxLibelleChambre.Clear()

            GunaDataGridViewRoom.Visible = False

            GunaButtonReservation.Visible = False
            GunaButtonCheckIn.Visible = False
            GunaButtonCheckOut.Visible = False

        Else
            'On active les informations lié à la chambre car le type de chambre est rempli
            GunaTextBoxNumeroChambre.Enabled = True
            GunaButtonRoomSearchButton.Enabled = True
        End If

        GunaDataGridViewRoomType.Visible = True

        Dim query As String = "SELECT CODE_TYPE_CHAMBRE, LIBELLE_TYPE_CHAMBRE , PRIX From type_chambre WHERE CODE_TYPE_CHAMBRE Like '%" & Trim(GunaTextBoxCodeTypeDeChambre.Text) & "%' AND CODE_AGENCE=@CODE_AGENCE AND TYPE=@TYPE"
        Dim command As New MySqlCommand(query, GlobalVariable.connect)

        command.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()

        adapter.Fill(table)

        If (table.Rows.Count > 0) Then
            GunaDataGridViewRoomType.DataSource = table
        Else
            GunaDataGridViewRoomType.Columns.Clear()
            GunaDataGridViewRoomType.Visible = False
        End If

        If GunaTextBoxCodeTypeDeChambre.Text.Trim().Equals("") Then
            GunaDataGridViewRoomType.Columns.Clear()
            GunaDataGridViewRoomType.Visible = False
        End If

        'connect.closeConnection()

    End Sub

    'Filling the other fields concerning the room type when the click on the cusom Datagrid - Filling of room type at front desk
    Private Sub GunaDataGridViewRoomType_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewRoomType.CellClick

        GunaDataGridViewRoom.Visible = False

        If e.RowIndex >= 0 Then

            GunaTextBoxNumeroChambre.Clear()

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewRoomType.Rows(e.RowIndex)

            GunaTextBoxLibelleTYpe.Text = row.Cells("LIBELLE_TYPE_CHAMBRE").Value.ToString
            GunaTextBoxCodeTypeDeChambre.Text = row.Cells("CODE_TYPE_CHAMBRE").Value.ToString

            Dim TypeChambre As DataTable = Functions.getElementByCode(Trim(GunaTextBoxCodeTypeDeChambre.Text), "type_chambre", "CODE_TYPE_CHAMBRE")

            If TypeChambre.Rows.Count > 0 Then


                If GunaRadioButtonChambre.Checked Then

                    Dim prix As Double = 0
                    Double.TryParse(TypeChambre.Rows(0)("PRIX"), prix)
                    GunaTextBoxpPrixAffiche.Text = Format(prix, "#,##0")

                    'LE PRIX PAR DEFAUT NE DOIT PAS CHANGER LE PRIX DE LA CHAMBRE SI LA GRATUITEE EST ACTIVEE

                    If GunaCheckBoxGratuitee.Checked Then
                        If GunaCheckBoxGratuiteInfo.Checked Then
                            If Not Trim(GunaTextBoxAuthoriseePar.Text).Equals("") Then
                                prix = 0
                            End If
                        End If
                    End If

                    GunaTextBoxMontantAccorde.Text = Format(prix, "#,##0")

                ElseIf GunaRadioButtonSalleFete.Checked Then

                    Dim prix As Double = 0
                    Dim superficie As Double = 0
                    Dim capacite As Double = 0
                    Double.TryParse(TypeChambre.Rows(0)("PRIX"), prix)
                    Double.TryParse(TypeChambre.Rows(0)("SUPERFICIE"), superficie)
                    Double.TryParse(TypeChambre.Rows(0)("CAPACITE"), capacite)
                    GunaTextBoxMontantAfficherSalle.Text = Format(prix, "#,##0")

                    If GunaCheckBoxGratuitee.Checked Then
                        If GunaCheckBoxGratuiteInfo.Checked Then
                            If Not Trim(GunaTextBoxAuthoriseePar.Text).Equals("") Then
                                prix = 0
                            End If
                        End If
                    End If

                    GunaTextBoxMontantReelSalle.Text = Format(prix, "#,##0")
                    GunaTextBoxSuperficie.Text = Format(superficie, "#,##0")
                    GunaTextBoxCapacite.Text = Format(capacite, "#,##0")

                    Dim montant As Double = 0

                    Double.TryParse(GunaTextBoxMontantReelSalle.Text.Trim(), montant)

                    If GunaCheckBoxDayUse.Checked Then
                        GunaTextBoxGrandTotal.Text = Format(montant, "#,##0")
                    Else
                        GunaTextBoxGrandTotal.Text = Format(montant * CType(GunaTextBoxTempsAFaire.Text, Int32), "#,##0")
                    End If


                End If

                GunaDataGridViewRoomType.Visible = False

                'We make sure it is possible to Choose a room if a room type is choosen first
                'We set back the diasbled values after checkin or save
                GunaTextBoxNumeroChambre.BaseColor = Color.White
                GunaTextBoxNumeroChambre.Enabled = True

                'connect.closeConnection()

                reservationButtonToDisplay()

            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Bien vouloir choisir une catégorie", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Else
                    MessageBox.Show("Please select a categorie", "Reservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If

            End If


        End If


    End Sub

    'AFFECTATION DES TARIFICATIONS DYNAMIQUE

    Public Sub determinonsSiOnDoitAfficherLedropDownDesTarifsAssocieAUnTypeDeChambre(ByVal CODE_TYPE_CHAMBRE As String)

        'ON PRENDS LA TARIFICATION AFFECTE CORRESPONDANT AUX TYPE DE CHAMBRE

        Dim existQuerytarif As String = "SELECT * From tarif_prix, tarification_dynamique WHERE CODE_TYPE=@CODE_TYPE_CHAMBRE AND tarif_prix.CODE_TARIF_DYNAMIQUE = tarification_dynamique.CODE_TARIF_DYNAMIQUE AND tarification_dynamique.ETAT=@ETAT ORDER BY LIBELLE_TARIF ASC"

        Dim commandtarif As New MySqlCommand(existQuerytarif, GlobalVariable.connect)
        Dim ETAT As Integer = 1

        commandtarif.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = CODE_TYPE_CHAMBRE
        commandtarif.Parameters.Add("@ETAT", MySqlDbType.Int64).Value = ETAT

        Dim adaptertarif As New MySqlDataAdapter(commandtarif)
        Dim tarif As New DataTable()

        adaptertarif.Fill(tarif)

        If tarif.Rows.Count > 0 Then

            GunaComboBoxCodeTarif.DataSource = tarif
            GunaComboBoxCodeTarif.ValueMember = "CODE_TARIF"
            GunaComboBoxCodeTarif.DisplayMember = "LIBELLE_TARIF"

            GunaComboBoxCodeTarif.Visible = True
            GunaLabelCodeTarif.Visible = True

            GunaComboBoxCodeTarif.Enabled = True

        Else

            'DONC ON SE REPOSE SUR LES PRIX AFFICHE
            GunaComboBoxCodeTarif.Visible = False
            GunaLabelCodeTarif.Visible = False

            GunaComboBoxCodeTarif.Enabled = False

        End If

    End Sub

    Public Sub determinationDesTarifsAssocieAUnTypeDeChambre(ByVal CODE_TYPE_CHAMBRE As String)

        determinonsSiOnDoitAfficherLedropDownDesTarifsAssocieAUnTypeDeChambre(CODE_TYPE_CHAMBRE)

        'DETERMINONS LE PRIX DE DEPART A PARTIR DE LA TARIFICATION
        Dim tarifDynamique As New Tarifs

        Dim DateDebut As Date = CDate(GlobalVariable.DateDeTravail).ToShortDateString
        Dim CODE_TARIF_RESERVATION As String = ""

        'If tarif.Rows.Count > 0 Then

        If GunaComboBoxCodeTarif.SelectedIndex >= 0 Then

            If GunaComboBoxCodeTarif.Visible Then
                CODE_TARIF_RESERVATION = GunaComboBoxCodeTarif.SelectedValue.ToString()
            End If

        End If

        Dim DateArrivee As Date = GunaDateTimePickerArrivee.Value.ToShortDateString
        Dim DateDepart As Date = GunaDateTimePickerDepart.Value.ToShortDateString

        Dim MONTANT As Double = 0

        MONTANT = tarifDynamique.determinationDuMontantDeDepartPourlaReservation(DateDebut, CODE_TARIF_RESERVATION, DateArrivee, DateDepart, CODE_TYPE_CHAMBRE)

        If MONTANT > 0 Then
            GunaTextBoxMontantAccorde.Text = Format(MONTANT, "#,##0")
        Else
            GunaTextBoxMontantAccorde.Text = Format(0, "#,##0")
        End If

    End Sub

    'PERSONNAL AUTOCOMPLETE OF ROOM
    Private Sub GunaTextBoxNumeroChambre_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNumeroChambre.TextChanged

        'Si code de chambre n'existe pas alors on efface toute les informations le concernant
        If Trim(GunaTextBoxNumeroChambre.Text).Equals("") Then
            GunaTextBoxLibelleChambre.Clear()
            GunaDataGridViewRoom.Visible = False
        End If

        Dim roomStatus As String = ""

        GunaDataGridViewRoom.Visible = True

        Dim roomStatus1 As String = "Libre propre"
        Dim roomStatus2 As String = "Libre sale"
        Dim roomStatus3 As String = "Occupée propre"
        Dim roomStatus4 As String = "Occupée sale"
        Dim roomStatus5 As String = "Hors Service"

        If GlobalVariable.actualLanguageValue = 0 Then
            roomStatus1 = "Free clean"
            roomStatus2 = "Free dirty"
            roomStatus3 = "Occupied clean"
            roomStatus4 = "Occupied dirty"
            roomStatus5 = "Out of service"
        End If

        If True Then

            'We select all the rooms that are not occupied
            'Dim query As String = "SELECT CODE_CHAMBRE, ETAT_CHAMBRE_NOTE, LIBELLE_CHAMBRE From chambre WHERE ETAT_CHAMBRE = 0 AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & Trim(GunaTextBoxNumeroChambre.Text) & "%' AND TYPE=@TYPE AND ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE OR ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE2 AND TYPE=@TYPE AND ETAT_CHAMBRE = 0 AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & Trim(GunaTextBoxNumeroChambre.Text) & "%' ORDER BY CODE_CHAMBRE ASC"
            Dim query As String = "SELECT CODE_CHAMBRE, ETAT_CHAMBRE_NOTE, LIBELLE_CHAMBRE From chambre WHERE ETAT_CHAMBRE = 0 AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & Trim(GunaTextBoxNumeroChambre.Text) & "%' AND TYPE=@TYPE AND ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE ORDER BY CODE_CHAMBRE ASC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            'command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"

            command.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(GunaTextBoxCodeTypeDeChambre.Text)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = roomStatus1
            'command.Parameters.Add("@ETAT_CHAMBRE_NOTE2", MySqlDbType.VarChar).Value = "Libre sale"
            command.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()

            adapter.Fill(table)

            '------------------------------------------------------------------------------------------------------------------------------------------------------------

            'We select the rooms that are found in reservation
            'Dim query1 As String = "SELECT CODE_CHAMBRE, ETAT_CHAMBRE_NOTE, LIBELLE_CHAMBRE From chambre, reservation WHERE DATE_ENTTRE >= @DATE_SORTIE AND ETAT_CHAMBRE = 0 AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND  chambre.CODE_CHAMBRE=reservation.CHAMBRE_ID AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & Trim(GunaTextBoxNumeroChambre.Text) & "%' AND ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"
            Dim query1 As String = "SELECT CODE_CHAMBRE, ETAT_CHAMBRE_NOTE, LIBELLE_CHAMBRE From chambre, reservation WHERE DATE_ENTTRE >= @DATE_SORTIE AND ETAT_CHAMBRE = 0 AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND  chambre.CODE_CHAMBRE=reservation.CHAMBRE_ID AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & Trim(GunaTextBoxNumeroChambre.Text) & "%' AND ETAT_CHAMBRE_NOTE IN ('Occupée propre','Occupée sale') AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"

            'OR DATE_SORTIE <= @DATE_ENTREE
            Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
            'command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"

            command1.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(GunaTextBoxCodeTypeDeChambre.Text)
            command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            'command1.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Occupée propre"
            'command1.Parameters.Add("@ETAT_CHAMBRE_NOTE2", MySqlDbType.VarChar).Value = "Occupée sale"
            command1.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence
            command1.Parameters.Add("@DATE_SORTIE", MySqlDbType.Date).Value = GunaDateTimePickerDepart.Value.ToShortDateString
            command1.Parameters.Add("@DATE_ENTREE", MySqlDbType.Date).Value = GunaDateTimePickerArrivee.Value.ToShortDateString

            Dim adapter1 As New MySqlDataAdapter(command1)
            Dim table1 As New DataTable()

            adapter1.Fill(table1)

            If Not table1.Rows.Count > 0 Then

                Dim DateEntree As Date = GunaDateTimePickerArrivee.Value.ToShortDateString

                'We select the rooms that are found in reserve_conf
                Dim query2 As String = "SELECT CODE_CHAMBRE, LIBELLE_CHAMBRE, ETAT_CHAMBRE_NOTE From chambre, reserve_conf WHERE reserve_conf.CHAMBRE_ID = chambre.CODE_CHAMBRE AND ETAT_RESERVATION = 1 AND " & DateEntree.ToString("yyyy-MM-dd") & " >= DATE_SORTIE  AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE '%" & GunaTextBoxNumeroChambre.Text & "%' AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"

                Dim command2 As New MySqlCommand(query2, GlobalVariable.connect)
                'command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"

                command2.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(GunaTextBoxCodeTypeDeChambre.Text)
                command2.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
                command2.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence
                'command2.Parameters.Add("@DATE_ENTREE", MySqlDbType.Date).Value = 

                Dim adapter2 As New MySqlDataAdapter(command2)
                Dim table2 As New DataTable()

                'We don't have a room in reservation so we search into reserve_conf
                If table2.Rows.Count > 0 Then
                    table.Merge(table2)
                End If

            Else
                table.Merge(table1)
            End If

            GunaDataGridViewRoom.DataSource = table

            If (table.Rows.Count > 0) Then
                GunaDataGridViewRoom.Visible = True
                GunaDataGridViewRoom.DataSource = table
            Else
                GunaDataGridViewRoom.Columns.Clear()
                GunaDataGridViewRoom.Visible = False
            End If

            If Trim(GunaTextBoxNumeroChambre.Text).Equals("") Then
                GunaDataGridViewRoom.Visible = False
            End If

        Else

            'We select all the rooms that are not occupied
            Dim query As String = "SELECT CODE_CHAMBRE, ETAT_CHAMBRE_NOTE, LIBELLE_CHAMBRE From chambre WHERE ETAT_CHAMBRE = 0 AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & Trim(GunaTextBoxNumeroChambre.Text) & "%' AND TYPE=@TYPE AND ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE OR ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE2 AND TYPE=@TYPE AND ETAT_CHAMBRE = 0 AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & Trim(GunaTextBoxNumeroChambre.Text) & "%' ORDER BY CODE_CHAMBRE ASC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            'command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"

            command.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(GunaTextBoxCodeTypeDeChambre.Text)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = roomStatus1
            command.Parameters.Add("@ETAT_CHAMBRE_NOTE2", MySqlDbType.VarChar).Value = roomStatus2
            command.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()

            adapter.Fill(table)

            '------------------------------------------------------------------------------------------------------------------------------------------------------------

            'We select the rooms that are found in reservation
            'Dim query1 As String = "Select CODE_CHAMBRE,LIBELLE_CHAMBRE, ETAT_CHAMBRE_NOTE From chambre INNER JOIN reservation WHERE reservation.CHAMBRE_ID = chambre.CODE_CHAMBRE AND ETAT_RESERVATION = 0 AND DATE_SORTIE < @DATE_ENTREE AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & GunaTextBoxNumeroChambre.Text & "%' AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"
            Dim query1 As String = "SELECT CODE_CHAMBRE, ETAT_CHAMBRE_NOTE, LIBELLE_CHAMBRE From chambre, reservation WHERE DATE_ENTTRE >= @DATE_SORTIE AND ETAT_CHAMBRE = 0 AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND  chambre.CODE_CHAMBRE=reservation.CHAMBRE_ID AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & Trim(GunaTextBoxNumeroChambre.Text) & "%' AND ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"

            'OR DATE_SORTIE <= @DATE_ENTREE
            Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
            'command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"

            command1.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(GunaTextBoxCodeTypeDeChambre.Text)
            command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            command1.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = roomStatus3
            command1.Parameters.Add("@ETAT_CHAMBRE_NOTE2", MySqlDbType.VarChar).Value = roomStatus4
            command1.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence
            command1.Parameters.Add("@DATE_SORTIE", MySqlDbType.Date).Value = GunaDateTimePickerDepart.Value.ToShortDateString
            command1.Parameters.Add("@DATE_ENTREE", MySqlDbType.Date).Value = GunaDateTimePickerArrivee.Value.ToShortDateString

            Dim adapter1 As New MySqlDataAdapter(command1)
            Dim table1 As New DataTable()

            adapter1.Fill(table1)

            If Not table1.Rows.Count > 0 Then

                Dim DateEntree As Date = GunaDateTimePickerArrivee.Value.ToShortDateString

                'We select the rooms that are found in reserve_conf
                Dim query2 As String = "SELECT CODE_CHAMBRE, LIBELLE_CHAMBRE, ETAT_CHAMBRE_NOTE From chambre, reserve_conf WHERE reserve_conf.CHAMBRE_ID = chambre.CODE_CHAMBRE AND ETAT_RESERVATION = 1 AND " & DateEntree.ToString("yyyy-MM-dd") & " >= DATE_SORTIE  AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE '%" & GunaTextBoxNumeroChambre.Text & "%' AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"

                Dim command2 As New MySqlCommand(query2, GlobalVariable.connect)
                'command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"

                command2.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(GunaTextBoxCodeTypeDeChambre.Text)
                command2.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
                command2.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence
                'command2.Parameters.Add("@DATE_ENTREE", MySqlDbType.Date).Value = 

                Dim adapter2 As New MySqlDataAdapter(command2)
                Dim table2 As New DataTable()

                'We don't have a room in reservation so we search into reserve_conf
                If table2.Rows.Count > 0 Then
                    table.Merge(table2)
                End If

            Else
                table.Merge(table1)
            End If

            GunaDataGridViewRoom.DataSource = table

            If (table.Rows.Count > 0) Then
                GunaDataGridViewRoom.Visible = True
                GunaDataGridViewRoom.DataSource = table
            Else
                GunaDataGridViewRoom.Columns.Clear()
                GunaDataGridViewRoom.Visible = False
            End If

            If Trim(GunaTextBoxNumeroChambre.Text).Equals("") Then
                GunaDataGridViewRoom.Visible = False
            End If

        End If

    End Sub

    'Refresh Room information
    Sub refreshChambre()

        Dim Query As String = "SELECT * From chambre WHERE ETAT_CHAMBRE=@ETAT_CHAMBRE AND TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"
        Dim command As New MySqlCommand(Query, GlobalVariable.connect)
        command.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim table As New DataTable
        Dim adapter As New MySqlDataAdapter(command)
        adapter.Fill(table)

        Dim col As New AutoCompleteStringCollection
        Dim i As Integer

        For i = 0 To table.Rows.Count - 1
            col.Add(table.Rows(i)("CODE_CHAMBRE").ToString())
        Next

        'connect.closeConnection()

        'We display buttons
        reservationButtonToDisplay()

    End Sub

    'Filling the other fields concerning the room when the value of th room changes
    Private Sub GunaDataGridViewRoom_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewRoom.CellClick

        GunaDataGridViewRoom.Visible = False

        If e.RowIndex >= 0 Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewRoom.Rows(e.RowIndex)

            Dim query As String = "SELECT * FROM chambre INNER JOIN type_chambre WHERE chambre.CODE_TYPE_CHAMBRE = type_chambre.CODE_TYPE_CHAMBRE AND CODE_CHAMBRE=@CODE_CHAMBRE AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"
            Dim adapter As New MySqlDataAdapter
            Dim table As New DataTable
            Dim command As New MySqlCommand(query, GlobalVariable.connect)

            command.Parameters.Add("@CODE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(row.Cells("CODE_CHAMBRE").Value.ToString)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

            adapter.SelectCommand = command
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                Dim chambreId As Integer = 0
                Integer.TryParse(table.Rows(0)("ID_CHAMBRE"), chambreId)
                GlobalVariable.idChambre = chambreId
                GlobalVariable.codeChambre = row.Cells("CODE_CHAMBRE").Value.ToString
                GunaTextBoxNumeroChambre.Text = row.Cells("CODE_CHAMBRE").Value.ToString
                GunaTextBoxLibelleChambre.Text = table.Rows(0)("LOCALISATION").ToString
                'Dim superficie As Double
                'Double.TryParse()
                GunaTextBoxSuperficie.Text = table.Rows(0)("SUPERFICIE")
                GunaTextBoxCapacite.Text = table.Rows(0)("CAPACITE")

                GunaDataGridViewRoom.Visible = False

            Else

                GunaTextBoxSuperficie.Clear()
                GunaTextBoxLibelleTYpe.Clear()
                GunaTextBoxNumeroChambre.Clear()
                GunaTextBoxLibelleChambre.Clear()
                GunaTextBoxpPrixAffiche.Text = 0
                GunaTextBoxCodeTypeDeChambre.Clear()
                GunaTextBoxMontantAccorde.Text = 0
                GunaTextBoxprixRepas.Text = 0
                GunaTextBoxServiceEtProduitSup.Text = 0

            End If

            'connect.closeConnection()

        End If

    End Sub

    'We empty all the filed of the form after registration

    Private Sub emtptyRegistrationFields()

        'Refreshing the database of the rooms to select
        refreshChambre()

        '---------------------- Room field -----------------------
        GunaTextBoxLibelleChambre.Text = ""
        GunaTextBoxCodeTypeDeChambre.Text = ""
        GunaTextBoxLibelleTYpe.Text = ""
        GunaTextBoxNumeroChambre.Text = ""

        '----------------------periode field
        GunaTextBoxTempsAFaire.Text = 0

        GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail

        '---------------- calculation field
        GunaTextBoxpPrixAffiche.Text = 0
        GunaTextBoxMontantAccorde.Text = 0
        GunaTextBoxNbreAdulte.Text = 0
        GunaTextBoxNbreEnfant.Text = 0
        GunaTextBoxNbrePersonne.Text = 0


        GunaTextBoxPrixParNuitee.Text = 0
        GunaTextBoxNombreDeJourTotal.Text = 0
        GunaTextBoxprixRepas.Text = 0
        GunaTextBoxServiceEtProduitSup.Text = 0
        GunaTextBoxMontantARegler.Text = 0
        GunaTextBoxAvance.Text = 0
        GunaTextBoxMontantCaution.Text = 0

        GunaTextBoxPrixSejour.Text = 0

        GunaTextBoxTotal.Text = 0

        GunaTextBoxMontantARegler.Text = 0
        GunaLabelSolde.Text = 0

        '--------------------- Client field
        GunaTextBoxNomPrenom.Text = ""
        GunaTextBoxTelClient.Text = ""
        GunaTextBoxClientEmail.Text = ""
        GunaTextBoxCNI.Text = ""
        GunaTextBoxRefClient.Text = ""
        GunaTextBoxSiteWeb.Text = ""

        GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")

        'Routage
        GunaCheckBoxPetitDejRoutage.Checked = False
        GunaTextBoxPetitDejeunerRoutage.Visible = False
        GunaCheckBoxChambreRoutage.Checked = False
        GunaTextBoxPrixChambreRoutage.Visible = False


    End Sub

    'Affecting values to the field when coming from main_courante_reception to front office

    Dim mainCouranteJournaliere As New DataTable()

    Sub affectingValuesToFields()

        GlobalVariable.typeDeClientAFacturer = ""

        If GlobalVariable.actualLanguageValue = 0 Then

            If Trim(GlobalVariable.codeReservationToUpdate).Equals("") Then
                GunaButtonReservation.Text = "Booking"
            Else
                GunaButtonReservation.Text = "Save"
            End If

        Else

            If Trim(GlobalVariable.codeReservationToUpdate).Equals("") Then
                GunaButtonReservation.Text = "Réserver"
            Else

                GunaButtonReservation.Text = "Enregistrer"
                GunaRadioButtonWhatsAppNon.Checked = True

                GunaRadioButtonWhatsAppOui.Enabled = True

            End If

        End If

        Dim checkInDateEnabled As Boolean = True
        'GESTION DE L'EMPLACEMENT DE LA RESERVATION
        '----------------------periode field -------------------------
        Dim reservation As DataTable
        reservation = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

        If Not reservation.Rows.Count > 0 Then

            reservation = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")
            If Not reservation.Rows.Count > 0 Then
                reservation = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_temp", "CODE_RESERVATION")
            Else
                checkInDateEnabled = False
            End If

        End If

        Dim codeType As String = ""
        Dim roomType As DataTable

        If reservation.Rows.Count > 0 Then

            If mainCouranteJournaliere IsNot Nothing Then

                If mainCouranteJournaliere.Rows.Count > 0 Then

                    codeType = mainCouranteJournaliere.Rows(0)("TYPE_CHAMBRE")

                    'INFO SUPPLEMENTAIRE PAR APPORT AU TYPE DE CHAMBRE
                    roomType = Functions.getElementByCode(codeType, "type_chambre", "CODE_TYPE_CHAMBRE")

                    If roomType.Rows.Count > 0 Then

                        GunaTextBoxCodeTypeDeChambre.Text = roomType.Rows(0)("CODE_TYPE_CHAMBRE")
                        GunaTextBoxLibelleTYpe.Text = roomType.Rows(0)("LIBELLE_TYPE_CHAMBRE")

                    Else

                        GunaTextBoxCodeTypeDeChambre.Text = "-"
                        GunaTextBoxLibelleTYpe.Text = "-"

                    End If

                    '-----------------------------------------------------------------------------------------------------------------------
                    'On n'a le numéro de chambre alors seulement on pourra remplir les inforamtion de la chambre

                    'SI LE NUMERO DE CHAMBRE N'EST PAS VIDE

                    If Not Trim(GlobalVariable.codeChambreToUpdate).Equals("") Then
                        'SI LE NUMERO DE CHAMBRE N'EST PAS VIDE ET NE CONTIENT PAS DE TRAIT D'UNION
                        If Not Trim(GlobalVariable.codeChambreToUpdate).Equals("-") Then
                            'ON RECHERCHE LA CHAMBRE
                            Dim room As DataTable = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")
                            'SI ON TROUVE LA CHAMBRE
                            If room.Rows.Count > 0 Then
                                'ON AFFICHE SES INFORMATION
                                GunaTextBoxNumeroChambre.Text = room.Rows(0)("CODE_CHAMBRE").ToString
                                GunaTextBoxLibelleChambre.Text = room.Rows(0)("LOCALISATION").ToString
                                'GunaTextBoxLibelleChambre.Text = room.Rows(0)("LIBELLE_CHAMBRE")

                            Else

                                GunaTextBoxNumeroChambre.Text = ""
                                GunaTextBoxLibelleChambre.Text = ""
                                GunaTextBoxLibelleChambre.Text = ""

                            End If

                        Else

                            GunaTextBoxNumeroChambre.Text = ""
                            GunaTextBoxLibelleChambre.Text = ""
                            GunaTextBoxLibelleChambre.Text = ""

                        End If

                    Else

                        GunaTextBoxNumeroChambre.Text = ""
                        GunaTextBoxLibelleChambre.Text = ""
                        GunaTextBoxLibelleChambre.Text = ""

                    End If

                Else

                    'LA RESERVATION N'EST PAS ASSOCIE A UNE MAINCOURANTE

                    Dim CHAMBRE_CODE As String = reservation.Rows(0)("CHAMBRE_ID")
                    Dim chamabreInfo As DataTable = Functions.getElementByCode(CHAMBRE_CODE, "chambre", "CODE_CHAMBRE")

                    'MAI ASSOCIE A UNE CHAMBRE
                    If chamabreInfo.Rows.Count > 0 Then

                        '-------------------------------------------------------------------------------------------

                        codeType = chamabreInfo.Rows(0)("CODE_TYPE_CHAMBRE")

                        roomType = Functions.getElementByCode(codeType, "type_chambre", "CODE_TYPE_CHAMBRE")

                        If roomType.Rows.Count > 0 Then

                            GunaTextBoxCodeTypeDeChambre.Text = roomType.Rows(0)("CODE_TYPE_CHAMBRE")
                            GunaTextBoxLibelleTYpe.Text = roomType.Rows(0)("LIBELLE_TYPE_CHAMBRE")

                        Else

                            GunaTextBoxCodeTypeDeChambre.Text = "-"
                            GunaTextBoxLibelleTYpe.Text = "-"

                        End If
                        '-----------------------------------------------------------------------------------------------------------------------
                        'On n'a le numéro de chambre alors seulement on pourra remplir les inforamtion de la chambre

                        If Not Trim(GlobalVariable.codeChambreToUpdate).Equals("") Then
                            'SI LE NUMERO DE CHAMBRE N'EST PAS VIDE ET NE CONTIENT PAS DE TRAIT D'UNION
                            If Not Trim(GlobalVariable.codeChambreToUpdate).Equals("-") Then
                                'ON RECHERCHE LA CHAMBRE
                                Dim room As DataTable = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")
                                'SI ON TROUVE LA CHAMBRE
                                If room.Rows.Count > 0 Then
                                    'ON AFFICHE SES INFORMATION
                                    GunaTextBoxNumeroChambre.Text = room.Rows(0)("CODE_CHAMBRE").ToString
                                    GunaTextBoxLibelleChambre.Text = room.Rows(0)("LOCALISATION").ToString
                                    'GunaTextBoxLibelleChambre.Text = room.Rows(0)("LIBELLE_CHAMBRE")

                                Else

                                    GunaTextBoxNumeroChambre.Text = ""
                                    GunaTextBoxLibelleChambre.Text = ""
                                    GunaTextBoxLibelleChambre.Text = ""

                                End If

                            Else

                                GunaTextBoxNumeroChambre.Text = ""
                                GunaTextBoxLibelleChambre.Text = ""
                                GunaTextBoxLibelleChambre.Text = ""

                            End If

                        Else

                            GunaTextBoxNumeroChambre.Text = ""
                            GunaTextBoxLibelleChambre.Text = ""
                            GunaTextBoxLibelleChambre.Text = ""

                        End If
                        '-------------------------------------------------------------------------------------------

                        GunaTextBoxNumeroChambre.Text = GlobalVariable.codeChambreToUpdate
                        GunaTextBoxLibelleChambre.Text = chamabreInfo.Rows(0)("LOCALISATION").ToString
                        GunaTextBoxLibelleChambre.Text = chamabreInfo.Rows(0)("LIBELLE_CHAMBRE")

                        GunaDataGridViewRoomType.Visible = False

                    Else

                        'LA RESERVATION N'EST PAS ASSOCIE A UN NUMERO DE CHAMBRE 
                        'ON RECUPERE LE TYPE DE CHAMBRE DIRECTEMENT DANS LA RESA

                        roomType = Functions.getElementByCode(reservation.Rows(0)("TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                        If roomType.Rows.Count > 0 Then

                            GunaTextBoxCodeTypeDeChambre.Text = roomType.Rows(0)("CODE_TYPE_CHAMBRE")
                            GunaTextBoxLibelleTYpe.Text = roomType.Rows(0)("LIBELLE_TYPE_CHAMBRE")

                        Else

                            GunaTextBoxCodeTypeDeChambre.Text = "-"
                            GunaTextBoxLibelleTYpe.Text = "-"

                        End If

                    End If

                End If

            Else

                'LA RESERVATION N'EST PAS ASSOCIE A UNE MAINCOURANTE

                Dim CHAMBRE_CODE As String = reservation.Rows(0)("CHAMBRE_ID")
                Dim chamabreInfo As DataTable = Functions.getElementByCode(CHAMBRE_CODE, "chambre", "CODE_CHAMBRE")

                'MAI ASSOCIE A UNE CHAMBRE
                If chamabreInfo.Rows.Count > 0 Then

                    '-------------------------------------------------------------------------------------------

                    codeType = chamabreInfo.Rows(0)("CODE_TYPE_CHAMBRE")

                    roomType = Functions.getElementByCode(codeType, "type_chambre", "CODE_TYPE_CHAMBRE")

                    If roomType.Rows.Count > 0 Then

                        GunaTextBoxCodeTypeDeChambre.Text = roomType.Rows(0)("CODE_TYPE_CHAMBRE")
                        GunaTextBoxLibelleTYpe.Text = roomType.Rows(0)("LIBELLE_TYPE_CHAMBRE")

                    Else

                        GunaTextBoxCodeTypeDeChambre.Text = "-"
                        GunaTextBoxLibelleTYpe.Text = "-"

                    End If
                    '-----------------------------------------------------------------------------------------------------------------------
                    'On n'a le numéro de chambre alors seulement on pourra remplir les inforamtion de la chambre

                    If Not Trim(GlobalVariable.codeChambreToUpdate).Equals("") Then
                        'SI LE NUMERO DE CHAMBRE N'EST PAS VIDE ET NE CONTIENT PAS DE TRAIT D'UNION
                        If Not Trim(GlobalVariable.codeChambreToUpdate).Equals("-") Then
                            'ON RECHERCHE LA CHAMBRE
                            Dim room As DataTable = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")
                            'SI ON TROUVE LA CHAMBRE
                            If room.Rows.Count > 0 Then
                                'ON AFFICHE SES INFORMATION
                                GunaTextBoxNumeroChambre.Text = room.Rows(0)("CODE_CHAMBRE").ToString
                                GunaTextBoxLibelleChambre.Text = room.Rows(0)("LOCALISATION").ToString
                                'GunaTextBoxLibelleChambre.Text = room.Rows(0)("LIBELLE_CHAMBRE")

                            Else

                                GunaTextBoxNumeroChambre.Text = ""
                                GunaTextBoxLibelleChambre.Text = ""
                                GunaTextBoxLibelleChambre.Text = ""

                            End If

                        Else

                            GunaTextBoxNumeroChambre.Text = ""
                            GunaTextBoxLibelleChambre.Text = ""
                            GunaTextBoxLibelleChambre.Text = ""

                        End If

                    Else

                        GunaTextBoxNumeroChambre.Text = ""
                        GunaTextBoxLibelleChambre.Text = ""
                        GunaTextBoxLibelleChambre.Text = ""

                    End If
                    '-------------------------------------------------------------------------------------------

                    GunaTextBoxNumeroChambre.Text = GlobalVariable.codeChambreToUpdate
                    GunaTextBoxLibelleChambre.Text = chamabreInfo.Rows(0)("LOCALISATION").ToString
                    GunaTextBoxLibelleChambre.Text = chamabreInfo.Rows(0)("LIBELLE_CHAMBRE")

                    GunaDataGridViewRoomType.Visible = False

                Else

                    'LA RESERVATION N'EST PAS ASSOCIE A UN NUMERO DE CHAMBRE 
                    'ON RECUPERE LE TYPE DE CHAMBRE DIRECTEMENT DANS LA RESA

                    roomType = Functions.getElementByCode(reservation.Rows(0)("TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                    If roomType.Rows.Count > 0 Then

                        GunaTextBoxCodeTypeDeChambre.Text = roomType.Rows(0)("CODE_TYPE_CHAMBRE")
                        GunaTextBoxLibelleTYpe.Text = roomType.Rows(0)("LIBELLE_TYPE_CHAMBRE")

                    Else

                        GunaTextBoxCodeTypeDeChambre.Text = "-"
                        GunaTextBoxLibelleTYpe.Text = "-"

                    End If

                End If

            End If

        End If

        'emtptyRegistrationFields()

        '---------------- calculation field -----------------------------
        'Dim mainCouranteJournaliere As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")

        If GunaRadioButtonChambre.Checked Then

            If mainCouranteJournaliere IsNot Nothing Then

                If mainCouranteJournaliere.Rows.Count > 0 Then

                    If Trim(GlobalVariable.codeChambreToUpdate) = "-" Or Trim(GlobalVariable.codeChambreToUpdate) = "" Then

                        Dim CODE_TYPE_CHAMBRE As String = mainCouranteJournaliere.Rows(0)("TYPE_CHAMBRE")
                        roomType = Functions.getElementByCode(CODE_TYPE_CHAMBRE, "type_chambre", "CODE_TYPE_CHAMBRE")

                        If roomType.Rows.Count > 0 Then
                            GunaTextBoxpPrixAffiche.Text = Format(roomType.Rows(0)("PRIX"), "#,##0")
                            GunaTextBoxCodeTypeDeChambre.Text = roomType.Rows(0)("CODE_TYPE_CHAMBRE")
                            GunaTextBoxLibelleTYpe.Text = roomType.Rows(0)("LIBELLE_TYPE_CHAMBRE")
                        End If

                    Else

                        If roomType.Rows.Count > 0 Then
                            GunaTextBoxpPrixAffiche.Text = Format(roomType.Rows(0)("PRIX"), "#,##0")
                        End If

                    End If

                    GunaDataGridViewRoomType.Visible = False
                    GunaDataGridViewRoom.Visible = False

                    GunaTextBoxMontantAccorde.Text = Format(mainCouranteJournaliere.Rows(0)("MONTANT_ACCORDE"), "#,##0")

                    GunaTextBoxPrixParNuitee.Text = Format(GunaTextBoxMontantAccorde.Text, "#,##0")

                    Dim produitSup As Double = 0

                    produitSup = mainCouranteJournaliere.Rows(0)("SERVICES") + mainCouranteJournaliere.Rows(0)("SALON_DE_BEAUTE") + mainCouranteJournaliere.Rows(0)("BOUTIQE") + mainCouranteJournaliere.Rows(0)("CYBERCAFE") + mainCouranteJournaliere.Rows(0)("AUTRES") + mainCouranteJournaliere.Rows(0)("SPORTS") + mainCouranteJournaliere.Rows(0)("LOISIRS") + mainCouranteJournaliere.Rows(0)("KIOSQUE_A_JOURNAUX") + mainCouranteJournaliere.Rows(0)("BLANCHISSERIE")

                    'Prix des repas 'verifier la mise a jour des repas dans la maincourante

                    Dim consommationBarRestaurant As Double = mainCouranteJournaliere.Rows(0)("BAR_RESTAURANT")

                    If consommationBarRestaurant >= 0 Then
                        GunaTextBoxprixRepas.Text = Format(mainCouranteJournaliere.Rows(0)("BAR_RESTAURANT"), "#,##0")
                    Else
                        GunaTextBoxprixRepas.Text = Format(0, "#,##0")
                    End If


                    GunaTextBoxServiceEtProduitSup.Text = Format(produitSup, "#,##0")
                    GunaTextBoxMontantARegler.Text = 0

                    GunaTextBoxNombreDeJourTotal.Text = CType(GunaTextBoxTempsAFaire.Text, Int32)

                    Dim CODE_RESERVATION As String = mainCouranteJournaliere.Rows(0)("NUM_RESERVATION")

                    Dim taxe_sejour As DataTable = Functions.getElementByCode(CODE_RESERVATION, "taxe_sejour_collectee", "NUM_RESERVATION")

                    If taxe_sejour.Rows.Count > 0 Then

                        GunaCheckBoxTaxeSejour.Checked = True
                        GunaTextBoxTaxeSejour.Visible = True
                        GunaTextBoxTaxeSejour.Text = Format(taxe_sejour.Rows(0)("TAXE_SEJOUR_COLLECTEE"), "#,##0")

                    Else

                        GunaCheckBoxTaxeSejour.Checked = False
                        GunaTextBoxTaxeSejour.Visible = False

                    End If

                End If

            Else

                'POUR LES RESERVATIONS DUPLIQUE LA MAINCOURANTE N'EXISTE PAS
                Dim taxe_sejour As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "taxe_sejour_collectee", "NUM_RESERVATION")

                If taxe_sejour.Rows.Count > 0 Then

                    GunaCheckBoxTaxeSejour.Checked = True
                    GunaTextBoxTaxeSejour.Visible = True
                    GunaTextBoxTaxeSejour.Text = Format(taxe_sejour.Rows(0)("TAXE_SEJOUR_COLLECTEE"), "#,##0")

                Else
                    GunaCheckBoxTaxeSejour.Checked = False
                    GunaTextBoxTaxeSejour.Visible = False
                End If

            End If


        End If

        Dim TypeChambre As DataTable = Functions.getElementByCode(GunaTextBoxCodeTypeDeChambre.Text, "type_chambre", "CODE_TYPE_CHAMBRE")

        If GunaRadioButtonSalleFete.Checked Then

            If TypeChambre.Rows.Count > 0 Then

                GunaTextBoxMontantAfficherSalle.Text = Format(TypeChambre.Rows(0)("PRIX"), "#,##0")
                GunaTextBoxMontantReelSalle.Text = Format(CType(reservation.Rows(0)("MONTANT_ACCORDE"), Double), "#,##0")

            End If

        End If

        GunaCheckBoxDayUse.Checked = False
        GunaCheckBoxMensuel.Checked = False

        Dim NB_PERSONNES As Integer = 0
        'In case the reservation is not found in reservation, it will be found in reserve_conf
        If reservation.Rows.Count > 0 Then

            Dim DAY_USE As Integer = Integer.Parse(reservation.Rows(0)("DAY_USE"))

            If DAY_USE = 1 Then
                GunaCheckBoxDayUse.Checked = True
            End If

            Dim MENSUEL As Integer = Integer.Parse(reservation.Rows(0)("MENSUEL"))

            If MENSUEL = 1 Then
                GunaCheckBoxMensuel.Checked = True
            End If

            NB_PERSONNES = CType(reservation.Rows(0)("NB_PERSONNES"), Int32)

            If Trim(reservation.Rows(0)("AFFICHER_PRIX")) = 1 Then
                GunaCheckBoxAfficherPrix.Checked = True
            ElseIf Trim(reservation.Rows(0)("AFFICHER_PRIX")) = 0 Then
                GunaCheckBoxAfficherPrix.Checked = False
            End If

            GunaTextBoxTempsAFaire.Visible = True

            GunaTextBoxTempsAFaire.Text = 0

            If GunaRadioButtonChambre.Checked Then

                GunaTextBoxNbreAdulte.Text = CType(reservation.Rows(0)("ADULTES"), Int32)
                GunaTextBoxNbreEnfant.Text = CType(reservation.Rows(0)("ENFANTS"), Int32)
                GunaTextBoxNbrePersonne.Text = CType(reservation.Rows(0)("NB_PERSONNES"), Int32)

                GunaTextBoxDepotDeGarantie.Text = Format(reservation.Rows(0)("DEPOT_DE_GARANTIE"), "#,##0")

            End If

            If GunaRadioButtonSalleFete.Checked Then

                montanTotalDeLocationSalle(CType(GunaTextBoxTempsAFaire.Text, Int32))

                GunaTextBoxNbrePersonne.Text = CType(reservation.Rows(0)("NB_PERSONNES"), Int32)
                'Gestion des forfaits

                GunaTextBoxDepotDeGarantie.Text = Format(reservation.Rows(0)("DEPOT_DE_GARANTIE"), "#,##0")

            End If

        End If

        If reservation.Rows.Count > 0 Then


            If (CDate(reservation.Rows(0)("DATE_ENTTRE")).ToShortDateString = CDate(reservation.Rows(0)("DATE_SORTIE")).ToShortDateString) Then

                Dim numberOfHoursToSpend As Integer = 0
                'numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)
                'numberOfHoursToSpend = CType((CDate(reservation.Rows(0)("HEURE_SORTIE")) - CDate(reservation.Rows(0)("HEURE_ENTREE"))).TotalHours, Int32)

                '--------------------------------------------------------------------------------------------------------------------------------------------------------

                Dim DateTimeArriveeStringFormat As String = CDate(reservation.Rows(0)("HEURE_ENTREE"))

                Dim DateTimeDepartStringFormat As String = CDate(reservation.Rows(0)("HEURE_SORTIE"))

                'Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
                Dim DateTimeArrivee As DateTime = CDate(DateTimeArriveeStringFormat).ToLongTimeString
                'Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
                Dim DateTimeDepart As DateTime = CDate(DateTimeDepartStringFormat).ToLongTimeString

                GunaComboBoxHeureDepart.Items.Remove(GunaComboBoxHeureDepart.SelectedItem)
                GunaComboBoxHeureArrivee.Items.Remove(GunaComboBoxHeureArrivee.SelectedItem)

                GunaComboBoxHeureArrivee.Items.Add(CDate(DateTimeArriveeStringFormat).ToLongTimeString)
                GunaComboBoxHeureArrivee.SelectedItem = CDate(DateTimeArriveeStringFormat).ToLongTimeString

                GunaComboBoxHeureDepart.Items.Add(CDate(DateTimeDepartStringFormat).ToLongTimeString)
                GunaComboBoxHeureDepart.SelectedItem = CDate(DateTimeDepartStringFormat).ToLongTimeString

                numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

                If numberOfHoursToSpend > 0 Then
                    GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
                Else
                    GunaTextBoxTempsAFaire.Text = 0
                End If

                '--------------------------------------------------------------------------------------------------------------------------------------------------------

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaLabelTempsAFaire.Text = "Total heures"
                Else
                    GunaLabelTempsAFaire.Text = "Total hours"
                End If


            Else
                'GESTION DES NUITES

                GunaTextBoxTempsAFaire.Visible = True
                GunaTextBoxTempsAFaire.Text = CType((GunaDateTimePickerDepart.Value - GunaDateTimePickerArrivee.Value).TotalDays, Int32)

                'Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem
                Dim DateTimeArriveeStringFormat As String = reservation.Rows(0)("HEURE_ENTREE")

                'Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem
                Dim DateTimeDepartStringFormat As String = reservation.Rows(0)("HEURE_SORTIE")

                GunaComboBoxHeureDepart.Items.Remove(GunaComboBoxHeureDepart.SelectedItem)
                GunaComboBoxHeureArrivee.Items.Remove(GunaComboBoxHeureArrivee.SelectedItem)

                GunaComboBoxHeureArrivee.Items.Add(CDate(DateTimeArriveeStringFormat).ToLongTimeString)
                GunaComboBoxHeureArrivee.SelectedItem = CDate(DateTimeArriveeStringFormat).ToLongTimeString

                GunaComboBoxHeureDepart.Items.Add(CDate(DateTimeDepartStringFormat).ToLongTimeString)
                GunaComboBoxHeureDepart.SelectedItem = CDate(DateTimeDepartStringFormat).ToLongTimeString

                If GunaCheckBoxMensuel.Checked Then

                    If GlobalVariable.actualLanguageValue = 1 Then
                        GunaLabelTempsAFaire.Text = "Total jour(s)"
                    Else
                        GunaLabelTempsAFaire.Text = "Total day(s)"
                    End If

                Else

                    If GlobalVariable.actualLanguageValue = 1 Then
                        GunaLabelTempsAFaire.Text = "Total nuitées"
                    Else
                        GunaLabelTempsAFaire.Text = "Total nights"
                    End If

                End If

            End If

            GunaTextBoxMontantCaution.Text = Format(reservation.Rows(0)("MONTANT_TOTAL_CAUTION"), "#,##0")
            GunaTextBoxVenantDe.Text = reservation.Rows(0)("VENANT_DE")
            GlobalVariable.reserveConfCheckInState = reservation.Rows(0)("CHECKIN")

            GlobalVariable.reserveConfCheckOutState = reservation.Rows(0)("ETAT_RESERVATION")

            Dim reglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReglementToUpdate, "reglement", "NUM_REGLEMENT")

        End If

        Dim nombreDeJourTotal As Integer
        Dim montantAccorde As Double
        Dim prixParNuitee As Double
        Dim prixRepas As Double
        Dim Total As Double
        Dim ServiceEtProduitSup As Double
        Dim montantARegler As Double
        Dim avance As Double
        Dim caution As Double

        'The price to take into consideration

        If GunaRadioButtonChambre.Checked Then

            totalAReglerPourLeDuSejour()

        End If

        Double.TryParse(GunaTextBoxAvance.Text.Trim(), avance)
        Double.TryParse(GunaTextBoxMontantCaution.Text.Trim(), caution)

        '--------------------- Client field ----------------------------
        Dim client As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

        If Not client.Rows.Count > 0 Then
            'En cas d'existence d'une réservation sans nom de client 

            If Not GlobalVariable.ReservationToUpdate Is Nothing Then

                If GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                    client = Functions.getElementByCode(GlobalVariable.ReservationToUpdate.Rows(0)("NOM_CLIENT"), "client", "NOM_PRENOM")
                End If

            End If

        End If

        If client.Rows.Count > 0 Then

            GunaTextBoxNomPrenom.Text = client.Rows(0)("NOM_PRENOM")
            GunaTextBoxTelClient.Text = client.Rows(0)("TELEPHONE")
            GunaTextBoxClientEmail.Text = client.Rows(0)("EMAIL")
            GunaTextBoxCNI.Text = client.Rows(0)("CNI")
            'GunaTextBoxRefClient.Text = GlobalVariable.codeClientToUpdate
            GunaTextBoxRefClient.Text = client.Rows(0)("CODE_CLIENT")
            GunaTextBoxSiteWeb.Text = client.Rows(0)("SITE_INTERNET")
            'GunaTextBoxCodeDeGroupe.Text = client.Rows(0)("CODE_ENTREPRISE")
            GunaTextBoxNomJeuneFille.Text = client.Rows(0)("NOM_JEUNE_FILLE")
            GunaTextBoxTypeClient.Text = client.Rows(0)("TYPE_CLIENT")
            GunaDateTimePickerDateNaissance.Value = client.Rows(0)("DATE_DE_NAISSANCE")
            GunaTextBoxLieu.Text = client.Rows(0)("LIEU_DE_NAISSANCE")
            GunaTextBoxNationalite.Text = client.Rows(0)("NATIONALITE")
            GunaTextBoxPaysResidence.Text = client.Rows(0)("PAYS_RESIDENCE")
            GunaTextBoxProfession.Text = client.Rows(0)("PROFESSION")
            GunaTextBoxNumeroCompte.Text = client.Rows(0)("NUM_COMPTE")
            GunaTextBoxRue.Text = client.Rows(0)("ADRESSE")
            GunaTextBoxVilleDeResidence.Text = client.Rows(0)("VILLE_DE_RESIDENCE")
            GunaTextBoxModeTransport.Text = client.Rows(0)("MODE_TRANSPORT")
            GunaTextBoxNumVehicule.Text = client.Rows(0)("NUM_VEHICULE")

            If Trim(client.Rows(0)("CODE_ELITE")).Equals("") Then
                GunaLabelElite.Visible = False
                GunaTextBoxCodeElite.Visible = False
                GunaTextBoxCodeElite.Text = ""
            Else
                GunaLabelElite.Visible = True
                GunaTextBoxCodeElite.Visible = True
                GunaTextBoxCodeElite.Text = client.Rows(0)("CODE_ELITE")
            End If

            If Not Trim(GunaTextBoxRefClient.Text).Equals("") Then
                Dim CODE_CLIENT As String = GunaTextBoxRefClient.Text
                gestionDesComptesDebiteurLorsDesReservationsIndividu(CODE_CLIENT)
            End If

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                If Not GlobalVariable.ReservationToUpdate.Rows(0)("SOURCE_RESERVATION") = "" Then
                    GunaComboBoxSourceReservation.SelectedValue = GlobalVariable.ReservationToUpdate.Rows(0)("SOURCE_RESERVATION")
                End If

                Dim CODE_ENTREPRISE_COMPTE As String = GlobalVariable.ReservationToUpdate.Rows(0)("CODE_ENTREPRISE")

                If Not CODE_ENTREPRISE_COMPTE = "" Then

                    gestionDesComptesDebiteurLorsDesReservations(CODE_ENTREPRISE_COMPTE)

                End If

            End If

            Dim Entreprise As DataTable = Functions.getElementByCode(client.Rows(0)("CODE_ENTREPRISE"), "client", "CODE_CLIENT")

            If Entreprise.Rows.Count > 0 Then

                GunaTextBoxEntrepriseDuclient.Text = Trim(Entreprise.Rows(0)("NOM_PRENOM"))

                gestionDesComptesDebiteurLorsDesReservations(client.Rows(0)("CODE_ENTREPRISE"))

            End If

            GunaTextBoxVenantDe.Text = ""

            GunaTextBoxSerendantA.Text = ""

        Else

            'MessageBox.Show("Aucun client associé a cette réservation")

        End If



        'We display buttons
        reservationButtonToDisplay()

        'Hiding the datagrid
        GunaDataGridViewClient.Visible = False
        GunaDataGridViewRoom.Visible = False
        GunaDataGridViewPhone.Visible = False

        'Initialisation de la ville de depart
        GunaTextBoxSerendantA.Text = GlobalVariable.AgenceActuelle.Rows(0)("VILLE")

        'GESTION DE L'ENSEMBLE DES REGLEMENTS ET FACTURE D'UNE RESERVATION

        If Not GlobalVariable.codeReservationToUpdate = "" Then

            ListeDesFacturesEtReglementPourUneReservation() 'Ligne 1051

        End If

        'GESTION DES TAXES SEJOURS COLLECTE ET PETIE DEJEUNER

        'GESTION DELA RESERVATION DE GROUPE
        If Not GlobalVariable.codeReservationToUpdate = "" And GlobalVariable.typeChambreOuSalle = "chambre" Then

            'Notre réservation existe alors on controle si elle est associé a un groupe si oui on active le bouton de gestion des groupes
            If Not Trim(reservation.Rows(0)("GROUPE")) = "" Then
                GunaCheckBoxReservationDeGroupe.Checked = True
                GunaTextBoxCodeDeGroupe.Visible = True
                GunaTextBoxCodeDeGroupe.Text = reservation.Rows(0)("GROUPE")
            Else
                GunaCheckBoxReservationDeGroupe.Checked = False
            End If

            'GESTION DES ROUTAGES - INSTRUCTIONS DE ROUTAGE

            'ROUTAGE PETIT DEJEUNER
            If Not Trim(reservation.Rows(0)("PETIT_DEJEUNER_ROUTAGE")) = 0 Then
                GunaCheckBoxPetitDejRoutage.Checked = True
            Else
                GunaCheckBoxPetitDejRoutage.Checked = False
            End If

            'If reservation.Rows(0)("CHAMBRE_ROUTAGE") IsNot Nothing Then
            'reservation.Rows(0)("CHAMBRE_ROUTAGE") = ""
            'ElseIf reservation.Rows(0)("CHAMBRE_ROUTAGE") = DbNull.Value Then
            'reservation.Rows(0)("CHAMBRE_ROUTAGE") = ""
            'End If

            'ROUTAGE LOGEMENT
            If Not Trim(reservation.Rows(0)("CHAMBRE_ROUTAGE")) = "" Then
                GunaCheckBoxChambreRoutage.Checked = True
                GunaComboBoxChambreRoutage.SelectedValue = reservation.Rows(0)("CHAMBRE_ROUTAGE")
                GunaTextBoxPrixChambreRoutage.Visible = True
                GunaTextBoxPrixChambreRoutage.Text = Format(reservation.Rows(0)("MONTANT_ACCORDE"), "#,##0")
            Else
                GunaCheckBoxChambreRoutage.Checked = False
                GunaTextBoxPrixChambreRoutage.Visible = False
                GunaTextBoxPrixChambreRoutage.Clear()
            End If

        End If

        EtatDuBoutonDeGestionDesReservationDeGroupe()

        'GESTION DES DESTINATION ET PROVENANCE

        If reservation.Rows.Count > 0 Then

            If reservation.Rows(0)("VENANT_DE") IsNot Nothing Then
                'reservation.Rows(0)("VENANT_DE") = ""
            End If

            If reservation.Rows(0)("SE_RENDANT_A") IsNot Nothing Then
                '.Rows(0)("SE_RENDANT_A") = ""
            End If

            If reservation.Rows(0)("RAISON") IsNot Nothing Then
                'reservation.Rows(0)("RAISON") = ""
            End If

            If reservation.Rows(0)("TYPE") = "salle" Then
                GunaTextBoxNbrePersonne.Text = reservation.Rows(0)("NB_PERSONNES")
            End If

            'GESTION DU NOMBRE DE PETIT DEJEUNER INCLUS
            'If reservation.Rows(0)("PETIT_DEJEUNER") = 1 Then
            If reservation.Rows(0)("PETIT_DEJEUNER") >= 1 Then
                GunaCheckBoxPetitDejeuenerInclus.Checked = True
                'GunaTextBoxPetitDejeuner.Text = 1
                GunaTextBoxPetitDejeuner.Text = reservation.Rows(0)("PETIT_DEJEUNER")
                GunaTextBoxBreakFastCost.Text = reservation.Rows(0)("BFK_COST")
            Else
                GunaCheckBoxPetitDejeuenerInclus.Checked = False
                GunaTextBoxPetitDejeuner.Text = 0
                GunaTextBoxBreakFastCost.Text = 0
            End If

            GunaTextBoxVenantDe.Text = reservation.Rows(0)("VENANT_DE")
            montantAccorde = reservation.Rows(0)("MONTANT_ACCORDE")
            GunaTextBoxSerendantA.Text = reservation.Rows(0)("SE_RENDANT_A")
            GunaComboBoxTypeReservation.SelectedItem = reservation.Rows(0)("RAISON")
            GunaComboBoxSourceReservation.SelectedValue = reservation.Rows(0)("SOURCE_RESERVATION")

            'GESTION DES ENTREPRISE ASSOCIE A UN CLIENT
            GunaTextBoxEntrepriseDuclient.Text = reservation.Rows(0)("NOM_ENTREPRISE")
            GunaTextBoxCodeEntrepriseDuClient.Text = reservation.Rows(0)("CODE_ENTREPRISE")
            GunaTextBoxBC.Text = reservation.Rows(0)("BC_ENTREPRISE")
            GunaDataGridViewEntrepriseDuClient.Visible = False

            'GESTION DES TARIFS ASSOCIE A LA RESERVATION

            Dim CODE_ENTREPRISE As String = Trim(GunaTextBoxCodeEntrepriseDuClient.Text)
            Dim CODE_TYPE_CEHAMBRE As String = Trim(GunaTextBoxCodeTypeDeChambre.Text)

            'GESTION DES PRISE EN CHARGES
            Dim CODE_RESERVATION_PRISE_EN_CHARGE As String = reservation.Rows(0)("CODE_RESERVATION")

            gestionDelaPriseEnChargeDeLaReservation(GlobalVariable.codeReservationToUpdate)

            'GESTION DES GRATUITEES
            gestionDelaGratuiteeDeLaReservation(GlobalVariable.codeReservationToUpdate)

            'On recherche si l'entreprise associé au client a une tarification
            tarifToDisplay(CODE_ENTREPRISE, CODE_TYPE_CEHAMBRE)

            'GESTION DES NAVETTES
            gestionDesNavettes(2, GlobalVariable.codeReservationToUpdate)

            gestionDesComptesDebiteurLorsDesReservations(CODE_ENTREPRISE)

            ActivationOuDesactivationDeToutLesBoutonsApresUnCheckOUt()

            GunaTextBoxNbrePersonne.Text = NB_PERSONNES

            GunaTextBoxpPrixAffiche.Text = 0
            GunaTextBoxMontantAccorde.Text = 0


        End If

        'CAS OU LE PRIX DE LA CHAMBRE DE NE S'AFFICHE PAS PAR DEFAUT

        If Trim(GunaTextBoxpPrixAffiche.Text) = "" Or Trim(GunaTextBoxpPrixAffiche.Text) = "0" Then
            If Not Trim(GunaTextBoxCodeTypeDeChambre.Text) = "" Then
                Dim CODE_TYPE_CHAMBRE As String = GunaTextBoxCodeTypeDeChambre.Text
                Dim rePrixChambre As DataTable = Functions.getElementByCode(CODE_TYPE_CHAMBRE, "type_chambre", "CODE_TYPE_CHAMBRE")

                If rePrixChambre.Rows.Count > 0 Then

                    GunaTextBoxpPrixAffiche.Text = Format(rePrixChambre.Rows(0)("PRIX"), "#,##0")

                    Dim MONTANT_ACCORDE As Double = GlobalVariable.ReservationToUpdate.Rows(0)("MONTANT_ACCORDE")

                    If Double.Parse(GunaTextBoxpPrixAffiche.Text) = MONTANT_ACCORDE Then
                        GunaTextBoxMontantAccorde.Text = Format(rePrixChambre.Rows(0)("PRIX"), "#,##0")
                    Else
                        GunaTextBoxMontantAccorde.Text = Format(MONTANT_ACCORDE, "#,##0")
                    End If

                End If

            End If
        Else

        End If

        If reservation.Rows.Count > 0 Then

            montantAccorde = reservation.Rows(0)("MONTANT_ACCORDE")

            If Trim(GlobalVariable.codeReservationToUpdate) = "" Then
                GunaComboBoxHeureArrivee.Items.Clear()
                GunaComboBoxHeureArrivee.Items.Add(Now().ToLongTimeString)
                GunaComboBoxHeureArrivee.SelectedItem = Now().ToLongTimeString
            End If

            GunaDateTimePickerArrivee.Value = CDate(reservation.Rows(0)("DATE_ENTTRE")).ToShortDateString
            GunaDateTimePickerDepart.Value = CDate(reservation.Rows(0)("DATE_SORTIE")).ToShortDateString

            'GESTION DES AFFICHAGE DES DAY USE
            '--------------------------

            If GunaCheckBoxDayUse.Checked Then
                'The price to take into consideration
                Dim tempsAFaire = 1

                If Not Trim(GunaTextBoxTempsAFaire.Text) = "" Then
                    tempsAFaire = GunaTextBoxTempsAFaire.Text
                End If

                'GunaTextBoxMontantAccorde.Text = Format(montantAccorde / tempsAFaire, "#,##0")
                GunaTextBoxMontantAccorde.Text = Format(montantAccorde / tempsAFaire, "#,##0")

            End If

            suivieDesReservations(GlobalVariable.codeReservationToUpdate)

        Else

        End If

        'BLOQUER LA MODIFICATION DES PRIX SI ACTIVE

        If GlobalVariable.AgenceActuelle.Rows(0)("BLOQUER_PRIX_HEBERGEMENT") = 0 Then
            GunaTextBoxMontantAccorde.Enabled = True
        Else

            If GlobalVariable.ReservationToUpdate.Rows(0)("CHECKIN") = "OUI" Then

                If GlobalVariable.ReservationToUpdate.Rows(0)("ETAT_RESERVATION") = 1 Then
                    'PERMET DE NE PAS ACTIVER LE CHAMP MONTANT ACCORDE AU CAS OU ON TRAITE UN CHECKOUT

                    If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("CORRECTIONS") = 1 Then
                        GunaTextBoxMontantAccorde.Enabled = True
                    Else
                        GunaTextBoxMontantAccorde.Enabled = False
                    End If

                End If

            Else
                GunaTextBoxMontantAccorde.Enabled = True
            End If

        End If

        If Not checkInDateEnabled Then
            GunaDateTimePickerArrivee.Enabled = False
            GunaComboBoxHeureArrivee.Enabled = False
        End If

        If GunaCheckBoxMensuel.Checked Then
            GunaTextBoxTempsAFaire.Text = ((GunaDateTimePickerDepart.Value - GunaDateTimePickerArrivee.Value).TotalDays)
            GunaTextBoxPrixParNuitee.Text = Format(montantAccorde, "#,##0")
            GunaTextBoxPrixSejour.Text = Format(montantAccorde, "#,##0")
        End If

    End Sub

    Public Sub totalAReglerPourLeDuSejour()

        '-----------------------------------------------------------------------------------

        Dim nombreDeJourTotal As Integer
        Dim tempsAFaire As Integer
        Dim montantAccorde As Double
        Dim prixParNuitee As Double
        Dim prixRepas As Double
        Dim Total As Double
        Dim ServiceEtProduitSup As Double
        Dim montantARegler As Double
        Dim avance As Double
        Dim caution As Double

        'CALCUL DU MONTANT LIE AUX CHAMBRES 

        If GunaCheckBoxMensuel.Checked Then

            GunaTextBoxTempsAFaire.Text = ((GunaDateTimePickerDepart.Value - GunaDateTimePickerArrivee.Value).TotalDays)
            GunaTextBoxNombreDeJourTotal.Text = ((GunaDateTimePickerDepart.Value - GunaDateTimePickerArrivee.Value).TotalDays)
            GunaTextBoxPrixParNuitee.Text = GunaTextBoxMontantAccorde.Text
            GunaTextBoxPrixSejour.Text = GunaTextBoxMontantAccorde.Text

            GunaTextBoxTotal.Text = GunaTextBoxPrixSejour.Text
            If Trim(GunaTextBoxPrixSejour.Text).Equals("") Then
                GunaTextBoxPrixSejour.Text = 0
            End If
            Dim totalSejour As Double = GunaTextBoxPrixSejour.Text

            Double.TryParse(GunaTextBoxServiceEtProduitSup.Text.Trim(), ServiceEtProduitSup)
            GunaTextBoxMontantARegler.Text = Format(ServiceEtProduitSup + totalSejour, "#,##0")

        Else

            'Integer.TryParse(GunaTextBoxTempsSieste.Text, tempsAFaire)
            Integer.TryParse(GunaTextBoxTempsAFaire.Text, tempsAFaire)

            'GESTION DES NUITEES
            GunaTextBoxNombreDeJourTotal.Text = GunaTextBoxTempsAFaire.Text

            Integer.TryParse(GunaTextBoxNombreDeJourTotal.Text.Trim(""), nombreDeJourTotal)

            'The price to take into consideration
            If Not (Double.TryParse(GunaTextBoxMontantAccorde.Text.Trim(""), montantAccorde) = 0) Then
                prixParNuitee = Format(montantAccorde, "#,##0")
            Else

                Double.TryParse(GunaTextBoxpPrixAffiche.Text.Trim(), montantAccorde)
                prixParNuitee = Format(montantAccorde, "#,##0")
            End If

            GunaTextBoxPrixParNuitee.Text = Format(prixParNuitee, "#,##0")

            Double.TryParse(GunaTextBoxprixRepas.Text.Trim(), prixRepas)
            Double.TryParse(GunaTextBoxServiceEtProduitSup.Text.Trim(), ServiceEtProduitSup)
            Integer.TryParse(GunaTextBoxNombreDeJourTotal.Text.Trim(), nombreDeJourTotal)

            If tempsAFaire > 0 Then
                'GESTION DES NUITEES
                GunaTextBoxPrixSejour.Text = Format(montantAccorde * nombreDeJourTotal, "#,##0")
                'Total = (montantAccorde * nombreDeJourTotal) + prixRepas + ServiceEtProduitSup
                Total = (montantAccorde * nombreDeJourTotal)
            Else
                'GESTION DES SIESTES
                GunaTextBoxPrixSejour.Text = Format(montantAccorde, "#,##0")
                ' Total = (montantAccorde * nombreDeJourTotal) + prixRepas + ServiceEtProduitSup
                Total = (montantAccorde * nombreDeJourTotal)
            End If

            '-----------------------------------------------------------------------------------

            GunaTextBoxPrixParNuitee.Text = Format(prixParNuitee, "#,##0")

            If (GunaDateTimePickerDepart.Value = GunaDateTimePickerArrivee.Value) Then
                GunaTextBoxPrixSejour.Text = Format(montantAccorde, "#,##0")
                Total = (montantAccorde * nombreDeJourTotal)
            Else
                GunaTextBoxPrixSejour.Text = Format(montantAccorde * nombreDeJourTotal, "#,##0")
                Total = (montantAccorde * nombreDeJourTotal)
            End If

            Dim total_hebergement_prixRepas_Service As Double = Total + prixRepas + ServiceEtProduitSup

            GunaTextBoxTotal.Text = Format(Total, "#,##0")

            GunaTextBoxMontantARegler.Text = Format(total_hebergement_prixRepas_Service, "#,##0")

        End If

    End Sub

    Public Sub suivieDesReservations(ByVal CODE_RESERVATION As String)

        If True Then

            Dim infoSuiviResa As DataTable = Functions.getElementByCode(CODE_RESERVATION, "suivi_des_reservations", "CODE_RESERVATION")

            If infoSuiviResa.Rows.Count > 0 Then

                'ActivationForm.GunaTextBoxMessage.Text = 

                'RESERVATION

                Dim RESERVATION_PAR As String = infoSuiviResa.Rows(0)("RESERVATION_PAR")
                Dim infoUserResa As DataTable = Functions.getElementByCode(RESERVATION_PAR, "utilisateurs", "CODE_UTILISATEUR")

                If infoUserResa.Rows.Count > 0 Then

                    GunaLabelResa.Visible = True
                    GunaLabel155.Visible = True
                    GunaLabel155.Text = infoUserResa.Rows(0)("GRIFFE_UTILISATEUR")

                Else
                    GunaLabelResa.Visible = False
                    GunaLabel155.Visible = False
                End If

                Dim CHECKIN_PAR As String = infoSuiviResa.Rows(0)("CHECKIN_PAR")
                Dim infoUserCheckIn As DataTable = Functions.getElementByCode(CHECKIN_PAR, "utilisateurs", "CODE_UTILISATEUR")

                If infoUserCheckIn.Rows.Count > 0 Then

                    'CHECKIN
                    GunaLabel153.Visible = True

                    GunaLabel156.Visible = True
                    GunaLabel156.Text = infoUserCheckIn.Rows(0)("GRIFFE_UTILISATEUR")

                Else
                    GunaLabel153.Visible = False
                    GunaLabel156.Visible = False
                End If

                'CHECKOUT

                Dim CHECKOUT_PAR As String = infoSuiviResa.Rows(0)("CHECKOUT_PAR")
                Dim infoUserCheckOut As DataTable = Functions.getElementByCode(CHECKOUT_PAR, "utilisateurs", "CODE_UTILISATEUR")

                If infoUserCheckOut.Rows.Count > 0 Then

                    GunaLabel154.Visible = True

                    GunaLabel157.Visible = True
                    GunaLabel157.Text = infoUserCheckOut.Rows(0)("GRIFFE_UTILISATEUR")
                Else
                    GunaLabel154.Visible = False
                    GunaLabel157.Visible = False
                End If

                'DELOGEMENT
                Dim DELOGEMENT_PAR As String = infoSuiviResa.Rows(0)("DELOGEMENT_PAR")
                Dim infoUserdelogement As DataTable = Functions.getElementByCode(DELOGEMENT_PAR, "utilisateurs", "CODE_UTILISATEUR")

                If infoUserdelogement.Rows.Count > 0 Then

                    GunaLabel158.Visible = True

                    GunaLabel159.Visible = True
                    GunaLabel159.Text = infoUserdelogement.Rows(0)("GRIFFE_UTILISATEUR")

                Else
                    GunaLabel158.Visible = False
                    GunaLabel159.Visible = False
                End If

                'ANNULATION
                Dim ANNULER_PAR As String = infoSuiviResa.Rows(0)("ANNULER_PAR")
                Dim infoUserAnnulation As DataTable = Functions.getElementByCode(ANNULER_PAR, "utilisateurs", "CODE_UTILISATEUR")

                If infoUserAnnulation.Rows.Count > 0 Then

                    GunaLabel160.Visible = True

                    GunaLabel161.Visible = True
                    GunaLabel161.Text = infoUserAnnulation.Rows(0)("GRIFFE_UTILISATEUR")

                Else
                    GunaLabel161.Visible = False
                    GunaLabel160.Visible = False
                End If

            End If

        Else

            GunaLabelResa.Visible = False 'RESA
            GunaLabel155.Visible = False 'RESA
            GunaLabel153.Visible = False
            GunaLabel156.Visible = False
            GunaLabel154.Visible = False
            GunaLabel157.Visible = False
            GunaLabel158.Visible = False
            GunaLabel159.Visible = False
            GunaLabel160.Visible = False
            GunaLabel161.Visible = False

        End If

    End Sub


    Private Sub ListeDesFacturesEtReglementPourUneReservation()

        Dim listeDesFactureDelaReservation As New Facture
        Dim listeDesReglementsDelaReservation As New Reglement

        Dim ListeDesFactures As DataTable = listeDesFactureDelaReservation.ListeDesFactureDeLaReservationEncours(GlobalVariable.codeReservationToUpdate)
        Dim ListeDesReglements As DataTable = listeDesReglementsDelaReservation.ListeDesReglementDeLaReservationEncours(GlobalVariable.codeReservationToUpdate)

        'LISTE DES FACTURES
        If ListeDesFactures.Rows.Count > 0 Then
            GunaDataGridViewDesFactures.DataSource = ListeDesFactures

            GunaDataGridViewDesFactures.Columns(3).DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewDesFactures.Columns(3).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

            GunaDataGridViewDesFactures.Columns(4).DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewDesFactures.Columns(4).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

            GunaDataGridViewDesFactures.Columns(5).DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewDesFactures.Columns(5).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

        End If

        'LISTE DES REGLEMENTS
        If ListeDesReglements.Rows.Count > 0 Then
            GunaDataGridViewListeDesReglement.DataSource = ListeDesReglements
            GunaDataGridViewListeDesReglement.Columns(3).DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewListeDesReglement.Columns(3).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
        Else
            GunaDataGridViewListeDesReglement.Columns.Clear()
        End If

    End Sub
    'When ever the number of resting days changes

    Private Sub GunaTextBoxTempsAFaire_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxTempsAFaire.TextChanged

        Dim tempsAFaire As Integer = 1

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, tempsAFaire)

        If GunaCheckBoxDayUse.Checked Then

            GunaLabelTypeDeSejour.Text = "DAY USE"

            If tempsAFaire > 0 Then

                Dim newTime = DateAndTime.DateAdd("h", tempsAFaire, GunaComboBoxHeureArrivee.SelectedItem)

                GunaComboBoxHeureDepart.Items.Remove(GunaComboBoxHeureDepart.SelectedItem)

                GunaComboBoxHeureDepart.Items.Add(newTime.ToLongTimeString)

                GunaComboBoxHeureDepart.SelectedItem = newTime.ToLongTimeString

                ReservationMoneyCalculation()

            End If

        Else

            GunaDateTimePickerDepart.Value = DateAndTime.DateAdd("d", tempsAFaire, GunaDateTimePickerArrivee.Value)

            GlobalVariable.DATE_ENTTRE = GunaDateTimePickerArrivee.Value.ToShortDateString
            GlobalVariable.DATE_SORTIE = GunaDateTimePickerDepart.Value.ToShortDateString

            'Gestion des salles

            If tempsAFaire > 0 And 8 > tempsAFaire Then
                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaLabelTypeDeSejour.Text = "COURT SEJOURS"
                Else
                    GunaLabelTypeDeSejour.Text = "SHORT STAY"
                End If
            ElseIf tempsAFaire > 7 Then
                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaLabelTypeDeSejour.Text = "LONG SEJOURS"

                Else
                    GunaLabelTypeDeSejour.Text = "LONG STAY"

                End If
            End If

        End If

        If Trim(GunaTextBoxTempsAFaire.Text) = "" Then
            GunaTextBoxTempsAFaire.Text = 0
        End If

        ' GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * CType(GunaTextBoxTempsAFaire.Text, Int32), "#,##0")

        montanTotalDeLocationSalle(CType(GunaTextBoxTempsAFaire.Text, Int32))

        'We display buttons
        reservationButtonToDisplay()

    End Sub

    ' -------------------------------- PERSONNAL AUTOCOMPLETION -------------------------------------
    'Autocompletion of client

    Sub AutoCompleteClient()

        'Dim Query As String = "SELECT * From client WHERE NOM_PRENOM LIKE '%'" & GunaTextBoxNomPrenom.Text & "'%'"
        Dim Query As String = "SELECT * From client"
        Dim command As New MySqlCommand(Query, GlobalVariable.connect)
        Dim table As New DataTable
        Dim adapter As New MySqlDataAdapter(command)
        adapter.Fill(table)

        Dim col As New AutoCompleteStringCollection
        Dim i As Integer

        For i = 0 To table.Rows.Count - 1

            'col.Add(table.Rows(i)("NOM_PRENOM").ToString() + "-" + table.Rows(i)("EMAIL"))
            col.Add(table.Rows(i)("NOM_PRENOM").ToString())
        Next

        'connect.closeConnection()

        'We display buttons
        reservationButtonToDisplay()

    End Sub

    'Custom Live search of client
    Private Sub GunaTextBoxNomPrenom_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNomPrenom.TextChanged

        If Trim(GunaTextBoxNomPrenom.Text).Equals("") Then

            If Not GunaCheckBoxReservationDeGroupe.Checked Then


                GunaTextBoxCompteDebiteur.Visible = False
                GunaButtonCheckIn.Visible = False
                GunaTextBoxCodeElite.Visible = False
                GunaLabelElite.Visible = False

                GunaTextBoxRefClient.Text = ""
                GunaTextBoxTelClient.Text = ""
                GunaTextBoxClientEmail.Text = ""
                GunaTextBoxCodeDeGroupe.Clear()
                GunaTextBoxCNI.Text = ""

                GunaTextBoxRefClient.Text = ""

                GunaTextBoxSiteWeb.Text = ""
                GunaTextBoxCodeElite.Text = ""
                GunaTextBoxNomPrenom.Text = ""
                GunaTextBoxTelClient.Clear()
                GunaTextBoxClientEmail.Text = ""
                GunaTextBoxCNI.Text = ""

                GunaTextBoxSiteWeb.Text = ""
                GunaTextBoxNomJeuneFille.Text = ""
                GunaTextBoxTypeClient.Text = ""
                GunaDateTimePickerDateNaissance.Value = Now()
                GunaTextBoxLieu.Text = ""
                GunaTextBoxNationalite.Text = ""
                GunaTextBoxPaysResidence.Text = ""
                GunaTextBoxProfession.Text = ""
                GunaTextBoxNumeroCompte.Text = ""
                GunaTextBoxRue.Text = ""
                GunaTextBoxVilleDeResidence.Text = ""
                GunaTextBoxModeTransport.Text = ""
                GunaTextBoxNumVehicule.Text = ""
                GunaTextBoxEntrepriseDuclient.Text = ""

                GunaTextBoxPaiement.Text = 0
                'GunaTextBoxAvance.Text = 0
                GunaTextBoxDepotDeGarantie.Text = 0
                GunaTextBoxMontantCaution.Text = 0

                'Aucun tableau d'autocompletion ne doit être visible
                setTableUsedForAutocompletionToFalse()

                'On masque les tarifs associés aux clients
                GunaComboBoxCodeTarif.Visible = False
                GunaLabelCodeTarif.Visible = False

                'GunaTextBoxMontantAccorde.Text = GunaTextBoxpPrixAffiche.Text

            End If

        End If

        GunaDataGridViewClient.Visible = True

        Dim Query As String = "SELECT NOM_PRENOM, EMAIL From client WHERE NOM_PRENOM LIKE '%" & GunaTextBoxNomPrenom.Text & "%' OR CODE_ELITE LIKE '%" & GunaTextBoxNomPrenom.Text & "%'"
        Dim command As New MySqlCommand(Query, GlobalVariable.connect)
        Dim table As New DataTable
        Dim adapter As New MySqlDataAdapter(command)

        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            GunaDataGridViewClient.DataSource = table
        Else
            GunaDataGridViewClient.Columns.Clear()
            GunaDataGridViewClient.Visible = False
        End If

        If GunaTextBoxNomPrenom.Text = "" Then
            GunaDataGridViewClient.Visible = False
        End If

        'reservationButtonToDisplay()

    End Sub

    'Upponc clicking a row on the values of the datagrid used for custom search of client
    Private Sub GunaDataGridViewClient_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewClient.CellClick

        GunaDataGridViewClient.Visible = False

        Dim row As DataGridViewRow

        row = Me.GunaDataGridViewClient.Rows(e.RowIndex)

        Dim query As String = "SELECT * FROM client WHERE NOM_PRENOM = @NOM_PRENOM AND EMAIL=@EMAIL"
        Dim adapter As New MySqlDataAdapter

        Dim table As New DataTable()
        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@NOM_PRENOM", MySqlDbType.VarChar).Value = Trim(row.Cells("NOM_PRENOM").Value.ToString())
        command.Parameters.Add("@EMAIL", MySqlDbType.VarChar).Value = row.Cells("EMAIL").Value.ToString()

        adapter.SelectCommand = command
        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            'Gathering of some information concernit the client to be use later

            GlobalVariable.idClient = table.Rows(0)("ID_CLIENT").ToString
            GlobalVariable.codeClient = Trim(table.Rows(0)("CODE_CLIENT").ToString)
            GlobalVariable.codeCompteClient = table.Rows(0)("NUM_COMPTE").ToString

            GunaTextBoxNomPrenom.Text = Trim(row.Cells("NOM_PRENOM").Value.ToString())
            GunaTextBoxTelClient.Text = Trim(table.Rows(0)("TELEPHONE").ToString)
            GunaTextBoxClientEmail.Text = Trim(table.Rows(0)("EMAIL").ToString)
            GunaTextBoxCNI.Text = Trim(table.Rows(0)("CNI").ToString)
            GunaTextBoxRefClient.Text = Trim(Trim(table.Rows(0)("CODE_CLIENT").ToString))
            GunaTextBoxSiteWeb.Text = Trim(table.Rows(0)("SITE_INTERNET").ToString)
            GunaTextBoxNomJeuneFille.Text = Trim(table.Rows(0)("NOM_JEUNE_FILLE"))
            GunaTextBoxTypeClient.Text = Trim(table.Rows(0)("TYPE_CLIENT"))
            GunaDateTimePickerDateNaissance.Value = Trim(table.Rows(0)("DATE_DE_NAISSANCE"))
            GunaTextBoxLieu.Text = Trim(table.Rows(0)("LIEU_DE_NAISSANCE"))
            GunaTextBoxNationalite.Text = Trim(table.Rows(0)("NATIONALITE"))
            GunaTextBoxPaysResidence.Text = Trim(table.Rows(0)("PAYS_RESIDENCE"))
            GunaTextBoxProfession.Text = Trim(table.Rows(0)("PROFESSION"))
            GunaTextBoxNumeroCompte.Text = Trim(table.Rows(0)("NUM_COMPTE"))
            GunaTextBoxRue.Text = Trim(table.Rows(0)("ADRESSE"))
            GunaTextBoxVilleDeResidence.Text = table.Rows(0)("VILLE_DE_RESIDENCE")
            GunaTextBoxModeTransport.Text = table.Rows(0)("MODE_TRANSPORT")
            GunaTextBoxNumVehicule.Text = table.Rows(0)("NUM_VEHICULE")
            'GunaTextBoxCodeDeGroupe.Text = table.Rows(0)("CODE_ENTREPRISE")
            GunaTextBoxCodeEntrepriseDuClient.Text = table.Rows(0)("CODE_ENTREPRISE")

            If Trim(table.Rows(0)("CODE_ELITE")).Equals("") Then
                GunaLabelElite.Visible = False
                GunaTextBoxCodeElite.Visible = False
                GunaTextBoxCodeElite.Text = ""
            Else
                GunaLabelElite.Visible = True
                GunaTextBoxCodeElite.Visible = True
                GunaTextBoxCodeElite.Text = table.Rows(0)("CODE_ELITE")
            End If

            Dim Entreprise As DataTable = Functions.getElementByCode(table.Rows(0)("CODE_ENTREPRISE"), "client", "CODE_CLIENT")

            If Entreprise.Rows.Count > 0 Then

                GunaTextBoxEntrepriseDuclient.Text = Trim(Entreprise.Rows(0)("NOM_CLIENT"))

                GunaDataGridViewEntrepriseDuClient.Visible = False

            End If

            GunaDataGridViewRoom.Visible = False

            'Initialisation de la ville de depart
            'GunaTextBoxVenantDe.Text = GlobalVariable.AgenceActuelle.Rows(0)("VILLE")
            GunaTextBoxVenantDe.Text = table.Rows(0)("VILLE_DE_RESIDENCE")

            'Initialisation du nombre de personne

            'GunaTextBoxNbreAdulte.Text = 0
            'GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text

            If Not Trim(GunaTextBoxRefClient.Text).Equals("") Then
                gestionDesComptesDebiteurLorsDesReservationsIndividu(Trim(GunaTextBoxRefClient.Text))
            End If

        Else
            GunaTextBoxNomPrenom.Clear()
        End If

        'connect.closeConnection()

        setTableUsedForAutocompletionToFalse()

        'Managing the buttons to print at the level of the main form 
        reservationButtonToDisplay()

        'GunaDataGridViewEntrepriseDuClient.Visible = False

    End Sub

    'Adding a customer that doesn't exist in database for reservation from front desk
    Private Sub GunaButtonAjouterClient_Click(sender As Object, e As EventArgs) Handles GunaButtonAjouterClient.Click

        GlobalVariable.addUserFromFrontOffice = True

        ClientForm.Show()
        ClientForm.TopMost = True

    End Sub

    'Calculating the number of time to spend in hotel when departure date changes
    Private Sub GunaDateTimePickerDepart_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerDepart.ValueChanged

        'We calculate the resting days or hours
        CalculatingRestDaysOrHours()

        'Displaying the right buttons on on date changes
        reservationButtonToDisplay()

    End Sub

    'Calculating the number of time to spend in hotel when arrival date changes
    Private Sub GunaDateTimePickerArrivee_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerArrivee.ValueChanged

        'SI ON NE TRAITE PAS LE DAY USE ALORS LA DATE D'ARRIVE NE DOIT JAMAIS ETRE EGALE A LA DATE DE DEPART
        If Not GunaCheckBoxDayUse.Checked Then

            'SEJOURS NORMAL

            If GunaDateTimePickerDepart.Value.ToShortDateString <= GunaDateTimePickerArrivee.Value.ToShortDateString Then
                GunaDateTimePickerDepart.Value = GunaDateTimePickerArrivee.Value.AddDays(1)
            End If

        Else

            'DAY USE

            '
            'GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail
            'GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail

        End If

        'We calculate the resting days or hours
        CalculatingRestDaysOrHours()

        'Displaying the right buttons on on date changes
        reservationButtonToDisplay()

    End Sub

    'Calculating the days to spend in hotel
    Private Sub CalculatingRestDaysOrHours()

        'GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail.AddDays(1)

        'Le bouton gestion des heures n'etant pas cochet on ne peut pas permettre que la date d'arrivee = la date de sortie
        If GunaCheckBoxDayUse.Checked Then

            If GunaDateTimePickerDepart.Value.ToShortDateString() = GunaDateTimePickerArrivee.Value.ToShortDateString() Then

            End If

            'On passe de nuitées a heures

            If GlobalVariable.actualLanguageValue = 1 Then
                GunaLabelTotalHeure.Text = "Nombre d'heure(s)"
                GunaLabelPrixParNuitee.Text = "Prix par heure"
            Else
                GunaLabelTotalHeure.Text = "Number of hour(s)"
                GunaLabelPrixParNuitee.Text = "Price per hour"
            End If


        ElseIf GunaCheckBoxMensuel.Checked Then

            If GlobalVariable.actualLanguageValue = 1 Then
                GunaLabelTotalHeure.Text = "Nombre de jour(s)"
                GunaLabelPrixParNuitee.Text = "Prix Mensuel"
            Else
                GunaLabelTotalHeure.Text = "Number of days(s)"
                GunaLabelPrixParNuitee.Text = "Monthly Price"
            End If

        Else

            'GunaCheckBoxDayUse.Checked = False

            If GlobalVariable.typeChambreOuSalle = "chambre" Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaLabelTotalHeure.Text = "Nombre de nuitée(s)"
                    GunaLabelTempsAFaire.Text = "Total nuitée(s)"
                    GunaLabelPrixParNuitee.Text = "Prix par nuitée"
                Else
                    GunaLabelTotalHeure.Text = "Number of day(s)"
                    GunaLabelTempsAFaire.Text = "Total night(s)"
                    GunaLabelPrixParNuitee.Text = "Price per night"
                End If

            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaLabelTotalHeure.Text = "Nombre de jour(s)"
                    GunaLabelTempsAFaire.Text = "Total Jour(s)"
                    GunaLabelPrixParNuitee.Text = "Prix par Jour"

                Else
                    GunaLabelTotalHeure.Text = "Number of days(s)"
                    GunaLabelTempsAFaire.Text = "Total day(s)"
                    GunaLabelPrixParNuitee.Text = "Price per day"

                End If


            End If

            If GunaDateTimePickerDepart.Value < GunaDateTimePickerArrivee.Value Then
                GunaTextBoxTempsAFaire.Text = 0
            Else
                ' Calculate the number of days to stay
                GunaTextBoxTempsAFaire.Text = CType((GunaDateTimePickerDepart.Value - GunaDateTimePickerArrivee.Value).TotalDays, Int32)

                If (CType(GunaTextBoxTempsAFaire.Text, Int32) < 0) Then

                    GunaTextBoxTempsAFaire.Text = 1

                End If
            End If

        End If

        'Le nombre de jour total vaut le nombre de temps a faire calculé au niveau de la periode du séjour
        ReservationMoneyCalculation()

    End Sub

    'When ever the number of children or adulte changes we recalculate the number of people
    Private Sub GunaTextBoxNbreAdulte_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNbreAdulte.TextChanged

        Dim enfants As Integer = 0
        Dim adultes As Integer = 0
        Dim nombrePersonne As Integer = 0

        Integer.TryParse(GunaTextBoxNbreAdulte.Text, adultes)
        Integer.TryParse(GunaTextBoxNbreEnfant.Text, enfants)

        GunaTextBoxNbrePersonne.Text = adultes + enfants

    End Sub

    Private Sub GunaTextBoxNbreEnfant_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNbreEnfant.TextChanged

        Dim enfants As Integer = 0
        Dim adultes As Integer = 0
        Dim nombrePersonne As Integer = 0

        Integer.TryParse(GunaTextBoxNbreAdulte.Text, adultes)
        Integer.TryParse(GunaTextBoxNbreEnfant.Text, enfants)

        GunaTextBoxNbrePersonne.Text = adultes + enfants

    End Sub

    'A chaque changement de valeur du Cod client on rafraichi les calculs
    Private Sub GunaTextBoxRefClient_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxRefClient.TextChanged
        'A CHAQUE FOIS QUE CETTE VALEUR CHANGE ON DOIT VERIFIER SI IL N'EST PAS ASSOCIE A UNE ENTREPRISE
        ReservationMoneyCalculation()

        'lorsque la référence du client se remplit on determine le bouton a afficher
        reservationButtonToDisplay()

    End Sub

    'PERMET DE DETERMINER LE MONTANT D'UN JOUR PRECIS INSCRIT DANS LA MAINCOURANTE JOURNALIERE


    Public Sub tarificationDynamiqueDeterminerLePrixDeVenteDuJour()

        If Not Trim(GlobalVariable.codeMainCouranteJournaliereToUpdate).Equals("") Then

            Dim CODE_MAIN_COURANTE_JOURNALIERE As String = GlobalVariable.codeMainCouranteJournaliereToUpdate
            Dim infoSupMainCourante As DataTable = Functions.getElementByCode(CODE_MAIN_COURANTE_JOURNALIERE, "main_courante_journaliere", "CODE_MAIN_COURANTE_JOURNALIERE")

            If infoSupMainCourante.Rows.Count > 0 Then
                GunaTextBoxMontantAccorde.Text = Format(infoSupMainCourante.Rows(0)("MONTANT_ACCORDE"), "#,##0")
            End If

        End If

    End Sub

    'calculation for the amount to pay and amount paid for reservation
    Sub ReservationMoneyCalculation()

        Dim tempsAFaire As Integer = 0

        Dim nombreDeJourTotal As Integer
        Dim montantAccorde As Double
        Dim prixParNuitee As Double
        Dim prixRepas As Double
        Dim Total As Double
        Dim ServiceEtProduitSup As Double
        Dim montantARegler As Double
        Dim avance As Double
        Dim caution As Double

        Dim numberOfHoursDayOfUse = 0

        Dim montatComplet As Double = -1

        'GESTION DES TARIFS
        'ON DETERMINE SI ON A AFFECTE DES PRIX AUX CLIENT (TARIFS) PUIS ON AGIT SELON LE CAS DE FIGURE
        'Faudrait impérativement avoir le code client et le code de type de chambre ou salle ou article
        If (Not Trim(GunaTextBoxRefClient.Text).Equals("")) And (Not Trim(GunaTextBoxCodeTypeDeChambre.Text).Equals("")) Then

            Dim tarif As New Tarifs

            'ON SELECTIONNE L'ENSEMBLE DES TARIFS
            Dim ListOftarif As DataTable = tarif.SelectDistinctTarif()

            GunaComboBoxCodeTarif.DataSource = ListOftarif
            GunaComboBoxCodeTarif.ValueMember = "CODE_TARIF"
            GunaComboBoxCodeTarif.DisplayMember = "LIBELLE_TARIF"

            Dim TarifDuclientActuel As DataTable = Functions.TarifAppliqueAuClient(Trim(GunaTextBoxRefClient.Text), Trim(GunaTextBoxCodeTypeDeChambre.Text))

            Dim prixDuTarif As Double = 0

            If TarifDuclientActuel.Rows.Count > 0 Then

                If TarifDuclientActuel.Rows(0)("PRIX_TARIF_ENCOURS") = 0 Then

                    prixDuTarif = TarifDuclientActuel.Rows(0)("TARIF_PRIX1")

                Else

                    prixDuTarif = TarifDuclientActuel.Rows(0)("PRIX_TARIF_ENCOURS")

                End If

            End If

            If TarifDuclientActuel.Rows.Count > 0 Then

                If GunaRadioButtonChambre.Checked Then

                    GunaTextBoxMontantAccorde.Text = Format(prixDuTarif, "#,##0")
                    prixParNuitee = GunaTextBoxMontantAccorde.Text

                    montatComplet = prixParNuitee

                    GunaComboBoxCodeTarif.Visible = True
                    GunaLabelCodeTarif.Visible = True

                    'LE TARIF GRATUIT NE DOIT APPARAITRE QUE SI LE BOUTON DE GRATUITE EST COCHE
                    If TarifDuclientActuel.Rows(0)("CODE_TARIF") = "GRATUITEE" Or TarifDuclientActuel.Rows(0)("CODE_TARIF") = "FREE" Then
                        If GunaCheckBoxGratuitee.Checked Then
                            GunaComboBoxCodeTarif.SelectedValue = TarifDuclientActuel.Rows(0)("CODE_TARIF")
                        Else
                            GunaComboBoxCodeTarif.Visible = False
                            GunaLabelCodeTarif.Visible = False
                            GunaComboBoxCodeTarif.DataSource = Nothing
                        End If
                    Else
                        GunaComboBoxCodeTarif.SelectedValue = TarifDuclientActuel.Rows(0)("CODE_TARIF")
                    End If

                End If

                If GunaRadioButtonSalleFete.Checked Then
                    GunaTextBoxMontantReelSalle.Text = Format(prixDuTarif, "#,##0")

                    GunaComboBoxCodeTarif.Visible = False
                    GunaLabelCodeTarif.Visible = False

                End If

            Else


            End If

            'GESTION DES DAY USE

        End If
        '----------------------------------------------------------------------------------

        If GunaRadioButtonChambre.Checked Then
            totalAReglerPourLeDuSejour()
        End If

        If GunaRadioButtonSalleFete.Checked Then
            'CALCUL DU MONTANT LIE AUX SALES

            If Not (Double.TryParse(GunaTextBoxMontantReelSalle.Text.Trim(), montantAccorde) = 0) Then
                Double.TryParse(GunaTextBoxMontantReelSalle.Text.Trim(), montantAccorde)
            Else
                Double.TryParse(GunaTextBoxMontantAfficherSalle.Text.Trim(), montantAccorde)
            End If

            montatComplet = montantAccorde

            If GunaCheckBoxDayUse.Checked Then
                ' LOCATION DE LA SALLE POUR LA JOURNEE
                Total = montantAccorde
            Else
                'LOCATION DE LA SALLE SUR PLUSIEURS JOURS
                If Trim(GunaTextBoxTempsAFaire.Text).Equals("") Then
                    GunaTextBoxTempsAFaire.Text = 0
                End If
                Total = CType(GunaTextBoxTempsAFaire.Text, Int32) * montantAccorde
            End If

        End If

        'Block de paiment
        Double.TryParse(GunaTextBoxAvance.Text.Trim(), avance)
        Double.TryParse(GunaTextBoxMontantCaution.Text.Trim(), caution)

        'Derteminig the solde to display

        If Not GlobalVariable.codeReservationToUpdate = "" Then

            'Dim solde As Double = Double.Parse(Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate))
            Dim solde As Double = Double.Parse(Functions.SituationDeReservation(GunaLabelNumReservation.Text))
            GunaLabelSolde.Text = Format(solde, "#,##0")

            If 0 > solde Then
                GunaLabelSolde.ForeColor = Color.Red
            ElseIf solde = 0 Then
                GunaLabelSolde.ForeColor = Color.Black
            ElseIf solde > 0 Then
                GunaLabelSolde.ForeColor = Color.Green
            End If

        Else

            GunaLabelSolde.Text = 0

        End If

        If GlobalVariable.tarificationDynamiqueActif Then

            If Not Trim(GlobalVariable.codeReservationToUpdate).Equals("") Then

                'LA RESERVATION A DEJA ETE CREER DONC SON FICHIER DE TARIFICATION EXISTE
                'ON DETERMINE LE PRIX DE VENTE DU JOUR CONFORMEMENT AU TABLEAU DE DISPONIBILITE INSCRIT DANS LE FICHIER TEXT
                tarificationDynamiqueDeterminerLePrixDeVenteDuJour()

                determinonsSiOnDoitAfficherLedropDownDesTarifsAssocieAUnTypeDeChambre(GunaTextBoxCodeTypeDeChambre.Text)

            Else

                'LE FICHIER N'EXISTE PAS ENCORE CAR NOUS N'AVONS PAS ENCORE CREE LA RESERVATION

                'NOUS DEVONS DONC :
                '1- DETERMINER LES TARIFS ET PAR LA MEME OCCASION 
                '2- LE PRIX DE DEPART DE LA TARIFICATION EN VIGUEUR

                Dim CODE_TYPE_CHAMBRE As String = GunaTextBoxCodeTypeDeChambre.Text

                determinationDesTarifsAssocieAUnTypeDeChambre(CODE_TYPE_CHAMBRE)

            End If

        End If

        If Not Trim(GlobalVariable.codeReservationToUpdate).Equals("") Then

            'SI ON TRAITE UNE RESERVATION QUI NE POSSEDE PAS DE FICHIER TEXT ALORS ON PROCEDE A UN TRAITEMENT NORMAL
            Dim CODE_RESERVATION As String = GlobalVariable.codeReservationToUpdate
            Dim extension As String = ".txt"
            Dim nomDuDossier As String = "RESERVATIONS"
            Dim cheminPlusDossier As String = GlobalVariable.AgenceActuelle.Rows(0)("CHEMIN_SAUVEGARDE_AUTO") & "\" & nomDuDossier
            Dim filepathPlusFile As String = cheminPlusDossier & "\" & CODE_RESERVATION & extension

            If Not System.IO.File.Exists(filepathPlusFile) Then
                'ON MASQUE LE BOUTON DES TARIFS DYNQMIQUE DE TOUTE LA PERIODE DE LA RESERVATION
                GunaButtonTarifAppliquable.Visible = False

            Else
                GunaButtonTarifAppliquable.Visible = True
            End If

        End If


        '--------------------------
        'Information to be inserted into database after clicking enregistrer reservation
        GlobalVariable.MONTANT_ACCORDE = montantAccorde

        GlobalVariable.MONTANT_TOTAL = Total

        GlobalVariable.MONTANT_TOTAL_CAUTION = caution

        GlobalVariable.avance = avance

    End Sub

    'Determining which buttons to display at the front office
    Sub reservationButtonToDisplay()

        Dim tempAFaire As Double = 0
        Double.TryParse(GunaTextBoxTempsAFaire.Text, tempAFaire)

        If Not Trim(GunaTextBoxTempsAFaire.Text).Equals("") Then
            tempAFaire = GunaTextBoxTempsAFaire.Text
        End If

        Dim tempsAFaireSieste As Integer = 0

        'Integer.TryParse(GunaTextBoxTempsSieste.Text, tempsAFaireSieste)

        If Trim(GunaTextBoxCodeTypeDeChambre.Text).Equals("") Then

            GunaButtonReservation.Visible = False
            GunaButtonCheckIn.Visible = False
            GunaButtonCheckOut.Visible = False

        Else

            'If the client field is not empty and resting time is different from 0, we show the buttons
            If (Not (GunaTextBoxNomPrenom.Text.Trim().Equals("")) And Not tempAFaire = 0) Then

                'Out putting the buttons Enregistrer, Checkin

                'GESTION DES HEURES
                If (GunaDateTimePickerDepart.Value = GunaDateTimePickerArrivee.Value) And GunaCheckBoxDayUse.Checked Then

                    Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

                    Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

                    Dim HeureArriveInRightFormat As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
                    Dim HeureDepartInRightFormat As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

                    'Dim HeureArriveInRightFormat As DateTime = CDate(GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.selectedItem)
                    'Dim HeureDepartInRightFormat As DateTime = CDate(GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.selectedItem)

                    If (HeureDepartInRightFormat < HeureArriveInRightFormat) Then

                        GunaTextBoxTempsAFaire.Text = 0

                        GunaButtonReservation.Visible = True
                        'Le bouton annuler n'est visible que sin on n'a deja enresgitré une résrevation
                        If Not GlobalVariable.codeReservationToUpdate = "" Then

                            Dim ETAT_RESERVATION As Integer = 1

                            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                            End If
                            If ETAT_RESERVATION = 0 Then
                                GunaButtonAnnulerResa.Visible = True
                            Else
                                GunaButtonAnnulerResa.Visible = False
                            End If
                        Else
                            GunaButtonAnnulerResa.Visible = False
                        End If

                        GunaButtonCheckOut.Visible = False
                        GunaButtonCheckIn.Visible = True

                    Else

                        If HeureDepartInRightFormat = HeureArriveInRightFormat Then

                            GunaButtonReservation.Visible = True
                            If Not GlobalVariable.codeReservationToUpdate = "" Then
                                Dim ETAT_RESERVATION As Integer = 1

                                If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                    ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                                End If
                                If ETAT_RESERVATION = 0 Then
                                    GunaButtonAnnulerResa.Visible = True
                                Else
                                    GunaButtonAnnulerResa.Visible = False
                                End If
                            Else
                                GunaButtonAnnulerResa.Visible = False
                            End If
                            GunaButtonCheckOut.Visible = False
                            'we output the checkin button only it state is NON checkin not yet donne
                            If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 Then
                                GunaButtonCheckIn.Visible = False
                                'GunaButtonAnnulerReservation.Visible = True
                            Else
                                GunaButtonCheckIn.Visible = True
                                Dim ETAT_RESERVATION As Integer = 1

                                If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                    ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                                End If
                                If ETAT_RESERVATION = 0 Then
                                    GunaButtonAnnulerResa.Visible = True
                                Else
                                    GunaButtonAnnulerResa.Visible = False
                                End If
                            End If

                        ElseIf HeureArriveInRightFormat <= HeureDepartInRightFormat Then

                            'Gestion du checkout

                            Dim solde As Double = 0

                            Double.TryParse(GunaLabelSolde.Text, solde)

                            GunaButtonReservation.Visible = True
                            If Not GlobalVariable.codeReservationToUpdate = "" Then
                                Dim ETAT_RESERVATION As Integer = 1

                                If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                    ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                                End If
                                If ETAT_RESERVATION = 0 Then
                                    GunaButtonAnnulerResa.Visible = True
                                Else
                                    GunaButtonAnnulerResa.Visible = False
                                End If
                            Else
                                GunaButtonAnnulerResa.Visible = False
                            End If
                            'If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 And solde >= 0 Then'
                            'GlobalVariable.reserveConfCheckOutState is ETAT_CONFIRMATION
                            'We can't checkout what has not been checked in and checkout what has already been checked out
                            If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 Then
                                GunaButtonCheckOut.Visible = True
                                GunaButtonCheckIn.Visible = False
                            Else
                                GunaButtonCheckOut.Visible = False
                                GunaButtonCheckIn.Visible = True
                            End If

                        Else

                            GunaButtonReservation.Visible = True

                            If Not GlobalVariable.codeReservationToUpdate = "" Then
                                Dim ETAT_RESERVATION As Integer = 1

                                If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                    ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                                End If
                                If ETAT_RESERVATION = 0 Then
                                    GunaButtonAnnulerResa.Visible = False
                                End If
                            Else
                                GunaButtonAnnulerResa.Visible = False
                            End If

                            GunaButtonCheckOut.Visible = False
                            GunaButtonCheckIn.Visible = False

                        End If

                    End If

                Else

                    'GESTION DES DATES
                    If (GunaDateTimePickerDepart.Value < GunaDateTimePickerArrivee.Value) Then

                        GunaTextBoxTempsAFaire.Text = 1
                        GunaButtonReservation.Visible = False
                        'Le bouton annuler n'est visible que sin on n'a deja enresgitré une résrevation
                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            Dim ETAT_RESERVATION As Integer = 1

                            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                            End If
                            If ETAT_RESERVATION = 0 Then
                                GunaButtonAnnulerResa.Visible = True
                            Else
                                GunaButtonAnnulerResa.Visible = False
                            End If
                        Else
                            GunaButtonAnnulerResa.Visible = False
                        End If

                        GunaButtonCheckOut.Visible = False
                        GunaButtonCheckIn.Visible = False

                    Else

                        If GunaDateTimePickerArrivee.Value.ToShortDateString() = GlobalVariable.DateDeTravail.ToShortDateString() Then

                            GunaButtonReservation.Visible = True
                            If Not GlobalVariable.codeReservationToUpdate = "" Then
                                Dim ETAT_RESERVATION As Integer = 1

                                If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                    ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                                End If
                                If ETAT_RESERVATION = 0 Then
                                    GunaButtonAnnulerResa.Visible = True
                                Else
                                    GunaButtonAnnulerResa.Visible = False
                                End If
                            Else
                                GunaButtonAnnulerResa.Visible = False
                            End If

                            'GunaButtonCheckOut.Visible = False
                            'we output the checkin button only it state is NON checkin not yet donne
                            If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 Then
                                GunaButtonCheckIn.Visible = False

                                If GlobalVariable.DateDeTravail.ToShortDateString() = GunaDateTimePickerDepart.Value.ToShortDateString() Then
                                    GunaButtonCheckOut.Visible = True
                                Else
                                    GunaButtonCheckOut.Visible = False
                                End If

                            Else
                                GunaButtonCheckIn.Visible = True
                            End If

                        ElseIf GlobalVariable.DateDeTravail.ToShortDateString() = GunaDateTimePickerDepart.Value.ToShortDateString() Then
                            'Permet a ce que l'ont puisse effectuer le checkout au bon moment et meme longtemps apres que la date soit passe
                            'Gestion du checkout
                            Dim solde As Double = 0

                            Double.TryParse(GunaLabelSolde.Text, solde)

                            GunaButtonReservation.Visible = True
                            If Not GlobalVariable.codeReservationToUpdate = "" Then
                                Dim ETAT_RESERVATION As Integer = 1

                                If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                    ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                                End If
                                If ETAT_RESERVATION = 0 Then
                                    GunaButtonAnnulerResa.Visible = True
                                Else
                                    GunaButtonAnnulerResa.Visible = False
                                End If
                            Else
                                GunaButtonAnnulerResa.Visible = False
                            End If

                            'If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 And solde >= 0 Then'
                            'GlobalVariable.reserveConfCheckOutState is ETAT_CONFIRMATION
                            'We can't checkout what has not been checked in and checkout what has already been checked out

                            If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 Then
                                GunaButtonCheckOut.Visible = True
                            Else
                                GunaButtonCheckOut.Visible = False
                            End If

                            GunaButtonCheckIn.Visible = False

                        ElseIf GunaDateTimePickerDepart.Value.ToShortDateString() < GlobalVariable.DateDeTravail.ToShortDateString() Then
                            'Permet a ce que l'ont puisse effectuer le checkout au bon moment et meme longtemps apres que la date soit passe
                            'Gestion du checkout
                            Dim solde As Double = 0

                            Double.TryParse(GunaLabelSolde.Text, solde)

                            GunaButtonReservation.Visible = True
                            If Not GlobalVariable.codeReservationToUpdate = "" Then
                                Dim ETAT_RESERVATION As Integer = 1

                                If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                    ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                                End If

                                If ETAT_RESERVATION = 0 Then
                                    GunaButtonAnnulerResa.Visible = True
                                Else
                                    GunaButtonAnnulerResa.Visible = False
                                End If
                            Else
                                GunaButtonAnnulerResa.Visible = False
                            End If

                            'If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 And solde >= 0 Then'
                            'GlobalVariable.reserveConfCheckOutState is ETAT_CONFIRMATION
                            'We can't checkout what has not been checked in and checkout what has already been checked out

                            If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 Then
                                GunaButtonCheckOut.Visible = True
                            Else
                                GunaButtonCheckOut.Visible = False
                            End If

                            GunaButtonCheckIn.Visible = False

                        Else

                            GunaButtonReservation.Visible = True

                            If Not GlobalVariable.codeReservationToUpdate = "" Then
                                Dim ETAT_RESERVATION As Integer = 1

                                If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                    ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                                End If
                                If ETAT_RESERVATION = 0 Then
                                    GunaButtonAnnulerResa.Visible = True
                                Else
                                    GunaButtonAnnulerResa.Visible = False
                                End If
                            Else
                                GunaButtonAnnulerResa.Visible = False
                            End If

                            GunaButtonCheckOut.Visible = False
                            GunaButtonCheckIn.Visible = False

                        End If

                    End If

                End If

                'Else Client field empty we hide the buttons Enregistrer, Checkin, checkout
            Else

                GunaButtonReservation.Visible = False
                GunaButtonAnnulerResa.Visible = False
                'GunaButtonCheckOut.Visible = False
                GunaButtonCheckIn.Visible = False

            End If

        End If
        'Si la réservation est dans reserve_conf on ne peut plus l'annuler via le bouton annuler mais en faisant un checkout
        If Not GlobalVariable.codeReservationToUpdate = "" Then
            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION").Rows.Count > 0 Then
                GunaButtonAnnulerResa.Visible = False
            End If
        End If

        TimerToRefreshClock.Start()

    End Sub

    '-------------------------------------- RESERVATION SAVING -----------------------------------------------

    Public Sub cautionEnregistrement(ByVal CODE_RESERVATION As String, ByVal DEBIT As Double, ByVal CREDIT As Double, ByVal TYPE As Integer)

        Dim resa As New Reservation()

        Dim caution As DataTable = Functions.GetAllElementsOnTwoConditions(CODE_RESERVATION, "caution", "CODE_RESERVATION", TYPE, "TYPE")

        Dim CODE_CAUTION As String = Functions.GeneratingRandomCodePanne("caution", "DG")

        If Trim(GunaTextBoxMontantCaution.Text) = "" Then
            GunaTextBoxMontantCaution.Text = 0
        End If

        Dim DATE_CREATION As Date = GlobalVariable.DateDeTravail
        Dim CODE_UTILISATEUR_CREA As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
        Dim NOM_CLIENT As String = GunaTextBoxNomPrenom.Text

        If caution.Rows.Count > 0 Then
            'LE CODE EXISTE DEJA ALORS ON SAUVEGARDE
            DEBIT = caution.Rows(0)("DEBIT")
            Dim MONTANT_CAUTION As Double = CREDIT
            CODE_CAUTION = caution.Rows(0)("CODE_CAUTION")
            Dim ETAT_DEPOT As String = caution.Rows(0)("ETAT_DEPOT")

            If MONTANT_CAUTION > 0 Then
                resa.updateCaution(CODE_CAUTION, CODE_RESERVATION, DEBIT, CREDIT, CODE_UTILISATEUR_CREA, TYPE, ETAT_DEPOT)
            End If

        Else

            If CREDIT > 0 Then
                'LE CODE N'EXISTE PAS ALORS ON INSERE
                Dim ETAT_DEPOT As String = "Affecté"
                If GlobalVariable.actualLanguageValue = 0 Then
                    ETAT_DEPOT = "Affected"
                End If
                resa.insertionCaution(CODE_CAUTION, CODE_RESERVATION, DEBIT, CREDIT, DATE_CREATION, CODE_UTILISATEUR_CREA, TYPE, ETAT_DEPOT, NOM_CLIENT)
            End If

        End If

    End Sub

    'Saving a reservation
    Private Sub GunaButtonReservation_Click(sender As Object, e As EventArgs) Handles GunaButtonReservation.Click

        Dim facturationAutoApresPronlongementDeSejour As Boolean = False

        'On doit vérifier que la date de sortie n'est jamais inférieure a la date de travail
        Dim dayDiff = CType((GlobalVariable.DateDeTravail - GunaDateTimePickerDepart.Value).TotalDays, Int32)

        Dim montant_total As Double = 0
        Dim multiplier As Boolean = True

        If GunaCheckBoxMensuel.Checked Then
            multiplier = False
        End If

        If dayDiff > 0 Then

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Bien vouloir vérifier la date de départ", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
            Else
                MessageBox.Show("Please check the departure date", "Reservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If

        Else

            If GunaComboBoxSourceReservation.SelectedIndex = -1 Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Bien vouloir choisir une source de réservation", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Else
                    MessageBox.Show("Please select a reservation source", "Reservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If

            Else

                If Not GunaTextBoxNbrePersonne.Text > 0 Then

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Bien vouloir indiquer le nombre de personne", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Else
                        MessageBox.Show("Please indicate the Number of Pax", "Reservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    End If

                Else

                    Dim envoieConfirmationDeReservation As Boolean = False

                    Dim WHATSAPP_OU_EMAIL As Integer
                    'WHATSAPP_OU_EMAIL = 0 'WHATSAPP
                    'WHATSAPP_OU_EMAIL = 1 'EMAIL

                    Dim SEND_WHATSAP As Boolean = False
                    Dim SEND_MAIL As Boolean = False
                    Dim ARG_ACTION As Integer
                    Dim EMAIL As String = Trim(GunaTextBoxClientEmail.Text)

                    If Trim(GunaButtonReservation.Text).Equals("Réserver") Or Trim(GunaButtonReservation.Text).Equals("Booking") Then

                        envoieConfirmationDeReservation = True
                        'GunaRadioButtonWhatsAppOui.Checked = False
                        'GunaRadioButtonWhatsAppNon.Checked = True

                        '---------------------------------------------------------------

                        If GunaRadioButtonWhatsAppOui.Checked Then

                            SEND_WHATSAP = True

                            'ON DOIT DETERMINER LE DOCUMENT ENVOYE

                            If GlobalVariable.typeChambreOuSalle = "salle" Then

                                If GunaComboBoxTypeDeDocSalle.SelectedIndex = 0 Then
                                    ARG_ACTION = 1
                                ElseIf GunaComboBoxTypeDeDocSalle.SelectedIndex = 1 Then
                                    ARG_ACTION = 2
                                End If

                            ElseIf GlobalVariable.typeChambreOuSalle = "chambre" Then
                                ARG_ACTION = 3
                            End If

                        End If

                        '-----------------------------------------------------

                        If GunaRadioButtonMailOui.Checked Then

                            If Not Trim(EMAIL).Equals("") And EMAIL.Length > 10 Then

                                SEND_MAIL = True

                                'ON DOIT DETERMINER LE DOCUMENT A ENVOYER

                                If GlobalVariable.typeChambreOuSalle = "salle" Then
                                    If GunaComboBoxTypeDeDocSalle.SelectedIndex = 0 Then
                                        ARG_ACTION = 1
                                    ElseIf GunaComboBoxTypeDeDocSalle.SelectedIndex = 1 Then
                                        ARG_ACTION = 2
                                    End If

                                ElseIf GlobalVariable.typeChambreOuSalle = "chambre" Then
                                    ARG_ACTION = 3
                                End If

                            End If

                        End If
                        '---------------------------------------------------------------

                    End If

                    Dim CODE_RESERVATION_DEPART As String = GunaLabelNumReservation.Text
                    Dim CHAMBRE_DEPART As String = GunaTextBoxNumeroChambre.Text

                    Dim resaExist As DataTable = Functions.getElementByCode(CODE_RESERVATION_DEPART, "reserve_conf", "CODE_RESERVATION")

                    Dim exist_reserve_conf As Boolean = False
                    Dim exist_reservation As Boolean = False
                    Dim exist As Boolean = False

                    If resaExist.Rows.Count > 0 Then
                        exist_reserve_conf = True
                        exist = True
                    Else
                        resaExist = Functions.getElementByCode(CODE_RESERVATION_DEPART, "reservation", "CODE_RESERVATION")

                        If resaExist.Rows.Count > 0 Then
                            exist_reservation = True
                            exist = True
                        End If

                    End If

                    Dim messageDeConfirmation As String = ""
                    GlobalVariable.duplicationDeReservation = False

                    'DAY USE ou SEJOURS

                    '---------------------------------------- 

                    'DEBUT ON SE RASSURE QUE LE NUMERO DE CHAMBRE N'EST PAS VIDE OU EXISTE VRAIMENT -------------------------------------

                    Dim continuer As Boolean = False

                    Dim dialog01 As DialogResult

                    Dim message As String = ""

                    If Trim(GunaTextBoxNumeroChambre.Text).Equals("") Or Trim(GunaTextBoxNumeroChambre.Text).Equals("-") Then

                        'SI LA CHAMBRE EST VIDE ET QUE ON TRAITE UN CHECKIN ON NE DOIT PAS POUVOIR CONTINUER
                        If exist_reserve_conf Then
                            continuer = False

                            If GlobalVariable.actualLanguageValue = 1 Then
                                message = "Bien vouloir saisir un numéro de chambre valide !!"
                            Else
                                message = "Please type in a valide room number !!"
                            End If

                        Else
                            continuer = True

                        End If

                    Else

                        Dim roomInfoSuo As DataTable = Functions.getElementByCode(GunaTextBoxNumeroChambre.Text, "chambre", "CODE_CHAMBRE")

                        If roomInfoSuo.Rows.Count > 0 Then
                            continuer = True
                        Else

                            If GlobalVariable.actualLanguageValue = 1 Then
                                message = "Bien vouloir saisir un numéro de chambre valide !!"
                            Else
                                message = "Please type in a valide room number !!"
                            End If

                        End If

                    End If

                    Dim shortMessage As String = ""

                    If Not exist Then

                        If GlobalVariable.actualLanguageValue = 1 Then
                            shortMessage = "Réserver"
                        Else
                            shortMessage = "Booking"
                        End If

                    Else

                        If GlobalVariable.actualLanguageValue = 1 Then
                            shortMessage = "Enregistrement"
                        Else
                            shortMessage = "Save"
                        End If

                    End If

                    If Not continuer Then
                        dialog01 = MessageBox.Show(message, shortMessage, MessageBoxButtons.OK, MessageBoxIcon.Warning)
                    End If

                    'END ON SE RASSURE QUE LE NUMERO DE CHAMBRE N'EST PAS VIDE OU EXISTE VRAIMENT -------------------------------------

                    If continuer Then

                        '----------------------------------------

                        If multiplier Then
                            montant_total = Double.Parse(GunaTextBoxMontantAccorde.Text) * Integer.Parse(GunaTextBoxTempsAFaire.Text)
                        Else
                            montant_total = Double.Parse(GunaTextBoxMontantAccorde.Text)
                        End If

                        If GunaCheckBoxDayUse.Checked Then

                            If GlobalVariable.actualLanguageValue = 1 Then
                                messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Type de Chambre : " & GunaTextBoxLibelleTYpe.Text & "; N° Chambre : " & GunaTextBoxNumeroChambre.Text & Chr(13) & " Durée : " & GunaComboBoxHeureArrivee.SelectedItem.ToString & " - " & GunaComboBoxHeureDepart.SelectedItem.ToString & " soit (" & GunaTextBoxTempsAFaire.Text & ") Heure(s)" & Chr(13) & "Tarif réel : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                            Else
                                messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Room Type : " & GunaTextBoxLibelleTYpe.Text & "; Room N° : " & GunaTextBoxNumeroChambre.Text & Chr(13) & " Period : " & GunaComboBoxHeureArrivee.SelectedItem.ToString & " - " & GunaComboBoxHeureDepart.SelectedItem.ToString & " For (" & GunaTextBoxTempsAFaire.Text & ") Hour(s)" & Chr(13) & "real Price : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")

                            End If

                        Else

                            If GunaRadioButtonChambre.Checked Then
                                'GESTION DES CHAMBRES
                                If GlobalVariable.actualLanguageValue = 1 Then
                                    messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Type de Chambre : " & GunaTextBoxLibelleTYpe.Text & "; N° Chambre: " & GunaTextBoxNumeroChambre.Text & Chr(13) & "Période : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " soit (" & GunaTextBoxTempsAFaire.Text & ") Jour(s)" & Chr(13) & "Tarif réel : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")

                                Else
                                    messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Room Type : " & GunaTextBoxLibelleTYpe.Text & "; Room N°: " & GunaTextBoxNumeroChambre.Text & Chr(13) & "Period : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " for (" & GunaTextBoxTempsAFaire.Text & ") Day(s)" & Chr(13) & "Real Price : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")

                                End If

                            Else

                                'GESTION DES SALLES
                                Dim nomEvent As String = ""

                                Dim infoSupEvent As DataTable = Functions.getElementByCode(GunaComboBoxEvenement.SelectedValue.ToString, "evenement", "CODE_EVENEMENT")

                                If infoSupEvent.Rows.Count > 0 Then
                                    nomEvent = infoSupEvent.Rows(0)("LIBELLE")
                                End If

                                If GlobalVariable.actualLanguageValue = 1 Then
                                    messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Type de Salle: " & GunaTextBoxLibelleTYpe.Text & "; Salle : " & GunaTextBoxNumeroChambre.Text & Chr(13) & "Pour : " & nomEvent & Chr(13) & "Période : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " soit (" & GunaTextBoxTempsAFaire.Text & ") Jour(s)" & Chr(13) & "Tarif réel : " & GunaTextBoxMontantReelSalle.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                                Else
                                    messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Party Hall type : " & GunaTextBoxLibelleTYpe.Text & "; Hall : " & GunaTextBoxNumeroChambre.Text & Chr(13) & "For  : " & nomEvent & Chr(13) & "Period : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " for (" & GunaTextBoxTempsAFaire.Text & ") Days(s)" & Chr(13) & "Real Price : " & GunaTextBoxMontantReelSalle.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                                End If

                            End If

                        End If

                        Dim messageTitre As String = ""

                        If Not exist Then
                            If GlobalVariable.actualLanguageValue = 1 Then
                                messageTitre = "Confirmation de Réservation"
                            Else
                                messageTitre = "Booking Confirmation"
                            End If
                        Else
                            If GlobalVariable.actualLanguageValue = 1 Then
                                messageTitre = "Enregistrement de Réservation"
                            Else
                                messageTitre = "Booking Saving"
                            End If
                        End If

                        Dim dialogEnregistrerReserver As DialogResult = MessageBox.Show(messageDeConfirmation, messageTitre, MessageBoxButtons.OKCancel, MessageBoxIcon.Information)

                        If dialogEnregistrerReserver = DialogResult.OK Then

                            Me.Cursor = Cursors.WaitCursor

                            GlobalVariable.duplicationDeReservation = False

                            Dim CODE_TARIF_RESERVATION As String = ""

                            If GlobalVariable.tarificationDynamiqueActif Then

                                If GunaComboBoxCodeTarif.SelectedIndex >= 0 Then

                                    If GunaComboBoxCodeTarif.Visible Then
                                        CODE_TARIF_RESERVATION = GunaComboBoxCodeTarif.SelectedValue.ToString()
                                    End If

                                End If

                            End If

                            Dim BC_ENTREPRISE As String = GunaTextBoxBC.Text
                            Dim TELEPHONE_CLIENT As String = Trim(GunaTextBoxTelClient.Text)

                            LabelNatureReservation.Visible = False

                            Dim solde As Double = 0

                            Double.TryParse(GunaLabelSolde.Text, solde)

                            If 0 > solde Then
                                GunaLabelSolde.ForeColor = Color.Red
                            ElseIf 0 = solde Then
                                GunaLabelSolde.ForeColor = Color.Black
                            ElseIf solde > 0 Then
                                GunaLabelSolde.ForeColor = Color.Green
                            End If

                            'GunaLabelNumReservation.Visible = False 'We hide reservation code

                            'Insertion de donnees dans la table reservation

                            Dim TYPE_CHAMBRE_OU_SALLE As String = ""

                            If GunaRadioButtonChambre.Checked Then

                                TYPE_CHAMBRE_OU_SALLE = "chambre"

                            ElseIf GunaRadioButtonSalleFete.Checked Then

                                TYPE_CHAMBRE_OU_SALLE = "salle"

                            End If

                            If GunaRadioButtonMailOui.Checked Then
                                GlobalVariable.RECEVOIR_EMAIL = 1
                            Else
                                GlobalVariable.RECEVOIR_EMAIL = 0
                            End If

                            If GunaRadioButtonWhatsAppOui.Checked Then
                                GlobalVariable.RECEVOIR_SMS = 1
                            Else
                                GlobalVariable.RECEVOIR_SMS = 0
                            End If

                            'Dim CLIENT_ID As String = GlobalVariable.codeClient

                            Dim CLIENT_ID As String = GunaTextBoxRefClient.Text
                            Dim UTILISATEUR_ID As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

                            Dim CHAMBRE_ID As String = ""

                            If Not Trim(GunaTextBoxNumeroChambre.Text) = "" Then
                                CHAMBRE_ID = Trim(GunaTextBoxNumeroChambre.Text)
                            Else
                                CHAMBRE_ID = "-"
                            End If

                            Dim AGENCE_ID As String = GlobalVariable.codeAgence
                            Dim NOM_CLIENT As String = GunaTextBoxNomPrenom.Text

                            'ROUTAGE PETIT DEJEUNER
                            Dim PETIT_DEJEUNER_ROUTAGE As Double = 0

                            If GunaCheckBoxPetitDejRoutage.Checked Then
                                Dim pdjRoutage As Double = 0
                                Double.TryParse(GunaTextBoxPetitDejeunerRoutage.Text, pdjRoutage)
                                PETIT_DEJEUNER_ROUTAGE = pdjRoutage
                            End If

                            'ROUTAGE LOGEMENT
                            Dim CHAMBRE_ROUTAGE As String = ""

                            If GunaCheckBoxChambreRoutage.Checked Then

                                If GunaComboBoxChambreRoutage.SelectedIndex >= 0 Then
                                    CHAMBRE_ROUTAGE = GunaComboBoxChambreRoutage.SelectedValue.ToString

                                End If

                            End If

                            Dim ETAT_NOTE_RESERVATION As String = ""

                            If Trim(LabelNatureReservation.Text) = "" Then
                                If GlobalVariable.actualLanguageValue = 1 Then
                                    ETAT_NOTE_RESERVATION = "ATTENDUE"
                                Else
                                    ETAT_NOTE_RESERVATION = "EXPECTED"
                                End If
                            Else
                                ETAT_NOTE_RESERVATION = Trim(LabelNatureReservation.Text)
                            End If

                            Dim CODE_RESERVATION = GunaLabelNumReservation.Text

                            If Trim(GunaButtonReservation.Text).Equals("Réserver") Or Trim(GunaButtonReservation.Text).Equals("Booking") Then
                                If GlobalVariable.actualLanguageValue = 1 Then
                                    ETAT_NOTE_RESERVATION = "ATTENDUE"
                                Else
                                    ETAT_NOTE_RESERVATION = "EXPECTED"
                                End If

                            End If

                            Dim ROUTAGE As String = ""

                            If GlobalVariable.actualLanguageValue = 1 Then
                                ROUTAGE = "NON"
                            Else
                                ROUTAGE = "NO"
                            End If

                            If GunaCheckBoxChambreRoutage.Checked Then
                                If GlobalVariable.actualLanguageValue = 1 Then
                                    ROUTAGE = "OUI"
                                Else
                                    ROUTAGE = "YES"
                                End If
                            End If

                            Dim SOURCE_RESERVATION As String = ""

                            If GunaComboBoxSourceReservation.SelectedIndex >= 0 Then
                                SOURCE_RESERVATION = GunaComboBoxSourceReservation.SelectedValue.ToString
                            End If

                            Dim VENANT_DE As String = GunaTextBoxVenantDe.Text
                            Dim SE_RENDANT_A As String = GunaTextBoxSerendantA.Text
                            Dim RAISON As String = GunaComboBoxTypeReservation.SelectedItem.ToString

                            If Trim(GunaTextBoxPetitDejeuner.Text) = "" Then
                                GunaTextBoxPetitDejeuner.Text = 0
                            End If

                            Dim PETIT_DEJEUNER As Double = GunaTextBoxPetitDejeuner.Text

                            Dim BFK_COST As Double = 0
                            If Not Trim(GunaTextBoxBreakFastCost.Text).Equals("") Then
                                BFK_COST = GunaTextBoxBreakFastCost.Text
                            End If
                            '----------------- dates obtained when ever the resting days change----------------------------------
                            'Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

                            'Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

                            '-------------------------- DAY USE MANAGEMENT ---------------------------------
                            Dim DAY_USE As Integer = 0

                            If GunaCheckBoxDayUse.Checked Then
                                DAY_USE = 1
                            End If

                            Dim MENSUEL As Integer = 0

                            If GunaCheckBoxMensuel.Checked Then
                                MENSUEL = 1
                            End If

                            Dim ETAT As Integer = 0 'gratuitee_de_resa
                            If GunaCheckBoxGratuitee.Checked Then
                                ETAT = 1
                            End If
                            Functions.updateOfFields("gratuitee_de_resa", "ETAT", ETAT, "CODE_RESERVATION", CODE_RESERVATION, 1)
                            '--------------------------------- GESTION DU DAY USE -----------------------------------------

                            '----------------------------------------------------------------------------------------------

                            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & GunaComboBoxHeureArrivee.SelectedItem

                            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & GunaComboBoxHeureDepart.SelectedItem

                            '-------------------------------------
                            Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
                            Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

                            'Dim DATE_ENTTRE As Date = GlobalVariable.DATE_ENTTRE
                            Dim DATE_ENTTRE As Date = GunaDateTimePickerArrivee.Value.ToShortDateString
                            Dim HEURE_ENTREE As String = DateTimeArrivee
                            'Dim DATE_SORTIE As Date = GlobalVariable.DATE_SORTIE
                            Dim DATE_SORTIE As Date = GunaDateTimePickerDepart.Value.ToShortDateString
                            Dim HEURE_SORTIE As String = DateTimeDepart

                            Dim ADULTES As Integer = GunaTextBoxNbreAdulte.Text
                            Dim ENFANTS As Integer = GunaTextBoxNbreEnfant.Text
                            'Dim NB_PERSONNES As Integer = ENFANTS + ADULTES

                            If Trim(GunaTextBoxNbrePersonne.Text) = "" Then
                                GunaTextBoxNbrePersonne.Text = 0
                            End If

                            If Trim(GunaTextBoxMontantCaution.Text) = "" Then
                                GunaTextBoxMontantCaution.Text = 0
                            End If

                            Dim NB_PERSONNES As Integer = GunaTextBoxNbrePersonne.Text
                            Dim RECEVOIR_EMAIL As Integer = GlobalVariable.RECEVOIR_EMAIL
                            Dim RECEVOIR_SMS As Integer = GlobalVariable.RECEVOIR_SMS
                            Dim ETAT_RESERVATION As Integer = 0
                            Dim DATE_CREATION As Date = GlobalVariable.DateDeTravail
                            Dim HEURE_CREATION As DateTime = DateTime.Now().ToString("hh:mm:ss")
                            Dim MONTANT_TOTAL_CAUTION As Double = GunaTextBoxMontantCaution.Text
                            Dim MOTIF_ETAT As String = ""
                            Dim DATE_ETAT As Date = GlobalVariable.DateDeTravail
                            'Dim MONTANT_ACCORDE As Double = GlobalVariable.MONTANT_ACCORDE
                            Dim MONTANT_ACCORDE As Double = 0

                            'RECALCUL DU MONTANT POUR LES DAY USE

                            Dim DEBUT_HEURE As Date = CDate(DateTimeArrivee).ToShortTimeString
                            Dim FIN_HEURE As Date = CDate(DateTimeDepart).ToShortTimeString

                            Dim NOMBRE_HEURE As Integer = 1

                            If GunaCheckBoxDayUse.Checked Then
                                NOMBRE_HEURE = CType((FIN_HEURE - DEBUT_HEURE).TotalHours, Int32)
                            End If

                            If GlobalVariable.typeChambreOuSalle = "salle" Then
                                If Not Trim(GunaTextBoxMontantReelSalle.Text) = "" Then
                                    MONTANT_ACCORDE = Double.Parse(GunaTextBoxMontantReelSalle.Text) * NOMBRE_HEURE
                                End If
                            ElseIf GlobalVariable.typeChambreOuSalle = "chambre" Then
                                If Not Trim(GunaTextBoxMontantAccorde.Text) = "" Then
                                    MONTANT_ACCORDE = Double.Parse(GunaTextBoxMontantAccorde.Text) * NOMBRE_HEURE
                                End If
                            End If

                            Dim CODE_ENTREPRISE As String = Trim(GunaTextBoxCodeEntrepriseDuClient.Text)
                            Dim NOM_ENTREPRISE As String = Trim(GunaTextBoxEntrepriseDuclient.Text)

                            Dim GROUPE As String = GunaTextBoxCodeDeGroupe.Text

                            'RESERVATION DE GROUPE

                            'Dim CODE_RESERVATION = Functions.GeneratingRandomCodeWithSpecifications("reservation", "RESA")

                            Dim reservation As New Reservation()
                            Dim mainCourante As New MainCourantes()
                            Dim reglement As New Reglement()
                            Dim occupationChambre As New OccupationChambre()
                            Dim facture As New Facture()
                            Dim ligneFacture As New LigneFacture()
                            Dim compte As New Compte()
                            Dim caisse As New Caisse()

                            '------------------------------- REGLEMENT ----------------------------------------------

                            If GunaTextBoxDepotDeGarantie.Text = "" Then
                                GunaTextBoxDepotDeGarantie.Text = 0
                            End If

                            Dim DEPOT_DE_GARANTIE As Double = Double.Parse(GunaTextBoxDepotDeGarantie.Text)

                            Dim NUM_FACTURE As String = ""
                            Dim CODE_CAISSIER As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
                            Dim montantVerse As Double = 0
                            Double.TryParse(GunaTextBoxAvance.Text, montantVerse)
                            Dim MONTANT_VERSE As Double = montantVerse
                            Dim DATE_REGLEMENT As Date = GlobalVariable.DateDeTravail
                            Dim MODE_REGLEMENT As String = ""
                            Dim REF_REGLEMENT As String = ""

                            If GlobalVariable.actualLanguageValue = 1 Then
                                MODE_REGLEMENT = "Garantie"
                                REF_REGLEMENT = "DEPOT DE GARANTIE DE " & "[" & NOM_CLIENT & " / " & CHAMBRE_ID & "]"
                            Else
                                MODE_REGLEMENT = "Arrhes"
                                REF_REGLEMENT = "ARRHES OF " & "[" & NOM_CLIENT & " / " & CHAMBRE_ID & "]"
                            End If

                            Dim CODE_MODE As String = ""
                            Dim IMPRIMER As Double = 0

                            Dim NUMERO_BLOC_NOTE = ""
                            Dim MODE_REG_INFO_SUP_1 = ""
                            Dim MODE_REG_INFO_SUP_2 = ""
                            Dim MODE_REG_INFO_SUP_3 = ""

                            Dim CODE_CLIENT As String = Trim(GunaTextBoxRefClient.Text)
                            Dim CODE_AGENCE As String = AGENCE_ID

                            Dim CODE_MAIN_COURANTE_JOURNALIERE As String = Functions.GeneratingRandomCodeWithSpecifications("main_courante_journaliere", "MCJ")

                            Dim TYPE_CHAMBRE As String = GunaTextBoxCodeTypeDeChambre.Text
                            'ON MET AJOUR LE MONTANT DU SOLDE LIE A LA RESERVATION

                            Dim updatedSolde As Double = 0

                            Dim POSTER_TAX As Double = 0 'TAUX_OCCUPATION_PCT USED AS TAXE DE SEJOUR

                            'Inserting a new reservation after checking that the reservation does not already exist
                            If True Then

                                ' variables declarations 

                                '-------------------------------- OCCUPATION CHAMBRE ------------------------------

                                Dim CODE_OCCUPATION_CHAMBRE = Functions.GeneratingRandomCodeWithSpecifications("occupation_chambre", "")
                                Dim MONTANT_HT As Double = MONTANT_ACCORDE
                                Dim TAXE As Double = 0
                                Dim MONTANT_TTC As Double = 0
                                Dim DATE_OCCUPATION As Date = DATE_ENTTRE
                                'Dim OBSERVATIONS As String = ""
                                Dim COMMENTAIRE1 As String = ""
                                Dim COMMENTAIRE2 As String = ""
                                Dim COMMENTAIRE3 As String = ""
                                Dim COMMENTAIRE4 As String = ""
                                Dim DATE_LIBERATION As Date = DATE_SORTIE
                                Dim CODE_UTILISATEUR_CREA As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
                                Dim DATE_PREMIERE_ARRIVEE As Date = DATE_ENTTRE
                                Dim TYPE_RESERVATION As String = ""
                                Dim PDJ_INCLUS As String = ""
                                Dim TAXE_SEJOURS_INCLUS As String = ""
                                Dim TVA_INCLUS As String = ""
                                Dim CODE_CLIENT_REEL As String = CLIENT_ID

                                '----------- MAIN COURANTES ------------------------------
                                Dim CODE_MAIN_COURANTE As String = Functions.GeneratingRandomCodeWithSpecifications("main_courante", "MC")

                                'Dim CODE_CLIENT As String = GlobalVariable.codeClient


                                CLIENT_ID = Trim(GunaTextBoxRefClient.Text)

                                Dim CODE_CHAMBRE As String = GlobalVariable.codeChambre
                                Dim ETAT_CHAMBRE As String = 0


                                '----------- MAIN COURANTE GENERALE ------------------------------

                                Dim TAUX_OCCUPATION_PCT As Double = 0 'TAUX_OCCUPATION_PCT USED AS TAXE DE SEJOUR


                                If GunaCheckBoxTaxeSejour.Checked Then
                                    If Not Trim(GunaTextBoxTaxeSejour.Text).Equals("") Then
                                        TAUX_OCCUPATION_PCT = GunaTextBoxTaxeSejour.Text
                                        POSTER_TAX = GunaTextBoxTaxeSejour.Text
                                    End If
                                Else
                                    Functions.DeleteElementByCode(CODE_RESERVATION, "taxe_sejour_collectee", "NUM_RESERVATION")
                                    'Functions.updateOfFields("main_courante_journaliere", "TAUX_OCCUPATION_PCT", TAUX_OCCUPATION_PCT, "NUM_RESERVATION", CODE_RESERVATION, 1)
                                End If

                                Dim CODE_MAIN_COURANTE_GENERALE As String = Functions.GeneratingRandomCodeWithSpecifications("main_courante_generale", "MCG")
                                Dim DATE_MAIN_COURANTE As Date = GlobalVariable.DateDeTravail
                                Dim PDJ_FOOD As Double = 0
                                Dim PDJ_BOISSON As Double = 0
                                Dim DEJEUNER_FOOD As Double = 0
                                Dim DEJEUNER_BOISSON As Double = 0
                                Dim DINER_FOOD As Double = 0
                                Dim DINER_BOISSON As Double = 0
                                Dim BANQUET_FOOD As Double = 0
                                Dim BANQUET_BOISSON As Double = 0
                                Dim BAR_MATIN As Double = 0
                                Dim BAR_SOIR As Double = 0
                                Dim DIVERS As Double = 0

                                Dim TOTAL_JOUR As Double = MONTANT_ACCORDE + TAUX_OCCUPATION_PCT
                                Dim REPORT_VEILLE As Double = 0
                                Dim TOTAL_GENERAL As Double = MONTANT_ACCORDE + TAUX_OCCUPATION_PCT
                                Dim NUM_RESERVATION = CODE_RESERVATION
                                Dim DEDUCTION As Double = 0
                                Dim ENCAISSEMENT_ESPECE As Double = 0
                                Dim ENCAISSEMENT_CHEQUE As Double = 0
                                Dim ENCAISSEMENT_CARTE_CREDIT As Double = 0
                                'Dim A_REPORTER As Double = MONTANT_ACCORDE + TAUX_OCCUPATION_PCT
                                Dim A_REPORTER As Double = Functions.SituationDeReservation(CODE_RESERVATION)
                                Dim OBSERVATIONS As String = ""


                                Dim INDICE_FREQUENTATION As Double = 0
                                Dim INDICE_FREQUENTATION_PCT As Double = 0
                                Dim TAUX_OCCUPATION As Double = 0

                                Dim CLIENTS_ATTENDUS As Integer = 0
                                Dim CLIENTS_EN_CHAMBRE As Integer = GunaTextBoxNbrePersonne.Text
                                Dim CHAMBRES_DISPONIBLES As Integer = 0
                                Dim TOTAL_HORS_SERVICE As Integer = 0
                                Dim CHAMBRES_HORS_SERVICE As Integer = 0
                                Dim TOTAL_FICTIVES As Integer = 0
                                Dim CHAMBRES_FICTIVES As Integer = 0
                                Dim NOMBRE_MESSAGES As Integer = 0
                                Dim TOTAL_GRATUITES As Double = 0
                                Dim CHAMBRES_GRATUITES As Integer = 0
                                Dim TOTAL_NON_FACTUREES As Double = 0
                                Dim CHAMBRES_NON_FACTUREES As Integer = 0

                                '----------- MAIN COURANTE JOURNALIERE ------------------------------

                                Dim PDJ As Double = 0
                                Dim DEJEUNER As Double = 0
                                Dim DINER As Double = 0
                                Dim CAFE As Double = 0
                                Dim BAR As Double = 0
                                Dim CAVE As Double = 0
                                Dim AUTRE As Double = 0
                                Dim SOUS_TOTAL1 As Double = 0
                                Dim Location As Double = 0
                                Dim TELE As Double = 0
                                Dim FAX As Double = 0
                                Dim LINGE As Double = 0
                                Dim SOUS_TOTAL2 As Double = 0
                                Dim DEBITEUR As Double = 0
                                Dim ARRHES As Double = 0

                                If GunaCheckBoxPetitDejeuenerInclus.Checked Then

                                    Dim petitDejeuner As Double = 0
                                    Double.TryParse(GunaTextBoxPetitDejeuner.Text, petitDejeuner)
                                    SOUS_TOTAL1 = petitDejeuner 'On gère les petit dejeuener inclus par apport a la valeur SOUS_TOTAL1 de la main courante journaliere

                                End If

                                Dim AFFICHER_PRIX As Integer = 1

                                If Not GunaCheckBoxAfficherPrix.Checked Then
                                    AFFICHER_PRIX = 0
                                End If
                                '------------------------------- compte -----------------------------

                                Dim INTITULE As String = ""
                                Dim NUMERO_COMPTE As String = ""
                                Dim TOTAL_DEBIT As Double = GlobalVariable.MONTANT_TOTAL
                                Dim TOTAL_CREDIT As Double = GlobalVariable.avance
                                Dim SOLDE_COMPTE As Double = TOTAL_CREDIT - TOTAL_DEBIT

                                Dim SENS_DU_SOLDE As String = ""

                                If (TOTAL_DEBIT < TOTAL_CREDIT) Then
                                    SENS_DU_SOLDE = "crediteur**************"
                                ElseIf (TOTAL_CREDIT < TOTAL_DEBIT) Then
                                    SENS_DU_SOLDE = "debiteur***************"
                                Else
                                    SENS_DU_SOLDE = "equilibre***************"
                                End If

                                Dim TYPE_DE_COMPTE As String = ""

                                '--------------------------- FORFAIT SALLE ---------------------------
                                Dim nbreCafe As Integer = 0
                                Dim cafePu As Double = 0
                                Dim dejeunerNbre As Integer = 0
                                Dim dejeunerPu As Double = 0
                                Dim dinerNbre As Integer = 0
                                Dim dinerPu As Double = 0
                                Dim traiteurNbre As Integer = 0
                                Dim traiteurPu As Double = 0

                                Double.TryParse(GunaTextBox35.Text, nbreCafe)
                                Double.TryParse(GunaTextBoxForfaitCafe.Text, cafePu)
                                Double.TryParse(GunaTextBox30.Text, dejeunerNbre)
                                Double.TryParse(GunaTextBoxForfatiDejeuner.Text, dejeunerPu)
                                Double.TryParse(GunaTextBox25.Text, dinerNbre)
                                Double.TryParse(GunaTextBoxForfaitDiner.Text, dinerPu)
                                Double.TryParse(GunaTextBox13.Text, traiteurNbre)
                                Double.TryParse(GunaTextBoxForfaitTraiteur.Text, traiteurPu)

                                Dim NBRE__CAFE = nbreCafe
                                Dim PU_CAFE = cafePu
                                Dim NBRE_DEJEUNER = dejeunerNbre
                                Dim PU_DEJEUNER = dejeunerPu
                                Dim NBRE_DINER = dinerNbre
                                Dim PU_DINER = dinerPu
                                Dim NBRE_TRAITEUR = traiteurNbre
                                Dim PU_TRAITEUR = traiteurPu
                                Dim decorationCast As Double = 0
                                Double.TryParse(GunaTextBoxDecoration.Text, decorationCast)
                                Dim DECORATION = decorationCast


                                Dim LOCATION_MATERIEL As Double = 0
                                Dim AUTRES As Double = 0

                                If Not Trim(GunaTextBoxMateriel.Text) = "" Then
                                    LOCATION_MATERIEL = GunaTextBoxMateriel.Text
                                End If

                                If Not Trim(GunaTextBoxAutres.Text) = "" Then
                                    AUTRES = GunaTextBoxAutres.Text
                                End If

                                Dim CODE_EVENEMENT = ""
                                Dim LIBELLE_EVENEMENT = ""

                                If GunaComboBoxEvenement.SelectedIndex >= 0 Then

                                    CODE_EVENEMENT = GunaComboBoxEvenement.SelectedValue

                                    Dim evenement As DataTable = Functions.getElementByCode("CODE_EVENEMENT", "evenement", "CODE_EVENEMENT")

                                    If evenement.Rows.Count > 0 Then
                                        LIBELLE_EVENEMENT = evenement.Rows(0)("LIBELLE_EVENEMENT")
                                    End If

                                End If

                                Dim NBRE_GOUTER As Integer = 0
                                Dim PU_GOUTER As Double = 0
                                Dim NBRE_COCKTAIL As Integer = 0
                                Dim PU_COCKTAIL As Double = 0

                                If Not Trim(GunaTextBoxQteGouter.Text) = "" Then
                                    NBRE_GOUTER = GunaTextBoxQteGouter.Text
                                End If

                                If Not Trim(GunaTextBoxPrixGouter.Text) = "" Then
                                    PU_GOUTER = GunaTextBoxPrixGouter.Text
                                End If

                                If Not Trim(GunaTextBoxCocktail.Text) = "" Then
                                    NBRE_COCKTAIL = GunaTextBoxCocktail.Text
                                End If

                                If Not Trim(GunaTextBoxPUCocktail.Text) = "" Then
                                    PU_COCKTAIL = GunaTextBoxPUCocktail.Text
                                End If

                                '-------------------------addition forfait salle -------------------------------------

                                Dim HEURE_PAUSE_CAFE As String = ""
                                If GunaComboBoxHeureCafe.SelectedIndex >= 0 Then
                                    HEURE_PAUSE_CAFE = GunaComboBoxHeureCafe.SelectedItem
                                End If

                                Dim HEURE_PAUSE_DEJEUNER As String = ""
                                If GunaComboBoxHeureDej.SelectedIndex >= 0 Then
                                    HEURE_PAUSE_DEJEUNER = GunaComboBoxHeureDej.SelectedItem
                                End If

                                Dim HEURE_DINER As String = ""
                                If GunaComboBoxHeureDiner.SelectedIndex >= 0 Then
                                    HEURE_DINER = GunaComboBoxHeureDiner.SelectedItem
                                End If

                                Dim HEURE_GOUTER As String = ""
                                If GunaComboBoxHeureGouter.SelectedIndex >= 0 Then
                                    HEURE_GOUTER = GunaComboBoxHeureGouter.SelectedItem
                                End If

                                Dim HEURE_COCKTAIL As String = ""
                                If GunaComboBoxHeureCocktail.SelectedIndex >= 0 Then
                                    HEURE_COCKTAIL = GunaComboBoxHeureCocktail.SelectedItem
                                End If

                                Dim VIDEO_PROJ As Integer = 0
                                If GunaCheckBoxVidOui.Checked Then
                                    VIDEO_PROJ = 1
                                ElseIf GunaCheckBoxVidNon.Checked Then
                                    VIDEO_PROJ = 0
                                Else
                                    VIDEO_PROJ = 0
                                End If

                                Dim SONO As Integer = 0
                                If GunaCheckBoxSonoOui.Checked Then
                                    SONO = 1
                                ElseIf GunaCheckBoxSonoNon.Checked Then
                                    SONO = 0
                                Else
                                    SONO = 0
                                End If

                                Dim COUVERTS As Integer = 0
                                If GunaCheckBoxCouvOui.Checked Then
                                    COUVERTS = 1
                                ElseIf GunaCheckBoxCouvNon.Checked Then
                                    COUVERTS = 0
                                Else
                                    COUVERTS = 0
                                End If

                                Dim TABLE_CHAISE As Integer = 0
                                If GunaCheckBoxTableOui.Checked Then
                                    TABLE_CHAISE = 1
                                ElseIf GunaCheckBoxTableNon.Checked Then
                                    TABLE_CHAISE = 0
                                Else
                                    TABLE_CHAISE = 0
                                End If

                                Dim EAU_PTE_QTE As Integer = 0
                                If Not Trim(GunaTextBox47.Text) = "" Then
                                    EAU_PTE_QTE = GunaTextBox47.Text
                                End If

                                Dim EAU_PTE_MONTANT As Double = 0
                                If Not Trim(GunaTextBoxMontantEauPetiteBouteille.Text) = "" Then
                                    EAU_PTE_MONTANT = GunaTextBoxMontantEauPetiteBouteille.Text
                                End If

                                Dim EAU_GRDE_QTE As Integer = 0
                                If Not Trim(GunaTextBox10.Text) = "" Then
                                    EAU_GRDE_QTE = GunaTextBox10.Text
                                End If

                                Dim EAU_GRDE_MONTANT As Double = 0
                                If Not Trim(GunaTextBox68.Text) = "" Then
                                    EAU_GRDE_MONTANT = GunaTextBox68.Text
                                End If

                                Dim BOISSONS_GAZEUSES_QTE As Integer = 0
                                If Not Trim(GunaTextBox48.Text) = "" Then
                                    BOISSONS_GAZEUSES_QTE = GunaTextBox48.Text
                                End If

                                Dim BOISSONS_GAZEUSES_MONTANT As Double = 0
                                If Not Trim(GunaTextBox62.Text) = "" Then
                                    BOISSONS_GAZEUSES_MONTANT = GunaTextBox62.Text
                                End If

                                Dim BIERES_QTE As Integer = 0
                                If Not Trim(GunaTextBox50.Text) = "" Then
                                    BIERES_QTE = GunaTextBox50.Text
                                End If

                                Dim BIERES_MONTANT As Double = 0
                                If Not Trim(GunaTextBox61.Text) = "" Then
                                    BIERES_MONTANT = GunaTextBox61.Text
                                End If

                                Dim VIN_ROUGE_QTE As Integer = 0
                                If Not Trim(GunaTextBox54.Text) = "" Then
                                    VIN_ROUGE_QTE = GunaTextBox54.Text
                                End If

                                Dim VIN_ROUGE_MONTANT As Double = 0
                                If Not Trim(GunaTextBox59.Text) = "" Then
                                    VIN_ROUGE_MONTANT = GunaTextBox59.Text
                                End If

                                Dim VIN_ROSE_QTE As Integer = 0
                                If Not Trim(GunaTextBox63.Text) = "" Then
                                    VIN_ROSE_QTE = GunaTextBox63.Text
                                End If

                                Dim delogement As Boolean = False

                                Dim VIN_ROSE_MONTANT As Double = 0
                                If Not Trim(GunaTextBox64.Text) = "" Then
                                    VIN_ROSE_MONTANT = GunaTextBox64.Text
                                End If

                                Dim BOISSONS_EXT_QTE As Integer = 0
                                If Not Trim(GunaTextBox36.Text) = "" Then
                                    BOISSONS_EXT_QTE = GunaTextBox36.Text
                                End If

                                Dim BOISSONS_EXT_MONTANT As Double = 0
                                If Not Trim(GunaTextBox57.Text) = "" Then
                                    BOISSONS_EXT_MONTANT = GunaTextBox57.Text
                                End If

                                Dim DROIT_DE_BOUCHON As Double = 0
                                If Not Trim(GunaTextBoxDroitDeBouchon.Text) = "" Then
                                    DROIT_DE_BOUCHON = GunaTextBoxDroitDeBouchon.Text
                                End If

                                Dim MISE_EN_PLACE As Integer = 0 ' U

                                If GunaCheckBoxU.Checked Then
                                    MISE_EN_PLACE = 1
                                ElseIf GunaCheckBoxEcole.Checked Then
                                    MISE_EN_PLACE = 2 ' Ecole
                                ElseIf GunaCheckBoxTheatre.Checked Then
                                    MISE_EN_PLACE = 3 ' Theatre
                                ElseIf GunaCheckBoxRectangle.Checked Then
                                    MISE_EN_PLACE = 4 ' Rectangle
                                ElseIf GunaCheckBoxCocktail.Checked Then
                                    MISE_EN_PLACE = 5 'Cocktail
                                ElseIf GunaCheckBoxBanquet.Checked Then
                                    MISE_EN_PLACE = 6 'Banquet
                                End If

                                Dim CLOISONNEMENT As Integer = 0

                                If GunaCheckBox2.Checked Then
                                    CLOISONNEMENT = 2
                                ElseIf GunaCheckBox9.Checked Then
                                    CLOISONNEMENT = 3 ' Ecole
                                Else
                                    CLOISONNEMENT = 0
                                End If

                                '---------------------- Facturation ---------------------------------------

                                Dim CODE_FACTURE = Functions.GeneratingRandomCodeWithSpecifications("facture", "")
                                Dim NUMERO_PIECE = ""
                                Dim CODE_ARTICLE = ""
                                Dim CODE_LOT = ""
                                Dim QUANTITE = 1
                                Dim PRIX_UNITAIRE_TTC = 0
                                Dim DATE_FACTURE = GlobalVariable.DateDeTravail
                                Dim HEURE_FACTURE = Now().ToShortTimeString
                                Dim ETAT_FACTURE = 0
                                Dim HEURE_OCCUPATION = Now().ToShortTimeString
                                Dim LIBELLE_FACTURE = "AVANCE LOCATION SALLE [ " & CODE_CHAMBRE & " ]"
                                Dim TYPE_LIGNE_FACTURE = 0
                                Dim NUMERO_SERIE = ""
                                Dim NUMERO_ORDRE = ""
                                Dim DESCRIPTION = ""
                                Dim MONTANT_REMISE = 0
                                Dim MONTANT_TAXE = 0
                                Dim NUMERO_SERIE_DEBUT = ""
                                Dim NUMERO_SERIE_FIN = ""
                                Dim CODE_MAGASIN = ""
                                Dim FUSIONNEE = ""
                                Dim Type = GlobalVariable.typeChambreOuSalle
                                Dim CODE_MOUVEMENT = ""
                                Dim CODE_MODE_PAIEMENT = ""

                                '-------------------------- UPDATE ROOM --------------------------------


                                If Not exist Then

                                    '-------------------------------------- MOUCHARDS ---------------------------------------------------
                                    Dim ACTION As String = ""

                                    If GunaCheckBoxDayUse.Checked Then

                                        If GlobalVariable.actualLanguageValue = 1 Then
                                            ACTION = "CREATION DE RESERVATION [CHAMBRE : " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " DE" & DEBUT_HEURE & " - " & FIN_HEURE & "]"

                                        Else
                                            ACTION = "BOOKING CREATION [ROOM : " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " FROM" & DEBUT_HEURE & " - " & FIN_HEURE & "]"

                                        End If
                                    Else
                                        If GlobalVariable.actualLanguageValue = 1 Then
                                            ACTION = "CREATION DE RESERVATION [CHAMBRE : " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " DU " & DATE_ENTTRE & " - " & DATE_SORTIE & "]"

                                        Else
                                            ACTION = "BOOKING CREATION [ROOM : " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " FROM " & DATE_ENTTRE & " - " & DATE_SORTIE & "]"

                                        End If
                                    End If

                                    User.mouchard(ACTION)
                                    '----------------------------------------------------------------------------------------------------

                                    'SUIVI DES RESERVATIONS

                                    Dim roomStatus As String = "Libre propre"
                                    If GlobalVariable.actualLanguageValue = 0 Then
                                        roomStatus = "Free clean"
                                    End If

                                    Dim CODE_SUIVI As String = Functions.GeneratingRandomCodeWithSpecifications("suivi_des_reservations", "SVR")
                                    Dim RESERVATION_PAR As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
                                    Dim CHECKIN_PAR As String = ""
                                    Dim CHECKOUT_PAR As String = ""
                                    Dim DELOGEMENT_PAR As String = ""

                                    User.suiviDesReservations(CODE_SUIVI, CODE_RESERVATION, RESERVATION_PAR, CHECKIN_PAR, CHECKOUT_PAR, DELOGEMENT_PAR)

                                    Dim operation As Integer = 0 'INSERTION
                                    gestionDesNavettes(operation, CODE_RESERVATION)

                                    '---------------------------------------------------------------------------------------------------
                                    'We  update the room, we manually got CODE_CHAMBRE when we inserted the room informations
                                    Dim updateQuery As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code "

                                    Dim command As New MySqlCommand(updateQuery, GlobalVariable.connect)

                                    command.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                                    command.Parameters.Add("@code", MySqlDbType.VarChar).Value = Trim(GunaTextBoxNumeroChambre.Text)
                                    command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = roomStatus

                                    'Opening the connection
                                    'connect.openConnection()

                                    'Excuting the command and testing if everything went on well
                                    If (command.ExecuteNonQuery() = 1) Then
                                        'connect.closeConnection()
                                    End If

                                Else

                                    'DELOGEMENT D'UNE CHAMBRE POUR UNE AUTRE
                                    ' We come from main courante reception journaliere
                                    'The room has been changed
                                    'If Not GlobalVariable.codeChambreToUpdate = GlobalVariable.codeChambre Then
                                    If Not (GlobalVariable.codeChambreToUpdate = GunaTextBoxNumeroChambre.Text) And Not GlobalVariable.duplicationDeReservation Then

                                        delogement = True

                                        'SI ON EST DANS LE CADRE D'UNE RESA DE GROUPE ON NE DOIT PAS DEMANDER LA RAISON DU DELOGEMENT
                                        If Trim(GlobalVariable.codeChambreToUpdate) = "-" Or Trim(GlobalVariable.codeChambreToUpdate) = "" Then
                                            delogement = False
                                        End If

                                        If delogement Then

                                            Dim motifDelogement As String = ""

                                            If GlobalVariable.actualLanguageValue = 1 Then
                                                motifDelogement = InputBox("DELOGEMENT ", " Motif du délogement de " & GlobalVariable.codeChambreToUpdate & " vers " & GunaTextBoxNumeroChambre.Text, "")
                                            Else
                                                motifDelogement = InputBox("DISPLACEMENT ", " Reason of displacement from " & GlobalVariable.codeChambreToUpdate & " to " & GunaTextBoxNumeroChambre.Text, "")
                                            End If

                                            OBSERVATIONS = motifDelogement

                                            Dim newEtatChambre As String = "Libre propre"
                                            If GlobalVariable.actualLanguageValue = 0 Then
                                                newEtatChambre = "Free clean"
                                            End If

                                            Dim reservationActuel As DataTable = Functions.getElementByCode(CODE_RESERVATION_DEPART, "reservation", "CODE_RESERVATION")

                                            If reservationActuel.Rows.Count > 0 Then
                                                If GlobalVariable.actualLanguageValue = 0 Then
                                                    newEtatChambre = "Free clean"
                                                Else
                                                    newEtatChambre = "Libre propre"
                                                End If
                                            Else

                                                Dim reservationConfActuel As DataTable = Functions.getElementByCode(CODE_RESERVATION_DEPART, "reserve_conf", "CODE_RESERVATION")

                                                If reservationConfActuel.Rows.Count > 0 Then
                                                    If GlobalVariable.actualLanguageValue = 0 Then
                                                        newEtatChambre = "Free dirty"
                                                    Else
                                                        newEtatChambre = "Libre sale"
                                                    End If
                                                End If

                                            End If
                                            'The room has been changed, we liberate the old room and set the new room as occupied

                                            '-------------------------------------- MOUCHARDS ---------------------------------------------------
                                            Dim ACTION As String = ""
                                            '"DELOGEMENT ", " Motif du délogement de " & GlobalVariable.codeChambreToUpdate & " vers " & GunaTextBoxNumeroChambre.Text

                                            If GlobalVariable.actualLanguageValue = 1 Then
                                                ACTION = "DELOGEMENT [DE LA CHAMBRE " & GlobalVariable.codeChambreToUpdate & " VERS " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & "  MOTIF : " & OBSERVATIONS & "]"

                                            Else
                                                ACTION = "DISPLACEMENT [FROM ROOM " & GlobalVariable.codeChambreToUpdate & " TO " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & "  REASON : " & OBSERVATIONS & "]"

                                            End If

                                            User.mouchard(ACTION)
                                            '----------------------------------------------------------------------------------------------------

                                            'SUIVI DES RESERVATIONS

                                            Dim CODE_SUIVI As String = Functions.GeneratingRandomCodeWithSpecifications("suivi_des_reservations", "SVR")
                                            Dim RESERVATION_PAR As String = ""
                                            Dim CHECKIN_PAR As String = ""
                                            Dim CHECKOUT_PAR As String = ""
                                            Dim DELOGEMENT_PAR As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

                                            User.updateSuiviDesReservations("DELOGEMENT_PAR", DELOGEMENT_PAR, CODE_RESERVATION)

                                            '-----------------------------------------------------------------------------------------------------

                                            'We liberate the old room so as to set occupy the new room
                                            Dim updateQuery1 As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code"

                                            Dim command1 As New MySqlCommand(updateQuery1, GlobalVariable.connect)

                                            command1.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                                            'command1.Parameters.Add("@code", MySqlDbType.VarChar).Value = GlobalVariable.codeChambre
                                            command1.Parameters.Add("@code", MySqlDbType.VarChar).Value = GlobalVariable.codeChambreToUpdate
                                            command1.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = newEtatChambre

                                            'Opening the connection
                                            'connect.openConnection()

                                            'Excuting the command and testing if everything went on well
                                            If (command1.ExecuteNonQuery() = 1) Then
                                                'connect.closeConnection()
                                            End If

                                            'We set the new room as occupied
                                            'CODE_CHAMBRE = GlobalVariable.codeChambreToUpdate
                                            CODE_CHAMBRE = Trim(GunaTextBoxNumeroChambre.Text)

                                            Dim updateQuery2 As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code"

                                            Dim command2 As New MySqlCommand(updateQuery2, GlobalVariable.connect)

                                            If GlobalVariable.actualLanguageValue = 0 Then

                                                If newEtatChambre = "Free clean" Then
                                                    newEtatChambre = "Occupied clean" 'Simple reservation
                                                Else
                                                    newEtatChambre = "Occupied dirty" 'reservation confirmee
                                                End If

                                            Else

                                                If newEtatChambre = "Libre propre" Then
                                                    newEtatChambre = "Occupée propre" 'Simple reservation
                                                Else
                                                    newEtatChambre = "Occupée sale" 'reservation confirmee
                                                End If

                                            End If

                                            Dim roomStatus As String = "Occupée propre"
                                            If GlobalVariable.actualLanguageValue = 0 Then
                                                roomStatus = "Occupied clean"
                                            End If

                                            command2.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                                            command2.Parameters.Add("@code", MySqlDbType.VarChar).Value = CODE_CHAMBRE
                                            command2.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = roomStatus

                                            If GlobalVariable.actualLanguageValue = 0 Then
                                                OBSERVATIONS = "Displacement from " & GlobalVariable.codeChambreToUpdate & " to " & Trim(GunaTextBoxNumeroChambre.Text) & " for " & motifDelogement
                                            Else
                                                OBSERVATIONS = "Délogement de la " & GlobalVariable.codeChambreToUpdate & " vers " & Trim(GunaTextBoxNumeroChambre.Text) & " pour " & motifDelogement
                                            End If

                                            If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                                                'MISE AJOURS DE LA MAIN COURANTE JOURNALIERE

                                                Dim CODE_MAIN_COURANTE_DELOGEMENT As String = GlobalVariable.codeMainCouranteJournaliereToUpdate
                                                reservation.updateChambreApresDelogement(CODE_MAIN_COURANTE_DELOGEMENT, CODE_CHAMBRE)

                                                User.mouchard(OBSERVATIONS)

                                            End If

                                            If (command2.ExecuteNonQuery() = 1) Then
                                                'connect.closeConnection()
                                            End If

                                            GlobalVariable.duplicationDeReservation = False

                                        End If

                                    End If

                                End If

                                '-------------------------- OCCUPATION CHAMBRE--------------------------
                                If Not Functions.entryCodeExists(CODE_OCCUPATION_CHAMBRE, "occupation_chambre", "CODE_OCCUPATION_CHAMBRE") Then

                                    If GlobalVariable.codeOccupationchambreToUpdate = "" Then
                                        'As the Global variable codeMainCouranteToUpdate is empty => new  Entry

                                        If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                                        End If

                                    Else

                                        'As the Global variable codeMainCouranteToUpdate is not empty => insert again

                                        If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                                        End If

                                    End If

                                End If

                                'GESTION DES AVANCES ICI

                                '----------- MAIN COURANTE GENERALE ------------------------------

                                'We check if the the main courante generale already exist
                                'If Not Functions.entryCodeExists(CODE_MAIN_COURANTE_GENERALE, "main_courante_generale", "CODE_MAIN_COURANTE_GENERALE") Then

                                If GlobalVariable.codeMainCouranteToUpdate = "" Then
                                    'As the Global variable codeMainCouranteGeneraleToUpdate is empty => new  Entry

                                    If mainCourante.insertMainCouranteGenerale(CODE_MAIN_COURANTE_GENERALE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ_FOOD, PDJ_BOISSON, DEJEUNER_FOOD, DEJEUNER_BOISSON, DINER_FOOD, DINER_BOISSON, BANQUET_FOOD, BANQUET_BOISSON, BAR_MATIN, BAR_SOIR, DIVERS, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                                    End If

                                Else
                                    'As the Global variable codeMainCouranteGeneraleToUpdate is not empty => update 

                                    CODE_MAIN_COURANTE_GENERALE = GlobalVariable.codeMainCouranteGeneraleToUpdate
                                    NUM_RESERVATION = CODE_RESERVATION_DEPART

                                    If mainCourante.updateMainCouranteGenerale(CODE_MAIN_COURANTE_GENERALE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ_FOOD, PDJ_BOISSON, DEJEUNER_FOOD, DEJEUNER_BOISSON, DINER_FOOD, DINER_BOISSON, BANQUET_FOOD, BANQUET_BOISSON, BAR_MATIN, BAR_SOIR, DIVERS, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                                    End If

                                End If

                                'End If

                                '----------- MAIN COURANTE JOURNALIERE ------------------------------

                                'We check if the the main courante journaliere already exist
                                'If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante_journaliere", "CODE_MAIN_COURANTE_JOURNALIERE") Then

                                If Trim(GlobalVariable.codeMainCouranteJournaliereToUpdate) = "" Then
                                    'As the Global variable codeMainCouranteToUpdate is empty => new  Entry

                                    If exist Then
                                        NUM_RESERVATION = CODE_RESERVATION_DEPART
                                    End If

                                    If mainCourante.insertMainCouranteJournaliere(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then


                                        '-------------------UTILISE POUR LES RESERVATION DONT L'ENCAISSEMENT EST FAIT AVANT L'ENREGISTREMENT ----------------------------------------
                                        'ON DOIT VERIFIER SI LA RESERVATION DONT ON CREEE LA LIGNE DE MAINCOURANTE EST ASSOCIE A UN REGLEMENT EN ESPECE FAITE LORS DE LA RESA

                                        miseAjourDeRegelementApresCreationDeMainCourante(NUM_RESERVATION, CODE_MAIN_COURANTE_JOURNALIERE)

                                        '------------------------------------------------------------------------------------------------------
                                    End If

                                Else
                                    'As the Global variable codeMainCourantJournaliereToUpdate is not empty => update 

                                    CODE_MAIN_COURANTE_JOURNALIERE = GlobalVariable.codeMainCouranteJournaliereToUpdate

                                    NUM_RESERVATION = CODE_RESERVATION_DEPART

                                    If mainCourante.updateMainCouranteJournaliereResaInfo(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                                    End If

                                End If

                                'End If

                                '------------------------------------------------- GESTION DE LA RESERVATION  -----------------------------------

                                If Not exist Then

                                    If GlobalVariable.tarificationDynamiqueActif Then

                                        Dim DateDebut As Date = CDate(GlobalVariable.DateDeTravail).ToShortDateString
                                        Dim tarif As New Tarifs

                                        'TRAITEMENT D'UN CKECKIN DIRECT DONC FICHIER TEXT DE TARIFICATION INEXISTANT DONC ON VA LE CREER
                                        tarif.determinationDesMontantPourTouteLaPeriodeDelaReservation(DateDebut, CODE_RESERVATION, CODE_TARIF_RESERVATION, DATE_ENTTRE, DATE_SORTIE, TYPE_CHAMBRE)

                                    End If

                                    'As the Global variable codeReservationToUpdate is empty => new Reservation Entry 

                                    If reservation.insertReservation(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, DEPOT_DE_GARANTIE, DAY_USE, MENSUEL, BC_ENTREPRISE, TYPE_CHAMBRE, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                                        Dim TABLE As String = "reservation"

                                        reservation.updatePetitDejeuner(PETIT_DEJEUNER, CODE_RESERVATION, TABLE, AFFICHER_PRIX, BFK_COST)

                                        If GlobalVariable.typeChambreOuSalle = "salle" Then
                                            reservation.insertForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION, LOCATION_MATERIEL, AUTRES, CODE_EVENEMENT, LIBELLE_EVENEMENT, NBRE_GOUTER, PU_GOUTER, NBRE_COCKTAIL, PU_COCKTAIL, HEURE_PAUSE_CAFE, HEURE_PAUSE_DEJEUNER, HEURE_DINER, HEURE_GOUTER, HEURE_COCKTAIL, VIDEO_PROJ, SONO, COUVERTS, TABLE_CHAISE, EAU_PTE_QTE, EAU_PTE_MONTANT, EAU_GRDE_QTE, EAU_GRDE_MONTANT, BOISSONS_GAZEUSES_QTE, BOISSONS_GAZEUSES_MONTANT, BIERES_QTE, BIERES_MONTANT, VIN_ROUGE_QTE, VIN_ROUGE_MONTANT, VIN_ROSE_QTE, VIN_ROSE_MONTANT, BOISSONS_EXT_QTE, BOISSONS_EXT_MONTANT, DROIT_DE_BOUCHON, MISE_EN_PLACE, CLOISONNEMENT)
                                        End If

                                        If GlobalVariable.actualLanguageValue = 1 Then
                                            MessageBox.Show("Réservation de " & NOM_CLIENT & " du " & DATE_ENTTRE & " au " & DATE_SORTIE & " enregistrée avec succès! !", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                        Else
                                            MessageBox.Show("Booking of " & NOM_CLIENT & " from " & DATE_ENTTRE & " to " & DATE_SORTIE & " successfully saved!! ", "Booking", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                        End If

                                    Else
                                        'Error when inserting a new reservation entry
                                        If GlobalVariable.actualLanguageValue = 1 Then
                                            MessageBox.Show("Problème lors de l'enregistrement de Réservation !!", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                                        Else
                                            MessageBox.Show("Issue during the saving of the booking !!", "Booking", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                                        End If

                                    End If

                                Else

                                    Dim operation As Integer = 1 'UPDATE
                                    gestionDesNavettes(operation, CODE_RESERVATION)

                                    Dim ACTION As String = ""

                                    If GunaCheckBoxDayUse.Checked Then
                                        If GlobalVariable.actualLanguageValue = 1 Then
                                            ACTION = "SAUVEGARDE DE RESERVATION [CHAMBRE " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " DE " & DEBUT_HEURE & " - " & FIN_HEURE & "]"

                                        Else
                                            ACTION = "BOOKING UPDATE [ROOM " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " FROM " & DEBUT_HEURE & " - " & FIN_HEURE & "]"

                                        End If
                                    Else
                                        If GlobalVariable.actualLanguageValue = 1 Then
                                            ACTION = "SAUVEGARDE DE RESERVATION [CHAMBRE " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " DU " & DATE_ENTTRE & " - " & DATE_SORTIE & "]"
                                        Else
                                            ACTION = "BOOKING UPDATE [ROOM " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " FROM " & DATE_ENTTRE & " - " & DATE_SORTIE & "]"

                                        End If
                                    End If

                                    User.mouchard(ACTION)

                                    Dim ReservationToUpdate As DataTable = Functions.getElementByCode(CODE_RESERVATION_DEPART, "reservation", "CODE_RESERVATION")

                                    If Not ReservationToUpdate.Rows.Count > 0 Then
                                        'not found in reservation so, we search in reserve_conf
                                        ReservationToUpdate = Functions.getElementByCode(CODE_RESERVATION_DEPART, "reserve_conf", "CODE_RESERVATION")

                                        'GESTION DES ETATS DE RESERVATIONS CONFIRMEE
                                        If ReservationToUpdate.Rows(0)("ETAT_RESERVATION") = 1 Then
                                            If GlobalVariable.typeChambreOuSalle = "chambre" Then
                                                If GlobalVariable.actualLanguageValue = 1 Then
                                                    ETAT_NOTE_RESERVATION = "EN CHAMBRE"
                                                Else
                                                    ETAT_NOTE_RESERVATION = "IN HOUSE"
                                                End If

                                            ElseIf GlobalVariable.typeChambreOuSalle = "salle" Then
                                                If GlobalVariable.actualLanguageValue = 1 Then
                                                    ETAT_NOTE_RESERVATION = "EN SALLE"
                                                Else
                                                    ETAT_NOTE_RESERVATION = "IN HALL"
                                                End If

                                            End If
                                        Else
                                            ETAT_NOTE_RESERVATION = "CHECKOUT"
                                        End If

                                    Else

                                        'GESTION DES ETATS DE RESERVATIONS
                                        If ReservationToUpdate.Rows(0)("ETAT_RESERVATION") = 0 Then
                                            If GlobalVariable.actualLanguageValue = 1 Then
                                                ETAT_NOTE_RESERVATION = "ATTENDUE"
                                            Else
                                                ETAT_NOTE_RESERVATION = "EXPECTED"
                                            End If

                                        Else
                                            If GlobalVariable.actualLanguageValue = 1 Then
                                                ETAT_NOTE_RESERVATION = "ANNULEE"
                                            Else
                                                ETAT_NOTE_RESERVATION = "CANCELED"
                                            End If

                                        End If

                                    End If
                                    '-------------------------EITHER WE ARE UPDATING A RESERVATION OR A RESERVATION_CONF-----------------------------------------

                                    'As the Global variable codeReservationToUpdate is not empty => update reservation or reservation _conf
                                    ' we determine if the reservation is found in reservation or reserve_conf
                                    CODE_RESERVATION = CODE_RESERVATION_DEPART
                                    CHAMBRE_ID = CHAMBRE_DEPART

                                    'We have to search where the reservtion to update is found either in reservation or reserve_conf
                                    Dim reservationTable As DataTable = Functions.getElementByCode(CODE_RESERVATION_DEPART, "reservation", "CODE_RESERVATION")

                                    If reservationTable.Rows.Count > 0 Then

                                        ' The Reseravtion is found in reservation

                                        If reservation.updateReservation(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, DEPOT_DE_GARANTIE, DAY_USE, MENSUEL, BC_ENTREPRISE, TYPE_CHAMBRE, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                                            Dim TABLE As String = "reservation"

                                            reservation.updatePetitDejeuner(PETIT_DEJEUNER, CODE_RESERVATION, TABLE, AFFICHER_PRIX, BFK_COST)

                                            If exist Then
                                                'ICI LE SOLDE_RESERVATION DEPAND DU LABEL EMPECHANT UNE VUE INSTANTANNEE
                                                'reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", GunaLabelSolde.Text)
                                                updatedSolde = Functions.SituationDeReservation(CODE_RESERVATION_DEPART)
                                                reservation.updateSoldeReservation(CODE_RESERVATION_DEPART, "reservation", updatedSolde)
                                            End If

                                            If GlobalVariable.typeChambreOuSalle = "salle" Then
                                                reservation.updateForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION, LOCATION_MATERIEL, AUTRES, CODE_EVENEMENT, LIBELLE_EVENEMENT, NBRE_GOUTER, PU_GOUTER, NBRE_COCKTAIL, PU_COCKTAIL, HEURE_PAUSE_CAFE, HEURE_PAUSE_DEJEUNER, HEURE_DINER, HEURE_GOUTER, HEURE_COCKTAIL, VIDEO_PROJ, SONO, COUVERTS, TABLE_CHAISE, EAU_PTE_QTE, EAU_PTE_MONTANT, EAU_GRDE_QTE, EAU_GRDE_MONTANT, BOISSONS_GAZEUSES_QTE, BOISSONS_GAZEUSES_MONTANT, BIERES_QTE, BIERES_MONTANT, VIN_ROUGE_QTE, VIN_ROUGE_MONTANT, VIN_ROSE_QTE, VIN_ROSE_MONTANT, BOISSONS_EXT_QTE, BOISSONS_EXT_MONTANT, DROIT_DE_BOUCHON, MISE_EN_PLACE, CLOISONNEMENT)
                                            End If

                                            If GlobalVariable.actualLanguageValue = 1 Then
                                                MessageBox.Show("Réservation de " & NOM_CLIENT & " du " & DATE_ENTTRE & " au " & DATE_SORTIE & " Mise à jours avec succès !!", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                            Else
                                                MessageBox.Show("Booking of " & NOM_CLIENT & " from " & DATE_ENTTRE & " to " & DATE_SORTIE & " Successfully updated !!", "Booking", MessageBoxButtons.OK, MessageBoxIcon.Information)
                                            End If

                                        End If

                                    Else

                                        'The resevation is instead found in reserve_conf
                                        'We have to set back the value of etat_reservation from 0 to 1
                                        ETAT_RESERVATION = 1
                                        CHAMBRE_ID = CHAMBRE_DEPART
                                        'MessageBox.Show(CLIENT_ID & " - " & CHAMBRE_ID)
                                        'In case the table has migrate from reservation to reservation_conf we update instead in reserve_conf

                                        ReservationToUpdate = Functions.getElementByCode(CODE_RESERVATION_DEPART, "reserve_conf", "CODE_RESERVATION")

                                        If ReservationToUpdate.Rows.Count > 0 Then
                                            'not found in reservation so, we search in reserve_conf

                                            'GESTION DES ETATS DE RESERVATIONS CONFIRMEE
                                            If ReservationToUpdate.Rows(0)("ETAT_RESERVATION") = 1 Then

                                                If GlobalVariable.typeChambreOuSalle = "chambre" Then
                                                    If GlobalVariable.actualLanguageValue = 1 Then
                                                        ETAT_NOTE_RESERVATION = "EN CHAMBRE"
                                                    Else
                                                        ETAT_NOTE_RESERVATION = "IN HOUSE"
                                                    End If

                                                ElseIf GlobalVariable.typeChambreOuSalle = "salle" Then
                                                    If GlobalVariable.actualLanguageValue = 1 Then
                                                        ETAT_NOTE_RESERVATION = "EN SALLE"
                                                    Else
                                                        ETAT_NOTE_RESERVATION = "IN HALL"
                                                    End If
                                                Else
                                                    ETAT_NOTE_RESERVATION = "CHECKOUT"
                                                End If

                                            Else

                                                'GESTION DES ETATS DE RESERVATIONS
                                                If ReservationToUpdate.Rows(0)("ETAT_RESERVATION") = 0 Then
                                                    If GlobalVariable.actualLanguageValue = 1 Then
                                                        ETAT_NOTE_RESERVATION = "ATTENDUE"
                                                    Else
                                                        ETAT_NOTE_RESERVATION = "EXPECTED"
                                                    End If

                                                Else
                                                    If GlobalVariable.actualLanguageValue = 1 Then
                                                        ETAT_NOTE_RESERVATION = "ANNULEE"
                                                    Else
                                                        ETAT_NOTE_RESERVATION = "CANCELED"
                                                    End If
                                                End If

                                            End If

                                            If reservation.updateReservationConf(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, ETAT_NOTE_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, DEPOT_DE_GARANTIE, DAY_USE, MENSUEL, BC_ENTREPRISE, TYPE_CHAMBRE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                                                Dim TABLE As String = "reserve_conf"

                                                reservation.updatePetitDejeuner(PETIT_DEJEUNER, CODE_RESERVATION, TABLE, AFFICHER_PRIX, BFK_COST)

                                                If exist Then
                                                    'reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reserve_conf", GunaLabelSolde.Text)
                                                    updatedSolde = Functions.SituationDeReservation(CODE_RESERVATION_DEPART)
                                                    reservation.updateSoldeReservation(CODE_RESERVATION_DEPART, "reserve_conf", updatedSolde)
                                                End If

                                                If GlobalVariable.typeChambreOuSalle = "salle" Then
                                                    reservation.updateForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION, LOCATION_MATERIEL, AUTRES, CODE_EVENEMENT, LIBELLE_EVENEMENT, NBRE_GOUTER, PU_GOUTER, NBRE_COCKTAIL, PU_COCKTAIL, HEURE_PAUSE_CAFE, HEURE_PAUSE_DEJEUNER, HEURE_DINER, HEURE_GOUTER, HEURE_COCKTAIL, VIDEO_PROJ, SONO, COUVERTS, TABLE_CHAISE, EAU_PTE_QTE, EAU_PTE_MONTANT, EAU_GRDE_QTE, EAU_GRDE_MONTANT, BOISSONS_GAZEUSES_QTE, BOISSONS_GAZEUSES_MONTANT, BIERES_QTE, BIERES_MONTANT, VIN_ROUGE_QTE, VIN_ROUGE_MONTANT, VIN_ROSE_QTE, VIN_ROSE_MONTANT, BOISSONS_EXT_QTE, BOISSONS_EXT_MONTANT, DROIT_DE_BOUCHON, MISE_EN_PLACE, CLOISONNEMENT)
                                                End If


                                            End If

                                        End If

                                    End If

                                End If

                                '-------------------------------------------- TAXE SEJOUR COLLECTE -------------------------------------------------------------------------

                                If GunaCheckBoxTaxeSejour.Checked Then

                                    'We delete if something already exist and insert a new entry
                                    Functions.DeleteElementByCode(CODE_RESERVATION, "taxe_sejour_collectee", "NUM_RESERVATION")

                                    'Insertion des lignes dans taxe séjours collectées TAXE_SEJOURS_COLLECTEE
                                    Dim insertQueryTaxe As String = "INSERT INTO `taxe_sejour_collectee`(`CODE_CATEGORIE_HOTEL`, `CODE_CLIENT`, `NUM_RESERVATION`, `NUM_FACTURE`, `CODE_CHAMBRE`, `TAXE_SEJOUR_COLLECTEE`, `DATE_FACTURATION_TAXE`, `DATE_CREATION`, `CODE_UTILISATEUR_CREA`, `CODE_AGENCE`) VALUES (@valu1,@valu2,@valu3,@valu4,@valu5,@valu6,@valu7,@valu8,@valu9,@valu10)"

                                    Dim commandTaxe As New MySqlCommand(insertQueryTaxe, GlobalVariable.connect)

                                    commandTaxe.Parameters.Add("@valu1", MySqlDbType.VarChar).Value = GlobalVariable.AgenceActuelle.Rows(0)("CATEGORIE_HOTEL")
                                    commandTaxe.Parameters.Add("@valu2", MySqlDbType.VarChar).Value = CLIENT_ID
                                    commandTaxe.Parameters.Add("@valu3", MySqlDbType.VarChar).Value = CODE_RESERVATION
                                    commandTaxe.Parameters.Add("@valu4", MySqlDbType.VarChar).Value = ""
                                    commandTaxe.Parameters.Add("@valu5", MySqlDbType.VarChar).Value = CHAMBRE_ID

                                    Dim TaxeSejour As Double
                                    Double.TryParse(GunaTextBoxTaxeSejour.Text, TaxeSejour)
                                    commandTaxe.Parameters.Add("@valu6", MySqlDbType.Double).Value = TaxeSejour

                                    commandTaxe.Parameters.Add("@valu7", MySqlDbType.Date).Value = GlobalVariable.DateDeTravail
                                    commandTaxe.Parameters.Add("@valu8", MySqlDbType.Date).Value = GlobalVariable.DateDeTravail
                                    commandTaxe.Parameters.Add("@valu9", MySqlDbType.VarChar).Value = GlobalVariable.codeUser
                                    commandTaxe.Parameters.Add("@valu10", MySqlDbType.VarChar).Value = GlobalVariable.AgenceActuelle.Rows(0)("CODE_AGENCE")

                                    'Opening the connection
                                    'connect.openConnection()

                                    'Excuting the command and testing if everything went on well
                                    If (commandTaxe.ExecuteNonQuery() = 1) Then
                                        'connect.closeConnection()
                                    Else
                                        'connect.closeConnection()
                                    End If

                                End If

                                'EN CAS D'ENCAISSEMT DURANT L'ENREGISTREMENT

                                If DEPOT_DE_GARANTIE > 0 Then

                                    Dim NUM_REGLEMENT As String = Functions.GeneratingRandomCodeWithSpecifications("reglement", "RGL")

                                    MONTANT_VERSE = DEPOT_DE_GARANTIE

                                    'reglement.insertReglement(NUM_REGLEMENT, NUM_FACTURE, CODE_CAISSIER, MONTANT_VERSE, DATE_REGLEMENT, MODE_REGLEMENT, REF_REGLEMENT, CODE_MODE, IMPRIMER, CODE_AGENCE, CODE_RESERVATION, CODE_CLIENT, NUMERO_BLOC_NOTE, MODE_REG_INFO_SUP_1, MODE_REG_INFO_SUP_2, MODE_REG_INFO_SUP_3)

                                End If

                                If Not Trim(GunaTextBoxPaiement.Text).Equals("") Then

                                    If Double.Parse(GunaTextBoxPaiement.Text) > 0 Then

                                        Dim NUM_REGLEMENT As String = Functions.GeneratingRandomCodeWithSpecifications("reglement", "RGL")

                                        MONTANT_VERSE = GunaTextBoxPaiement.Text

                                        If GlobalVariable.actualLanguageValue = 1 Then
                                            MODE_REGLEMENT = "Espèce"
                                            REF_REGLEMENT = "ENCAISSEMENT (" & MODE_REGLEMENT & ") DE " & "[" & NOM_CLIENT & " / " & CHAMBRE_ID & "]"
                                        Else
                                            MODE_REGLEMENT = "Cash"
                                            REF_REGLEMENT = "CASHED IN (" & MODE_REGLEMENT & ") FROM " & "[" & NOM_CLIENT & " / " & CHAMBRE_ID & "]"
                                        End If

                                    End If

                                    'reglement.insertReglement(NUM_REGLEMENT, NUM_FACTURE, CODE_CAISSIER, MONTANT_VERSE, DATE_REGLEMENT, MODE_REGLEMENT, REF_REGLEMENT, CODE_MODE, IMPRIMER, CODE_AGENCE, CODE_RESERVATION, CODE_CLIENT, NUMERO_BLOC_NOTE, MODE_REG_INFO_SUP_1, MODE_REG_INFO_SUP_2, MODE_REG_INFO_SUP_3)

                                    Dim TABLE As String = ""
                                    Dim FIELD As String = ""

                                    FIELD = "ENCAISSEMENT_ESPECE"

                                    TABLE = "main_courante_journaliere"

                                    Dim FIELDVALUE As Double = MONTANT_VERSE

                                    Dim mainCourantes As New MainCourantes()

                                    'mainCourantes.updateMainCouranteJournaliereModeReglement(CODE_MAIN_COURANTE_JOURNALIERE, TABLE, FIELD, FIELDVALUE)

                                End If

                            End If

                            '--------------------------------------- GESTION DE LA MISE A JOURS DU SOLDE DE LA RESERVATION ----------------------------
                            Dim reservationToUpdateInReservation As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reservation", "CODE_RESERVATION")

                            'SOIT DANS RESERVATION

                            Dim SOLDE_RESERVATION As Double = 0

                            If reservationToUpdateInReservation.Rows.Count > 0 Then

                                'MISE JOURS DU SOLDE DE LA RESERVATION
                                updatedSolde = Functions.SituationDeReservation(CODE_RESERVATION)
                                SOLDE_RESERVATION = updatedSolde
                                reservation.updateSoldeReservation(CODE_RESERVATION, "reservation", updatedSolde)

                            Else

                                'OU DANS RESERVATION
                                Dim reservationToUpdateInReserve_conf As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

                                If reservationToUpdateInReserve_conf.Rows.Count > 0 Then

                                    updatedSolde = Functions.SituationDeReservation(CODE_RESERVATION)
                                    SOLDE_RESERVATION = updatedSolde
                                    reservation.updateSoldeReservation(CODE_RESERVATION, "reserve_conf", updatedSolde)

                                End If

                            End If

                            '-------------------------------------------- GESTION DES TRACES DES UTILISATEURS ----------------------------------------------------------
                            Dim ACTION_FAITE As String = GunaButtonReservation.Text
                            Dim FAITE_PAR As String = GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR")
                            reservation.insertTrace(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, DEPOT_DE_GARANTIE, DAY_USE, MENSUEL, BC_ENTREPRISE, TYPE_CHAMBRE, ACTION_FAITE, FAITE_PAR, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE, SOLDE_RESERVATION)

                            'REENCODAGE DE LA CARTE EN CAS DE CHANGEMENT DE DATE OU HEURE

                            If exist_reserve_conf Then

                                'SEULEMENT POUR LES EN CHAMBRES
                                Dim demandeDeReEncodage As Boolean = False

                                Dim resa As DataTable = Functions.getElementByCode(CODE_RESERVATION_DEPART, "reserve_conf", "CODE_RESERVATION")

                                If resa.Rows.Count > 0 Then

                                    If GunaCheckBoxDayUse.Checked Then

                                        Dim nouveauNombreHeure As Integer = 0

                                        Dim DEBUT_NEW As Date = CDate(GunaComboBoxHeureArrivee.SelectedItem.ToString).ToShortTimeString
                                        Dim FIN_NEW As Date = CDate(GunaComboBoxHeureDepart.SelectedItem.ToString).ToShortTimeString

                                        nouveauNombreHeure = CType((FIN_NEW - DEBUT_NEW).TotalHours, Int32)

                                        Dim DEBUT As Date = CDate(resaExist(0)("HEURE_ENTREE")).ToShortTimeString
                                        Dim FIN As Date = CDate(resaExist(0)("HEURE_SORTIE")).ToShortTimeString

                                        Dim ancienNombreHeure As Integer = 0

                                        ancienNombreHeure = CType((FIN - DEBUT).TotalHours, Int32)

                                        If Not nouveauNombreHeure = ancienNombreHeure Then

                                            If GlobalVariable.AgenceActuelle.Rows(0)("SERRURES") = 1 Then

                                                If GlobalVariable.typeChambreOuSalle = "chambre" Then

                                                    Dim dialog1 As New DialogResult()

                                                    If GlobalVariable.actualLanguageValue = 1 Then
                                                        dialog1 = MessageBox.Show("Changement de période du séjours. Re-encoder la carte ", "Encodage de carte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
                                                    Else
                                                        dialog1 = MessageBox.Show("Period of stay changed. Issue Card ", "Card Issuance", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
                                                    End If

                                                    ZenoLockForm.Close()

                                                    If dialog1 = DialogResult.Yes Then

                                                        demandeDeReEncodage = True

                                                        GlobalVariable.infoReservationPourEncodage = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

                                                        '  --------------------------------- PAYER AVANT ENCODAGE --------------------------------

                                                        Dim DATE_DE_TRAVAIL As Date = GlobalVariable.DateDeTravail.ToShortDateString

                                                        Dim encoder As Boolean = True

                                                        Dim nombreDeNuiteAEncoder As Integer = 0

                                                        If GlobalVariable.AgenceActuelle.Rows(0)("PAYER_AVANT_ENCODAGE") = 1 Then

                                                            nombreDeNuiteAEncoder = Functions.nombreDeJourAInsererDansLEncodeur(DATE_ENTTRE, DATE_DE_TRAVAIL, CODE_RESERVATION)

                                                            If nombreDeNuiteAEncoder = 0 Then
                                                                encoder = False
                                                            End If

                                                        End If

                                                        If encoder Then
                                                            showZenlockFormAsync()
                                                        Else

                                                            If GlobalVariable.actualLanguageValue = 0 Then
                                                                languageMessage = "Please pay atleast one night"
                                                                languageTitle = "Locks Management"
                                                            ElseIf GlobalVariable.actualLanguageValue = 1 Then
                                                                languageMessage = "Bien vouloir effectuer un paiement d'au moins une nuitée"
                                                                languageTitle = "Gestion des serrures"
                                                            End If

                                                            MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Information)

                                                        End If

                                                        '--------------------------------- END PAYER AVANT ENCODAGE -----------------------------------

                                                    End If
                                                End If

                                            End If

                                            facturationAutoApresPronlongementDeSejour = True 'Payer Avant Encodage

                                        End If

                                        'FACTURATION ANTICIPE APRES PROLONGEMENT : FACTUARTION ANTICIPE 

                                        If facturationAutoApresPronlongementDeSejour Then
                                            reservation.facturationEnAvanceApresPronlogement(CODE_RESERVATION, POSTER_TAX, GlobalVariable.DateDeTravail)
                                        End If

                                    Else

                                        Dim nouveauNombreDejour As Integer = 0

                                        Dim DEBUT_NEW As Date = GunaDateTimePickerArrivee.Value.ToShortDateString
                                        Dim FIN_NEW As Date = GunaDateTimePickerDepart.Value.ToShortDateString

                                        nouveauNombreDejour = CType((FIN_NEW - DEBUT_NEW).TotalDays, Int32)

                                        Dim DEBUT As Date = CDate(resaExist(0)("DATE_ENTTRE")).ToShortDateString
                                        Dim FIN As Date = CDate(resaExist(0)("DATE_SORTIE")).ToShortDateString

                                        Dim ancienNombreDejour As Integer = 0

                                        ancienNombreDejour = CType((FIN - DEBUT).TotalDays, Int32)

                                        If Not nouveauNombreDejour = ancienNombreDejour Then

                                            'LA FENETRE D'ENCODAGE N'EST VISIBLE QUE SI ON ACTIVE L'UTILISATION DES SERRURES

                                            If GlobalVariable.AgenceActuelle.Rows(0)("SERRURES") = 1 Then

                                                If GlobalVariable.typeChambreOuSalle = "chambre" Then
                                                    Dim dialog1 As New DialogResult()

                                                    If GlobalVariable.actualLanguageValue = 1 Then
                                                        dialog1 = MessageBox.Show("Changement de période du séjours. Re-encoder la carte ", "Encodage de carte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                                    Else
                                                        dialog1 = MessageBox.Show("Period of stay changed. Issuer Card ", "Card Issuance", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                                    End If

                                                    ZenoLockForm.Close()

                                                    If dialog1 = DialogResult.Yes Then

                                                        demandeDeReEncodage = True

                                                        GlobalVariable.infoReservationPourEncodage = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

                                                        '--------------------------- PAYER AVANT ENCODAGE ---------------------------

                                                        Dim DATE_DE_TRAVAIL As Date = GlobalVariable.DateDeTravail.ToShortDateString

                                                        Dim encoder As Boolean = True

                                                        Dim nombreDeNuiteAEncoder As Integer = 0

                                                        If GlobalVariable.AgenceActuelle.Rows(0)("PAYER_AVANT_ENCODAGE") = 1 Then

                                                            nombreDeNuiteAEncoder = Functions.nombreDeJourAInsererDansLEncodeur(DATE_ENTTRE, DATE_DE_TRAVAIL, CODE_RESERVATION)

                                                            If nombreDeNuiteAEncoder = 0 Then
                                                                encoder = False
                                                            End If

                                                        End If

                                                        If encoder Then
                                                            showZenlockFormAsync()
                                                        Else

                                                            If GlobalVariable.actualLanguageValue = 0 Then
                                                                languageMessage = "Please pay atleast one night"
                                                                languageTitle = "Locks Management"
                                                            ElseIf GlobalVariable.actualLanguageValue = 1 Then
                                                                languageMessage = "Bien vouloir effectuer un paiement d'au moins une nuitée"
                                                                languageTitle = "Gestion des serrures"
                                                            End If

                                                            MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Information)

                                                        End If
                                                        '----------------------------------------------------------------------------
                                                        'showZenlockFormAsync()

                                                    End If

                                                End If

                                            End If

                                            'FACTURATION ANTICIPE APRES PROLONGEMENT : FACTUARTION ANTICIPE 
                                            facturationAutoApresPronlongementDeSejour = True

                                            If facturationAutoApresPronlongementDeSejour Then
                                                reservation.facturationEnAvanceApresPronlogement(CODE_RESERVATION, POSTER_TAX, GlobalVariable.DateDeTravail)
                                            End If

                                        Else

                                            facturationAutoApresPronlongementDeSejour = True

                                            'LES JOURS PEUVENT NE PAS AVOIR CHANGER MAIS LES HEURES OUI
                                            Dim nouveauNombreHeure As Integer = 0

                                            Dim DEBUT_NEW_HEURE As Date = CDate(GunaComboBoxHeureArrivee.SelectedItem.ToString).ToShortTimeString
                                            Dim FIN_NEW_HEURE As Date = CDate(GunaComboBoxHeureDepart.SelectedItem.ToString).ToShortTimeString

                                            nouveauNombreHeure = CType((FIN_NEW_HEURE - DEBUT_NEW_HEURE).TotalHours, Int32)

                                            Dim DEBUT_HEURE_SEJOUR As Date = CDate(resaExist(0)("HEURE_ENTREE")).ToShortTimeString
                                            Dim FIN_HEURE_SEJOUR As Date = CDate(resaExist(0)("HEURE_SORTIE")).ToShortTimeString

                                            Dim ancienNombreHeure As Integer = 0

                                            ancienNombreHeure = CType((FIN_HEURE_SEJOUR - DEBUT_HEURE_SEJOUR).TotalHours, Int32)

                                            If Not nouveauNombreHeure = ancienNombreHeure Then

                                                If GlobalVariable.AgenceActuelle.Rows(0)("SERRURES") = 1 Then

                                                    If GlobalVariable.typeChambreOuSalle = "chambre" Then
                                                        Dim dialog1 As New DialogResult()

                                                        If GlobalVariable.actualLanguageValue = 1 Then
                                                            dialog1 = MessageBox.Show("Changement de période du séjours. Re-encoder la carte ", "Encodage de carte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                                        Else
                                                            dialog1 = MessageBox.Show("Period of stay changed. Card Issuance ", "Card Issuance", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                                        End If

                                                        ZenoLockForm.Close()

                                                        If dialog1 = DialogResult.Yes Then

                                                            demandeDeReEncodage = True
                                                            GlobalVariable.infoReservationPourEncodage = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

                                                            '--------------------------- PAYER AVANT ENCODAGE ---------------------------

                                                            Dim DATE_DE_TRAVAIL As Date = GlobalVariable.DateDeTravail.ToShortDateString

                                                            Dim encoder As Boolean = True

                                                            Dim nombreDeNuiteAEncoder As Integer = 0

                                                            If GlobalVariable.AgenceActuelle.Rows(0)("PAYER_AVANT_ENCODAGE") = 1 Then

                                                                nombreDeNuiteAEncoder = Functions.nombreDeJourAInsererDansLEncodeur(DATE_ENTTRE, DATE_DE_TRAVAIL, CODE_RESERVATION)

                                                                If nombreDeNuiteAEncoder = 0 Then
                                                                    encoder = False
                                                                End If

                                                            End If

                                                            If encoder Then
                                                                showZenlockFormAsync()
                                                            Else

                                                                If GlobalVariable.actualLanguageValue = 0 Then
                                                                    languageMessage = "Please pay atleast one night"
                                                                    languageTitle = "Locks Management"
                                                                ElseIf GlobalVariable.actualLanguageValue = 1 Then
                                                                    languageMessage = "Bien vouloir effectuer un paiement d'au moins une nuitée"
                                                                    languageTitle = "Gestion des serrures"
                                                                End If

                                                                MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Information)

                                                            End If
                                                            '----------------------------------------------------------------------------
                                                            'showZenlockFormAsync()

                                                        End If

                                                    End If


                                                    'FACTURATION ANTICIPE APRES PROLONGEMENT : FACTUARTION ANTICIPE 
                                                    facturationAutoApresPronlongementDeSejour = True 'Payer Avant Encodage

                                                    If facturationAutoApresPronlongementDeSejour Then
                                                        reservation.facturationEnAvanceApresPronlogement(CODE_RESERVATION, POSTER_TAX, GlobalVariable.DateDeTravail)
                                                    End If

                                                End If

                                            End If


                                        End If

                                    End If

                                    If Not resaExist(0)("CHAMBRE_ID") = GunaTextBoxNumeroChambre.Text Then

                                        If GlobalVariable.AgenceActuelle.Rows(0)("SERRURES") = 1 Then

                                            Dim dialog1 As New DialogResult()

                                            If demandeDeReEncodage Then

                                                If GlobalVariable.actualLanguageValue = 1 Then
                                                    MessageBox.Show("Délogement effectué de la " & GlobalVariable.codeChambreToUpdate & " vers la " & GunaTextBoxNumeroChambre.Text & " .", "Delogement", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                                Else
                                                    MessageBox.Show("Displacement made from " & GlobalVariable.codeChambreToUpdate & " to " & GunaTextBoxNumeroChambre.Text & " .", "Displacement", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                                End If

                                            Else

                                                If GlobalVariable.actualLanguageValue = 1 Then
                                                    dialog1 = MessageBox.Show("Délogement effectué de la " & GlobalVariable.codeChambreToUpdate & " vers la " & GunaTextBoxNumeroChambre.Text & " . Re-encoder la carte ", "Encodage de carte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                                Else
                                                    dialog1 = MessageBox.Show("Displacement made from " & GlobalVariable.codeChambreToUpdate & " to " & GunaTextBoxNumeroChambre.Text & " . Issue Card ", "Card Issuance", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                                End If

                                                ZenoLockForm.Close()

                                                If dialog1 = DialogResult.Yes Then
                                                    GlobalVariable.infoReservationPourEncodage = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

                                                    '--------------------------- PAYER AVANT ENCODAGE ---------------------------

                                                    Dim DATE_DE_TRAVAIL As Date = GlobalVariable.DateDeTravail.ToShortDateString

                                                    Dim encoder As Boolean = True

                                                    Dim nombreDeNuiteAEncoder As Integer = 0

                                                    If GlobalVariable.AgenceActuelle.Rows(0)("PAYER_AVANT_ENCODAGE") = 1 Then

                                                        nombreDeNuiteAEncoder = Functions.nombreDeJourAInsererDansLEncodeur(DATE_ENTTRE, DATE_DE_TRAVAIL, CODE_RESERVATION)

                                                        If nombreDeNuiteAEncoder = 0 Then
                                                            encoder = False
                                                        End If

                                                    End If

                                                    If encoder Then
                                                        showZenlockFormAsync()
                                                    Else

                                                        If GlobalVariable.actualLanguageValue = 0 Then
                                                            languageMessage = "Please pay atleast one night"
                                                            languageTitle = "Locks Management"
                                                        ElseIf GlobalVariable.actualLanguageValue = 1 Then
                                                            languageMessage = "Bien vouloir effectuer un paiement d'au moins une nuitée"
                                                            languageTitle = "Gestion des serrures"
                                                        End If

                                                        MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Information)

                                                    End If
                                                    '----------------------------------------------------------------------------
                                                    'showZenlockFormAsync()

                                                End If

                                            End If

                                        End If

                                    End If

                                End If

                                'numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)
                            End If

                            '-------------------------------------------- IMPRESSION DES DOCUMENTS -------------------------------------------------

                            Dim montantParNuitee As Double = 0

                            'la fiche de confirmation ou de contrat s'imrpirme uniquement si c'est la premiere reservation
                            If Not exist Then

                                Dim dialog As DialogResult

                                If GunaRadioButtonSalleFete.Checked Then

                                    If True Then

                                        If GunaComboBoxTypeDeDocSalle.SelectedIndex = 0 Then

                                            If GlobalVariable.actualLanguageValue = 1 Then
                                                dialog = MessageBox.Show("Télécharger La fiche de confirmation ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
                                            Else
                                                dialog = MessageBox.Show("Download Hotel Registration Form ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
                                            End If
                                        Else
                                            If GlobalVariable.actualLanguageValue = 1 Then
                                                dialog = MessageBox.Show("Télécharger Dévis estimatif ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                            Else
                                                dialog = MessageBox.Show("Download Quotation ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                            End If
                                        End If

                                    End If

                                Else

                                    If True Then

                                        If GlobalVariable.actualLanguageValue = 1 Then
                                            dialog = MessageBox.Show("Télécharger La fiche de confirmation ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
                                        Else
                                            dialog = MessageBox.Show("Download confirmation form ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
                                        End If

                                    End If

                                End If


                                If dialog = DialogResult.Yes Then
                                    'e.Cancel = True

                                    'Génération des documents concernants les salles Confirmation de réservation

                                    'DOCUMENT DE LA SALLE DE FETE
                                    If GunaRadioButtonSalleFete.Checked Then

                                        If Not exist Then

                                            'CONFIRMATION DE RESERVATION

                                            Double.TryParse(GunaTextBoxMontantReelSalle.Text, montantParNuitee)

                                            If GunaComboBoxTypeDeDocSalle.SelectedIndex = 0 Then
                                                Functions.GenerationDeConfirmationReservation(CODE_RESERVATION, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)
                                            Else
                                                Impression.devisEstimatifDeSalleDeFete(CODE_RESERVATION, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)
                                            End If

                                        Else

                                        End If

                                        'DOCUMENT DE LA CHAMBRE
                                    ElseIf GunaRadioButtonChambre.Checked Then
                                        'Génération des documents concernants les chambres confirmation de réservation

                                        If Not exist Then
                                            'CONFIRMATION DE RESERVATION
                                            Double.TryParse(GunaTextBoxMontantAccorde.Text, montantParNuitee)
                                            Functions.GenerationDeConfirmationReservation(CODE_RESERVATION, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)

                                        End If

                                    End If

                                    'dialog = MessageBox.Show("Télécharger La fiche de confirmation ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                End If

                            End If

                            Dim CODE_RESERVATAION_ As String = CODE_RESERVATION
                            Dim NOM_PRENOM_ As String = GunaTextBoxNomPrenom.Text
                            Dim ARRIVAL_ As Date = GunaDateTimePickerArrivee.Value.ToShortDateString()
                            Dim DEPART_ As Date = GunaDateTimePickerDepart.Value.ToShortDateString()
                            Dim TEMP_A_FAIRE_ As Integer = GunaTextBoxTempsAFaire.Text
                            Dim TYPE_CHAMBRE_ As String = GunaTextBoxLibelleTYpe.Text
                            Dim NUM_CHAMBRE_ As String = GunaTextBoxNumeroChambre.Text
                            Dim MONTANT_PAR_NUITEE_ As Double = montantParNuitee
                            Dim HEURE_ARRIVEE_ As DateTime = GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem
                            Dim HEURE_DEPART_ As DateTime = GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem
                            Dim TYPE_CHAMBRE_SALLE_ As String = GlobalVariable.typeChambreOuSalle

                            Dim args As ArgumentType = New ArgumentType()

                            args.CODE_RESERVATAION = CODE_RESERVATAION_
                            args.NOM_PRENOM = NOM_PRENOM_
                            args.ARRIVAL = ARRIVAL_
                            args.DEPART = DEPART_
                            args.TEMP_A_FAIRE = TEMP_A_FAIRE_
                            args.TYPE_CHAMBRE = TYPE_CHAMBRE_
                            args.NUM_CHAMBRE = NUM_CHAMBRE_
                            args.MONTANT_PAR_NUITEE = MONTANT_PAR_NUITEE_
                            args.HEURE_ARRIVEE = HEURE_ARRIVEE_
                            args.HEURE_DEPART = HEURE_DEPART_
                            args.TYPE_CHAMBRE_SALLE = TYPE_CHAMBRE_SALLE_
                            args.EMAIL = EMAIL
                            args.TELEPHONE_CLIENT = TELEPHONE_CLIENT

                            GunaLabelNumReservation.Text = CODE_RESERVATION

                            '-----------------------------------------------------

                            'GESTION DES GRATUITEES - PERMET D'INSERER LA RESERVATION DANS LA TABLE gratuitee_de_resa
                            gestionDelaGratuiteeDeLaReservation()

                            'GESTION DES PRISES EN CHARGES DE LA RESERVATION
                            gestionDelaPriseEnChargeDeLaReservation()

                            '---------------------------------------------------------------------------------------------------------------------

                            Dim TYPE_DEPOT_CAUTION As Integer = 0

                            If MONTANT_TOTAL_CAUTION > 0 Then
                                TYPE_DEPOT_CAUTION = 0
                                'cautionEnregistrement(CODE_RESERVATION, 0, GunaTextBoxMontantCaution.Text, TYPE)
                                cautionEnregistrement(CODE_RESERVATION, 0, MONTANT_TOTAL_CAUTION, TYPE_DEPOT_CAUTION)
                            End If

                            If DEPOT_DE_GARANTIE > 0 Then
                                TYPE_DEPOT_CAUTION = 1
                                cautionEnregistrement(CODE_RESERVATION, 0, DEPOT_DE_GARANTIE, TYPE_DEPOT_CAUTION)
                            End If


                            'TabControlHbergement.SelectedIndex = 0

                            'VidageDesChampsPourNouvelleReservation()

                            '-------------------------------------------------------------------------------------------------
                            'RSERVATION NORMALE

                            'Clearing all the informations found in the the reseravtion field
                            'emtptyRegistrationFields()

                            'We set all the global variables used for update to their original values


                            'Renitialisation des dates en plus de la date de travail après avoir vidé les variables globales
                            ReinitialisationDesDates()

                            Functions.SiplifiedClearTextBox(Me)

                            'On masque les tarifs associés au client si existe 
                            GunaComboBoxCodeTarif.Visible = False
                            GunaLabelCodeTarif.Visible = False

                            'ReservationList()

                            'Desactivation du bouton de gestion de groupe
                            GunaCheckBoxReservationDeGroupe.Checked = False

                            reservationButtonToDisplay()

                            GunaCheckBoxPetitDejeuenerInclus.Checked = False
                            GunaCheckBoxTaxeSejour.Checked = False
                            GunaTextBoxPetitDejeuner.Visible = False
                            GunaTextBoxPetitDejeunerRoutage.Visible = False

                            'Obtention des informations pour les statistiques
                            Dim stat As New statistiques()

                            stat.ObtenirDerniereStatistique()

                            Dim codeDelaDerniereStatistique As String = stat.ObtenirDerniereStatistique()

                            GlobalVariable.informationDesStatistiques = Functions.getElementByCode(codeDelaDerniereStatistique, "statistiques", "CODE_STATISTIQUE")

                            GunaTextBoxBC.Visible = False

                            GunaButtonCheckOut.Visible = False

                            GunaTextBoxNbreAdulte.Text = 0

                            'CARDEX

                            VidageDesChampsPourNouvelleReservation()


                            If GlobalVariable.AgenceActuelle.Rows(0)("MESSAGE_WHATSAPP") = 1 Then

                                If envoieConfirmationDeReservation Then

                                    '1- MESSAGE WHATSAPP

                                    If SEND_WHATSAP Then

                                        WHATSAPP_OU_EMAIL = 0
                                        args.WHATSAPP_OU_EMAIL = WHATSAPP_OU_EMAIL
                                        args.action = ARG_ACTION

                                        backGroundWorkerToCall(args)

                                    End If

                                    '2- MESSAGE PAR MAIL

                                    If SEND_MAIL Then

                                        WHATSAPP_OU_EMAIL = 1
                                        args.WHATSAPP_OU_EMAIL = WHATSAPP_OU_EMAIL
                                        args.action = ARG_ACTION

                                        backGroundWorkerToCall(args)

                                    End If

                                End If

                            End If

                            '-----------------------------------------------------

                            Me.Cursor = Cursors.Default

                        End If

                    Else

                        Dim infoSupResa As DataTable = Functions.getElementByCode(GunaLabelNumReservation.Text, "reserve_conf", "CODE_RESERVATION")

                        If infoSupResa.Rows.Count > 0 Then
                            GunaTextBoxNumeroChambre.Text = infoSupResa.Rows(0)("CHAMBRE_ID")
                        End If

                        Dim infoChambreResa As DataTable = Functions.getElementByCode(GunaTextBoxNumeroChambre.Text, "chambre", "CODE_CHAMBRE")

                        If infoChambreResa.Rows.Count > 0 Then
                            GunaTextBoxLibelleChambre.Text = infoChambreResa.Rows(0)("LOCALISATION")
                        End If

                    End If

                End If

            End If
        End If


    End Sub

    '------------------------------ END RESERVATION ----------------------------------


    'When Changing the real price manually we re do calculations
    Private Sub GunaTextBoxMontantAccorde_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxMontantAccorde.TextChanged

        ReservationMoneyCalculation()

        Dim prixAfficher As Double = 0
        Dim prixAccorde As Double = 0

        If Not Trim(GunaTextBoxpPrixAffiche.Text).Equals("") Then
            prixAfficher = GunaTextBoxpPrixAffiche.Text
        End If

        If Not Trim(GunaTextBoxMontantAccorde.Text).Equals("") Then
            prixAccorde = GunaTextBoxMontantAccorde.Text
        End If

        If prixAfficher > 0 Then
            If prixAfficher = prixAccorde Then
                If GlobalVariable.AgenceActuelle.Rows(0)("CLUB_ELITE") = 1 Then
                    gestionReductionClubElite()
                End If
            End If
        End If

        If GunaCheckBoxGratuitee.Checked Then
            GunaTextBoxMontantAccorde.Text = 0
        End If

    End Sub

    'We automatically fill the user part of the form when when ever a new client is created
    Sub FillingFormFromNewlyCreatedUserData()

        If (GlobalVariable.addUserFromFrontOffice = True) Then

            GunaTextBoxNomPrenom.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("NOM_PRENOM").ToString
            GunaTextBoxTelClient.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("TELEPHONE").ToString
            GunaTextBoxClientEmail.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("EMAIL").ToString
            GunaTextBoxCNI.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("CNI").ToString
            GunaTextBoxRefClient.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("CODE_CLIENT").ToString)
            GlobalVariable.codeClient = GlobalVariable.userAddedFromFrontOffice.Rows(0)("CODE_CLIENT").ToString
            'GunaTextBoxRefClient.Text = Trim(Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("CODE_CLIENT").ToString))
            GunaTextBoxSiteWeb.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("SITE_INTERNET").ToString)
            GunaTextBoxTelClient.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("TELEPHONE"))
            GunaTextBoxNomJeuneFille.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("NOM_JEUNE_FILLE"))
            GunaTextBoxTypeClient.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("TYPE_CLIENT"))
            GunaDateTimePickerDateNaissance.Value = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("DATE_DE_NAISSANCE"))
            GunaTextBoxLieu.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("LIEU_DE_NAISSANCE"))
            GunaTextBoxNationalite.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("NATIONALITE"))
            GunaTextBoxPaysResidence.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("PAYS_RESIDENCE"))
            GunaTextBoxProfession.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("PROFESSION"))
            GunaTextBoxNumeroCompte.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("NUM_COMPTE"))
            GunaTextBoxRue.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("ADRESSE"))
            GunaTextBoxVilleDeResidence.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("VILLE_DE_RESIDENCE")
            GunaTextBoxModeTransport.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("MODE_TRANSPORT")
            GunaTextBoxNumVehicule.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("NUM_VEHICULE")
            GunaTextBoxVenantDe.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("VILLE_DE_RESIDENCE")

            'Client ajouté a partir du front desk chargement de l'entreprise du client
            Dim Entreprise As DataTable = Functions.getElementByCode(GlobalVariable.userAddedFromFrontOffice.Rows(0)("CODE_ENTREPRISE"), "client", "CODE_CLIENT")

            If Entreprise.Rows.Count > 0 Then
                GunaTextBoxEntrepriseDuclient.Text = Trim(Entreprise.Rows(0)("NOM_PRENOM"))
            End If

        End If

        'We determine which button to display depending on the information that have been filled
        reservationButtonToDisplay()

    End Sub

    Public Sub MainWindowManualActivation()

        GunaLabelNbreDeNavette.Text = "(" & Functions.alerteNavette() & ")"
        GunaLabelNbreDeNavette.ForeColor = Color.Red

        GunaLabelNombreDeConsigne.Text = "(" & Functions.alerteConsignes() & ")"

        GunaGroupBoxRoomStatus.Controls.Clear()
        'PanelGraphiques.Controls.Clear()
        GunaGroupBoxStatistiques.Controls.Clear()

        Me.Refresh()

        ' GlobalVariable.cloturer = True lorsque l'on cloture une journee
        If GlobalVariable.cloturer Then

            GunaDateTimePickerArriveeDepart.Value = GlobalVariable.DateDeTravail
            GunaDateTimePickerDepartDepert.Value = GlobalVariable.DateDeTravail.AddDays(1)
            GunaDateTimePickerDebutEnChambre.Value = GlobalVariable.DateDeTravail
            GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail
            GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail
            GunaLabelDateDeTravail.Text = GlobalVariable.DateDeTravail.ToShortDateString
            GunaDateTimePickerDebut.Value = GlobalVariable.DateDeTravail
            GunaDateTimePickerFin.Value = GlobalVariable.DateDeTravail

            'Clearing all the informations found in the the reseravtion field
            VidageDesChampsPourNouvelleReservation()
            'Functions.emptyFields(Me)

            'We set all the global variables used for update to their original values
            Functions.EmtyGlobalVariablesContainingCodeToUpdate()
            ReinitialisationDesDates()

            'Functions.SiplifiedClearTextBox(Me)

            'On masque les tarifs associés au client si existe 
            GunaComboBoxCodeTarif.Visible = False
            GunaLabelCodeTarif.Visible = False

            GlobalVariable.cloturer = False

        End If

        'Loading Tarif from front desk, as it has an influence on Prix réel
        If GlobalVariable.tarifFromFrontDesk Then

            Dim tarif As DataTable = Functions.getElementByCode(GlobalVariable.tarifFromFrontDeskCode, "tarif_prix", "ID_TARIF")

            If GlobalVariable.typeChambreOuSalle = "chambre" Then

                If tarif.Rows.Count > 0 Then
                    GunaTextBoxMontantAccorde.Text = Format(tarif.Rows(0)("PRIX_TARIF1"), "#,##0")
                End If

            ElseIf GlobalVariable.typeChambreOuSalle = "salle" Then

                If tarif.Rows.Count > 0 Then
                    GunaTextBoxMontantReelSalle.Text = Format(tarif.Rows(0)("PRIX_TARIF1"), "#,##0")
                End If

            End If

            GlobalVariable.tarifFromFrontDeskCode = ""
            GlobalVariable.tarifFromFrontDesk = False

        End If


        'We update our values from Planning pannel
        If GlobalVariable.ComingFromPlanning Then

            GunaLabelNumReservation.Visible = True
            GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")
            'We set back the value to false
            GlobalVariable.ComingFromPlanning = False

        End If

        If Not GlobalVariable.chambreOuSalleFromFrontDesk = "" Then

            'ON ne peut mettre que ceux qui sont libre propre
            Dim chambre As DataTable = Functions.getElementByCode(GlobalVariable.chambreOuSalleFromFrontDesk, "chambre", "CODE_CHAMBRE")

            'We want to attribute the code of the romm that was select in the room list coming from the frontdesk
            If chambre.Rows.Count > 0 Then

                Dim chambreId As Integer = 0
                Integer.TryParse(chambre.Rows(0)("ID_CHAMBRE"), chambreId)
                GlobalVariable.idChambre = chambreId
                GlobalVariable.codeChambre = chambre.Rows(0)("CODE_CHAMBRE").ToString
                GunaTextBoxNumeroChambre.Text = chambre.Rows(0)("CODE_CHAMBRE").ToString
                GunaTextBoxLibelleChambre.Text = chambre.Rows(0)("LOCALISATION").ToString
                'GunaTextBoxSuperficie.Text = chambre.Rows(0)("SUPERFICIE").ToString
                'GunaTextBoxSuperficie.Text = chambre.Rows(0)("CAPACITE").ToString

                GunaDataGridViewRoom.Visible = False

            End If

            GlobalVariable.chambreOuSalleFromFrontDesk = ""

        End If

        If GlobalVariable.addCategorieFromFrontOffice Then

            ' We add the information obtained after a double click on the Room Type Categorie list

            If Not GlobalVariable.CategorieAddedFromFrontOffice Is Nothing Then

                If GlobalVariable.CategorieAddedFromFrontOffice.Rows.Count > 0 Then

                    GunaTextBoxCodeTypeDeChambre.Text = GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("CODE_TYPE_CHAMBRE")

                    GunaTextBoxLibelleTYpe.Text = GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("LIBELLE_TYPE_CHAMBRE")

                    Dim PrixAffiche As Double
                    Double.TryParse(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("PRIX"), PrixAffiche)
                    GunaTextBoxpPrixAffiche.Text = Format(PrixAffiche, "#,##0")

                    Dim prixAccorde As Double
                    Double.TryParse(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("PRIX"), prixAccorde)

                    'LE PRIX DU TYPE DE CHAMBRE NE DOIT PAS MODIFIER LE PRIX DE VENTE (0) EN CAS DE GRATUITEE

                    If GunaCheckBoxGratuitee.Checked Then
                        If GunaCheckBoxGratuiteInfo.Checked Then
                            If Not Trim(GunaTextBoxAuthoriseePar.Text).Equals("") Then
                                prixAccorde = 0
                            End If
                        End If
                    End If

                    GunaTextBoxMontantAccorde.Text = Format(prixAccorde, "#,##0")
                    'GunaTextBoxCodeType.Text = GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("CODE_TYPE_CHAMBRE")

                    If GlobalVariable.typeChambreOuSalle = "salle" Then

                        GunaTextBoxMontantAfficherSalle.Text = Format(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("PRIX"), "#,##0")
                        GunaTextBoxMontantReelSalle.Text = Format(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("PRIX"), "#,##0")
                        GunaTextBoxSuperficie.Text = Format(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("SUPERFICIE"), "#,##0")
                        GunaTextBoxCapacite.Text = Format(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("CAPACITE"), "#,##0")

                    End If

                End If

            End If

            'GunaTextBoxNumeroChambre.BaseColor = Color.White
            GunaTextBoxNumeroChambre.Enabled = True

            GunaTextBoxNumeroChambre.Text = ""
            GunaTextBoxLibelleChambre.Text = ""

            GlobalVariable.addCategorieFromFrontOffice = False

        End If

        'Refreshing the value of the Solde 
        If Not GlobalVariable.codeClientToUpdate = "" Then


            GunaLabelSolde.Text = Format(Functions.SituationDeReservation(GunaLabelNumReservation.Text), "#,##0")

            'We print the reservation  number or code
            GunaLabelNumReservation.Visible = True
            GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate
            GunaLabelNumReservation.Refresh()

        End If

        If GlobalVariable.addUserFromFrontOffice Then

            FillingFormFromNewlyCreatedUserData()

            GlobalVariable.addUserFromFrontOffice = False

        End If

        'We activated the main form as we come from MainCouranteJournaliere
        If (GlobalVariable.fromMainCouranteJournaliereToFrontOffice) Then

            TabControlHbergement.SelectedIndex = 0

            affectingValuesToFields()

            GunaDataGridViewRoomType.Visible = False

            'We set the value that permit to know that we come fron MainCouranteJournaliere to Default
            GlobalVariable.fromMainCouranteJournaliereToFrontOffice = False

        End If

        Dim solde As Double = 0

        Double.TryParse(GunaLabelSolde.Text, solde)

        If 0 > solde Then
            GunaLabelSolde.ForeColor = Color.Red
        ElseIf solde = 0 Then
            GunaLabelSolde.ForeColor = Color.Black
        Else
            GunaLabelSolde.ForeColor = Color.Green
        End If

        GunaDataGridViewRoomType.Visible = False
        GunaDataGridViewClient.Visible = False
        GunaDataGridViewRoom.Visible = False
        GunaDataGridViewPhone.Visible = False

    End Sub

    'Update the amount when ever the arhes (Avances) changes
    Private Sub GunaTextBoxAvance_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxAvance.TextChanged

        'We automatically field information of the newly registered client
        ReservationMoneyCalculation()

    End Sub

    'END OF FILLING OF FORM FOR REGISTRATION

    '-------------------------------------------------- CHECKIN MANAGEMENT BUTTON ------------------------------------------------------
    Dim web As New WebBrowser
    Dim web0 As New WebBrowser
    Dim web1 As New WebBrowser
    Dim web2 As New WebBrowser
    Dim web3 As New WebBrowser
    Dim web4 As New WebBrowser

    Private Sub miseAjourDeRegelementApresCreationDeMainCourante(ByVal NUM_RESERVATION As String, ByVal CODE_MAIN_COURANTE_JOURNALIERE As String, Optional ByVal DEPOSIT_YES_NO As Integer = 0)

        'ON DOIT VERIFIER SI LA RESERVATION DONT ON CREEE LA LIGNE DE MAINCOURANTE EST ASSOCIE A UN REGLEMENT EN ESPECE FAITE LORS DE LA RESA

        If DEPOSIT_YES_NO = 0 Then


        End If

        Dim ensembleDesReglementsPasse As DataTable = Functions.getElementByCode(NUM_RESERVATION, "reglement", "CODE_RESERVATION")

        Dim MONTANT_VERSE As Double = 0

        If ensembleDesReglementsPasse.Rows.Count > 0 Then

            Dim encaissementPasse As Double = 0

            Dim FIELDVALUE As Double = 0

            Dim TABLE_TO_UPDATE As String = ""
            TABLE_TO_UPDATE = "main_courante_journaliere"
            Dim FIELD_TO_UPDATE As String = ""
            Dim MODE_REGLEMENT_PASSE As String = ""

            For i = 0 To ensembleDesReglementsPasse.Rows.Count - 1

                MONTANT_VERSE = ensembleDesReglementsPasse.Rows(i)("MONTANT_VERSE")
                MODE_REGLEMENT_PASSE = ensembleDesReglementsPasse.Rows(i)("MODE_REGLEMENT")

                FIELD_TO_UPDATE = ReglementForm.champEncaissementAMettreAjours(MODE_REGLEMENT_PASSE)

                Dim mainCourantes As New MainCourantes()

                If DEPOSIT_YES_NO = 1 Then

                    FIELD_TO_UPDATE = "ARRHES"

                    'ON MET A JOURS L'ARRHES (DEPOSIT) POUR EQUILIBRER LE MONTANT A REPORTER
                    mainCourantes.UpdateArrhesMainCourante(CODE_MAIN_COURANTE_JOURNALIERE, TABLE_TO_UPDATE, FIELD_TO_UPDATE, MONTANT_VERSE)

                ElseIf DEPOSIT_YES_NO = 0 Then
                    mainCourantes.updateMainCouranteJournaliereModeReglement(CODE_MAIN_COURANTE_JOURNALIERE, TABLE_TO_UPDATE, FIELD_TO_UPDATE, MONTANT_VERSE)
                    If CDate(ensembleDesReglementsPasse.Rows(i)("DATE_REGLEMENT")).ToShortDateString < CDate(GlobalVariable.DateDeTravail).ToShortDateString Then
                        Functions.updateOfFields(TABLE_TO_UPDATE, FIELD_TO_UPDATE, MONTANT_VERSE * -1, "CODE_MAIN_COURANTE_JOURNALIERE", CODE_MAIN_COURANTE_JOURNALIERE, 1)
                    End If
                End If

            Next

        End If

    End Sub

    Private Sub GunaButtonCheckIn_Click(sender As Object, e As EventArgs) Handles GunaButtonCheckIn.Click

        Dim facturationAnticipe As Boolean = True
        'On doit vérifier que la date de sortie n'est jamais inférieure a la date de travail
        Dim dayDiff = CType((GlobalVariable.DateDeTravail - GunaDateTimePickerDepart.Value).TotalHours, Int32)


        Dim multiplier As Boolean = True
        Dim montant_total As Double = 0

        If GunaCheckBoxMensuel.Checked Then
            multiplier = False
        End If

        If dayDiff > 0 Then

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Bien vouloir vérifier la da de départ", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
            Else
                MessageBox.Show("Please check the departure date", "Reservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If

        Else

            If GunaComboBoxSourceReservation.SelectedIndex = -1 Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Bien vouloir choisir une source de réservation", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Else
                    MessageBox.Show("Please select a reservation source", "Reservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If

            Else

                If GunaTextBoxNbrePersonne.Text > 0 Then

                    Dim CHAMBRE_ID As String = ""

                    If Not Trim(GunaTextBoxNumeroChambre.Text) = "" Then
                        CHAMBRE_ID = Trim(GunaTextBoxNumeroChambre.Text)
                    Else
                        CHAMBRE_ID = "-"
                    End If

                    If Not Functions.clientDejaEnChambre(CHAMBRE_ID) Then

                        Dim messageDeConfirmation As String = ""
                        GlobalVariable.duplicationDeReservation = False

                        'DAY USE ou SEJOURS
                        If multiplier Then
                            montant_total = Double.Parse(GunaTextBoxMontantAccorde.Text) * Integer.Parse(GunaTextBoxTempsAFaire.Text)
                        Else
                            montant_total = Double.Parse(GunaTextBoxMontantAccorde.Text)
                        End If

                        If GunaCheckBoxDayUse.Checked Then

                            If GlobalVariable.actualLanguageValue = 1 Then
                                messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Type de Chambre : " & GunaTextBoxLibelleTYpe.Text & "; N° Chambre : " & GunaTextBoxNumeroChambre.Text & Chr(13) & " Durée : " & GunaComboBoxHeureArrivee.SelectedItem.ToString & " - " & GunaComboBoxHeureDepart.SelectedItem.ToString & " soit (" & GunaTextBoxTempsAFaire.Text & ") Heure(s)" & Chr(13) & "Tarif réel : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                            Else
                                messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Room Type : " & GunaTextBoxLibelleTYpe.Text & "; Room N° : " & GunaTextBoxNumeroChambre.Text & Chr(13) & " Period : " & GunaComboBoxHeureArrivee.SelectedItem.ToString & " - " & GunaComboBoxHeureDepart.SelectedItem.ToString & " for (" & GunaTextBoxTempsAFaire.Text & ") Hour(s)" & Chr(13) & "Real Price : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                            End If
                        Else

                            If GunaRadioButtonChambre.Checked Then
                                'GESTION DES CHAMBRES
                                If GlobalVariable.actualLanguageValue = 1 Then
                                    messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Type de Chambre : " & GunaTextBoxLibelleTYpe.Text & "; N° Chambre : " & GunaTextBoxNumeroChambre.Text & Chr(13) & "Période : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " soit (" & GunaTextBoxTempsAFaire.Text & ") Jour(s)" & Chr(13) & "Tarif réel : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                                Else
                                    messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Room Type : " & GunaTextBoxLibelleTYpe.Text & "; Room N° : " & GunaTextBoxNumeroChambre.Text & Chr(13) & "Period : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " i.e (" & GunaTextBoxTempsAFaire.Text & ") Day(s)" & Chr(13) & "Real Price : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                                End If

                            Else

                                'GESTION DES SALLES
                                Dim nomEvent As String = ""

                                Dim infoSupEvent As DataTable = Functions.getElementByCode(GunaComboBoxEvenement.SelectedValue.ToString, "evenement", "CODE_EVENEMENT")

                                If infoSupEvent.Rows.Count > 0 Then
                                    nomEvent = infoSupEvent.Rows(0)("LIBELLE")
                                End If

                                If GlobalVariable.actualLanguageValue = 1 Then
                                    messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Type de Chambre : " & GunaTextBoxLibelleTYpe.Text & "; N° Chambre : " & GunaTextBoxNumeroChambre.Text & Chr(13) & "Période : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " soit (" & GunaTextBoxTempsAFaire.Text & ") Jour(s)" & Chr(13) & "Tarif réel : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                                Else
                                    messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Room Type : " & GunaTextBoxLibelleTYpe.Text & "; Room N° : " & GunaTextBoxNumeroChambre.Text & Chr(13) & "Period : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " i.e" & GunaTextBoxTempsAFaire.Text & ") Day(s)" & Chr(13) & "Real Price : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                                End If
                            End If

                        End If

                        Dim dialogCheckIn As DialogResult = MessageBox.Show(messageDeConfirmation, "Confirmation de Check In", MessageBoxButtons.OKCancel, MessageBoxIcon.Information)

                        If dialogCheckIn = DialogResult.OK Then

                            'DEBUT ON SE RASSURE QUE LE NUMERO DE CHAMBRE N'EST PAS VIDE OU EXISTE VRAIMENT -------------------------------------

                            Dim continuer As Boolean = False

                            Dim dialog01 As DialogResult

                            Dim message As String = ""

                            If Trim(GunaTextBoxNumeroChambre.Text).Equals("") Or Trim(GunaTextBoxNumeroChambre.Text).Equals("-") Then

                                If GlobalVariable.actualLanguageValue = 1 Then
                                    message = "Bien vouloir saisir un numéro de chambre !!"
                                Else
                                    message = "please type in a room number !!"
                                End If
                            Else

                                Dim roomInfoSuo As DataTable = Functions.getElementByCode(GunaTextBoxNumeroChambre.Text, "chambre", "CODE_CHAMBRE")

                                If roomInfoSuo.Rows.Count > 0 Then
                                    continuer = True
                                Else

                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        message = "Bien vouloir saisir un numéro de chambre valide !!"
                                    Else
                                        message = "please type in a valide room number !!"
                                    End If
                                End If

                            End If

                            If Not continuer Then
                                dialog01 = MessageBox.Show(message, "CheckIn Impossible", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                            End If

                            'END ON SE RASSURE QUE LE NUMERO DE CHAMBRE N'EST PAS VIDE OU EXISTE VRAIMENT -------------------------------------

                            If continuer Then

                                Me.Cursor = Cursors.WaitCursor

                                Dim CODE_TARIF_RESERVATION As String = ""

                                If GlobalVariable.tarificationDynamiqueActif Then

                                    If GunaComboBoxCodeTarif.SelectedIndex >= 0 Then

                                        If GunaComboBoxCodeTarif.Visible Then

                                            CODE_TARIF_RESERVATION = GunaComboBoxCodeTarif.SelectedValue.ToString()
                                        End If

                                    End If

                                End If

                                Dim TELEPHONE_CLIENT As String = Trim(GunaTextBoxTelClient.Text)
                                Dim EMAIL As String = Trim(GunaTextBoxClientEmail.Text)

                                Dim BC_ENTREPRISE As String = GunaTextBoxBC.Text

                                If Trim(GunaTextBoxMontantCaution.Text) = "" Then
                                    GunaTextBoxMontantCaution.Text = 0
                                End If

                                LabelNatureReservation.Visible = False

                                Dim solde As Double = 0

                                Double.TryParse(GunaLabelSolde.Text, solde)

                                If 0 > solde Then
                                    GunaLabelSolde.ForeColor = Color.Red
                                ElseIf solde = 0 Then
                                    GunaLabelSolde.ForeColor = Color.Black
                                Else
                                    GunaLabelSolde.ForeColor = Color.Green
                                End If

                                'On masque les tarifs associés au client si existe 
                                GunaComboBoxCodeTarif.Visible = False
                                GunaLabelCodeTarif.Visible = False

                                Dim ADULTES As Integer = GunaTextBoxNbreAdulte.Text
                                Dim ENFANTS As Integer = GunaTextBoxNbreEnfant.Text

                                If GunaRadioButtonMailOui.Checked Then
                                    GlobalVariable.RECEVOIR_EMAIL = 1
                                Else
                                    GlobalVariable.RECEVOIR_EMAIL = 0
                                End If

                                If GunaRadioButtonWhatsAppOui.Checked Then
                                    GlobalVariable.RECEVOIR_SMS = 1
                                Else
                                    GlobalVariable.RECEVOIR_SMS = 0
                                End If

                                Dim DAY_USE As Integer = 0

                                If GunaCheckBoxDayUse.Checked Then
                                    DAY_USE = 1
                                End If

                                Dim MENSUEL As Integer = 0

                                If GunaCheckBoxMensuel.Checked Then
                                    MENSUEL = 1
                                End If

                                Dim CLIENT_ID As String = GunaTextBoxRefClient.Text

                                Dim UTILISATEUR_ID As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

                                Dim AGENCE_ID As String = GlobalVariable.codeAgence

                                Dim NOM_CLIENT As String = GunaTextBoxNomPrenom.Text

                                'ROUTAGE PETIT DEJEUNER
                                Dim PETIT_DEJEUNER_ROUTAGE As Double = 0

                                If GunaCheckBoxPetitDejRoutage.Checked Then
                                    Dim pdjRoutage As Double = 0
                                    Double.TryParse(GunaTextBoxPetitDejeunerRoutage.Text, pdjRoutage)
                                    PETIT_DEJEUNER_ROUTAGE = pdjRoutage
                                End If

                                'ROUTAGE LOGEMENT
                                Dim CHAMBRE_ROUTAGE As String = ""

                                If GunaCheckBoxChambreRoutage.Checked Then
                                    If GunaComboBoxChambreRoutage.SelectedIndex >= 0 Then
                                        CHAMBRE_ROUTAGE = GunaComboBoxChambreRoutage.SelectedValue.ToString
                                    End If
                                End If

                                Dim ETAT_NOTE_RESERVATION As String


                                If GlobalVariable.typeChambreOuSalle = "chambre" Then
                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        ETAT_NOTE_RESERVATION = "EN CHAMBRE"

                                    Else
                                        ETAT_NOTE_RESERVATION = "IN HOUSE"

                                    End If

                                ElseIf GlobalVariable.typeChambreOuSalle = "salle" Then

                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        ETAT_NOTE_RESERVATION = "EN SALLE"

                                    Else
                                        ETAT_NOTE_RESERVATION = "IN HALL"
                                    End If

                                End If

                                Dim ROUTAGE As String = ""

                                If GlobalVariable.actualLanguageValue = 1 Then
                                    ROUTAGE = "NON"
                                Else
                                    ROUTAGE = "NO"
                                End If

                                If GunaCheckBoxChambreRoutage.Checked Then
                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        ROUTAGE = "OUI"
                                    Else
                                        ROUTAGE = "YES"
                                    End If
                                End If

                                Dim SOURCE_RESERVATION As String = ""

                                If GunaComboBoxSourceReservation.SelectedIndex >= 0 Then
                                    SOURCE_RESERVATION = GunaComboBoxSourceReservation.SelectedValue.ToString
                                End If

                                Dim CODE_ENTREPRISE As String = Trim(GunaTextBoxCodeEntrepriseDuClient.Text)
                                Dim NOM_ENTREPRISE As String = Trim(GunaTextBoxEntrepriseDuclient.Text)

                                Dim VENANT_DE As String = GunaTextBoxVenantDe.Text
                                Dim SE_RENDANT_A As String = GunaTextBoxSerendantA.Text
                                Dim RAISON As String = GunaComboBoxTypeReservation.SelectedItem.ToString

                                If Trim(GunaTextBoxPetitDejeuner.Text) = "" Then
                                    GunaTextBoxPetitDejeuner.Text = 0
                                End If

                                Dim PETIT_DEJEUNER As Double = GunaTextBoxPetitDejeuner.Text

                                Dim AFFICHER_PRIX As Integer = 1

                                If Not GunaCheckBoxAfficherPrix.Checked Then
                                    AFFICHER_PRIX = 0
                                End If

                                Dim BFK_COST As Double = 0
                                If Not Trim(GunaTextBoxBreakFastCost.Text).Equals("") Then
                                    BFK_COST = GunaTextBoxBreakFastCost.Text
                                End If

                                '----------------- dates obtained when ever the resting days change
                                'working perfectly
                                Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

                                Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

                                Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
                                Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

                                'Dim DATE_ENTTRE As Date = GlobalVariable.DATE_ENTTRE
                                Dim DATE_ENTTRE As Date = GunaDateTimePickerArrivee.Value.ToShortDateString
                                Dim HEURE_ENTREE As String = DateTimeArrivee
                                'Dim DATE_SORTIE As Date = GlobalVariable.DATE_SORTIE
                                Dim DATE_SORTIE As Date = GunaDateTimePickerDepart.Value.ToShortDateString
                                Dim HEURE_SORTIE As String = DateTimeDepart

                                Dim TYPE_CHAMBRE_OU_SALLE As String = ""

                                If GunaRadioButtonChambre.Checked Then

                                    TYPE_CHAMBRE_OU_SALLE = "chambre"

                                ElseIf GunaRadioButtonSalleFete.Checked Then

                                    TYPE_CHAMBRE_OU_SALLE = "salle"

                                End If

                                If GunaRadioButtonMailOui.Checked Then
                                    GlobalVariable.RECEVOIR_EMAIL = 1
                                End If

                                If Trim(GunaTextBoxNbrePersonne.Text) = "" Then
                                    GunaTextBoxNbrePersonne.Text = 0
                                End If

                                Dim NB_PERSONNES As Integer = GunaTextBoxNbrePersonne.Text
                                Dim RECEVOIR_EMAIL As Integer = GlobalVariable.RECEVOIR_EMAIL
                                Dim RECEVOIR_SMS As Integer = GlobalVariable.RECEVOIR_SMS
                                Dim ETAT_RESERVATION As Integer = 1
                                Dim DATE_CREATION As Date = GlobalVariable.DateDeTravail
                                Dim HEURE_CREATION As DateTime = DateTime.Now().ToString("hh:mm:ss")
                                Dim MONTANT_TOTAL_CAUTION As Double = GunaTextBoxMontantCaution.Text
                                Dim MOTIF_ETAT As String = ""
                                Dim DATE_ETAT As Date = GlobalVariable.DateDeTravail
                                Dim MONTANT_ACCORDE As Double = 0

                                Dim DEBUT_HEURE As Date = CDate(DateTimeArrivee).ToShortTimeString
                                Dim FIN_HEURE As Date = CDate(DateTimeDepart).ToShortTimeString

                                Dim NOMBRE_HEURE As Integer = 1

                                If GunaCheckBoxDayUse.Checked Then
                                    NOMBRE_HEURE = CType((FIN_HEURE - DEBUT_HEURE).TotalHours, Int32)
                                End If

                                If GlobalVariable.typeChambreOuSalle = "salle" Then
                                    If Not Trim(GunaTextBoxMontantReelSalle.Text) = "" Then
                                        MONTANT_ACCORDE = Double.Parse(GunaTextBoxMontantReelSalle.Text) * NOMBRE_HEURE
                                    End If
                                ElseIf GlobalVariable.typeChambreOuSalle = "chambre" Then
                                    If Not Trim(GunaTextBoxMontantAccorde.Text) = "" Then
                                        MONTANT_ACCORDE = Double.Parse(GunaTextBoxMontantAccorde.Text) * NOMBRE_HEURE
                                    End If
                                End If

                                Dim updatedSolde As Double = 0

                                'RESERVATION DE GROUPE
                                Dim GROUPE As String = ""

                                If GunaCheckBoxReservationDeGroupe.Checked Then
                                    GROUPE = Trim(GunaTextBoxCodeDeGroupe.Text)
                                End If

                                'Dim CODE_RESERVATION = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")
                                Dim CODE_RESERVATION = GunaLabelNumReservation.Text

                                Dim reservation As New Reservation()
                                Dim mainCourante As New MainCourantes()
                                Dim reglement As New Reglement()
                                Dim occupationChambre As New OccupationChambre()
                                Dim facture As New Facture()

                                Dim compte As New Compte()
                                Dim caisse As New Caisse()

                                'Inserting a new reservation after checking that the reservation does not already exist

                                ' variables declarations 

                                '-------------------------------- OCCUPATION CHAMBRE ------------------------------
                                Dim CODE_OCCUPATION_CHAMBRE = Functions.GeneratingRandomCodeWithSpecifications("occupation_chambre", "OC")
                                Dim MONTANT_HT As Double = MONTANT_ACCORDE
                                Dim TAXE As Double = 0
                                Dim MONTANT_TTC As Double = 0
                                Dim DATE_OCCUPATION As Date = DATE_ENTTRE
                                'Dim OBSERVATIONS As String =""
                                Dim COMMENTAIRE1 As String = ""
                                Dim COMMENTAIRE2 As String = ""
                                Dim COMMENTAIRE3 As String = ""
                                Dim COMMENTAIRE4 As String = ""
                                Dim DATE_LIBERATION As Date = DATE_SORTIE
                                Dim CODE_UTILISATEUR_CREA As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
                                Dim DATE_PREMIERE_ARRIVEE As Date = DATE_ENTTRE
                                Dim TYPE_RESERVATION As String = ""
                                Dim PDJ_INCLUS As String = ""
                                Dim TAXE_SEJOURS_INCLUS As String = ""
                                Dim TVA_INCLUS As String = ""
                                Dim CODE_CLIENT_REEL As String = CLIENT_ID

                                '------------------------------- REGLEMENT ----------------------------------------------

                                If GunaTextBoxDepotDeGarantie.Text = "" Then
                                    GunaTextBoxDepotDeGarantie.Text = 0
                                End If

                                Dim DEPOT_DE_GARANTIE As Double = Double.Parse(GunaTextBoxDepotDeGarantie.Text)

                                'Dim NUM_REGLEMENT As String = Functions.GeneratingRandomCode("reglement", "RGL")
                                Dim NUM_FACTURE As String = ""
                                Dim CODE_CAISSIER As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
                                Dim montantVerse As Double = 0
                                Double.TryParse(GunaTextBoxAvance.Text, montantVerse)
                                Dim MONTANT_VERSE As Double = montantVerse
                                Dim DATE_REGLEMENT As Date = GlobalVariable.DateDeTravail

                                Dim MODE_REGLEMENT As String = ""
                                Dim REF_REGLEMENT As String = ""

                                If GlobalVariable.actualLanguageValue = 1 Then
                                    MODE_REGLEMENT = "Garantie"
                                    REF_REGLEMENT = "DEPOT DE GARANTIE DE " & "[" & NOM_CLIENT & " / " & CHAMBRE_ID & "]"
                                Else
                                    MODE_REGLEMENT = "arrhes"
                                    REF_REGLEMENT = "ARRHES OF " & "[" & NOM_CLIENT & " / " & CHAMBRE_ID & "]"
                                End If

                                Dim CODE_MODE As String = ""
                                Dim IMPRIMER As Double = 0

                                Dim NUMERO_BLOC_NOTE = ""
                                Dim MODE_REG_INFO_SUP_1 = ""
                                Dim MODE_REG_INFO_SUP_2 = ""
                                Dim MODE_REG_INFO_SUP_3 = ""

                                '----------- MAIN COURANTES ------------------------------
                                Dim CODE_MAIN_COURANTE As String = Functions.GeneratingRandomCodeWithSpecifications("main_courante", "MC")
                                Dim CODE_CLIENT As String = GlobalVariable.codeClient
                                Dim CODE_CHAMBRE As String = GlobalVariable.codeChambre
                                Dim ETAT_CHAMBRE As String = 1
                                Dim CODE_AGENCE As String = AGENCE_ID

                                '----------- MAIN COURANTE GENERALE ------------------------------

                                Dim CODE_MAIN_COURANTE_GENERALE As String = Functions.GeneratingRandomCodeWithSpecifications("main_courante_generale", "MCG")
                                Dim DATE_MAIN_COURANTE As Date = GlobalVariable.DateDeTravail
                                Dim PDJ_FOOD As Double = 0
                                Dim PDJ_BOISSON As Double = 0
                                Dim DEJEUNER_FOOD As Double = 0
                                Dim DEJEUNER_BOISSON As Double = 0
                                Dim DINER_FOOD As Double = 0
                                Dim DINER_BOISSON As Double = 0
                                Dim BANQUET_FOOD As Double = 0
                                Dim BANQUET_BOISSON As Double = 0
                                Dim BAR_MATIN As Double = 0
                                Dim BAR_SOIR As Double = 0
                                Dim DIVERS As Double = 0

                                Dim TAUX_OCCUPATION_PCT As Double = 0 'TAUX_OCCUPATION_PCT USED AS TAXE DE SEJOUR
                                Dim POSTER_TAX As Double = 0

                                If GunaCheckBoxTaxeSejour.Checked Then
                                    If Not Trim(GunaTextBoxTaxeSejour.Text).Equals("") Then
                                        TAUX_OCCUPATION_PCT = GunaTextBoxTaxeSejour.Text
                                        POSTER_TAX = GunaTextBoxTaxeSejour.Text
                                    End If
                                Else
                                    Functions.DeleteElementByCode(CODE_RESERVATION, "taxe_sejour_collectee", "NUM_RESERVATION")
                                End If

                                Dim TOTAL_JOUR As Double = MONTANT_ACCORDE + TAUX_OCCUPATION_PCT
                                Dim REPORT_VEILLE As Double = 0
                                Dim TOTAL_GENERAL As Double = MONTANT_ACCORDE + TAUX_OCCUPATION_PCT
                                Dim NUM_RESERVATION = CODE_RESERVATION
                                Dim DEDUCTION As Double = 0
                                Dim ENCAISSEMENT_ESPECE As Double = 0
                                Dim ENCAISSEMENT_CHEQUE As Double = 0
                                Dim ENCAISSEMENT_CARTE_CREDIT As Double = 0
                                Dim A_REPORTER As Double = (MONTANT_ACCORDE + TAUX_OCCUPATION_PCT) * -1
                                Dim OBSERVATIONS As String = ""
                                Dim TYPE_CHAMBRE As String = GunaTextBoxCodeTypeDeChambre.Text
                                Dim INDICE_FREQUENTATION As Double = 0
                                Dim INDICE_FREQUENTATION_PCT As Double = 0
                                Dim TAUX_OCCUPATION As Double = 0

                                Dim CLIENTS_ATTENDUS As Integer = 0
                                Dim CLIENTS_EN_CHAMBRE As Integer = GunaTextBoxNbrePersonne.Text
                                Dim CHAMBRES_DISPONIBLES As Integer = 0
                                Dim TOTAL_HORS_SERVICE As Integer = 0
                                Dim CHAMBRES_HORS_SERVICE As Integer = 0
                                Dim TOTAL_FICTIVES As Integer = 0
                                Dim CHAMBRES_FICTIVES As Integer = 0
                                Dim NOMBRE_MESSAGES As Integer = 0
                                Dim TOTAL_GRATUITES As Double = 0
                                Dim CHAMBRES_GRATUITES As Integer = 0
                                Dim TOTAL_NON_FACTUREES As Double = 0
                                Dim CHAMBRES_NON_FACTUREES As Integer = 0

                                '----------- MAIN COURANTE JOURNALIERE ------------------------------

                                Dim CODE_MAIN_COURANTE_JOURNALIERE As String = Functions.GeneratingRandomCodeWithSpecifications("main_courante_journaliere", "MCJ")
                                Dim PDJ As Double = 0
                                Dim DEJEUNER As Double = 0
                                Dim DINER As Double = 0
                                Dim CAFE As Double = 0
                                Dim BAR As Double = 0
                                Dim CAVE As Double = 0
                                Dim AUTRE As Double = 0

                                Dim SOUS_TOTAL1 As Double = 0

                                If GunaCheckBoxPetitDejeuenerInclus.Checked Then

                                    Dim petitDejeuner As Double = 0
                                    Double.TryParse(GunaTextBoxPetitDejeuner.Text, petitDejeuner)
                                    SOUS_TOTAL1 = petitDejeuner 'On gère les taxes séjours par apport la valeur SOUS_TOTAL1 de la main courante journaliere

                                End If

                                Dim Location As Double = 0
                                Dim TELE As Double = 0
                                Dim FAX As Double = 0
                                Dim LINGE As Double = 0
                                Dim SOUS_TOTAL2 As Double = 0
                                Dim DEBITEUR As Double = 0
                                Dim ARRHES As Double = 0

                                '------------------------------- compte -----------------------------

                                Dim INTITULE As String = ""
                                Dim NUMERO_COMPTE As String = ""
                                Dim TOTAL_DEBIT As Double = GlobalVariable.MONTANT_TOTAL
                                Dim TOTAL_CREDIT As Double = GlobalVariable.avance
                                Dim SOLDE_COMPTE As Double = TOTAL_CREDIT - TOTAL_DEBIT

                                Dim SENS_DU_SOLDE As String = ""

                                If (TOTAL_DEBIT < TOTAL_CREDIT) Then
                                    SENS_DU_SOLDE = "crediteur+++++++++++++++++++++"
                                ElseIf (TOTAL_CREDIT < TOTAL_DEBIT) Then
                                    SENS_DU_SOLDE = "debiteur++++++++++++++++++++++"
                                Else
                                    SENS_DU_SOLDE = "equilibre+++++++++++++++++++++"
                                End If

                                Dim TYPE_DE_COMPTE As String = "debiteur"

                                '--------------------------- FORFAIT SALLE

                                Dim nbreCafe As Integer = 0
                                Dim cafePu As Double = 0
                                Dim dejeunerNbre As Integer = 0
                                Dim dejeunerPu As Double = 0
                                Dim dinerNbre As Integer = 0
                                Dim dinerPu As Double = 0
                                Dim traiteurNbre As Integer = 0
                                Dim traiteurPu As Double = 0

                                Double.TryParse(GunaTextBox35.Text, nbreCafe)
                                Double.TryParse(GunaTextBoxForfaitCafe.Text, cafePu)
                                Double.TryParse(GunaTextBox30.Text, dejeunerNbre)
                                Double.TryParse(GunaTextBoxForfatiDejeuner.Text, dejeunerPu)
                                Double.TryParse(GunaTextBox25.Text, dinerNbre)
                                Double.TryParse(GunaTextBoxForfaitDiner.Text, dinerPu)
                                Double.TryParse(GunaTextBox13.Text, traiteurNbre)
                                Double.TryParse(GunaTextBoxForfaitTraiteur.Text, traiteurPu)

                                Dim NBRE__CAFE = nbreCafe
                                Dim PU_CAFE = cafePu
                                Dim NBRE_DEJEUNER = dejeunerNbre
                                Dim PU_DEJEUNER = dejeunerPu
                                Dim NBRE_DINER = dinerNbre
                                Dim PU_DINER = dinerPu
                                Dim NBRE_TRAITEUR = traiteurNbre
                                Dim PU_TRAITEUR = traiteurPu
                                Dim decorationCast As Double = 0
                                Double.TryParse(GunaTextBoxDecoration.Text, decorationCast)
                                Dim DECORATION = decorationCast

                                Dim LOCATION_MATERIEL As Double = 0
                                Dim AUTRES As Double = 0

                                If Not Trim(GunaTextBoxMateriel.Text) = "" Then
                                    LOCATION_MATERIEL = GunaTextBoxMateriel.Text
                                End If

                                If Not Trim(GunaTextBoxAutres.Text) = "" Then
                                    AUTRES = GunaTextBoxAutres.Text
                                End If

                                Dim CODE_EVENEMENT = ""
                                Dim LIBELLE_EVENEMENT = ""

                                If GunaComboBoxEvenement.SelectedIndex >= 0 Then
                                    CODE_EVENEMENT = GunaComboBoxEvenement.SelectedValue

                                    Dim evenement As DataTable = Functions.getElementByCode("CODE_EVENEMENT", "evenement", "CODE_EVENEMENT")

                                    If evenement.Rows.Count > 0 Then
                                        LIBELLE_EVENEMENT = evenement.Rows(0)("evenement")
                                    End If

                                End If

                                Dim NBRE_GOUTER As Integer = 0
                                Dim PU_GOUTER As Double = 0
                                Dim NBRE_COCKTAIL As Integer = 0
                                Dim PU_COCKTAIL As Double = 0

                                If Not Trim(GunaTextBoxQteGouter.Text) = "" Then
                                    NBRE_GOUTER = GunaTextBoxQteGouter.Text
                                End If

                                If Not Trim(GunaTextBoxPrixGouter.Text) = "" Then
                                    PU_GOUTER = GunaTextBoxPrixGouter.Text
                                End If

                                If Not Trim(GunaTextBoxCocktail.Text) = "" Then
                                    NBRE_COCKTAIL = GunaTextBoxCocktail.Text
                                End If

                                If Not Trim(GunaTextBoxPUCocktail.Text) = "" Then
                                    PU_COCKTAIL = GunaTextBoxPUCocktail.Text
                                End If

                                '------------------------------- addition ---------------------------------------------------------

                                Dim HEURE_PAUSE_CAFE As String = ""
                                If GunaComboBoxHeureCafe.SelectedIndex >= 0 Then
                                    HEURE_PAUSE_CAFE = GunaComboBoxHeureCafe.SelectedItem
                                End If

                                Dim HEURE_PAUSE_DEJEUNER As String = ""
                                If GunaComboBoxHeureDej.SelectedIndex >= 0 Then
                                    HEURE_PAUSE_DEJEUNER = GunaComboBoxHeureDej.SelectedItem
                                End If

                                Dim HEURE_DINER As String = ""
                                If GunaComboBoxHeureDiner.SelectedIndex >= 0 Then
                                    HEURE_DINER = GunaComboBoxHeureDiner.SelectedItem
                                End If

                                Dim HEURE_GOUTER As String = ""
                                If GunaComboBoxHeureGouter.SelectedIndex >= 0 Then
                                    HEURE_GOUTER = GunaComboBoxHeureGouter.SelectedItem
                                End If

                                Dim HEURE_COCKTAIL As String = ""
                                If GunaComboBoxHeureCocktail.SelectedIndex >= 0 Then
                                    HEURE_COCKTAIL = GunaComboBoxHeureCocktail.SelectedItem
                                End If

                                Dim VIDEO_PROJ As Integer = 0
                                If GunaCheckBoxVidOui.Checked Then
                                    VIDEO_PROJ = 1
                                ElseIf GunaCheckBoxVidNon.Checked Then
                                    VIDEO_PROJ = 0
                                Else
                                    VIDEO_PROJ = 0
                                End If

                                Dim SONO As Integer = 0
                                If GunaCheckBoxSonoOui.Checked Then
                                    SONO = 1
                                ElseIf GunaCheckBoxSonoNon.Checked Then
                                    SONO = 0
                                Else
                                    SONO = 0
                                End If

                                Dim COUVERTS As Integer = 0
                                If GunaCheckBoxCouvOui.Checked Then
                                    COUVERTS = 1
                                ElseIf GunaCheckBoxCouvNon.Checked Then
                                    COUVERTS = 0
                                Else
                                    COUVERTS = 0
                                End If

                                Dim TABLE_CHAISE As Integer = 0
                                If GunaCheckBoxTableOui.Checked Then
                                    TABLE_CHAISE = 1
                                ElseIf GunaCheckBoxTableNon.Checked Then
                                    TABLE_CHAISE = 0
                                Else
                                    TABLE_CHAISE = 0
                                End If

                                Dim EAU_PTE_QTE As Integer = 0
                                If Not Trim(GunaTextBox47.Text) = "" Then
                                    EAU_PTE_QTE = GunaTextBox47.Text
                                End If

                                Dim EAU_PTE_MONTANT As Double = 0
                                If Not Trim(GunaTextBoxMontantEauPetiteBouteille.Text) = "" Then
                                    EAU_PTE_MONTANT = GunaTextBoxMontantEauPetiteBouteille.Text
                                End If

                                Dim EAU_GRDE_QTE As Integer = 0
                                If Not Trim(GunaTextBox10.Text) = "" Then
                                    EAU_GRDE_QTE = GunaTextBox10.Text
                                End If

                                Dim EAU_GRDE_MONTANT As Double = 0
                                If Not Trim(GunaTextBox68.Text) = "" Then
                                    EAU_GRDE_MONTANT = GunaTextBox68.Text
                                End If

                                Dim BOISSONS_GAZEUSES_QTE As Integer = 0
                                If Not Trim(GunaTextBox48.Text) = "" Then
                                    BOISSONS_GAZEUSES_QTE = GunaTextBox48.Text
                                End If

                                Dim BOISSONS_GAZEUSES_MONTANT As Double = 0
                                If Not Trim(GunaTextBox62.Text) = "" Then
                                    BOISSONS_GAZEUSES_MONTANT = GunaTextBox62.Text
                                End If

                                Dim BIERES_QTE As Integer = 0
                                If Not Trim(GunaTextBox50.Text) = "" Then
                                    BIERES_QTE = GunaTextBox50.Text
                                End If

                                Dim BIERES_MONTANT As Double = 0
                                If Not Trim(GunaTextBox61.Text) = "" Then
                                    BIERES_MONTANT = GunaTextBox61.Text
                                End If

                                Dim VIN_ROUGE_QTE As Integer = 0
                                If Not Trim(GunaTextBox54.Text) = "" Then
                                    VIN_ROUGE_QTE = GunaTextBox54.Text
                                End If

                                Dim VIN_ROUGE_MONTANT As Double = 0
                                If Not Trim(GunaTextBox59.Text) = "" Then
                                    VIN_ROUGE_MONTANT = GunaTextBox59.Text
                                End If

                                Dim VIN_ROSE_QTE As Integer = 0
                                If Not Trim(GunaTextBox63.Text) = "" Then
                                    VIN_ROSE_QTE = GunaTextBox63.Text
                                End If

                                Dim VIN_ROSE_MONTANT As Double = 0
                                If Not Trim(GunaTextBox64.Text) = "" Then
                                    VIN_ROSE_MONTANT = GunaTextBox64.Text
                                End If

                                Dim BOISSONS_EXT_QTE As Integer = 0
                                If Not Trim(GunaTextBox36.Text) = "" Then
                                    BOISSONS_EXT_QTE = GunaTextBox36.Text
                                End If

                                Dim BOISSONS_EXT_MONTANT As Double = 0
                                If Not Trim(GunaTextBox57.Text) = "" Then
                                    BOISSONS_EXT_MONTANT = GunaTextBox57.Text
                                End If

                                Dim DROIT_DE_BOUCHON As Double = 0
                                If Not Trim(GunaTextBoxDroitDeBouchon.Text) = "" Then
                                    DROIT_DE_BOUCHON = GunaTextBoxDroitDeBouchon.Text
                                End If

                                Dim MISE_EN_PLACE As Integer = 0 ' U

                                If GunaCheckBoxU.Checked Then
                                    MISE_EN_PLACE = 1
                                ElseIf GunaCheckBoxEcole.Checked Then
                                    MISE_EN_PLACE = 2 ' Ecole
                                ElseIf GunaCheckBoxTheatre.Checked Then
                                    MISE_EN_PLACE = 3 ' Theatre
                                ElseIf GunaCheckBoxRectangle.Checked Then
                                    MISE_EN_PLACE = 4 ' Rectangle
                                ElseIf GunaCheckBoxCocktail.Checked Then
                                    MISE_EN_PLACE = 5 'Cocktail
                                ElseIf GunaCheckBoxBanquet.Checked Then
                                    MISE_EN_PLACE = 6 'Banquet
                                End If

                                Dim CLOISONNEMENT As Integer = 0
                                If GunaCheckBox2.Checked Then
                                    CLOISONNEMENT = 2
                                ElseIf GunaCheckBox9.Checked Then
                                    CLOISONNEMENT = 3 ' Ecole
                                Else
                                    CLOISONNEMENT = 0
                                End If
                                '--------------------------------------------------------------------------------------------------

                                Dim reservationConf As New Reservation()

                                'CHECKIN DIRECT CAR ON A AUCUNE EXISTENCE DE LA RESA

                                '-------------------------------------- MOUCHARDS ---------------------------------------------------
                                Dim ACTION As String = ""

                                If GunaCheckBoxDayUse.Checked Then

                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        ACTION = "CHECKIN [CHAMBRE " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " DU " & DEBUT_HEURE & " - " & FIN_HEURE & "]"

                                    Else
                                        ACTION = "CHECKIN [ROOM " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " FROM " & DEBUT_HEURE & " - " & FIN_HEURE & "]"

                                    End If
                                Else

                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        ACTION = "CHECKIN [CHAMBRE " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " DU " & DATE_ENTTRE & " - " & DATE_SORTIE & "]"

                                    Else
                                        ACTION = "CHECKIN [ROOM " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " FROM " & DATE_ENTTRE & " - " & DATE_SORTIE & "]"

                                    End If
                                End If

                                User.mouchard(ACTION)
                                '-------------------------------------------------------------------------------------------------------------------------

                                Dim CODE_SUIVI As String = Functions.GeneratingRandomCodeWithSpecifications("suivi_des_reservations", "SVR")
                                Dim RESERVATION_PAR As String = ""
                                Dim CHECKIN_PAR As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
                                Dim CHECKOUT_PAR As String = ""
                                Dim DELOGEMENT_PAR As String = ""

                                '-------------------------------------- TARIFICATION DYNAMIQUE EN UTILISANT UN FICHIER TEXT --------------------------------------------------------------

                                'Dim tarif As New Tarifs

                                If (GlobalVariable.codeReservationToUpdate = "") Then
                                    'CHECKIN DIRECT
                                    If GlobalVariable.tarificationDynamiqueActif Then

                                        Dim DateDebut As Date = CDate(GlobalVariable.DateDeTravail).ToShortDateString

                                        Dim tarif As New Tarifs

                                        'TRAITEMENT D'UN CKECKIN DIRECT DONC FICHIER TEXT DE TARIFICATION INEXISTANT DONC ON VA LE CREER
                                        tarif.determinationDesMontantPourTouteLaPeriodeDelaReservation(DateDebut, CODE_RESERVATION, CODE_TARIF_RESERVATION, DATE_ENTTRE, DATE_SORTIE, TYPE_CHAMBRE)

                                    End If

                                    'DIRECT CHECKIN
                                    User.suiviDesReservations(CODE_SUIVI, CODE_RESERVATION, RESERVATION_PAR, CHECKIN_PAR, CHECKOUT_PAR, DELOGEMENT_PAR)
                                    Dim operation As Integer = 0 'INSERTION 

                                    gestionDesNavettes(operation, CODE_RESERVATION)

                                    'Direct checkIn as the reservation has not been saved before
                                    'We check if the code of the reservation already exist in the database
                                    If Not Functions.entryCodeExists(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION") Then

                                        If reservationConf.insertReservationConf(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, DEPOT_DE_GARANTIE, DAY_USE, MENSUEL, BC_ENTREPRISE, TYPE_CHAMBRE, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                                            'FACTURATION ANTICIPE
                                            If facturationAnticipe Then
                                                reservation.facturationEnAvance(CODE_RESERVATION, POSTER_TAX)
                                            End If

                                            Dim TABLE As String = "reserve_conf"

                                            reservation.updatePetitDejeuner(PETIT_DEJEUNER, CODE_RESERVATION, TABLE, AFFICHER_PRIX, BFK_COST)

                                            If GlobalVariable.typeChambreOuSalle = "salle" Then
                                                reservation.insertForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION, LOCATION_MATERIEL, AUTRES, CODE_EVENEMENT, LIBELLE_EVENEMENT, NBRE_GOUTER, PU_GOUTER, NBRE_COCKTAIL, PU_COCKTAIL, HEURE_PAUSE_CAFE, HEURE_PAUSE_DEJEUNER, HEURE_DINER, HEURE_GOUTER, HEURE_COCKTAIL, VIDEO_PROJ, SONO, COUVERTS, TABLE_CHAISE, EAU_PTE_QTE, EAU_PTE_MONTANT, EAU_GRDE_QTE, EAU_GRDE_MONTANT, BOISSONS_GAZEUSES_QTE, BOISSONS_GAZEUSES_MONTANT, BIERES_QTE, BIERES_MONTANT, VIN_ROUGE_QTE, VIN_ROUGE_MONTANT, VIN_ROSE_QTE, VIN_ROSE_MONTANT, BOISSONS_EXT_QTE, BOISSONS_EXT_MONTANT, DROIT_DE_BOUCHON, MISE_EN_PLACE, CLOISONNEMENT)
                                            End If

                                            'We update the checkin button so not to display the checkin button again
                                            reservation.updateReservationConfCheckIn(CODE_RESERVATION)

                                            'We update the room if everythig is ok

                                            '-------------------------- OCCUPATION CHAMBRE--------------------------
                                            If Not Functions.entryCodeExists(CODE_OCCUPATION_CHAMBRE, "occupation_chambre", "CODE_OCCUPATION_CHAMBRE") Then

                                                If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                                                End If

                                            End If

                                            '----------- MAIN COURANTES ------------------------------

                                            'We check if the the main courante already exist
                                            If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante", "CODE_MAIN_COURANTE") Then

                                                If mainCourante.insertMainCourante(CODE_MAIN_COURANTE, CODE_CLIENT, CODE_RESERVATION, CODE_CHAMBRE, ETAT_CHAMBRE, ETAT_RESERVATION, DATE_ETAT, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                                                End If
                                            End If

                                            '----------- MAIN COURANTE GENERALE ------------------------------

                                            'We check if the the main courante generale already exist
                                            If Not Functions.entryCodeExists(CODE_MAIN_COURANTE_GENERALE, "main_courante_generale", "CODE_MAIN_COURANTE_GENERALE") Then

                                                If mainCourante.insertMainCouranteGenerale(CODE_MAIN_COURANTE_GENERALE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ_FOOD, PDJ_BOISSON, DEJEUNER_FOOD, DEJEUNER_BOISSON, DINER_FOOD, DINER_BOISSON, BANQUET_FOOD, BANQUET_BOISSON, BAR_MATIN, BAR_SOIR, DIVERS, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                                                End If

                                            End If

                                            '----------- MAIN COURANTE JOURNALIERE ------------------------------

                                            'We check if the the main courante journaliere already exist
                                            If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante_journaliere", "CODE_MAIN_COURANTE_JOURNALIERE") Then

                                                ETAT_CHAMBRE = 1

                                                If mainCourante.insertMainCouranteJournaliere(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                                                    '-------------------UTILISE POUR LES RESERVATION DONT L'ENCAISSEMENT EST FAIT AVANT L'ENREGISTREMENT -------------------------
                                                    miseAjourDeRegelementApresCreationDeMainCourante(NUM_RESERVATION, CODE_MAIN_COURANTE_JOURNALIERE)
                                                    '------------------------------------------------------------------------------------------------------


                                                End If

                                            End If

                                        End If

                                    Else
                                        ' the generated code already exist

                                    End If

                                Else
                                    'CHECKIN INDIRECT
                                    'LA RESERVATION A ETE ENREGISTREE AU PREALABLE 

                                    'Checkin from reservation meaning the reseravtion has been saved earlier

                                    'AVANT DE MIGRER ON DOIT ENREGISTERE D'EVENTUELLE MODIFICATION

                                    'As the Global variable codeReservationToUpdate is not empty => update reservation
                                    ' we determine if the reservation is found in reservation or reserve_conf
                                    CODE_RESERVATION = GlobalVariable.codeReservationToUpdate
                                    CHAMBRE_ID = GlobalVariable.codeChambre

                                    'DIRECT CHECKIN
                                    User.updateSuiviDesReservations("CHECKIN_PAR", CHECKIN_PAR, CODE_RESERVATION)

                                    Dim operation As Integer = 1 'UPDATE
                                    gestionDesNavettes(operation, CODE_RESERVATION)

                                    'We have to search where the reservtion to update is found either in reservation or reserve_conf
                                    Dim reservationTable As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

                                    If reservationTable.Rows.Count > 0 Then

                                        If reservation.updateReservation(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, DEPOT_DE_GARANTIE, DAY_USE, MENSUEL, BC_ENTREPRISE, TYPE_CHAMBRE, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                                            Dim TABLE As String = "reserve_conf"

                                            reservation.updatePetitDejeuner(PETIT_DEJEUNER, CODE_RESERVATION, TABLE, AFFICHER_PRIX, BFK_COST)

                                            'So we migrate the  entry from reservation to reserve_conf
                                            If reservationConf.insertReservationMigration(CODE_RESERVATION) Then

                                                'FACTURATION ANTICIPE
                                                If facturationAnticipe Then
                                                    reservation.facturationEnAvance(CODE_RESERVATION, POSTER_TAX)
                                                End If

                                                Functions.DeleteElementByCode(CODE_RESERVATION, "reservation", "CODE_RESERVATION")
                                                'We change the status of the checkin field to yes as it was initialise to 0
                                                reservation.updateReservationConfCheckIn(CODE_RESERVATION)
                                            End If

                                            'GESTION DE NOUVELLE RESERVATION
                                            If Not GlobalVariable.codeReservationToUpdate = "" Then
                                                'reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", GunaLabelSolde.Text) ''klg
                                                updatedSolde = Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate)
                                                reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", updatedSolde)
                                            End If

                                            If GlobalVariable.typeChambreOuSalle = "salle" Then
                                                reservation.updateForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION, LOCATION_MATERIEL, AUTRES, CODE_EVENEMENT, LIBELLE_EVENEMENT, NBRE_GOUTER, PU_GOUTER, NBRE_COCKTAIL, PU_COCKTAIL, HEURE_PAUSE_CAFE, HEURE_PAUSE_DEJEUNER, HEURE_DINER, HEURE_GOUTER, HEURE_COCKTAIL, VIDEO_PROJ, SONO, COUVERTS, TABLE_CHAISE, EAU_PTE_QTE, EAU_PTE_MONTANT, EAU_GRDE_QTE, EAU_GRDE_MONTANT, BOISSONS_GAZEUSES_QTE, BOISSONS_GAZEUSES_MONTANT, BIERES_QTE, BIERES_MONTANT, VIN_ROUGE_QTE, VIN_ROUGE_MONTANT, VIN_ROSE_QTE, VIN_ROSE_MONTANT, BOISSONS_EXT_QTE, BOISSONS_EXT_MONTANT, DROIT_DE_BOUCHON, MISE_EN_PLACE, CLOISONNEMENT)
                                            End If

                                            '---------------------------------------------------------------
                                            CODE_MAIN_COURANTE_JOURNALIERE = GlobalVariable.codeMainCouranteJournaliereToUpdate

                                            NUM_RESERVATION = GlobalVariable.codeReservationToUpdate

                                            ETAT_CHAMBRE = 1

                                            'CHEKCIN D'UNE RESA AVEC MAINCOURANTE JOURNALIERE QUI SERA JUSTE UTILISE APRES BASCULEMENT DE reserve vers reserve_conf

                                            Dim tableMainCouranteJournaliere As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")

                                            If tableMainCouranteJournaliere.Rows.Count > 0 Then

                                                If mainCourante.updateMainCouranteJournaliere(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                                                    Dim ensembleDesReglementsPasse As DataTable = Functions.getElementByCode(NUM_RESERVATION, "reglement", "CODE_RESERVATION")

                                                    If ensembleDesReglementsPasse.Rows.Count > 0 Then

                                                        Dim encaissementPasse As Double = 0

                                                        Dim FIELDVALUE As Double = 0

                                                        Dim TABLE_TO_UPDATE As String = ""
                                                        TABLE_TO_UPDATE = "main_courante_journaliere"
                                                        Dim FIELD_TO_UPDATE As String = ""
                                                        Dim MODE_REGLEMENT_PASSE As String = ""

                                                        Dim MONTANT_VERSE_RESERVE As Double = 0

                                                        For i = 0 To ensembleDesReglementsPasse.Rows.Count - 1

                                                            MONTANT_VERSE_RESERVE = ensembleDesReglementsPasse.Rows(i)("MONTANT_VERSE")
                                                            MODE_REGLEMENT_PASSE = ensembleDesReglementsPasse.Rows(i)("MODE_REGLEMENT")

                                                            FIELD_TO_UPDATE = ReglementForm.champEncaissementAMettreAjours(MODE_REGLEMENT_PASSE)

                                                            Dim mainCourantes As New MainCourantes()
                                                            'INSETION SUR LA MAINCOURANTE DES REGLEMENTS ULTERIEURES
                                                            mainCourantes.updateMainCouranteJournaliereModeReglement(CODE_MAIN_COURANTE_JOURNALIERE, TABLE_TO_UPDATE, FIELD_TO_UPDATE, MONTANT_VERSE_RESERVE)

                                                            If CDate(ensembleDesReglementsPasse.Rows(i)("DATE_REGLEMENT")).ToShortDateString < CDate(GlobalVariable.DateDeTravail).ToShortDateString Then
                                                                Functions.updateOfFields(TABLE_TO_UPDATE, FIELD_TO_UPDATE, MONTANT_VERSE_RESERVE * -1, "CODE_MAIN_COURANTE_JOURNALIERE", CODE_MAIN_COURANTE_JOURNALIERE, 1)
                                                            End If

                                                        Next

                                                    End If

                                                End If

                                            Else

                                                'CHEKCIN D'UNE RESA SANS MAINCOURANTE JOURNALIERE CAR  ELLE A ETE CREE UN JOUR ANTERIEUR DONC PLUS D'EXISTENCE DE LA PREMIERE MAINCOURANTE
                                                'LA MAINCOURANTE N'EST PAS ASSOCIE A UNE RESA AVEC LA DATE DU JOUR
                                                'EN PLUS ON DOIT VERIFIER SI IL EXISTE D'EVENTUEL ARRHES
                                                ETAT_CHAMBRE = 1

                                                CODE_CLIENT = GlobalVariable.ReservationToUpdate.Rows(0)("CLIENT_ID")
                                                NOM_CLIENT = GlobalVariable.ReservationToUpdate.Rows(0)("NOM_CLIENT")

                                                CODE_MAIN_COURANTE_JOURNALIERE = Functions.GeneratingRandomCodeWithSpecifications("main_courante_journaliere", "MCJ")

                                                If mainCourante.insertMainCouranteJournaliere(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                                                    'MISE A ZERO DU MONTANT A REPORTER *****-*****

                                                    'ON DOIT VERIFIER SI LA RESERVATION DONT ON CREEE LA LIGNE DE MAINCOURANTE EST ASSOCIE A UN REGLEMENT EN ESPECE FAITE LORS DE LA RESA

                                                    Dim DEPOSIT_YES_NO As Integer = 1

                                                    miseAjourDeRegelementApresCreationDeMainCourante(NUM_RESERVATION, CODE_MAIN_COURANTE_JOURNALIERE, DEPOSIT_YES_NO)

                                                End If

                                            End If

                                            '---------------------------------------------------------------
                                        End If

                                    Else

                                    End If

                                    '-------------------------- OCCUPATION CHAMBRE--------------------------
                                    'If Not Functions.entryCodeExists(CODE_OCCUPATION_CHAMBRE, "occupation_chambre", "CODE_OCCUPATION_CHAMBRE") Then

                                    If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                                    End If

                                    'End If

                                End If

                                '-------------------------- UPDATE ROOM --------------------------------
                                Dim updateQuery As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code"

                                Dim command As New MySqlCommand(updateQuery, GlobalVariable.connect)

                                Dim roomStatus As String = "Occupée sale"
                                If GlobalVariable.actualLanguageValue = 0 Then
                                    roomStatus = "Occupied dirty"
                                End If
                                command.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                                command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = roomStatus
                                command.Parameters.Add("@code", MySqlDbType.VarChar).Value = Trim(GunaTextBoxNumeroChambre.Text)
                                'Opening the connection
                                'connect.openConnection()

                                'Excuting the command and testing if everything went on well
                                If (command.ExecuteNonQuery() = 1) Then
                                    'connect.closeConnection()
                                End If

                                '-------------------------------------------- TAXE SEJOUR COLLECTE ---------------------------------------

                                If GunaCheckBoxTaxeSejour.Checked Then

                                    Functions.DeleteElementByCode(CODE_RESERVATION, "taxe_sejour_collectee", "NUM_RESERVATION")

                                    'Insertion des lignes dans taxe séjours collectées TAXE_SEJOURS_COLLECTEE
                                    Dim insertQueryTaxe As String = "INSERT INTO `taxe_sejour_collectee` (`CODE_CATEGORIE_HOTEL`, `CODE_CLIENT`, `NUM_RESERVATION`, `NUM_FACTURE`, `CODE_CHAMBRE`, `TAXE_SEJOUR_COLLECTEE`, `DATE_FACTURATION_TAXE`, `DATE_CREATION`, `CODE_UTILISATEUR_CREA`, `CODE_AGENCE`) VALUES (@valu1,@valu2,@valu3,@valu4,@valu5,@valu6,@valu7,@valu8,@valu9,@valu10)"

                                    Dim commandTaxe As New MySqlCommand(insertQueryTaxe, GlobalVariable.connect)

                                    commandTaxe.Parameters.Add("@valu1", MySqlDbType.VarChar).Value = GlobalVariable.AgenceActuelle.Rows(0)("CATEGORIE_HOTEL")
                                    commandTaxe.Parameters.Add("@valu2", MySqlDbType.VarChar).Value = CLIENT_ID
                                    commandTaxe.Parameters.Add("@valu3", MySqlDbType.VarChar).Value = CODE_RESERVATION
                                    commandTaxe.Parameters.Add("@valu4", MySqlDbType.VarChar).Value = ""
                                    commandTaxe.Parameters.Add("@valu5", MySqlDbType.VarChar).Value = CHAMBRE_ID

                                    Dim TaxeSejour As Double
                                    Double.TryParse(GunaTextBoxTaxeSejour.Text, TaxeSejour)
                                    commandTaxe.Parameters.Add("@valu6", MySqlDbType.Double).Value = TaxeSejour

                                    commandTaxe.Parameters.Add("@valu7", MySqlDbType.Date).Value = GlobalVariable.DateDeTravail
                                    commandTaxe.Parameters.Add("@valu8", MySqlDbType.Date).Value = GlobalVariable.DateDeTravail
                                    commandTaxe.Parameters.Add("@valu9", MySqlDbType.VarChar).Value = GlobalVariable.codeUser
                                    commandTaxe.Parameters.Add("@valu10", MySqlDbType.VarChar).Value = GlobalVariable.AgenceActuelle.Rows(0)("CODE_AGENCE")

                                    'Opening the connection
                                    'connect.openConnection()

                                    'Excuting the command and testing if everything went on well
                                    If (commandTaxe.ExecuteNonQuery() = 1) Then
                                        'connect.closeConnection()
                                    Else
                                        'connect.closeConnection()
                                    End If

                                End If

                                'GESTION DES ENCAISSEMENTS ICI

                                '----------------------------------- ENCAISSEMENT + DEPOT DE GARANTIE --------------------------------------------------------

                                If DEPOT_DE_GARANTIE > 0 Then

                                    Dim NUM_REGLEMENT As String = Functions.GeneratingRandomCodeWithSpecifications("reglement", "RGL")

                                    MONTANT_VERSE = DEPOT_DE_GARANTIE

                                    'reglement.insertReglement(NUM_REGLEMENT, NUM_FACTURE, CODE_CAISSIER, MONTANT_VERSE, DATE_REGLEMENT, MODE_REGLEMENT, REF_REGLEMENT, CODE_MODE, IMPRIMER, CODE_AGENCE, CODE_RESERVATION, CODE_CLIENT, NUMERO_BLOC_NOTE, MODE_REG_INFO_SUP_1, MODE_REG_INFO_SUP_2, MODE_REG_INFO_SUP_3)

                                End If

                                If Not Trim(GunaTextBoxPaiement.Text).Equals("") Then

                                    If Double.Parse(GunaTextBoxPaiement.Text) > 0 Then

                                        Dim NUM_REGLEMENT As String = Functions.GeneratingRandomCodeWithSpecifications("reglement", "RGL")

                                        MONTANT_VERSE = GunaTextBoxPaiement.Text

                                        If GlobalVariable.actualLanguageValue = 1 Then
                                            MODE_REGLEMENT = "Espèce"
                                            REF_REGLEMENT = "ENCAISSEMENT (" & MODE_REGLEMENT & ") DE " & "[" & NOM_CLIENT & " / " & CHAMBRE_ID & "]"
                                        Else
                                            MODE_REGLEMENT = "Cash"
                                            REF_REGLEMENT = "CASHED IN (" & MODE_REGLEMENT & ") FROM " & "[" & NOM_CLIENT & " / " & CHAMBRE_ID & "]"
                                        End If

                                        ' reglement.insertReglement(NUM_REGLEMENT, NUM_FACTURE, CODE_CAISSIER, MONTANT_VERSE, DATE_REGLEMENT, MODE_REGLEMENT, REF_REGLEMENT, CODE_MODE, IMPRIMER, CODE_AGENCE, CODE_RESERVATION, CODE_CLIENT, NUMERO_BLOC_NOTE, MODE_REG_INFO_SUP_1, MODE_REG_INFO_SUP_2, MODE_REG_INFO_SUP_3)

                                        'MISE AJOURS DE LA MAINCOURANTE APRES VERSEMENT DE L'ESPECE AU MOMENT DE LA CREATION DE RESERVATION

                                        Dim TABLE As String = ""
                                        Dim FIELD As String = ""

                                        FIELD = "ENCAISSEMENT_ESPECE"

                                        TABLE = "main_courante_journaliere"

                                        Dim FIELDVALUE As Double = MONTANT_VERSE

                                        Dim mainCourantes As New MainCourantes()

                                        ' mainCourantes.updateMainCouranteJournaliereModeReglement(CODE_MAIN_COURANTE_JOURNALIERE, TABLE, FIELD, FIELDVALUE)

                                    End If

                                End If

                                '--------------------------------------- GESTION DE LA MISE A JOURS DU SOLDE DE LA RESERVATION ----------------------------

                                Dim reservationToUpdateInReservation As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reservation", "CODE_RESERVATION")

                                'SOIT DANS RESERVATION
                                Dim SOLDE_RESERVATION As Double = 0

                                If reservationToUpdateInReservation.Rows.Count > 0 Then

                                    'MISE JOURS DU SOLDE DE LA RESERVATION
                                    updatedSolde = Functions.SituationDeReservation(CODE_RESERVATION)
                                    SOLDE_RESERVATION = updatedSolde
                                    reservation.updateSoldeReservation(CODE_RESERVATION, "reservation", updatedSolde)

                                Else

                                    'OU DANS RESERVATION
                                    Dim reservationToUpdateInReserve_conf As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

                                    If reservationToUpdateInReserve_conf.Rows.Count > 0 Then

                                        updatedSolde = Functions.SituationDeReservation(CODE_RESERVATION)
                                        SOLDE_RESERVATION = updatedSolde
                                        reservation.updateSoldeReservation(CODE_RESERVATION, "reserve_conf", updatedSolde)

                                    End If

                                End If

                                '---------------------------------------EN CODAGE DES CARTE-------------------------------------------
                                'Gestion de l'encodage

                                If GlobalVariable.typeChambreOuSalle = "chambre" Then
                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        MessageBox.Show("HEBERGEMENT DE " & NOM_CLIENT & " DU  " & DATE_ENTTRE & " AU " & DATE_SORTIE & " enregistré avec succès!!", "Logement", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                    Else
                                        MessageBox.Show("ACCOMMODATION OF " & NOM_CLIENT & " FROM  " & DATE_ENTTRE & " TO " & DATE_SORTIE & " successfully saved !!", "Accommodation", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                    End If

                                ElseIf GlobalVariable.typeChambreOuSalle = "salle" Then
                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        MessageBox.Show("LOCATION DE SALLE DE " & NOM_CLIENT & " DU  " & DATE_ENTTRE & " AU " & DATE_SORTIE & " enregistré avec succès !!", "Logement", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                    Else
                                        MessageBox.Show("HALL RENTING " & NOM_CLIENT & " FROM  " & DATE_ENTTRE & " TO " & DATE_SORTIE & " sucessfully saved !!", "Lodging", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                    End If
                                End If

                                '-------------------------------------------- IMPRESSION DES DOCUMENTS -------------------------------------------------

                                Dim montantParNuitee As Double = 0

                                Dim dialog As DialogResult

                                If GlobalVariable.typeChambreOuSalle = "chambre" Then
                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        dialog = MessageBox.Show("Télécharger La fiche de police ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                    Else
                                        dialog = MessageBox.Show("Download Hotel Registration Form ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                    End If
                                ElseIf GlobalVariable.typeChambreOuSalle = "salle" Then
                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        dialog = MessageBox.Show("Télécharger Le contrat de location ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
                                    Else
                                        dialog = MessageBox.Show("Download renting contract ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                    End If
                                End If

                                If dialog = DialogResult.No Then
                                    'e.Cancel = True
                                Else

                                    'Génération des documents concernants les salles Confirmation de réservation

                                    'DOCUMENT DE LA SALLE DE FETE
                                    If GunaRadioButtonSalleFete.Checked Then

                                        If GlobalVariable.codeReservationToUpdate = "" Then

                                            'CONFIRMATION DE RESERVATION CAS DE CHECKIN DIRECT

                                            Double.TryParse(GunaTextBoxMontantReelSalle.Text, montantParNuitee)

                                            'CONTRAT DE POLICE
                                            'Functions.GenerationDeFicheDePolice(CODE_RESERVATION, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)

                                            Impression.contratDeLocationDeSalleDeFete(CODE_RESERVATION, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)

                                            'Functions.GenerationDeConfirmationReservation(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GunaDateTimeHeureArrive.Value.ToLongTimeString, GunaDateTimePickerHeureDepart.Value.ToLongTimeString, GlobalVariable.typeChambreOuSalle)

                                        Else

                                            'MessageBox.Show("Sélectionner un Document à imprimer!", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                        End If

                                        'DOCUMENT DE LA CHAMBRE
                                    ElseIf GunaRadioButtonChambre.Checked Then
                                        'Génération des documents concernants les chambres confirmation de réservation

                                        'CAS DE CHECKIN DIRECT

                                        Double.TryParse(GunaTextBoxMontantAccorde.Text, montantParNuitee)

                                        Functions.GenerationDeFicheDePolice(CODE_RESERVATION, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)

                                        'ENVOI DE FICHE DE POLICE AU CLIENT PAR EMAIL

                                    End If

                                End If

                                '-------------------------------------------- GESTION DES TRACES DES UTILISATEURS ----------------------------------------------------------

                                Dim ACTION_FAITE As String = GunaButtonCheckIn.Text
                                Dim FAITE_PAR As String = GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR")

                                reservation.insertTrace(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, DEPOT_DE_GARANTIE, DAY_USE, MENSUEL, BC_ENTREPRISE, TYPE_CHAMBRE, ACTION_FAITE, FAITE_PAR, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE, SOLDE_RESERVATION)


                                Dim CODE_RESERVATAION_ As String = CODE_RESERVATION
                                Dim NOM_PRENOM_ As String = GunaTextBoxNomPrenom.Text
                                Dim ARRIVAL_ As Date = GunaDateTimePickerArrivee.Value.ToShortDateString()
                                Dim DEPART_ As Date = GunaDateTimePickerDepart.Value.ToShortDateString()
                                Dim TEMP_A_FAIRE_ As Integer = GunaTextBoxTempsAFaire.Text
                                Dim TYPE_CHAMBRE_ As String = GunaTextBoxLibelleTYpe.Text
                                Dim NUM_CHAMBRE_ As String = GunaTextBoxNumeroChambre.Text
                                Dim MONTANT_PAR_NUITEE_ As Double = montantParNuitee
                                Dim HEURE_ARRIVEE_ As DateTime = GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem
                                Dim HEURE_DEPART_ As DateTime = GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem
                                Dim TYPE_CHAMBRE_SALLE_ As String = GlobalVariable.typeChambreOuSalle
                                Dim TELEPHONE As String = GunaTextBoxTelClient.Text

                                Dim args As ArgumentType = New ArgumentType()

                                args.CODE_RESERVATAION = CODE_RESERVATAION_
                                args.NOM_PRENOM = NOM_PRENOM_
                                args.ARRIVAL = ARRIVAL_
                                args.DEPART = DEPART_
                                args.TEMP_A_FAIRE = TEMP_A_FAIRE_
                                args.TYPE_CHAMBRE = TYPE_CHAMBRE_
                                args.NUM_CHAMBRE = NUM_CHAMBRE_
                                args.MONTANT_PAR_NUITEE = MONTANT_PAR_NUITEE_
                                args.HEURE_ARRIVEE = HEURE_ARRIVEE_
                                args.HEURE_DEPART = HEURE_DEPART_
                                args.TYPE_CHAMBRE_SALLE = TYPE_CHAMBRE_SALLE_
                                args.EMAIL = EMAIL
                                args.TELEPHONE_CLIENT = TELEPHONE_CLIENT

                                Dim sendMailChambre As Boolean = False
                                Dim sendWhatsAppChambre As Boolean = False

                                Dim sendMailSalle As Boolean = False
                                Dim sendWhatsAppSalle As Boolean = False

                                If GunaRadioButtonChambre.Checked Then

                                    If GunaRadioButtonMailOui.Checked Then
                                        If Not Trim(EMAIL).Equals("") And EMAIL.Length > 10 Then
                                            sendMailChambre = True
                                        End If
                                    End If

                                    If GunaRadioButtonWhatsAppOui.Checked Then
                                        If TELEPHONE.Length >= 13 Then
                                            sendWhatsAppChambre = True
                                        End If
                                    End If

                                Else

                                    If GunaRadioButtonMailOui.Checked Then
                                        If Not Trim(EMAIL).Equals("") And EMAIL.Length > 10 Then
                                            sendMailSalle = True
                                        End If
                                    End If

                                    If GunaRadioButtonWhatsAppOui.Checked Then
                                        If TELEPHONE.Length >= 13 Then
                                            sendWhatsAppSalle = True
                                        End If
                                    End If

                                End If

                                'ENVOI DE MESSAGE WHATSAPP AU CLIENT

                                Dim NUITEES As Integer = 0

                                NOMBRE_HEURE = CType((FIN_HEURE - DEBUT_HEURE).TotalHours, Int32)

                                NUITEES = CType((DATE_SORTIE - DATE_ENTTRE).TotalDays, Int32)

                                'If Not GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID") = GunaTextBoxNumeroChambre.Text Then

                                'Dim dialog1 As New DialogResult()

                                'dialog1 = MessageBox.Show("Délogement effectué de la " & GlobalVariable.codeChambreToUpdate & " vers la " & GunaTextBoxNumeroChambre.Text & " . Re-encoder la carte ?", "Encodage de carte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                ' If dialog1 = DialogResult.Yes Then
                                'GlobalVariable.infoReservationPourEncodage = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")
                                'ZenoLockForm.Show()
                                'ZenoLockForm.TopMost = True
                                'End If

                                ' End If


                                If GlobalVariable.typeChambreOuSalle = "chambre" Then

                                    If GlobalVariable.AgenceActuelle.Rows(0)("SERRURES") = 1 Then

                                        GlobalVariable.infoReservationPourEncodage = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

                                        Dim dialog1 As New DialogResult()

                                        If GlobalVariable.actualLanguageValue = 1 Then
                                            dialog1 = MessageBox.Show("Client entré en chambre. Encoder une carte ", "Encodage de carte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                        Else
                                            dialog1 = MessageBox.Show("Client Checked In. Issue a card ", "Card Issuance", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                                        End If

                                        'ZenoLockForm.Close()

                                        If dialog1 = DialogResult.Yes Then

                                            '--------------------------- PAYER AVANT ENCODAGE ---------------------------

                                            Dim DATE_DE_TRAVAIL As Date = GlobalVariable.DateDeTravail.ToShortDateString

                                            Dim encoder As Boolean = True

                                            Dim nombreDeNuiteAEncoder As Integer = 0

                                            If GlobalVariable.AgenceActuelle.Rows(0)("PAYER_AVANT_ENCODAGE") = 1 Then

                                                nombreDeNuiteAEncoder = Functions.nombreDeJourAInsererDansLEncodeur(DATE_ENTTRE, DATE_DE_TRAVAIL, CODE_RESERVATION)

                                                If nombreDeNuiteAEncoder = 0 Then
                                                    encoder = False
                                                End If

                                            End If

                                            If encoder Then
                                                showZenlockFormAsync()
                                            Else

                                                If GlobalVariable.actualLanguageValue = 0 Then
                                                    languageMessage = "Please pay atleast one night"
                                                    languageTitle = "Locks Management"
                                                ElseIf GlobalVariable.actualLanguageValue = 1 Then
                                                    languageMessage = "Bien vouloir effectuer un paiement d'au moins une nuitée"
                                                    languageTitle = "Gestion des serrures"
                                                End If

                                                MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Information)

                                            End If
                                            '----------------------------------------------------------------------------
                                            'showZenlockFormAsync()

                                        End If

                                    End If

                                End If

                                '------------------------------------------------------------------------------------------------------------------------------------------------

                                '---------------------------------------------ENVOI DES MESSAGES WHATSAPP------------------------------------------------------------------------

                                Dim RESA_TYPE As String = ""

                                If NUITEES = 0 Then

                                    If GlobalVariable.actualLanguageValue = 1 Then
                                        RESA_TYPE = "HEURE(S)"
                                    Else
                                        RESA_TYPE = "HOUR(S)"
                                    End If
                                    NUITEES = NOMBRE_HEURE
                                    MONTANT_ACCORDE = MONTANT_ACCORDE / NOMBRE_HEURE

                                Else

                                    If GlobalVariable.actualLanguageValue = 1 Then

                                        RESA_TYPE = "NUITEE(S)"
                                    Else

                                        RESA_TYPE = "NIGHT(S)"
                                    End If

                                End If

                                Dim NoReception = GlobalVariable.AgenceActuelle.Rows(0)("NUMERO_RECEPTION")
                                Dim NoTelChambre = GlobalVariable.AgenceActuelle.Rows(0)("NUMERO_RECEPTION_CHAMBRE")

                                Dim TOTAL_SEJOUR As Double = 0

                                If multiplier Then
                                    TOTAL_SEJOUR = MONTANT_ACCORDE * NUITEES
                                Else
                                    TOTAL_SEJOUR = MONTANT_ACCORDE
                                End If

                                If GlobalVariable.actualLanguageValue = 1 Then

                                    whatsAppMessage = "CHECKIN " & Chr(13) & " -/ PAR : " & GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR") & Chr(13) & " -/ A : " & Now().ToShortTimeString & Chr(13) & " -/ ARRIVEE : " & DATE_ENTTRE & " " & CDate(HEURE_ENTREE).ToShortTimeString & Chr(13) & " -/ DEPART : " & DATE_SORTIE & " " & CDate(HEURE_SORTIE).ToShortTimeString & Chr(13) & " -/ " & RESA_TYPE & " : " & NUITEES & Chr(13) & " -/ CLIENT : " & NOM_CLIENT & Chr(13) & "-/ TYPE DE CHAMBRE : " & TYPE_CHAMBRE & Chr(13) & " -/ CHAMBRE : " & CHAMBRE_ID & Chr(13) & " -/ MONTANT :  " & MONTANT_ACCORDE & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & " */ MONTANT TOTAL : " & Format(TOTAL_SEJOUR, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                                    _whatsAppMessage = Chr(13) & "Cher " & NOM_CLIENT & Chr(13) & Chr(13) & "C'est avec plaisir que nous vous souhaitons la bienvenue à " & GlobalVariable.AgenceActuelle.Rows(0)("NOM_AGENCE") & ", nous sommes ravis de vous accueillir parmi nous. " & Chr(13) & Chr(13) & " Pour toute demande, notre équipe est à votre écoute à la réception ou en composant le " & NoTelChambre & " sur le téléphone de votre chambre ou via notre portable au " & NoReception & "." & Chr(13) & Chr(13) & "Nous vous remercions d'avoir choisi " & GlobalVariable.AgenceActuelle.Rows(0)("NOM_AGENCE") & " pour votre séjour. " & Chr(13) & Chr(13) & " Cordialement"

                                Else
                                    whatsAppMessage = "CHECKIN " & Chr(13) & " -/ BY : " & GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR") & Chr(13) & " -/ AT : " & Now().ToShortTimeString & Chr(13) & " -/ ARRIVAL : " & DATE_ENTTRE & " " & CDate(HEURE_ENTREE).ToShortTimeString & Chr(13) & " -/ DEPARTURE : " & DATE_SORTIE & " " & CDate(HEURE_SORTIE).ToShortTimeString & Chr(13) & " -/ " & RESA_TYPE & " : " & NUITEES & Chr(13) & " -/ CLIENT : " & NOM_CLIENT & Chr(13) & "-/ ROOM TYPE : " & TYPE_CHAMBRE & Chr(13) & " -/ ROOM : " & CHAMBRE_ID & Chr(13) & " -/ AMOUNT :  " & MONTANT_ACCORDE & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & " */ TOTAL AMOUNT : " & Format(TOTAL_SEJOUR, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                                    _whatsAppMessage = Chr(13) & "Dear " & NOM_CLIENT & Chr(13) & Chr(13) & " We are delighted to welcome you to " & GlobalVariable.AgenceActuelle.Rows(0)("NOM_AGENCE") & ", for any query, please do not hesitate to contact our team at reception or by calling " & NoTelChambre & " on your room telephone or via our mobile on " & NoReception & "." & Chr(13) & Chr(13) & "  Thank you for choosing " & GlobalVariable.AgenceActuelle.Rows(0)("NOM_AGENCE") & " for your stay. " & Chr(13) & Chr(13) & "Kind regards"

                                End If

                                If GlobalVariable.AgenceActuelle.Rows(0)("MESSAGE_WHATSAPP") = 1 Then

                                    Dim mobile_number As String = listeOfTelephoneNumbers()

                                    args.action = 0
                                    args.whatsAppMessage = whatsAppMessage
                                    args.mobile_number = mobile_number

                                    backGroundWorkerToCall(args)

                                    'Functions.ultrMessageSimpleText(whatsAppMessage, mobile_number)

                                End If

                                '---------------------------------------------ENVOI DES MESSAGES WHATSAPP------------------------------------------------------------------------

                                GunaLabelNumReservation.Text = CODE_RESERVATION
                                'Desactivation du bouton de gestion des groupes
                                GunaCheckBoxReservationDeGroupe.Checked = False

                                'GESTION DES GRATUITEES
                                gestionDelaGratuiteeDeLaReservation()

                                'GESTION DES PRISES EN CHARGES DE LA RESERVATION
                                gestionDelaPriseEnChargeDeLaReservation()

                                'RSERVATION NORMALE

                                Dim TYPE_DEPOT_CAUTION As Integer = 0

                                If MONTANT_TOTAL_CAUTION > 0 Then
                                    TYPE_DEPOT_CAUTION = 0
                                    'cautionEnregistrement(CODE_RESERVATION, 0, GunaTextBoxMontantCaution.Text, TYPE)
                                    cautionEnregistrement(CODE_RESERVATION, 0, MONTANT_TOTAL_CAUTION, TYPE_DEPOT_CAUTION)
                                End If

                                If DEPOT_DE_GARANTIE > 0 Then
                                    TYPE_DEPOT_CAUTION = 1
                                    cautionEnregistrement(CODE_RESERVATION, 0, DEPOT_DE_GARANTIE, TYPE_DEPOT_CAUTION)
                                End If

                                'cautionEnregistrement(CODE_RESERVATION, 0, GunaTextBoxMontantCaution.Text)

                                'Clearing all the informations found in the the reseravtion field

                                'emtptyRegistrationFields()

                                'We set all the global variables used for update to their original values
                                Functions.EmtyGlobalVariablesContainingCodeToUpdate()
                                ReinitialisationDesDates()

                                'We prevent from choosing a room if a room type is not first choosen
                                'GunaTextBoxNumeroChambre.BaseColor = Color.Beige
                                GunaTextBoxNumeroChambre.Enabled = True

                                Functions.SiplifiedClearTextBox(Me)

                                'On masque les tarifs associés au client si existe 
                                GunaComboBoxCodeTarif.Visible = False
                                GunaLabelCodeTarif.Visible = False

                                'ReservationList()

                                'We update the buttons to display
                                reservationButtonToDisplay()

                                GunaComboBoxHeureArrivee.SelectedItem = "120000"
                                GunaComboBoxHeureDepart.SelectedItem = "120000"

                                GunaCheckBoxPetitDejeuenerInclus.Checked = False
                                GunaCheckBoxTaxeSejour.Checked = False
                                GunaTextBoxPetitDejeuner.Visible = False
                                GunaTextBoxPetitDejeunerRoutage.Visible = False

                                'Obtention des informations pour les statistiques
                                Dim stat As New statistiques()

                                stat.ObtenirDerniereStatistique()

                                Dim codeDelaDerniereStatistique As String = stat.ObtenirDerniereStatistique()

                                GlobalVariable.informationDesStatistiques = Functions.getElementByCode(codeDelaDerniereStatistique, "statistiques", "CODE_STATISTIQUE")

                                GunaTextBoxBC.Visible = False

                                GunaButtonCheckOut.Visible = False

                                GunaTextBoxNbreAdulte.Text = 0

                                If continuer Then
                                    VidageDesChampsPourNouvelleReservation()
                                End If

                                Dim WHATSAPP_OU_MAIL As Integer = 0
                                'WHATSAPP_OU_MAIL = 0 ' WHATSAPP
                                'WHATSAPP_OU_MAIL = 1 ' EMAIL


                                If sendMailChambre Then
                                    WHATSAPP_OU_MAIL = 1
                                    args.WHATSAPP_OU_EMAIL = 1
                                    If GlobalVariable.AgenceActuelle.Rows(0)("MESSAGE_WHATSAPP") = 1 Then
                                        args.action = 4

                                        backGroundWorkerToCall(args)

                                    End If

                                End If

                                If sendMailSalle Then
                                    WHATSAPP_OU_MAIL = 1
                                    args.WHATSAPP_OU_EMAIL = 1
                                    If GlobalVariable.AgenceActuelle.Rows(0)("MESSAGE_WHATSAPP") = 1 Then
                                        args.action = 5

                                        backGroundWorkerToCall(args)

                                    End If
                                End If

                                If sendWhatsAppChambre Then
                                    WHATSAPP_OU_MAIL = 0
                                    args.WHATSAPP_OU_EMAIL = 0
                                    If GlobalVariable.AgenceActuelle.Rows(0)("MESSAGE_WHATSAPP") = 1 Then

                                        args.action = 4
                                        backGroundWorkerToCall(args)

                                    End If
                                End If

                                If sendWhatsAppSalle Then

                                    If GlobalVariable.AgenceActuelle.Rows(0)("MESSAGE_WHATSAPP") = 1 Then
                                        WHATSAPP_OU_MAIL = 0
                                        args.WHATSAPP_OU_EMAIL = WHATSAPP_OU_MAIL
                                        args.action = 5

                                        backGroundWorkerToCall(args)

                                    End If
                                End If

                                If GlobalVariable.AgenceActuelle.Rows(0)("MESSAGE_WHATSAPP") = 1 Then

                                    args.action = 0
                                    args.whatsAppMessage = _whatsAppMessage
                                    args.mobile_number = TELEPHONE_CLIENT

                                    backGroundWorkerToCall(args)

                                End If

                                Me.Cursor = Cursors.Default

                            End If

                        End If

                    Else

                        GunaTextBoxNumeroChambre.Clear()

                        If Trim(CHAMBRE_ID).Equals("") Or Trim(CHAMBRE_ID).Equals("-") Then

                            Dim Message As String = ""

                            If GunaRadioButtonChambre.Checked Then

                                If GlobalVariable.actualLanguageValue = 1 Then
                                    Message = "Bien vouloir saisir un numéro de chambre valide!!"
                                Else
                                    Message = "Please type in a valide room number !!"
                                End If

                            ElseIf GunaRadioButtonSalleFete.Checked Then

                                If GlobalVariable.actualLanguageValue = 1 Then
                                    Message = "Bien vouloir saisir un numéro de salle valide xx!!"
                                Else
                                    Message = "Please type in a valide hole !!"

                                End If
                            End If


                            MessageBox.Show(Message, "Check In Impossible", MessageBoxButtons.OK, MessageBoxIcon.Information)

                        Else

                            If GunaRadioButtonChambre.Checked Then

                                If GlobalVariable.actualLanguageValue = 1 Then
                                    MessageBox.Show("Ce numéro de chambre est déjà occupé et ne figure pas parmis les propositions", "Check In Impossible", MessageBoxButtons.OK, MessageBoxIcon.Information)
                                Else
                                    MessageBox.Show("This room number is already occupied, select from the list of proposals", "Check In Impossible", MessageBoxButtons.OK, MessageBoxIcon.Information)
                                End If

                            ElseIf GunaRadioButtonSalleFete.Checked Then

                                If GlobalVariable.actualLanguageValue = 1 Then
                                    MessageBox.Show("Ce numéro de salle est déjà occupé et ne figure pas parmis les propositions", "Check In Impossible", MessageBoxButtons.OK, MessageBoxIcon.Information)
                                Else
                                    MessageBox.Show("This hall is already occupied, select from the list of proposals", "Check In Impossible", MessageBoxButtons.OK, MessageBoxIcon.Information)
                                End If

                            End If

                        End If

                    End If


                Else

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Bien vouloir indiquer le nombre de personne", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Else
                        MessageBox.Show("Please Indicate the Number of Pax", "Reservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    End If

                End If

            End If
        End If



    End Sub

    Dim whatsAppMessage As String = ""
    Dim _whatsAppMessage As String = ""

    Public Sub checkoutEncodeur()

        Dim lStatus As Integer
        Dim CardNo As Integer
        Dim RoomNo As String

        If IsNumeric(TB_CardNo.Text) Then
            CardNo = Val(TB_CardNo.Text)
        Else
            CardNo = 0
        End If

        RoomNo = TB_RoomNo.Text

        TB_Result.Text = "Executing..."
        TB_Result.Refresh()

        lStatus = CheckOut(RoomNo, CardNo)

        TB_Result.Text = lStatus.ToString("X")

    End Sub

    Public Sub demarrageDeSessionEncodeur()

        Dim cheminLockSystem = GlobalVariable.AgenceActuelle.Rows(0)("CHEMIN_HOTEL_LOCK_SYSTEM")

        Dim server As String
        Dim user As String
        Dim LockSoftware As Integer
        Dim lStatus As Integer
        Dim db_flag As Long

        server = tb_server.Text
        user = "DllUser"
        LockSoftware = CB_Software.SelectedIndex + 1

        TB_Result.Text = "Executing..."
        db_flag = CB_DB.SelectedIndex
        TB_Result.Refresh()

        lStatus = StartSession(LockSoftware, server, user, CB_DB.SelectedIndex)
        'lStatus = StartSession(LockSoftware, server, user, db_flag)

        TB_Result.Text = lStatus.ToString("X")

    End Sub

    Public Sub supressionCarteEncodeur()

        Dim lStatus As Integer
        Dim Port As Integer
        Dim CardNo As Integer

        Port = CB_Port.SelectedIndex

        If IsNumeric(TB_CardNo.Text) Then
            CardNo = Val(TB_CardNo.Text)
        Else
            CardNo = 0
        End If

        TB_Result.Text = "Executing..."
        TB_Result.Refresh()

        lStatus = EraseKeyCard(Port, CardNo)

        TB_Result.Text = lStatus.ToString("X")

    End Sub
    '--------------------------------------- CHECKOUT MANAGEMENT ----------------------------------------
    Private Sub GunaButtonCheckOut_Click(sender As Object, e As EventArgs) Handles GunaButtonCheckOut.Click

        'ON DOIT DETERMINER SI POUR LES CLIENTS A SEJOUR NORMAL ON DOIT PERMETTRE LE CHECK-OUT APRES CLOTURE DE FACTURE

        'On doit vérifier que la date de sortie n'est jamais inférieure a la date de travail
        Dim dayDiff = CType((GlobalVariable.DateDeTravail - GunaDateTimePickerDepart.Value).TotalHours, Int32)

        Dim multiplier As Boolean = True
        Dim montant_total As Double = 0

        If GunaCheckBoxMensuel.Checked Then
            multiplier = False
        End If

        If dayDiff > 0 Then

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Bien vouloir vérifier la da de départ", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
            Else
                MessageBox.Show("Please check the departure date", "Reservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If

        Else

            Dim dt As DataTable

            Dim messageDeConfirmation As String = ""
            GlobalVariable.duplicationDeReservation = False

            Dim imposerCloture As Boolean = False

            'ON VERIFIE QUE L'OPTION DE CLOTURE DE FACTURE EST ACTIVE
            If GlobalVariable.AgenceActuelle.Rows(0)("CLOTURE_FACTURE") = 1 Then
                imposerCloture = True
            End If

            Dim factureCloturee As Boolean = True

            If imposerCloture Then
                'ON NE DOIT GERER QUE LES SEJOURS NORMAUX
                If Not GunaCheckBoxDayUse.Checked Then

                    'ON NE PEUT PORDUIRE UNE FACTURE SI IL Y'A PAS DE CHARGES

                    Dim infoSupLigneFactureDeResa As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "ligne_facture", "CODE_RESERVATION")

                    If infoSupLigneFactureDeResa.Rows.Count > 0 Then

                        Dim infoSupFactureDeResa As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

                        If Not infoSupFactureDeResa.Rows.Count > 0 Then


                            If GlobalVariable.actualLanguageValue = 1 Then
                                messageDeConfirmation = "Bien vouloir produire la facture de " & GunaTextBoxNomPrenom.Text
                            Else
                                messageDeConfirmation = "Please produce de bill of " & GunaTextBoxNomPrenom.Text
                            End If

                            Dim dialog As DialogResult = MessageBox.Show(messageDeConfirmation, "Check Out", MessageBoxButtons.OK, MessageBoxIcon.Information)

                            If dialog = DialogResult.OK Then
                                FolioForm.Close()
                                FolioForm.Show()
                                FolioForm.TopMost = True
                            End If

                            factureCloturee = False

                        End If

                    End If

                End If

            End If

            'LA FACTURE DU CLIENT A ETE PRODUITE OU ALORS IN NE POSSEDE PAS DE CHARGE

            If multiplier Then
                montant_total = Double.Parse(GunaTextBoxMontantAccorde.Text) * Integer.Parse(GunaTextBoxTempsAFaire.Text)
            Else
                montant_total = Double.Parse(GunaTextBoxMontantAccorde.Text)
            End If


            If factureCloturee Then

                'DAY USE ou SEJOURS
                If GunaCheckBoxDayUse.Checked Then

                    If GlobalVariable.actualLanguageValue = 1 Then
                        messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Type de Chambre : " & GunaTextBoxLibelleTYpe.Text & "; N° Chambre: " & GunaTextBoxNumeroChambre.Text & Chr(13) & " Durée : " & GunaComboBoxHeureArrivee.SelectedItem.ToString & " - " & GunaComboBoxHeureDepart.SelectedItem.ToString & " soit (" & GunaTextBoxTempsAFaire.Text & ") Heure(s)" & Chr(13) & "Tarif réel : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")

                    Else
                        messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Room Type : " & GunaTextBoxLibelleTYpe.Text & "; Room N° : " & GunaTextBoxNumeroChambre.Text & Chr(13) & " Period : " & GunaComboBoxHeureArrivee.SelectedItem.ToString & " - " & GunaComboBoxHeureDepart.SelectedItem.ToString & " i.e (" & GunaTextBoxTempsAFaire.Text & ") Hour(s)" & Chr(13) & "Real Price : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")

                    End If

                Else

                    If GunaRadioButtonChambre.Checked Then
                        'GESTION DES CHAMBRES

                        If GlobalVariable.actualLanguageValue = 1 Then
                            messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Type de Chambre : " & GunaTextBoxLibelleTYpe.Text & "; N° Chambre : " & GunaTextBoxNumeroChambre.Text & Chr(13) & "Période : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " soit (" & GunaTextBoxTempsAFaire.Text & ") Jour(s)" & Chr(13) & "Tarif réel: " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")

                        Else
                            messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Room Type : " & GunaTextBoxLibelleTYpe.Text & "; Room N° : " & GunaTextBoxNumeroChambre.Text & Chr(13) & "Period : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " that is (" & GunaTextBoxTempsAFaire.Text & ") Days(s)" & Chr(13) & "Real Price : " & GunaTextBoxMontantAccorde.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & "Total : " & Format(montant_total, "###,0") & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")

                        End If
                    Else

                        'GESTION DES SALLES
                        Dim nomEvent As String = ""

                        Dim infoSupEvent As DataTable = Functions.getElementByCode(GunaComboBoxEvenement.SelectedValue.ToString, "evenement", "CODE_EVENEMENT")

                        If infoSupEvent.Rows.Count > 0 Then
                            nomEvent = infoSupEvent.Rows(0)("LIBELLE")
                        End If


                        If GlobalVariable.actualLanguageValue = 1 Then
                            messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Type de Salle : " & GunaTextBoxLibelleTYpe.Text & "; Salle: " & GunaTextBoxNumeroChambre.Text & Chr(13) & "Pour: " & nomEvent & Chr(13) & "Période: " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " soit (" & GunaTextBoxTempsAFaire.Text & ") Jour(s)" & Chr(13) & "Tarif réel : " & GunaTextBoxMontantReelSalle.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                        Else
                            messageDeConfirmation = "Client : " & GunaTextBoxNomPrenom.Text & Chr(13) & "Hall Type : " & GunaTextBoxLibelleTYpe.Text & "; Hall : " & GunaTextBoxNumeroChambre.Text & Chr(13) & "For : " & nomEvent & Chr(13) & "Period : " & GunaDateTimePickerArrivee.Value.ToShortDateString & " - " & GunaDateTimePickerDepart.Value.ToShortDateString & " that is (" & GunaTextBoxTempsAFaire.Text & ") Days(s)" & Chr(13) & "Real Price : " & GunaTextBoxMontantReelSalle.Text & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
                        End If

                    End If

                End If

                Dim messageTitle As String = ""

                If GlobalVariable.actualLanguageValue = 1 Then
                    messageTitle = "Confirmation de CheckOut"
                Else
                    messageTitle = "CheckOut Confirmation"
                End If

                Dim dialogCheckOutConfirm As DialogResult = MessageBox.Show(messageDeConfirmation, messageTitle, MessageBoxButtons.OKCancel, MessageBoxIcon.Information)

                If dialogCheckOutConfirm = DialogResult.OK Then

                    Me.Cursor = Cursors.WaitCursor

                    Dim TELEPHONE_CLIENT As String = Trim(GunaTextBoxTelClient.Text)
                    Dim EMAIL As String = Trim(GunaTextBoxClientEmail.Text)

                    Dim ETAT_NOTE_RESERVATION As String = "CHECKOUT"

                    Dim BC_ENTREPRISE As String = GunaTextBoxBC.Text

                    Dim DAY_USE As Integer = 0

                    If GunaCheckBoxDayUse.Checked Then
                        DAY_USE = 1
                    End If

                    Dim MENSUEL As Integer = 0

                    If GunaCheckBoxMensuel.Checked Then
                        MENSUEL = 1
                    End If

                    If Trim(GunaTextBoxMontantCaution.Text) = "" Then
                        GunaTextBoxMontantCaution.Text = 0
                    End If

                    'demarrageDeSessionEncodeur()

                    '---------------SUPPRESSION DU CONTENU DE LA CARTE -------------------

                    'supressionCarteEncodeur()

                    '---------------------------------------------------------------------

                    LabelNatureReservation.Visible = False

                    'We change the color of the label depending on if the label the value is negatif or positif

                    'On masque les tarifs associés au client si existe 
                    GunaComboBoxCodeTarif.Visible = False
                    GunaLabelCodeTarif.Visible = False

                    'GunaLabelNumReservation.Visible = False 'We hide reservation code

                    '------------------------------------------ VARIEBLES------------------------------------------------
                    Dim TYPE_CHAMBRE_OU_SALLE As String = ""

                    If GunaRadioButtonChambre.Checked Then

                        TYPE_CHAMBRE_OU_SALLE = "chambre"

                    ElseIf GunaRadioButtonSalleFete.Checked Then

                        TYPE_CHAMBRE_OU_SALLE = "salle"

                    End If

                    'Dim ETAT_NOTE_RESERVATION As String = ""

                    'ETAT_NOTE_RESERVATION = "CHECK OUT"

                    If Trim(GunaTextBoxNbreAdulte.Text).Equals("") Then

                        If GlobalVariable.typeChambreOuSalle = "salle" Then
                            GunaTextBoxNbreAdulte.Text = 0
                        ElseIf GlobalVariable.typeChambreOuSalle = "chambre" Then
                            GunaTextBoxNbreAdulte.Text = 0
                        End If

                    End If

                    If Trim(GunaTextBoxNbreEnfant.Text).Equals("") Then
                        GunaTextBoxNbreEnfant.Text = 0
                    End If

                    If GunaRadioButtonMailOui.Checked Then
                        GlobalVariable.RECEVOIR_EMAIL = 1
                    End If

                    If GunaRadioButtonWhatsAppOui.Checked Then
                        GlobalVariable.RECEVOIR_SMS = 1
                    End If

                    Dim CODE_ENTREPRISE As String = Trim(GunaTextBoxCodeEntrepriseDuClient.Text)
                    Dim NOM_ENTREPRISE As String = Trim(GunaTextBoxEntrepriseDuclient.Text)

                    'Dim CLIENT_ID As String = GlobalVariable.codeClient
                    Dim CLIENT_ID As String = Trim(GunaTextBoxRefClient.Text)

                    Dim UTILISATEUR_ID As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
                    'Dim CHAMBRE_ID As String = GlobalVariable.codeChambre
                    Dim CHAMBRE_ID As String = Trim(GunaTextBoxNumeroChambre.Text)

                    Dim AGENCE_ID As String = GlobalVariable.codeAgence

                    Dim NOM_CLIENT As String = Trim(GunaTextBoxNomPrenom.Text)

                    If Trim(GunaTextBoxPetitDejeuner.Text) = "" Then
                        GunaTextBoxPetitDejeuner.Text = 0
                    End If

                    Dim PETIT_DEJEUNER As Double = GunaTextBoxPetitDejeuner.Text

                    Dim AFFICHER_PRIX As Integer = 1

                    If Not GunaCheckBoxAfficherPrix.Checked Then
                        AFFICHER_PRIX = 0
                    End If

                    Dim BFK_COST As Double = 0
                    If Not Trim(GunaTextBoxBreakFastCost.Text).Equals("") Then
                        BFK_COST = GunaTextBoxBreakFastCost.Text
                    End If
                    ' ----------------------------- GESTION DU DAY USE ----------------------------------------------------------------------------------------
                    Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

                    Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

                    Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
                    Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

                    'Dim DATE_ENTTRE As Date = GlobalVariable.DATE_ENTTRE
                    Dim DATE_ENTTRE As Date = GunaDateTimePickerArrivee.Value.ToShortDateString
                    Dim HEURE_ENTREE As String = DateTimeArrivee
                    'Dim DATE_SORTIE As Date = GlobalVariable.DATE_SORTIE
                    Dim DATE_SORTIE As Date = GunaDateTimePickerDepart.Value.ToShortDateString
                    Dim HEURE_SORTIE As String = DateTimeDepart

                    'Dim ADULTES As Integer = GlobalVariable.ADULTES
                    Dim ADULTES As Integer = Integer.Parse(GunaTextBoxNbreAdulte.Text)
                    Dim ENFANTS As Integer = Integer.Parse(GunaTextBoxNbreEnfant.Text)
                    ' Dim NB_PERSONNES As Integer = ENFANTS + ADULTES

                    If Trim(GunaTextBoxNbrePersonne.Text) = "" Then
                        GunaTextBoxNbrePersonne.Text = 0
                    End If

                    Dim NB_PERSONNES As Integer = GunaTextBoxNbrePersonne.Text
                    Dim RECEVOIR_EMAIL As Integer = GlobalVariable.RECEVOIR_EMAIL
                    Dim RECEVOIR_SMS As Integer = GlobalVariable.RECEVOIR_SMS
                    Dim ETAT_RESERVATION As Integer = 0
                    Dim DATE_CREATION As Date = GlobalVariable.DateDeTravail
                    Dim HEURE_CREATION As DateTime = DateTime.Now().ToString("hh:mm:ss")
                    Dim MONTANT_TOTAL_CAUTION As Double = GunaTextBoxMontantCaution.Text
                    Dim MOTIF_ETAT As String = ""
                    Dim DATE_ETAT As Date = GlobalVariable.DateDeTravail
                    Dim MONTANT_ACCORDE As Double = 0

                    If GlobalVariable.typeChambreOuSalle = "salle" Then
                        If Not Trim(GunaTextBoxMontantReelSalle.Text) = "" Then
                            MONTANT_ACCORDE = Double.Parse(GunaTextBoxMontantReelSalle.Text)
                        End If
                    ElseIf GlobalVariable.typeChambreOuSalle = "chambre" Then
                        If Not Trim(GunaTextBoxMontantAccorde.Text) = "" Then
                            MONTANT_ACCORDE = Double.Parse(GunaTextBoxMontantAccorde.Text)
                        End If
                    End If

                    Dim GROUPE As String = GunaTextBoxCodeDeGroupe.Text
                    'Dim CODE_RESERVATION = Functions.GeneratingRandomCode("reservation", "REA")
                    Dim CODE_RESERVATION As String = Trim(GunaLabelNumReservation.Text)

                    Dim reservation As New Reservation()
                    Dim mainCourante As New MainCourantes()
                    Dim reglement As New Reglement()
                    Dim occupationChambre As New OccupationChambre()
                    Dim facture As New Facture()
                    Dim ligneFacture As New LigneFacture()
                    Dim compte As New Compte()

                    'Inserting a new reservation after checking that the reservation does not already exist

                    ' variables declarations 

                    '-------------------------------- OCCUPATION CHAMBRE ------------------------------

                    Dim CODE_OCCUPATION_CHAMBRE = Functions.GeneratingRandomCodeWithSpecifications("occupation_chambre", "OC")
                    Dim MONTANT_HT As Double = 0
                    Dim TAXE As Double = 0
                    Dim MONTANT_TTC As Double = 0
                    Dim DATE_OCCUPATION As Date = GlobalVariable.DateDeTravail
                    'Dim OBSERVATIONS As String =""
                    Dim COMMENTAIRE1 As String = ""
                    Dim COMMENTAIRE2 As String = ""
                    Dim COMMENTAIRE3 As String = ""
                    Dim COMMENTAIRE4 As String = ""
                    Dim DATE_LIBERATION As Date = GlobalVariable.DateDeTravail
                    Dim CODE_UTILISATEUR_CREA As String = ""
                    Dim DATE_PREMIERE_ARRIVEE As Date = GlobalVariable.DateDeTravail
                    Dim TYPE_RESERVATION As String = ""
                    Dim PDJ_INCLUS As String = ""
                    Dim TAXE_SEJOURS_INCLUS As String = ""
                    Dim TVA_INCLUS As String = ""
                    Dim CODE_CLIENT_REEL As String = ""

                    '------------------------------- REGLEMENT ----------------------------------------------

                    If GunaTextBoxDepotDeGarantie.Text = "" Then
                        GunaTextBoxDepotDeGarantie.Text = 0
                    End If

                    Dim DEPOT_DE_GARANTIE As Double = Double.Parse(GunaTextBoxDepotDeGarantie.Text)

                    Dim NUM_REGLEMENT As String = Functions.GeneratingRandomCodeWithSpecifications("reglement", "RGL")
                    Dim NUM_FACTURE As String = ""
                    Dim CODE_CAISSIER As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
                    Dim MONTANT_VERSE As Double = 0
                    Dim DATE_REGLEMENT As Date = GlobalVariable.DateDeTravail
                    Dim MODE_REGLEMENT As String = ""
                    Dim REF_REGLEMENT As String = ""
                    Dim CODE_MODE As String = ""
                    Dim IMPRIMER As Double = 0

                    '----------- MAIN COURANTES ------------------------------
                    Dim CODE_MAIN_COURANTE As String = Functions.GeneratingRandomCodeWithSpecifications("main_courante", "MC")
                    Dim CODE_CLIENT As String = GlobalVariable.codeClient
                    Dim CODE_CHAMBRE As String = GlobalVariable.codeChambre
                    Dim ETAT_CHAMBRE As String = 0
                    Dim CODE_AGENCE As String = AGENCE_ID

                    '----------- MAIN COURANTE GENERALE ------------------------------

                    Dim TAUX_OCCUPATION_PCT As Double = 0 'TAUX_OCCUPATION_PCT USED AS TAXE DE SEJOUR
                    Dim POSTER_TAX As Double = 0 'TAUX_OCCUPATION_PCT USED AS TAXE DE SEJOUR

                    If GunaCheckBoxTaxeSejour.Checked Then
                        If Not Trim(GunaTextBoxTaxeSejour.Text).Equals("") Then
                            TAUX_OCCUPATION_PCT = GunaTextBoxTaxeSejour.Text
                            POSTER_TAX = GunaTextBoxTaxeSejour.Text
                        End If
                    Else
                        Functions.DeleteElementByCode(CODE_RESERVATION, "taxe_sejour_collectee", "NUM_RESERVATION")
                    End If

                    Dim CODE_MAIN_COURANTE_GENERALE As String = Functions.GeneratingRandomCodeWithSpecifications("main_courante_generale", "MCG")
                    Dim DATE_MAIN_COURANTE As Date = GlobalVariable.DateDeTravail
                    Dim PDJ_FOOD As Double = 0
                    Dim PDJ_BOISSON As Double = 0
                    Dim DEJEUNER_FOOD As Double = 0
                    Dim DEJEUNER_BOISSON As Double = 0
                    Dim DINER_FOOD As Double = 0
                    Dim DINER_BOISSON As Double = 0
                    Dim BANQUET_FOOD As Double = 0
                    Dim BANQUET_BOISSON As Double = 0
                    Dim BAR_MATIN As Double = 0
                    Dim BAR_SOIR As Double = 0
                    Dim DIVERS As Double = 0
                    Dim TOTAL_JOUR As Double = MONTANT_ACCORDE + TAUX_OCCUPATION_PCT
                    Dim REPORT_VEILLE As Double = 0
                    Dim TOTAL_GENERAL As Double = MONTANT_ACCORDE + TAUX_OCCUPATION_PCT
                    Dim NUM_RESERVATION = CODE_RESERVATION
                    Dim DEDUCTION As Double = 0
                    Dim ENCAISSEMENT_ESPECE As Double = 0
                    Dim ENCAISSEMENT_CHEQUE As Double = 0
                    Dim ENCAISSEMENT_CARTE_CREDIT As Double = 0
                    'Dim A_REPORTER As Double = MONTANT_ACCORDE + TAUX_OCCUPATION_PCT
                    Dim A_REPORTER As Double = Functions.SituationDeReservation(CODE_RESERVATION)
                    Dim OBSERVATIONS As String = ""
                    Dim TYPE_CHAMBRE As String = GunaTextBoxCodeTypeDeChambre.Text
                    Dim INDICE_FREQUENTATION As Double = 0
                    Dim INDICE_FREQUENTATION_PCT As Double = 0
                    Dim TAUX_OCCUPATION As Double = 0

                    Dim CLIENTS_ATTENDUS As Integer = 0
                    Dim CLIENTS_EN_CHAMBRE As Integer = GunaTextBoxNbrePersonne.Text
                    Dim CHAMBRES_DISPONIBLES As Integer = 0
                    Dim TOTAL_HORS_SERVICE As Integer = 0
                    Dim CHAMBRES_HORS_SERVICE As Integer = 0
                    Dim TOTAL_FICTIVES As Integer = 0
                    Dim CHAMBRES_FICTIVES As Integer = 0
                    Dim NOMBRE_MESSAGES As Integer = 0
                    Dim TOTAL_GRATUITES As Double = 0
                    Dim CHAMBRES_GRATUITES As Integer = 0
                    Dim TOTAL_NON_FACTUREES As Double = 0
                    Dim CHAMBRES_NON_FACTUREES As Integer = 0

                    '--------------------------- FORFAIT SALLE
                    Dim nbreCafe As Integer = 0
                    Dim cafePu As Double = 0
                    Dim dejeunerNbre As Integer = 0
                    Dim dejeunerPu As Double = 0
                    Dim dinerNbre As Integer = 0
                    Dim dinerPu As Double = 0
                    Dim traiteurNbre As Integer = 0
                    Dim traiteurPu As Double = 0

                    Double.TryParse(GunaTextBox35.Text, nbreCafe)
                    Double.TryParse(GunaTextBoxForfaitCafe.Text, cafePu)
                    Double.TryParse(GunaTextBox30.Text, dejeunerNbre)
                    Double.TryParse(GunaTextBoxForfatiDejeuner.Text, dejeunerPu)
                    Double.TryParse(GunaTextBox25.Text, dinerNbre)
                    Double.TryParse(GunaTextBoxForfaitDiner.Text, dinerPu)
                    Double.TryParse(GunaTextBox13.Text, traiteurNbre)
                    Double.TryParse(GunaTextBoxForfaitTraiteur.Text, traiteurPu)

                    Dim NBRE__CAFE = nbreCafe
                    Dim PU_CAFE = cafePu
                    Dim NBRE_DEJEUNER = dejeunerNbre
                    Dim PU_DEJEUNER = dejeunerPu
                    Dim NBRE_DINER = dinerNbre
                    Dim PU_DINER = dinerPu
                    Dim NBRE_TRAITEUR = traiteurNbre
                    Dim PU_TRAITEUR = traiteurPu
                    Dim decorationCast As Double = 0
                    Double.TryParse(GunaTextBoxDecoration.Text, decorationCast)
                    Dim DECORATION = decorationCast

                    Dim LOCATION_MATERIEL As Double = 0
                    Dim AUTRES As Double = 0

                    If Not Trim(GunaTextBoxMateriel.Text) = "" Then
                        LOCATION_MATERIEL = GunaTextBoxMateriel.Text
                    End If

                    If Not Trim(GunaTextBoxAutres.Text) = "" Then
                        AUTRES = GunaTextBoxAutres.Text
                    End If

                    Dim CODE_EVENEMENT = ""
                    Dim LIBELLE_EVENEMENT = ""

                    If GunaComboBoxEvenement.SelectedIndex >= 0 Then

                        CODE_EVENEMENT = GunaComboBoxEvenement.SelectedValue

                        Dim evenement As DataTable = Functions.getElementByCode("CODE_EVENEMENT", "evenement", "CODE_EVENEMENT")

                        If evenement.Rows.Count > 0 Then
                            LIBELLE_EVENEMENT = evenement.Rows(0)("evenement")
                        End If

                    End If

                    Dim NBRE_GOUTER As Integer = 0
                    Dim PU_GOUTER As Double = 0
                    Dim NBRE_COCKTAIL As Integer = 0
                    Dim PU_COCKTAIL As Double = 0

                    If Not Trim(GunaTextBoxQteGouter.Text) = "" Then
                        NBRE_GOUTER = GunaTextBoxQteGouter.Text
                    End If

                    If Not Trim(GunaTextBoxPrixGouter.Text) = "" Then
                        PU_GOUTER = GunaTextBoxPrixGouter.Text
                    End If

                    If Not Trim(GunaTextBoxCocktail.Text) = "" Then
                        NBRE_COCKTAIL = GunaTextBoxCocktail.Text
                    End If

                    If Not Trim(GunaTextBoxPUCocktail.Text) = "" Then
                        PU_COCKTAIL = GunaTextBoxPUCocktail.Text
                    End If

                    '----------------------------------- addition --------------------------------------------------------

                    Dim HEURE_PAUSE_CAFE As String = ""
                    If GunaComboBoxHeureCafe.SelectedIndex >= 0 Then
                        HEURE_PAUSE_CAFE = GunaComboBoxHeureCafe.SelectedItem
                    End If

                    Dim HEURE_PAUSE_DEJEUNER As String = ""
                    If GunaComboBoxHeureDej.SelectedIndex >= 0 Then
                        HEURE_PAUSE_DEJEUNER = GunaComboBoxHeureDej.SelectedItem
                    End If

                    Dim HEURE_DINER As String = ""
                    If GunaComboBoxHeureDiner.SelectedIndex >= 0 Then
                        HEURE_DINER = GunaComboBoxHeureDiner.SelectedItem
                    End If

                    Dim HEURE_GOUTER As String = ""
                    If GunaComboBoxHeureGouter.SelectedIndex >= 0 Then
                        HEURE_GOUTER = GunaComboBoxHeureGouter.SelectedItem
                    End If

                    Dim HEURE_COCKTAIL As String = ""
                    If GunaComboBoxHeureCocktail.SelectedIndex >= 0 Then
                        HEURE_COCKTAIL = GunaComboBoxHeureCocktail.SelectedItem
                    End If

                    Dim VIDEO_PROJ As Integer = 0
                    If GunaCheckBoxVidOui.Checked Then
                        VIDEO_PROJ = 1
                    ElseIf GunaCheckBoxVidNon.Checked Then
                        VIDEO_PROJ = 0
                    Else
                        VIDEO_PROJ = 0
                    End If

                    Dim SONO As Integer = 0
                    If GunaCheckBoxSonoOui.Checked Then
                        SONO = 1
                    ElseIf GunaCheckBoxSonoNon.Checked Then
                        SONO = 0
                    Else
                        SONO = 0
                    End If

                    Dim COUVERTS As Integer = 0
                    If GunaCheckBoxCouvOui.Checked Then
                        COUVERTS = 1
                    ElseIf GunaCheckBoxCouvNon.Checked Then
                        COUVERTS = 0
                    Else
                        COUVERTS = 0
                    End If

                    Dim TABLE_CHAISE As Integer = 0
                    If GunaCheckBoxTableOui.Checked Then
                        TABLE_CHAISE = 1
                    ElseIf GunaCheckBoxTableNon.Checked Then
                        TABLE_CHAISE = 0
                    Else
                        TABLE_CHAISE = 0
                    End If

                    Dim EAU_PTE_QTE As Integer = 0
                    If Not Trim(GunaTextBox47.Text) = "" Then
                        EAU_PTE_QTE = GunaTextBox47.Text
                    End If

                    Dim EAU_PTE_MONTANT As Double = 0
                    If Not Trim(GunaTextBoxMontantEauPetiteBouteille.Text) = "" Then
                        EAU_PTE_MONTANT = GunaTextBoxMontantEauPetiteBouteille.Text
                    End If

                    Dim EAU_GRDE_QTE As Integer = 0
                    If Not Trim(GunaTextBox10.Text) = "" Then
                        EAU_GRDE_QTE = GunaTextBox10.Text
                    End If

                    Dim EAU_GRDE_MONTANT As Double = 0
                    If Not Trim(GunaTextBox68.Text) = "" Then
                        EAU_GRDE_MONTANT = GunaTextBox68.Text
                    End If

                    Dim BOISSONS_GAZEUSES_QTE As Integer = 0
                    If Not Trim(GunaTextBox48.Text) = "" Then
                        BOISSONS_GAZEUSES_QTE = GunaTextBox48.Text
                    End If

                    Dim BOISSONS_GAZEUSES_MONTANT As Double = 0
                    If Not Trim(GunaTextBox62.Text) = "" Then
                        BOISSONS_GAZEUSES_MONTANT = GunaTextBox62.Text
                    End If

                    Dim BIERES_QTE As Integer = 0
                    If Not Trim(GunaTextBox50.Text) = "" Then
                        BIERES_QTE = GunaTextBox50.Text
                    End If

                    Dim BIERES_MONTANT As Double = 0
                    If Not Trim(GunaTextBox61.Text) = "" Then
                        BIERES_MONTANT = GunaTextBox61.Text
                    End If

                    Dim VIN_ROUGE_QTE As Integer = 0
                    If Not Trim(GunaTextBox54.Text) = "" Then
                        VIN_ROUGE_QTE = GunaTextBox54.Text
                    End If

                    Dim VIN_ROUGE_MONTANT As Double = 0
                    If Not Trim(GunaTextBox59.Text) = "" Then
                        VIN_ROUGE_MONTANT = GunaTextBox59.Text
                    End If

                    Dim VIN_ROSE_QTE As Integer = 0
                    If Not Trim(GunaTextBox63.Text) = "" Then
                        VIN_ROSE_QTE = GunaTextBox63.Text
                    End If

                    Dim VIN_ROSE_MONTANT As Double = 0
                    If Not Trim(GunaTextBox64.Text) = "" Then
                        VIN_ROSE_MONTANT = GunaTextBox64.Text
                    End If

                    Dim BOISSONS_EXT_QTE As Integer = 0
                    If Not Trim(GunaTextBox36.Text) = "" Then
                        BOISSONS_EXT_QTE = GunaTextBox36.Text
                    End If

                    Dim BOISSONS_EXT_MONTANT As Double = 0
                    If Not Trim(GunaTextBox57.Text) = "" Then
                        BOISSONS_EXT_MONTANT = GunaTextBox57.Text
                    End If

                    Dim DROIT_DE_BOUCHON As Double = 0
                    If Not Trim(GunaTextBoxDroitDeBouchon.Text) = "" Then
                        DROIT_DE_BOUCHON = GunaTextBoxDroitDeBouchon.Text
                    End If

                    Dim MISE_EN_PLACE As Integer = 0 ' U

                    If GunaCheckBoxU.Checked Then
                        MISE_EN_PLACE = 1
                    ElseIf GunaCheckBoxEcole.Checked Then
                        MISE_EN_PLACE = 2 ' Ecole
                    ElseIf GunaCheckBoxTheatre.Checked Then
                        MISE_EN_PLACE = 3 ' Theatre
                    ElseIf GunaCheckBoxRectangle.Checked Then
                        MISE_EN_PLACE = 4 ' Rectangle
                    ElseIf GunaCheckBoxCocktail.Checked Then
                        MISE_EN_PLACE = 5 'Cocktail
                    ElseIf GunaCheckBoxBanquet.Checked Then
                        MISE_EN_PLACE = 6 'Banquet
                    End If

                    Dim CLOISONNEMENT As Integer = 0
                    If GunaCheckBox2.Checked Then
                        CLOISONNEMENT = 2
                    ElseIf GunaCheckBox9.Checked Then
                        CLOISONNEMENT = 3 ' Ecole
                    Else
                        CLOISONNEMENT = 0
                    End If
                    '-----------------------------------------------------------------------------------------------------
                    '----------- MAIN COURANTE JOURNALIERE ------------------------------

                    Dim CODE_MAIN_COURANTE_JOURNALIERE As String = Functions.GeneratingRandomCodeWithSpecifications("main_courante_journaliere", "MCJ")
                    Dim PDJ As Double = 0
                    Dim DEJEUNER As Double = 0
                    Dim DINER As Double = 0
                    Dim CAFE As Double = 0
                    Dim BAR As Double = 0
                    Dim CAVE As Double = 0
                    Dim AUTRE As Double = 0
                    Dim SOUS_TOTAL1 As Double = 0
                    Dim Location As Double = 0
                    Dim TELE As Double = 0
                    Dim FAX As Double = 0
                    Dim LINGE As Double = 0
                    Dim SOUS_TOTAL2 As Double = 0
                    Dim DEBITEUR As Double = 0
                    Dim ARRHES As Double = 0

                    If GunaCheckBoxPetitDejeuenerInclus.Checked Then

                        Dim petitDejeuner As Double = 0
                        Double.TryParse(GunaTextBoxPetitDejeuner.Text, petitDejeuner)
                        SOUS_TOTAL1 = petitDejeuner 'On gère les petit dejeuener inclus par apport a la valeur SOUS_TOTAL1 de la main courante journaliere

                    End If

                    '------------------------------- compte -----------------------------

                    Dim INTITULE As String = ""
                    Dim NUMERO_COMPTE As String = ""
                    Dim TOTAL_DEBIT As Double = GlobalVariable.MONTANT_TOTAL
                    Dim TOTAL_CREDIT As Double = GlobalVariable.avance
                    Dim SOLDE_COMPTE As Double = TOTAL_CREDIT - TOTAL_DEBIT

                    Dim SENS_DU_SOLDE As String = ""

                    If (TOTAL_DEBIT < TOTAL_CREDIT) Then
                        SENS_DU_SOLDE = "crediteur------------------------------------"
                    ElseIf (TOTAL_CREDIT < TOTAL_DEBIT) Then
                        SENS_DU_SOLDE = "debiteur-------------------------------------"
                    End If

                    Dim TYPE_DE_COMPTE As String = "debiteur"

                    Dim reservationConf As New Reservation()


                    'ROUTAGE PETIT DEJEUNER
                    Dim PETIT_DEJEUNER_ROUTAGE As Double = 0

                    If GunaCheckBoxPetitDejRoutage.Checked Then
                        Dim pdjRoutage As Double = 0
                        Double.TryParse(GunaTextBoxPetitDejeunerRoutage.Text, pdjRoutage)
                        PETIT_DEJEUNER_ROUTAGE = pdjRoutage
                    End If

                    'ROUTAGE LOGEMENT
                    Dim CHAMBRE_ROUTAGE As String = ""

                    If GunaCheckBoxChambreRoutage.Checked Then
                        If GunaComboBoxChambreRoutage.SelectedIndex >= 0 Then
                            CHAMBRE_ROUTAGE = GunaComboBoxChambreRoutage.SelectedValue.ToString
                        End If
                    End If

                    Dim VENANT_DE As String = GunaTextBoxVenantDe.Text
                    Dim SE_RENDANT_A As String = GunaTextBoxSerendantA.Text

                    Dim SOURCE_RESERVATION As String = ""

                    If GunaComboBoxSourceReservation.SelectedIndex >= 0 Then
                        SOURCE_RESERVATION = GunaComboBoxSourceReservation.SelectedValue.ToString
                    End If

                    Dim ROUTAGE As String = ""

                    If GlobalVariable.actualLanguageValue = 1 Then
                        ROUTAGE = "NON"
                    Else
                        ROUTAGE = "NO"
                    End If

                    If GunaCheckBoxChambreRoutage.Checked Then
                        If GlobalVariable.actualLanguageValue = 1 Then
                            ROUTAGE = "OUI"
                        Else
                            ROUTAGE = "YES"
                        End If
                    End If

                    Dim RAISON As String = ""

                    If GunaComboBoxTypeReservation.Items.Count > 0 Then
                        RAISON = GunaComboBoxTypeReservation.SelectedItem.ToString
                    End If

                    If GunaCheckBoxDayUse.Checked Then
                        DAY_USE = 1
                    End If

                    If GunaCheckBoxMensuel.Checked Then
                        MENSUEL = 1
                    End If
                    '-------------------------GESTION DE LIBERATION DES CHAMBRES POUR LES METTRES DANS DES CHAMBRES FICTIVE----------

                    ' Dim Solde As Double = Functions.SituationDuClient(GlobalVariable.codeClientToUpdate)
                    Dim Solde As Double = Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate)

                    Dim dialogCheckOut As DialogResult

                    If Not Solde = 0 Then

                        'Si nous avons un solde negatif ou positif

                        'dialogCheckOut = MessageBox.Show("Votre Solde est négatif voulez-vous continuer?", "Check out", MessageBoxButtons.YesNo, MessageBoxIcon.Warning)

                        If Solde < 0 Then

                            If GlobalVariable.actualLanguageValue = 1 Then
                                dialogCheckOut = MessageBox.Show("Impossible d'effectuer un Checkout avec un Solde Négatif !!!", "Check out", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                            Else
                                dialogCheckOut = MessageBox.Show("Impossible to check out with a negatif Balance !!!", "Check out", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                            End If

                        ElseIf Solde > 0 Then

                            If GlobalVariable.actualLanguageValue = 1 Then
                                dialogCheckOut = MessageBox.Show("Impossible d'effectuer un Checkout avec un Solde Positif !!!" & Chr(13) & " Bien vouloir procéder à un remboursement ", "Check out", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                            Else
                                dialogCheckOut = MessageBox.Show("Impossible to check out with a positif !!!" & Chr(13) & " Please proceed to a refund ", "Check out", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                            End If

                        End If

                        If dialogCheckOut = DialogResult.OK Then
                            ReglementForm.Close()
                            ReglementForm.Show()
                            ReglementForm.TopMost = True
                        End If

                    Else

                        'ON DOIT DTERMINER SI LE CHECKOUT EST FAISABLE CONCERNANT LES DAY USE

                        Dim continuer As Boolean = False

                        If GunaCheckBoxDayUse.Checked Then

                            Dim infoProcedureDayUse As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reglement", "CODE_RESERVATION")

                            If infoProcedureDayUse.Rows.Count > 0 Then
                                continuer = True
                            Else

                                If GlobalVariable.actualLanguageValue = 1 Then
                                    MessageBox.Show("Bien vouloir effectuer la procédure des Day Use " & Chr(13) & "(Facturation Manuelle en suite un Encaissement) !!!", "Day Use", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                                Else
                                    MessageBox.Show("Please perform the Day Use procedure " & Chr(13) & " (Manual Billing & Cas In) !!!  ", "Day Use", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                                End If

                            End If

                        Else

                            continuer = True

                        End If

                        If continuer Then

                            '-------------------------------------------- GESTION DES TRACES DES UTILISATEURS ----------------------------------------------------------

                            Dim ACTION_FAITE As String = GunaButtonCheckOut.Text
                            Dim FAITE_PAR As String = GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR")

                            reservation.insertTrace(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, DEPOT_DE_GARANTIE, DAY_USE, MENSUEL, BC_ENTREPRISE, TYPE_CHAMBRE, ACTION_FAITE, FAITE_PAR, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE)

                            '------------------------ NORMAL CHECKOUT CAR SOLDE SUPEIEUR A ZERO -----------------------------

                            '-------------------------------------- MOUCHARDS ---------------------------------------------------
                            Dim ACTION As String = ""

                            If GlobalVariable.actualLanguageValue = 1 Then
                                ACTION = "CHECKOUT [CHAMBRE " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " DU " & DATE_ENTTRE & " - " & DATE_SORTIE & "]"
                            Else
                                ACTION = "CHECKOUT [ROOM " & GunaTextBoxNumeroChambre.Text & " / " & NOM_CLIENT & " FROM " & DATE_ENTTRE & " - " & DATE_SORTIE & "]"
                            End If
                            '----------------------------------------------------------------------------------------------------

                            If Not (GlobalVariable.codeReservationToUpdate = "") Then

                                User.mouchard(ACTION)

                                'Checkout meaning the reseravtion has been saved earlier
                                CODE_RESERVATION = GlobalVariable.codeReservationToUpdate

                                Dim CODE_SUIVI As String = Functions.GeneratingRandomCodeWithSpecifications("suivi_des_reservations", "SVR")
                                Dim CHECKOUT_PAR As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

                                User.updateSuiviDesReservations("CHECKOUT_PAR", CHECKOUT_PAR, CODE_RESERVATION)

                                Dim operation As Integer = 1 'UPDATE
                                gestionDesNavettes(operation, CODE_RESERVATION)

                                'MISE AJOUR DE L'ETAT DE LA CHAMBRE

                                If reservationConf.updateReservationConf(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, "", DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, DEPOT_DE_GARANTIE, DAY_USE, MENSUEL, BC_ENTREPRISE, TYPE_CHAMBRE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                                End If

                                If Not GlobalVariable.codeReservationToUpdate = "" Then
                                    'reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", GunaLabelSolde.Text)
                                    Dim updatedSolde As Double = Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate)
                                    reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", updatedSolde)
                                End If

                                'If GlobalVariable.typeChambreOuSalle = "salle" Then
                                'reservation.updateForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION, LOCATION_MATERIEL, AUTRES, CODE_EVENEMENT, LIBELLE_EVENEMENT, NBRE_GOUTER, PU_GOUTER, NBRE_COCKTAIL, PU_COCKTAIL, HEURE_PAUSE_CAFE, HEURE_PAUSE_DEJEUNER, HEURE_DINER, HEURE_GOUTER, HEURE_COCKTAIL, VIDEO_PROJ, SONO, COUVERTS, TABLE_CHAISE, EAU_PTE_QTE, EAU_PTE_MONTANT, EAU_GRDE_QTE, EAU_GRDE_MONTANT, BOISSONS_GAZEUSES_QTE, BOISSONS_GAZEUSES_MONTANT, BIERES_QTE, BIERES_MONTANT, VIN_ROUGE_QTE, VIN_ROUGE_MONTANT, VIN_ROSE_QTE, VIN_ROSE_MONTANT, BOISSONS_EXT_QTE, BOISSONS_EXT_MONTANT, DROIT_DE_BOUCHON, MISE_EN_PLACE, CLOISONNEMENT)
                                'End If

                                'We update the checkin button so no to display the checkin button again
                                reservation.updateReservationConfCheckIn(CODE_RESERVATION)

                                'We update the room if everythig is ok

                                '--------------------------  COMPTE --------------------------

                                CODE_CLIENT = GlobalVariable.codeClientToUpdate
                                NUMERO_COMPTE = GlobalVariable.codeCompteToUpdate

                                'If compte.updateCompte(INTITULE, NUMERO_COMPTE, CODE_CLIENT, TOTAL_DEBIT, TOTAL_CREDIT, SOLDE_COMPTE, DATE_CREATION, TYPE_DE_COMPTE, SENS_DU_SOLDE) Then
                                'End If

                                '-------------------------- REGLEMENT --------------------------
                                If (Not Functions.entryCodeExists(NUM_REGLEMENT, "reglement", "NUM_REGLEMENT")) And (Not GlobalVariable.avance = 0) Then

                                    NUM_REGLEMENT = GlobalVariable.codeFactureToUpdate
                                    REF_REGLEMENT = GlobalVariable.codeReglementToUpdate
                                    CODE_RESERVATION = GlobalVariable.codeReservationToUpdate
                                    CODE_CLIENT = GlobalVariable.codeClientToUpdate

                                    'If reglement.updateReglement(NUM_REGLEMENT, NUM_FACTURE, CODE_CAISSIER, MONTANT_VERSE, DATE_REGLEMENT, MODE_REGLEMENT, REF_REGLEMENT, CODE_MODE, IMPRIMER, CODE_AGENCE, CODE_RESERVATION, CODE_CLIENT) Then

                                    'End If

                                End If

                                '-------------------------- OCCUPATION CHAMBRE--------------------------
                                'If Not Functions.entryCodeExists(CODE_OCCUPATION_CHAMBRE, "occupation_chambre", "CODE_OCCUPATION_CHAMBRE") Then

                                CODE_RESERVATION = GlobalVariable.codeReservationToUpdate
                                CODE_CHAMBRE = GlobalVariable.codeChambreToUpdate
                                CODE_CLIENT_REEL = GlobalVariable.codeClientToUpdate

                                If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                                End If

                                'End If


                                'We check if the the main courante journaliere already exist
                                If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante_journaliere", "CODE_MAIN_COURANTE_JOURNALIERE") Then

                                    'If mainCourante.updateMainCouranteJournaliere(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                                    'End If

                                End If

                                'End If


                                If GlobalVariable.actualLanguageValue = 1 Then
                                    MessageBox.Show("Check Out de " & NOM_CLIENT & " du " & DATE_ENTTRE & " au " & DATE_SORTIE & " effectué avec succès!!", "Check Out", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                Else
                                    MessageBox.Show("Check Out of " & NOM_CLIENT & " from " & DATE_ENTTRE & " to " & DATE_SORTIE & " done successfully !!", "Check Out", MessageBoxButtons.OK, MessageBoxIcon.Information)

                                End If
                                'GunaButtonCheckOut.Visible = False

                            End If

                            '-------------------------- UPDATE ROOM --------------------------------
                            Dim updateQuery As String = "UPDATE `chambre` Set `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE =@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code "

                            Dim command As New MySqlCommand(updateQuery, GlobalVariable.connect)
                            Dim roomStatus As String = "Libre sale"
                            If GlobalVariable.actualLanguageValue = 0 Then
                                roomStatus = "Free dirty"
                            End If
                            command.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                            command.Parameters.Add("@code", MySqlDbType.VarChar).Value = GlobalVariable.codeChambre
                            command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = roomStatus

                            '---------UN CLIENT DONT ON A FAIT LE CHECKOUT NE DOIT PLUS APPARAITRE SUR LA MAINS COURANTES ------------------------------------

                            '1- ON DOIT METTERE A JOUR L'ETAT DE LA RESERVATION DONT ON A FAIT LE CHEKOUT POUR QU'IL N'APPARAISSENT PLUS SUR LA MAIN COURANTE

                            Dim ETAT_MAIN_COURANTE As Integer = 1

                            reservation.miseAjourEtatMainCourante(GlobalVariable.codeMainCouranteJournaliereToUpdate, ETAT_MAIN_COURANTE)

                            'CHANGEMENT DE L'ETAT DE LA RESERVATION
                            reservation.etatReservation(CODE_RESERVATION, ETAT_RESERVATION, ETAT_NOTE_RESERVATION)
                            '---------------------------------------------------------------------------------------------------------------------------------

                            '---------------------------------------------ENVOI DES MESSAGES WHATSAPP------------------------------------------------------------------------
                            Dim NUITEES As Integer = 0

                            Dim NOMBRE_HEURE As Integer = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)
                            NUITEES = CType((DATE_SORTIE - DATE_ENTTRE).TotalDays, Int32)

                            Dim RESA_TYPE As String = ""

                            If NUITEES = 0 Then


                                If GlobalVariable.actualLanguageValue = 1 Then
                                    RESA_TYPE = "HEURE(S)"
                                Else
                                    RESA_TYPE = "HOUR(S)"
                                End If

                                NUITEES = NOMBRE_HEURE
                            Else
                                If GlobalVariable.actualLanguageValue = 1 Then
                                    RESA_TYPE = "NUITEE(S)"

                                Else
                                    RESA_TYPE = "NIGHT(S)"

                                End If

                            End If

                            Dim NoReception = GlobalVariable.AgenceActuelle.Rows(0)("NUMERO_RECEPTION")
                            Dim NoTelChambre = GlobalVariable.AgenceActuelle.Rows(0)("NUMERO_RECEPTION_CHAMBRE")

                            Dim TOTAL_SEJOUR As Double = 0

                            If multiplier Then
                                TOTAL_SEJOUR = MONTANT_ACCORDE * NUITEES
                            Else
                                TOTAL_SEJOUR = MONTANT_ACCORDE
                            End If

                            If GlobalVariable.actualLanguageValue = 1 Then
                                whatsAppMessage = "CHECKOUT " & Chr(13) & " -/ PAR : " & GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR") & Chr(13) & " -/ A : " & Now().ToShortTimeString & Chr(13) & " -/ ARRIVEE : " & DATE_ENTTRE & " " & CDate(HEURE_ENTREE).ToShortTimeString & Chr(13) & " -/ DEPART : " & DATE_SORTIE & " " & CDate(HEURE_SORTIE).ToShortTimeString & Chr(13) & " -/ " & RESA_TYPE & " : " & NUITEES & Chr(13) & " -/ CLIENT : " & NOM_CLIENT & Chr(13) & " -/ TYPE DE CHAMBRE : " & TYPE_CHAMBRE & Chr(13) & " -/ CHAMBRE : " & CHAMBRE_ID & Chr(13) & " -/ MONTANT :  " & MONTANT_ACCORDE & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & " */ MONTANT TOTAL : " & Format(TOTAL_SEJOUR, "###,0")
                                _whatsAppMessage = Chr(13) & "Cher " & NOM_CLIENT & Chr(13) & Chr(13) & "Merci d'avoir séjourné parmi nous à " & GlobalVariable.AgenceActuelle.Rows(0)("NOM_AGENCE") & "." & Chr(13) & Chr(13) & "Nous espérons que votre séjour a été agréable et espérons que vous continuerez à utiliser notre hôtel pour vos besoins d'hébergement dans un proche avenir." & Chr(13) & Chr(13) & " Si vous avez des suggestions concernant notre établissement, nous serons heureux de vous écouter au " & NoReception & "." & Chr(13) & Chr(13) & "Nous nous réjouissons d’avance de vous servir lors de votre prochain voyage." & Chr(13) & Chr(13) & " Cordialement"
                            Else
                                whatsAppMessage = "DEPARTURE " & Chr(13) & " -/ BY : " & GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR") & Chr(13) & " -/ AT : " & Now().ToShortTimeString & Chr(13) & " -/ ARRIVAL : " & DATE_ENTTRE & " " & CDate(HEURE_ENTREE).ToShortTimeString & Chr(13) & " -/ DEPARTURE : " & DATE_SORTIE & " " & CDate(HEURE_SORTIE).ToShortTimeString & Chr(13) & " -/ " & RESA_TYPE & " : " & NUITEES & Chr(13) & " -/ CLIENT : " & NOM_CLIENT & Chr(13) & " -/ ROOM TYPE : " & TYPE_CHAMBRE & Chr(13) & " -/ ROOM : " & CHAMBRE_ID & Chr(13) & " -/ AMOUNT :  " & MONTANT_ACCORDE & " " & GlobalVariable.societe.Rows(0)("CODE_MONNAIE") & Chr(13) & " */ MONTANT TOTAL : " & Format(TOTAL_SEJOUR, "###,0")
                                _whatsAppMessage = Chr(13) & "Dear " & NOM_CLIENT & Chr(13) & Chr(13) & "Thank you for staying with us at " & GlobalVariable.AgenceActuelle.Rows(0)("NOM_AGENCE") & "." & Chr(13) & Chr(13) & "We hope you enjoyed your stay and hope you will continue to use our hotel for your accommodation needs in the near future." & Chr(13) & Chr(13) & " If you have any suggestions regarding our establishment, we would be delighted to hear from you at " & NoReception & "." & Chr(13) & Chr(13) & "We look forward To serving you On your Next trip." & Chr(13) & Chr(13) & "Kind regards"
                            End If

                            Dim lStatus As Integer
                            Dim CardNo As Integer
                            Dim RoomNo As String

                            If IsNumeric(TB_CardNo.Text) Then
                                CardNo = Val(TB_CardNo.Text)
                            Else
                                CardNo = 0
                            End If

                            RoomNo = CHAMBRE_ID

                            TB_Result.Text = "Executing..."
                            TB_Result.Refresh()

                            'lStatus = CheckOut(RoomNo, CardNo)

                            'TB_Result.Text = lStatus.ToString("X")

                            Dim args As ArgumentType = New ArgumentType()

                            If GlobalVariable.AgenceActuelle.Rows(0)("MESSAGE_WHATSAPP") = 1 Then
                                Dim mobile_number As String = listeOfTelephoneNumbers()

                                args.action = 0
                                args.whatsAppMessage = whatsAppMessage
                                args.mobile_number = mobile_number

                                backGroundWorkerToCall(args)

                                'Functions.ultrMessageSimpleText(whatsAppMessage, mobile_number)

                            End If

                            If GlobalVariable.AgenceActuelle.Rows(0)("SERRURES") = 1 Then

                                'demarrageDeSessionEncodeur()

                                'checkoutEncodeur()

                            End If
                            '---------------------------------------------ENVOI DES MESSAGES WHATSAPP------------------------------------------------------------------------

                            'Excuting the command and testing if everything went on well
                            If (command.ExecuteNonQuery() = 1) Then
                                'connect.closeConnection()
                            End If

                            'GunaLabelNumReservation.Text = CODE_RESERVATION
                            'GESTION DES GRATUITEES
                            gestionDelaGratuiteeDeLaReservation()

                            'GESTION DES PRISES EN CHARGES DE LA RESERVATION
                            gestionDelaPriseEnChargeDeLaReservation()

                            'Gestion du désencodage

                            GunaLabelSolde.ForeColor = Color.Black

                            Dim ZenoLockForm As New ZenoLockForm()

                            Dim dialog As New DialogResult()

                            Dim args_ As New ArgumentType

                            If GlobalVariable.AgenceActuelle.Rows(0)("MESSAGE_WHATSAPP") = 1 Then

                                args_.action = 0
                                args_.whatsAppMessage = _whatsAppMessage
                                args_.mobile_number = TELEPHONE_CLIENT

                                backGroundWorkerToCall(args_)

                            End If

                            dt = GlobalVariable.ReservationToUpdate

                            VidageDesChampsPourNouvelleReservation()

                            'We empty the fields
                            emtptyRegistrationFields()

                            'ReservationList()

                            'We update the buttons to display
                            reservationButtonToDisplay()

                            'we set all the global variables used for updates using code
                            Functions.EmtyGlobalVariablesContainingCodeToUpdate()
                            ReinitialisationDesDates()

                            'We prevent from choosing a room if a room type is not first choosen
                            'GunaTextBoxNumeroChambre.BaseColor = Color.Beige
                            GunaTextBoxNumeroChambre.Enabled = True

                            GunaLabelSolde.ForeColor = Color.Black
                            GunaLabelSolde.Text = 0

                            GunaCheckBoxPetitDejeuenerInclus.Checked = False
                            GunaCheckBoxTaxeSejour.Checked = False
                            GunaTextBoxPetitDejeuner.Visible = False
                            GunaTextBoxPetitDejeunerRoutage.Visible = False

                            reservationButtonToDisplay()

                            GunaButtonCheckOut.Visible = False

                            GunaTextBoxBC.Visible = False

                            GunaTextBoxNbreAdulte.Text = 0

                        End If

                    End If

                    If GlobalVariable.AgenceActuelle.Rows(0)("CLUB_ELITE") = 1 Then

                        Dim elite_traitement As Boolean = True

                        If elite_traitement Then
                            Dim elite As New ClubElite()
                            elite.remplissageDesChampsPermettantLeUpGradingDuClient_(CODE_CLIENT, dt)
                        End If

                    End If

                    Me.Cursor = Cursors.Default

                End If

            End If
        End If

    End Sub

    Public Function listeOfTelephoneNumbers() As String

        Dim mobile_number As String

        If Not Trim(GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_1")).Equals("") Then
            mobile_number = GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_1")
        End If

        If Not Trim(GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_2")).Equals("") Then
            If Trim(mobile_number).Equals("") Then
                mobile_number = GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_2")
            Else
                mobile_number += "," & GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_2")
            End If
        End If

        If Not Trim(GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_3")).Equals("") Then
            If Trim(mobile_number).Equals("") Then
                mobile_number = GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_3")
            Else
                mobile_number += "," & GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_3")
            End If
        End If

        If Not Trim(GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_4")).Equals("") Then
            If Trim(mobile_number).Equals("") Then
                mobile_number = GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_4")
            Else
                mobile_number += "," & GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_4")
            End If
        End If

        If Not Trim(GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_5")).Equals("") Then
            If Trim(mobile_number).Equals("") Then
                mobile_number = GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_5")
            Else
                mobile_number += "," & GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_5")
            End If
        End If

        If Not Trim(GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_6")).Equals("") Then
            If Trim(mobile_number).Equals("") Then
                mobile_number = GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_6")
            Else
                mobile_number += "," & GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_6")
            End If
        End If

        If Not Trim(GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_7")).Equals("") Then
            If Trim(mobile_number).Equals("") Then
                mobile_number = GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_7")
            Else
                mobile_number += "," & GlobalVariable.AgenceActuelle.Rows(0)("WHATSAPP_7")
            End If
        End If

        Return mobile_number

    End Function
    '--------------------------------------------------- TABS GESTION DES ATTENDUS - EN CHAMBRES - DEPARTS --------------------------------------
    '-----------------------------------------------------------------------TABS MANAGEMENT ---------------------------------------------------------------
    '--------------------------------------- GRSTION DES RESERVATIONS --------------------------------------------------------
    Public Sub ReservationList(ByVal searchField As String, ByVal searchValue As String, Optional ByVal DateSearch As String = "")

        Dim query As String = ""
        Dim query1 As String = ""
        Dim query01 As String = ""
        Dim table As New DataTable()
        Dim table01 As New DataTable()


        'SI L'ON SE CONNECTE AVEC UN PROFILE AYANT LA GESTION DE LA FISCALITE

        If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("FISCALITE") = 1 Then

            If searchField = "all" Then

                query1 = "Select NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf, source_reservation WHERE TYPE=@TYPE AND FSC=@FSC AND reserve_conf.SOURCE_RESERVATION = source_reservation.CODE_SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

                Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
                command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
                command1.Parameters.Add("@FSC", MySqlDbType.Int32).Value = 1

                Dim adapter1 As New MySqlDataAdapter(command1)
                Dim table1 As New DataTable()
                adapter1.Fill(table1)

            ElseIf searchField = "entreprise" Or searchField = "individuelle" Or searchField = "groupe" Then

                Dim custom As String = ""

                If searchField = "entreprise" Then
                    custom = " NOM_ENTREPRISE NOT IN ('', ' ')"
                ElseIf searchField = "individuelle" Then
                    custom = " NOM_ENTREPRISE IN ('', ' ')"
                ElseIf searchField = "groupe" Then
                    custom = " GROUPE NOT IN ('', ' ')"
                End If

                'query1 = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE FSC=@FSC AND DAY_USE=@DAY_USE AND TYPE=@TYPE AND " & custom & " ORDER BY CHAMBRE_ID ASC"
                query1 = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf WHERE FSC=@FSC AND TYPE=@TYPE AND " & custom & " ORDER BY CHAMBRE_ID ASC"

                Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
                command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
                command1.Parameters.Add("@FSC", MySqlDbType.Int32).Value = 1

                Dim adapter1 As New MySqlDataAdapter(command1)
                Dim table1 As New DataTable()
                adapter1.Fill(table1)

                table.Merge(table1)


            Else

                query1 = "Select NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf WHERE TYPE=@TYPE AND FSC=@FSC AND DAY_USE=@DAY_USE AND " & searchField & "  LIKE '%" & searchValue & "%' ORDER BY CHAMBRE_ID ASC"

                Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
                command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
                command1.Parameters.Add("@searchField", MySqlDbType.VarChar).Value = searchValue
                command1.Parameters.Add("@DAY_USE", MySqlDbType.Int64).Value = 0
                command1.Parameters.Add("@FSC", MySqlDbType.Int64).Value = 1

                Dim adapter1 As New MySqlDataAdapter(command1)
                Dim table1 As New DataTable()
                adapter1.Fill(table1)

                table.Merge(table1)

            End If

        Else

            If searchField = "all" Then

                query = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reservation WHERE TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

                Dim command As New MySqlCommand(query, GlobalVariable.connect)
                command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
                'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

                Dim adapter As New MySqlDataAdapter(command)

                adapter.Fill(table)

                query1 = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf WHERE TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

                Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
                command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
                'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

                Dim adapter1 As New MySqlDataAdapter(command1)
                Dim table1 As New DataTable()
                adapter1.Fill(table1)

                table.Merge(table1)

            ElseIf searchField = "entreprise" Or searchField = "individuelle" Or searchField = "groupe" Then

                Dim custom As String = ""

                If searchField = "entreprise" Then
                    custom = " NOM_ENTREPRISE NOT IN ('', ' ')"
                ElseIf searchField = "individuelle" Then
                    custom = " NOM_ENTREPRISE IN ('', ' ')"
                ElseIf searchField = "groupe" Then
                    custom = " GROUPE NOT IN ('', ' ')"
                End If

                query = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reservation WHERE TYPE=@TYPE AND " & custom & " ORDER BY CHAMBRE_ID ASC"

                Dim command As New MySqlCommand(query, GlobalVariable.connect)
                command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

                Dim adapter As New MySqlDataAdapter(command)

                adapter.Fill(table)

                query1 = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf WHERE TYPE=@TYPE AND " & custom & " ORDER BY CHAMBRE_ID ASC"

                Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
                command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

                Dim adapter1 As New MySqlDataAdapter(command1)
                Dim table1 As New DataTable()
                adapter1.Fill(table1)

                table.Merge(table1)


            Else

                query = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reservation WHERE TYPE=@TYPE AND " & searchField & " LIKE '%" & searchValue & "%' ORDER BY CHAMBRE_ID ASC"

                Dim command As New MySqlCommand(query, GlobalVariable.connect)
                command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
                command.Parameters.Add("@searchField", MySqlDbType.VarChar).Value = searchValue

                Dim adapter As New MySqlDataAdapter(command)

                adapter.Fill(table)

                ' query1 = "Select NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE TYPE=@TYPE AND " & searchField & "=@searchField ORDER BY CHAMBRE_ID ASC"

                query1 = "Select NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf WHERE TYPE=@TYPE AND " & searchField & "  LIKE '%" & searchValue & "%' ORDER BY CHAMBRE_ID ASC"

                Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
                command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
                command1.Parameters.Add("@searchField", MySqlDbType.VarChar).Value = searchValue

                Dim adapter1 As New MySqlDataAdapter(command1)
                Dim table1 As New DataTable()
                adapter1.Fill(table1)

                table.Merge(table1)

            End If

        End If

        If (table.Rows.Count > 0) Then

            GunaDataGridViewReservationList.DataSource = table

            GunaDataGridViewReservationList.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
            GunaDataGridViewReservationList.DefaultCellStyle.SelectionForeColor = Color.White
            GunaDataGridViewReservationList.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewReservationList.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            GunaDataGridViewReservationList.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewReservationList.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            GunaDataGridViewReservationList.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

            For i = 0 To GunaDataGridViewReservationList.Rows.Count - 1

                If GunaDataGridViewReservationList.Rows(i).Cells("SOLDE").Value < 0 Then
                    GunaDataGridViewReservationList.Rows(i).DefaultCellStyle.BackColor = Color.LightPink
                    'GunaDataGridViewReservationList.Columns("SOLDE").DefaultCellStyle.BackColor = Color.LightPink
                    ' GunaDataGridViewReservationList.Columns("SOLDE").DefaultCellStyle.BackColor = Color.White
                    GunaDataGridViewReservationList.Rows(i).DefaultCellStyle.ForeColor = Color.White
                End If

            Next

        Else

            GunaDataGridViewReservationList.Columns.Clear()

        End If

    End Sub




    ''--------------------------- START ATTENDUS TAB ---------------------------------

    'we empty the datagrid whe tab when activated

    Private Sub TabControl1_Selected(sender As Object, e As TabControlEventArgs) Handles TabControlHbergement.Selected

        DataGridViewAttenduPanel.Columns.Clear()

        DataGridViewEnChambre.Columns.Clear()

        DataGridViewDepartTab.Columns.Clear()

    End Sub

    Dim nombreDesAttendus As Integer = 0
    Dim nombreDesEnChambres As Integer = 0
    Dim nombreDesDeparts As Integer = 0

    Public Sub ListeDesAttendues()

        Dim DateDebut As Date = GunaDateTimePickerDebut.Value.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GunaDateTimePickerFin.Value.ToString("yyyy-MM-dd")

        If (GunaDateTimePickerDebut.Value <= GunaDateTimePickerFin.Value) Then

            Dim query As String = ""

            If GlobalVariable.attribuerChambre = True Then

                query = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION= 0 AND CHAMBRE_ID IN ('','-') ORDER BY CHAMBRE_ID ASC"

            Else

                query = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION= 0 ORDER BY CHAMBRE_ID ASC"

            End If
            'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            'command.Parameters.Add("@CHAMBRE_ID", MySqlDbType.VarChar).Value = "-"

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                DataGridViewAttenduPanel.DataSource = table

                DataGridViewAttenduPanel.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                DataGridViewAttenduPanel.DefaultCellStyle.SelectionForeColor = Color.White
                DataGridViewAttenduPanel.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                DataGridViewAttenduPanel.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                DataGridViewAttenduPanel.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                DataGridViewAttenduPanel.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

                For i = 0 To DataGridViewAttenduPanel.Rows.Count - 1

                    If DataGridViewAttenduPanel.Rows(i).Cells("SOLDE").Value < 0 Then
                        DataGridViewAttenduPanel.Rows(i).DefaultCellStyle.BackColor = Color.Red
                        DataGridViewAttenduPanel.Rows(i).DefaultCellStyle.ForeColor = Color.White
                    End If

                Next

            Else

                DataGridViewAttenduPanel.Columns.Clear()

            End If

            'connect.closeConnection()
        Else

            DataGridViewAttenduPanel.Columns.Clear()

        End If


    End Sub

    Public Sub ListeDesDayUse(ByVal DateEntree As Date, ByVal DateSortie As Date)

        Dim DateDebut As Date = DateEntree.ToString("yyyy-MM-dd")
        Dim DateFin As Date = DateSortie.ToString("yyyy-MM-dd")

        Dim table1 As New DataTable()
        Dim table As New DataTable()

        If (GunaDateTimePickerDebut.Value <= GunaDateTimePickerFin.Value) Then

            Dim typeChambreOuSalle As String = ""

            If GlobalVariable.DocumentToGenerate = "day use" Then

                typeChambreOuSalle = "chambre"

                'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies
                Dim query As String = "SELECT CODE_RESERVATION AS 'RESERVATION', CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM & PRENOM', SOLDE_RESERVATION AS 'SOLDE', HEURE_ENTREE As 'HEURE ARRIVEE', HEURE_SORTIE As 'HEURE DEPART', NB_PERSONNES AS PAX WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND DAY_USE = @DAY_USE ORDER BY CHAMBRE_ID ASC"

                Dim command As New MySqlCommand(query, GlobalVariable.connect)
                command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = typeChambreOuSalle
                command.Parameters.Add("@DAY_USE", MySqlDbType.Int32).Value = 1

                Dim adapter As New MySqlDataAdapter(command)

                adapter.Fill(table)

            End If

            If (table.Rows.Count > 0) Then

                GunaDataGridViewRapportDST.DataSource = table

                GunaButtonImpressionPourDST.Visible = True

            Else

                GunaDataGridViewRapportDST.Columns.Clear()

                GunaButtonImpressionPourDST.Visible = False

            End If

            'connect.closeConnection()
        Else

            GunaDataGridViewRapportDST.Columns.Clear()

        End If


    End Sub

    Public Sub ListeDesAttenduesRapportDST(ByVal DateEntree As Date, ByVal DateSortie As Date, ByVal Optional resa As Integer = 0)

        Dim DateDebut As Date = DateEntree.ToString("yyyy-MM-dd")
        Dim DateFin As Date = DateSortie.ToString("yyyy-MM-dd")

        Dim table1 As New DataTable()
        Dim table As New DataTable()

        If (GunaDateTimePickerDebut.Value <= GunaDateTimePickerFin.Value) Then

            Dim typeChambreOuSalle As String = ""

            If GlobalVariable.DocumentToGenerate = "evenements" Then

                typeChambreOuSalle = "salle"

                'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies
                Dim query As String = "SELECT reserve_conf.CODE_RESERVATION AS 'RESERVATION', CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM & PRENOM', MONTANT_ACCORDE AS 'MONTANT ACCORDE', DATE_ENTTRE As 'DATE ARRIVEE', DATE_SORTIE As 'DATE DEPART', NB_PERSONNES AS PAX, LIBELLE As EVENEMENT FROM reserve_conf, forfait_salle, evenement WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND reserve_conf.CODE_RESERVATION =forfait_salle.CODE_RESERVATION AND forfait_salle.CODE_EVENEMENT=evenement.CODE_EVENEMENT ORDER BY CHAMBRE_ID ASC"

                Dim command As New MySqlCommand(query, GlobalVariable.connect)
                command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = typeChambreOuSalle
                'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

                Dim adapter As New MySqlDataAdapter(command)

                adapter.Fill(table)

            ElseIf GlobalVariable.DocumentToGenerate = "day use" Then

                typeChambreOuSalle = "chambre"

                Dim query As String = ""

                If GlobalVariable.AgenceActuelle.Rows(0)("SERRURES") = 1 Then
                    'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies
                    query = "SELECT reserve_conf.CODE_RESERVATION AS 'RESERVATION', CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM & PRENOM', MONTANT_ACCORDE AS 'MONTANT ACCORDE', HEURE_ENTREE As 'HEURE ARRIVEE', HEURE_SORTIE As 'HEURE DEPART', NB_PERSONNES AS PAX, HEURE_EFFACEMENT AS 'HEURE EFFACEMENT' FROM reserve_conf, suivi_des_encodages WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND DAY_USE = @DAY_USE AND reserve_conf.CODE_RESERVATION = suivi_des_encodages.CODE_RESERVATION ORDER BY CHAMBRE_ID ASC"
                Else
                    query = "SELECT reserve_conf.CODE_RESERVATION AS 'RESERVATION', CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM & PRENOM', MONTANT_ACCORDE AS 'MONTANT ACCORDE', HEURE_ENTREE As 'HEURE ARRIVEE', HEURE_SORTIE As 'HEURE DEPART', NB_PERSONNES AS PAX FROM reserve_conf WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND DAY_USE = @DAY_USE ORDER BY CHAMBRE_ID ASC"
                End If

                Dim command As New MySqlCommand(query, GlobalVariable.connect)
                command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = typeChambreOuSalle
                command.Parameters.Add("@DAY_USE", MySqlDbType.Int32).Value = 1

                Dim adapter As New MySqlDataAdapter(command)

                adapter.Fill(table)

            ElseIf GlobalVariable.DocumentToGenerate = "non day use" Then

                typeChambreOuSalle = "chambre"

                Dim query As String = ""

                If GlobalVariable.AgenceActuelle.Rows(0)("SERRURES") = 1 Then
                    'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies
                    query = "SELECT reserve_conf.CODE_RESERVATION AS 'RESERVATION', CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM & PRENOM', MONTANT_ACCORDE AS 'MONTANT ACCORDE', HEURE_ENTREE As 'HEURE ARRIVEE', HEURE_SORTIE As 'HEURE DEPART', NB_PERSONNES AS PAX, HEURE_EFFACEMENT AS 'HEURE EFFACEMENT' FROM reserve_conf, suivi_des_encodages WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND DAY_USE = @DAY_USE AND reserve_conf.CODE_RESERVATION = suivi_des_encodages.CODE_RESERVATION ORDER BY CHAMBRE_ID ASC"
                Else
                    query = "SELECT reserve_conf.CODE_RESERVATION AS 'RESERVATION', CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM & PRENOM', MONTANT_ACCORDE AS 'MONTANT ACCORDE', HEURE_ENTREE As 'HEURE ARRIVEE', HEURE_SORTIE As 'HEURE DEPART', NB_PERSONNES AS PAX FROM reserve_conf WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND DAY_USE = @DAY_USE ORDER BY CHAMBRE_ID ASC"
                End If

                Dim command As New MySqlCommand(query, GlobalVariable.connect)
                command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = typeChambreOuSalle
                command.Parameters.Add("@DAY_USE", MySqlDbType.Int32).Value = 0

                Dim adapter As New MySqlDataAdapter(command)

                adapter.Fill(table)


            ElseIf GlobalVariable.DocumentToGenerate = "reservations" Then

                typeChambreOuSalle = "chambre"

                Dim query As String = ""
                Dim query1 As String = ""

                If resa = 0 Then 'LES RESERVATIONS

                    query = "SELECT CHAMBRE_ID AS 'CHAMBRE', TYPE_CHAMBRE AS 'TYPE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', MONTANT_ACCORDE AS 'PRIX/NUITEE', SOLDE_RESERVATION AS 'SOLDE',  CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', source_reservation.SOURCE_RESERVATION AS SOURCE  FROM reserve_conf, source_reservation WHERE reserve_conf.DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND reserve_conf.DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND source_reservation.CODE_SOURCE_RESERVATION = reserve_conf.SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

                    query1 = "SELECT CHAMBRE_ID AS 'CHAMBRE', TYPE_CHAMBRE AS 'TYPE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', MONTANT_ACCORDE AS 'PRIX/NUITEE', SOLDE_RESERVATION AS 'SOLDE',  CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', source_reservation.SOURCE_RESERVATION AS SOURCE FROM reservation, source_reservation WHERE reservation.DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND reservation.DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND source_reservation.CODE_SOURCE_RESERVATION = reservation.SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

                    'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies

                    Dim command As New MySqlCommand(query, GlobalVariable.connect)
                    command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = typeChambreOuSalle
                    'command.Parameters.Add("@DAY_USE", MySqlDbType.Int32).Value = 1

                    Dim adapter As New MySqlDataAdapter(command)

                    adapter.Fill(table)

                    'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies

                    Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
                    command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = typeChambreOuSalle
                    'command1.Parameters.Add("@DAY_USE", MySqlDbType.Int32).Value = 1

                    Dim adapter1 As New MySqlDataAdapter(command1)

                    adapter1.Fill(table1)

                    table.Merge(table1)

                ElseIf resa = 1 Then 'CHECKED IN

                    query = "SELECT CHAMBRE_ID AS 'CHAMBRE', TYPE_CHAMBRE AS 'TYPE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', MONTANT_ACCORDE AS 'PRIX/NUITEE', SOLDE_RESERVATION AS 'SOLDE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', source_reservation.SOURCE_RESERVATION AS SOURCE FROM reserve_conf, source_reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND source_reservation.CODE_SOURCE_RESERVATION = reserve_conf.SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"
                    'query = "SELECT CHAMBRE_ID AS 'CHAMBRE', TYPE_CHAMBRE AS 'TYPE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', MONTANT_ACCORDE AS 'PRIX/NUITEE', SOLDE_RESERVATION AS 'SOLDE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', source_reservation.SOURCE_RESERVATION AS SOURCE FROM reserve_conf, source_reservation WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND source_reservation.CODE_SOURCE_RESERVATION = reserve_conf.SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

                    Dim command As New MySqlCommand(query, GlobalVariable.connect)
                    command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = typeChambreOuSalle
                    'command.Parameters.Add("@DAY_USE", MySqlDbType.Int32).Value = 1

                    Dim adapter As New MySqlDataAdapter(command)

                    adapter.Fill(table)

                ElseIf resa = 2 Then 'LES CHECKOUTS

                    query = "SELECT CHAMBRE_ID AS 'CHAMBRE', TYPE_CHAMBRE AS 'TYPE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', MONTANT_ACCORDE AS 'PRIX/NUITEE', SOLDE_RESERVATION AS 'SOLDE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', source_reservation.SOURCE_RESERVATION AS SOURCE FROM reserve_conf, source_reservation WHERE DATE_SORTIE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 0 AND TYPE=@TYPE AND source_reservation.CODE_SOURCE_RESERVATION = reserve_conf.SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

                    Dim command As New MySqlCommand(query, GlobalVariable.connect)
                    command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = typeChambreOuSalle
                    'command.Parameters.Add("@DAY_USE", MySqlDbType.Int32).Value = 1

                    Dim adapter As New MySqlDataAdapter(command)

                    adapter.Fill(table)

                ElseIf resa = 3 Then 'ATTENDUES

                    query = "SELECT CHAMBRE_ID AS 'CHAMBRE', TYPE_CHAMBRE AS 'TYPE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', MONTANT_ACCORDE AS 'PRIX/NUITEE', SOLDE_RESERVATION AS 'SOLDE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', source_reservation.SOURCE_RESERVATION AS SOURCE FROM reservation, source_reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND source_reservation.CODE_SOURCE_RESERVATION = reservation.SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

                    Dim command As New MySqlCommand(query, GlobalVariable.connect)
                    command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
                    'command.Parameters.Add("@DAY_USE", MySqlDbType.Int32).Value = 1

                    Dim adapter As New MySqlDataAdapter(command)

                    adapter.Fill(table)

                ElseIf resa = 4 Then 'NO SHOW

                    query = "SELECT CHAMBRE_ID AS 'CHAMBRE', TYPE_CHAMBRE AS 'TYPE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', MONTANT_ACCORDE AS 'PRIX/NUITEE', SOLDE_RESERVATION AS 'SOLDE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', source_reservation.SOURCE_RESERVATION AS SOURCE FROM reserve_temp, source_reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND source_reservation.CODE_SOURCE_RESERVATION = reserve_temp.SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

                    Dim command As New MySqlCommand(query, GlobalVariable.connect)
                    command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
                    'command.Parameters.Add("@DAY_USE", MySqlDbType.Int32).Value = 1

                    Dim adapter As New MySqlDataAdapter(command)

                    adapter.Fill(table)

                End If

            Else

                typeChambreOuSalle = "chambre"

                Dim query As String = "SELECT reserve_conf.NOM_CLIENT As 'CLIENT', CNI As 'CNI/NIU', DATE_ENTTRE As 'DATE ARRIVEE', DATE_SORTIE As 'DATE SORTIE', VENANT_DE AS 'VENANT DE', SE_RENDANT_A As 'SE RENDANT A' FROM reserve_conf, client WHERE reserve_conf.CLIENT_ID=client.CODE_CLIENT AND DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND DAY_USE = @DAY_USE ORDER BY reserve_conf.NOM_CLIENT ASC"

                Dim command As New MySqlCommand(query, GlobalVariable.connect)
                command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = typeChambreOuSalle
                command.Parameters.Add("@DAY_USE", MySqlDbType.Int32).Value = 0

                Dim adapter As New MySqlDataAdapter(command)

                adapter.Fill(table)

            End If

            If (table.Rows.Count > 0) Then

                GunaDataGridViewRapportDST.DataSource = table

                GunaButtonImpressionPourDST.Visible = True

            Else

                GunaDataGridViewRapportDST.Columns.Clear()

                GunaButtonImpressionPourDST.Visible = False

            End If

            'connect.closeConnection()
        Else
            GunaDataGridViewRapportDST.Columns.Clear()
        End If


    End Sub
    'Reservation to display at the espected Tab 
    Private Sub GunaButtonAfficher_Click(sender As Object, e As EventArgs) Handles GunaButtonAfficherArrivee.Click

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewAttenduPanel.Columns.Clear()

        ListeDesAttendues()

        If DataGridViewAttenduPanel.Rows.Count > 0 Then
            GunaLabelNbreAttendu.Text = "(" & DataGridViewAttenduPanel.Rows.Count & ")"
        Else
            GunaLabelNbreAttendu.Text = "(0)"
        End If

    End Sub


    ''--------------------------- START EN CHAMBRE TAB ---------------------------------

    '---------------------------------------- LIVE SEARCH -------------------------------------

    Public Sub ListeDesUsesDuJour(ByVal DateDebut As Date)

        'On affiche toutes les reserv_conf dont la date saisie est entre la d'entrée et la date de sortie (inclusif)

        'Dim DateDebut As Date = GunaDateTimePickerDebutEnChambre.Value.ToString("yyyy-MM-dd")

        Dim query As String = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()
        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            DataGridViewEnChambre.DataSource = table

            DataGridViewEnChambre.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
            DataGridViewEnChambre.DefaultCellStyle.SelectionForeColor = Color.White
            DataGridViewEnChambre.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
            DataGridViewEnChambre.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            DataGridViewEnChambre.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
            DataGridViewEnChambre.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            DataGridViewEnChambre.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
            DataGridViewEnChambre.Columns("CHAMBRE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
            DataGridViewEnChambre.Columns("NOM CLIENT").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

            For i = 0 To DataGridViewEnChambre.Rows.Count - 1

                If DataGridViewEnChambre.Rows(i).Cells("SOLDE").Value < 0 Then
                    DataGridViewEnChambre.Rows(i).DefaultCellStyle.BackColor = Color.LightPink
                    DataGridViewEnChambre.Rows(i).DefaultCellStyle.ForeColor = Color.Black
                End If

            Next

        Else

            DataGridViewEnChambre.Columns.Clear()

        End If

        'connect.closeConnection()

    End Sub


    Public Sub ListeDesEnChambresDuJour(ByVal DateDebut As Date)

        Dim query As String = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()
        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            DataGridViewEnChambre.DataSource = table

            DataGridViewEnChambre.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
            DataGridViewEnChambre.DefaultCellStyle.SelectionForeColor = Color.White
            DataGridViewEnChambre.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
            DataGridViewEnChambre.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            DataGridViewEnChambre.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
            DataGridViewEnChambre.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            DataGridViewEnChambre.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
            DataGridViewEnChambre.Columns("CHAMBRE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
            DataGridViewEnChambre.Columns("NOM CLIENT").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

            For i = 0 To DataGridViewEnChambre.Rows.Count - 1

                If DataGridViewEnChambre.Rows(i).Cells("SOLDE").Value < 0 Then
                    DataGridViewEnChambre.Rows(i).DefaultCellStyle.BackColor = Color.LightPink
                    DataGridViewEnChambre.Rows(i).DefaultCellStyle.ForeColor = Color.Black
                End If

            Next

        Else

            DataGridViewEnChambre.Columns.Clear()

        End If

        'connect.closeConnection()

    End Sub


    Public Sub ListeDesEnChambres()

        'On affiche toutes les reserv_conf dont la date saisie est entre la d'entrée et la date de sortie (inclusif)

        Dim DateDebut As Date = GunaDateTimePickerDebutEnChambre.Value.ToString("yyyy-MM-dd")

        Dim query As String = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()
        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            DataGridViewEnChambre.DataSource = table

            DataGridViewEnChambre.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
            DataGridViewEnChambre.DefaultCellStyle.SelectionForeColor = Color.White
            DataGridViewEnChambre.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
            DataGridViewEnChambre.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            DataGridViewEnChambre.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
            DataGridViewEnChambre.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            DataGridViewEnChambre.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
            DataGridViewEnChambre.Columns("CHAMBRE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
            DataGridViewEnChambre.Columns("NOM CLIENT").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

            For i = 0 To DataGridViewEnChambre.Rows.Count - 1

                If DataGridViewEnChambre.Rows(i).Cells("SOLDE").Value < 0 Then
                    DataGridViewEnChambre.Rows(i).DefaultCellStyle.BackColor = Color.LightPink
                    DataGridViewEnChambre.Rows(i).DefaultCellStyle.ForeColor = Color.Black
                End If

            Next

        Else

            DataGridViewEnChambre.Columns.Clear()

        End If

        'connect.closeConnection()

    End Sub

    'When we select a date an press the print button
    Private Sub GunaButtonEnChambre_Click(sender As Object, e As EventArgs) Handles GunaButtonEnChambreAfficher.Click

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewEnChambre.Columns.Clear()

        ListeDesEnChambres()

        If DataGridViewEnChambre.Rows.Count > 0 Then
            GunaLabelNbreEnChambre.Text = "(" & DataGridViewEnChambre.Rows.Count & ")"
        Else
            GunaLabelNbreEnChambre.Text = "(0)"
        End If

    End Sub

    ''--------------------------- END EN CHAMBRE TAB ---------------------------------

    '-------------------------------------- START DEPART PANEL -------------------------------

    Public Sub ListeDesDepartsEffectues(ByVal date_travail As Date)

        Dim DateDebut As Date = date_travail.ToString("yyyy-MM-dd")
        Dim DateFin As Date = date_travail.ToString("yyyy-MM-dd")

        If (True) Then

            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf WHERE DATE_SORTIE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 0 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                DataGridViewDepartTab.DataSource = table

                DataGridViewDepartTab.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                DataGridViewDepartTab.DefaultCellStyle.SelectionForeColor = Color.White
                DataGridViewDepartTab.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                DataGridViewDepartTab.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                DataGridViewDepartTab.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                DataGridViewDepartTab.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

                For i = 0 To DataGridViewDepartTab.Rows.Count - 1

                    If DataGridViewDepartTab.Rows(i).Cells("SOLDE").Value < 0 Then
                        DataGridViewDepartTab.Rows(i).DefaultCellStyle.BackColor = Color.Red
                        DataGridViewDepartTab.Rows(i).DefaultCellStyle.ForeColor = Color.White
                    End If

                Next

            Else

                DataGridViewDepartTab.Columns.Clear()

            End If

            'connect.closeConnection()
        End If

    End Sub
    Public Sub ListeDesDeparts()

        Dim DateDebut As Date = GunaDateTimePickerArriveeDepart.Value.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GunaDateTimePickerDepartDepert.Value.ToString("yyyy-MM-dd")

        If (GunaDateTimePickerArriveeDepart.Value <= GunaDateTimePickerDepartDepert.Value) Then

            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)', GROUPE FROM reserve_conf WHERE DATE_SORTIE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                DataGridViewDepartTab.DataSource = table

                DataGridViewDepartTab.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                DataGridViewDepartTab.DefaultCellStyle.SelectionForeColor = Color.White
                DataGridViewDepartTab.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                DataGridViewDepartTab.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                DataGridViewDepartTab.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                DataGridViewDepartTab.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

                For i = 0 To DataGridViewDepartTab.Rows.Count - 1

                    If DataGridViewDepartTab.Rows(i).Cells("SOLDE").Value < 0 Then
                        DataGridViewDepartTab.Rows(i).DefaultCellStyle.BackColor = Color.Red
                        DataGridViewDepartTab.Rows(i).DefaultCellStyle.ForeColor = Color.White
                    End If

                Next

            Else

                DataGridViewDepartTab.Columns.Clear()

            End If

            'connect.closeConnection()
        End If

    End Sub

    'outputting the elements of the departure tab at the font office depending on two dates and departure date
    Private Sub GunaButtonAfficherDepart_Click(sender As Object, e As EventArgs) Handles GunaButtonAfficherDepart.Click

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewDepartTab.Columns.Clear()

        ListeDesDeparts()

        If DataGridViewDepartTab.Rows.Count > 0 Then
            GunaLabelNbreDeparts.Text = "(" & DataGridViewDepartTab.Rows.Count & ")"
        Else
            GunaLabelNbreDeparts.Text = "(0)"
        End If

    End Sub

    '-------------------------------------- END DEPART PANEL -------------------------------

    '---------------------------------------------------FACTURATION MANAGEMENT

    '------------------------------------FACTURATION BASED ON THE ARTICLE FAMILY ONLY FOR IN ROOM-----------------------------------------------
    'On ne peut facturer ceux qui sont en chambre
    Private Sub FacturationDesEnChambres()

        If Not GlobalVariable.codeReservationToUpdate = "" Then
            'As we come from the MainCouranteReception 
            Dim clientInRoom As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

            If clientInRoom.Rows.Count > 0 Then
                'We selected the room in reserve_conf hence reservation has been checkedIn
                If clientInRoom.Rows(0)("ETAT_RESERVATION") = 1 Then
                    'We can output the the facturationForm has our reservation is a checked reservation with out checkout
                    FacturationForm.Show()
                End If
            End If

        End If

    End Sub

    'Facturation based on the bar/restaurant (clicked at front desk) family
    Private Sub GunaButtonBar_Click(sender As Object, e As EventArgs) Handles GunaButtonBar.Click

        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "BAR"
        FacturationForm.Show()
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)

    End Sub

    'Facturation based on the bar/restaurant (clicked at front desk) family
    Private Sub GunaButtonRestaurant_Click(sender As Object, e As EventArgs) Handles GunaButtonRestaurant.Click

        GlobalVariable.checkInFacturation = True
        GlobalVariable.ArticleFamily = "RESTAURANT"
        FacturationForm.Show()
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk

    End Sub

    'Facturation based on the services (clicked at front desk) family
    Private Sub GunaButtonServices_Click(sender As Object, e As EventArgs) Handles GunaButtonServices.Click

        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "SERVICES"

        FacturationForm.Show()

    End Sub

    'Facturation based on the salon de beaute (clicked at front desk) family
    Private Sub GunaButtonSalonDeBeaute_Click(sender As Object, e As EventArgs) Handles GunaButtonSalonDeBeaute.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "SALON DE BEAUTE"
        FacturationForm.Show()

    End Sub

    'Facturation based on boutique
    Private Sub GunaButtonBoutique_Click(sender As Object, e As EventArgs) Handles GunaButtonBoutique.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "BOUTIQUE"

        FacturationForm.Show()

    End Sub

    Private Sub GunaButtonCyberCafe_Click(sender As Object, e As EventArgs) Handles GunaButtonBusinessCenter.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "BUSINESS CENTER"

        FacturationForm.Show()

    End Sub

    Private Sub GunaButtonAutres_Click(sender As Object, e As EventArgs) Handles GunaButtonAutres.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "AUTRES"

        FacturationForm.Show()

    End Sub

    Private Sub GunaButtonLoisir_Click(sender As Object, e As EventArgs) Handles GunaButtonLoisir.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "LOISIRS"

        FacturationForm.Show()

    End Sub

    Private Sub GunaButtonKiosque_Click(sender As Object, e As EventArgs) Handles GunaButtonKiosque.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "KIOSQUE A JOURNAUX"

        FacturationForm.Show()
    End Sub

    Private Sub GunaButtonSport_Click(sender As Object, e As EventArgs) Handles GunaButtonSport.Click

        FacturationForm.Close()

        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "SPORTS"

        FacturationForm.Show()

    End Sub

    Private Sub GunaButtonBlanchisserie_Click(sender As Object, e As EventArgs) Handles GunaButtonBlanchisserie.Click

        FacturationForm.Close()

        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "BLANCHISSERIE"

        FacturationForm.Show()
    End Sub

    '---------------------------------- SITUATION DU CLIENT EN DOUBLE CLIQUANT SUR LE SOLDE ----------------------------------

    'When we double click on solde textbox we open SituationClientForm

    Private Sub GunaPanelSolde_DoubleClick(sender As Object, e As EventArgs) Handles GunaPanelSolde.DoubleClick

        SituationClientForm.Close()
        SituationClientForm.Show()
        SituationClientForm.TopMost = True

    End Sub

    Private Sub GunaLabelSolde_DoubleClick(sender As Object, e As EventArgs) Handles GunaLabelSolde.DoubleClick

        SituationClientForm.Close()
        SituationClientForm.Show()
        SituationClientForm.TopMost = True

    End Sub

    '---------------------------------- SITUATION DU CLIENT ----------------------------------

    'Affichage de la famille des article
    Private Sub GunaButton8_Click(sender As Object, e As EventArgs) Handles GunaButtonFamilleArticle.Click

        ArticleFamilyForm.Close()

        GlobalVariable.typeFamilleOuSousFamille = "categorie"

        Dim MainWindow As New MainWindow()
        MainWindow.TabControlHbergement.SelectedIndex = 2
        ArticleFamilyForm.Show()
        ArticleFamilyForm.TopMost = True

    End Sub

    'Affichage des article
    Private Sub GunaButtonArticles_Click(sender As Object, e As EventArgs) Handles GunaButtonArticles.Click

        ArticleForm.Close()

        Dim MainWindow As New MainWindow()
        MainWindow.TabControlHbergement.SelectedIndex = 2
        GlobalVariable.typeArticle = "article"
        ArticleForm.TopMost() = True
        ArticleForm.Show()

    End Sub

    'CHANGEMENT DE LABEL DES DATES POUR CHAQUE TAB-----------------------------------

    'Tab En chambre
    'En cas de changement de date on renomme les labelles pour chaque tab
    Private Sub GunaDateTimePickerDebutEnChambre_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerDebutEnChambre.ValueChanged
        GunaLabel50.Text = GunaDateTimePickerDebutEnChambre.Value.ToShortDateString()
    End Sub

    'Tab Departs
    Private Sub GunaDateTimePickerArriveeDepart_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerArriveeDepart.ValueChanged
        GunaLabelDateDepartFin.Text = GunaDateTimePickerDepartDepert.Value.ToShortDateString()
        GunaLabelDateDepartDebut.Text = GunaDateTimePickerArriveeDepart.Value.ToShortDateString()
    End Sub

    Private Sub GunaDateTimePickerDepartDepert_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerDepartDepert.ValueChanged
        GunaLabelDateDepartFin.Text = GunaDateTimePickerDepartDepert.Value.ToShortDateString()
        GunaLabelDateDepartDebut.Text = GunaDateTimePickerArriveeDepart.Value.ToShortDateString()
    End Sub

    'Tab Attendus
    Private Sub GunaDateTimePickerDebut_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerDebut.ValueChanged
        GunaLabel53.Text = GunaDateTimePickerFin.Value.ToShortDateString()
        GunaLabel54.Text = GunaDateTimePickerDebut.Value.ToShortDateString()
    End Sub

    Private Sub GunaDateTimePickerFin_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerFin.ValueChanged
        GunaLabel53.Text = GunaDateTimePickerFin.Value.ToShortDateString()
        GunaLabel54.Text = GunaDateTimePickerDebut.Value.ToShortDateString()
    End Sub

    '--------------------------------------------------- GESTION DES DATAGRIDS DES ENTENDUS - EN CHAMBRES - DEPARTS ---------------

    '------------------------------------- LOADING OF THE CONTENT OF A TAB INTO THE FRONT DESK ---------------------------------------------
    'EN CHAMBRE GRID
    Private Sub DataGridViewEnChambre_CellContentDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridViewEnChambre.CellDoubleClick

        viderDocumentDatagrids()
        VidageDesChampsPourNouvelleReservation()

        If e.RowIndex >= 0 Then

            If GlobalVariable.actualLanguageValue = 1 Then
                LabelNatureReservation.Text = "EN CHAMBRE"

            Else
                LabelNatureReservation.Text = "IN HOUSE"

            End If

            Dim row As DataGridViewRow

            row = Me.DataGridViewEnChambre.Rows(e.RowIndex)

            GlobalVariable.codeReservationToUpdate = row.Cells("RESERVATION").Value.ToString

            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                'not found in reservation so, we search in reserve
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

                'Variable to print or not checkout button
                GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")
            End If

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION", 0, "ETAT_MAIN_COURANTE")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            Dim ETAT_MAIN_COURANTE As Integer = 0

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION", ETAT_MAIN_COURANTE, "ETAT_MAIN_COURANTE")
            'Dim tableMainCouranteGenerale As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION")

            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", ETAT_MAIN_COURANTE, "ETAT_MAIN_COURANTE")

            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
                mainCouranteJournaliere = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                'GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                'GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                'GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                'GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                ' GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                'GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate

            If GunaRadioButtonSalleFete.Checked Then

                Dim chambrePourType As DataTable
                Dim typeChambre As DataTable

                If GlobalVariable.ChambreToUpdate.Rows.Count > 0 Then
                    typeChambre = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")
                Else
                    chambrePourType = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")
                    If chambrePourType.Rows.Count > 0 Then
                        Dim CODE_TYPE_CHAMBRE As String = chambrePourType.Rows(0)("CODE_TYPE_CHAMBRE")
                        typeChambre = Functions.getElementByCode(CODE_TYPE_CHAMBRE, "type_chambre", "CODE_TYPE_CHAMBRE")
                    End If
                End If

                If Not typeChambre Is Nothing Then

                    If typeChambre.Rows.Count > 0 Then
                        GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                        GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")
                    End If

                End If

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Format(Forfait.Rows(0)("PU_CAFE"), "#,##0")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Format(Forfait.Rows(0)("PU_DEJEUNER"), "#,##0")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Format(Forfait.Rows(0)("PU_DINER"), "#,##0")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Format(Forfait.Rows(0)("PU_TRAITEUR"), "#,##0")
                    GunaTextBoxDecoration.Text = Format(Forfait.Rows(0)("DECORATION"), "#,##0")

                    GunaTextBoxMateriel.Text = Format(Forfait.Rows(0)("LOCATION_MATERIEL"), "#,##0")
                    GunaTextBoxAutres.Text = Format(Forfait.Rows(0)("AUTRES"), "#,##0")

                    GunaComboBoxEvenement.SelectedValue = Forfait.Rows(0)("CODE_EVENEMENT")

                    '------------- addition -----------------------------------------------

                    GunaTextBoxQteGouter.Text = Forfait.Rows(0)("NBRE_GOUTER")
                    GunaTextBoxPrixGouter.Text = Format(Forfait.Rows(0)("PU_GOUTER"), "#,##0")

                    GunaTextBoxCocktail.Text = Format(Forfait.Rows(0)("NBRE_COCKTAIL"), "#,##0")
                    GunaTextBoxPUCocktail.Text = Format(Forfait.Rows(0)("PU_COCKTAIL"), "#,##0")

                    GunaComboBoxHeureCafe.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_CAFE"))
                    GunaComboBoxHeureCafe.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_CAFE")
                    GunaComboBoxHeureDej.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER"))
                    GunaComboBoxHeureDej.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER")
                    GunaComboBoxHeureDiner.Items.Add(Forfait.Rows(0)("HEURE_DINER"))
                    GunaComboBoxHeureDiner.SelectedItem = Forfait.Rows(0)("HEURE_DINER")
                    GunaComboBoxHeureGouter.Items.Add(Forfait.Rows(0)("HEURE_GOUTER"))
                    GunaComboBoxHeureGouter.SelectedItem = Forfait.Rows(0)("HEURE_GOUTER")
                    GunaComboBoxHeureCocktail.Items.Add(Forfait.Rows(0)("HEURE_COCKTAIL"))
                    GunaComboBoxHeureCocktail.SelectedItem = Forfait.Rows(0)("HEURE_COCKTAIL")

                    'QUANTITE

                    GunaTextBox47.Text = Forfait.Rows(0)("EAU_PTE_QTE")
                    GunaTextBox48.Text = Forfait.Rows(0)("BOISSONS_GAZEUSES_QTE")
                    GunaTextBox54.Text = Forfait.Rows(0)("VIN_ROUGE_QTE")
                    GunaTextBox63.Text = Forfait.Rows(0)("VIN_ROSE_QTE")
                    GunaTextBox10.Text = Forfait.Rows(0)("EAU_GRDE_QTE")
                    GunaTextBox50.Text = Forfait.Rows(0)("BIERES_QTE")
                    GunaTextBox36.Text = Forfait.Rows(0)("BOISSONS_EXT_QTE")

                    'MONTANT
                    GunaTextBoxMontantEauPetiteBouteille.Text = Format(Forfait.Rows(0)("EAU_PTE_MONTANT"), "#,##0")
                    GunaTextBox68.Text = Format(Forfait.Rows(0)("EAU_GRDE_MONTANT"), "#,##0")
                    GunaTextBox62.Text = Format(Forfait.Rows(0)("BOISSONS_GAZEUSES_MONTANT"), "#,##0")
                    GunaTextBox61.Text = Format(Forfait.Rows(0)("BIERES_MONTANT"), "#,##0")
                    GunaTextBox59.Text = Format(Forfait.Rows(0)("VIN_ROUGE_MONTANT"), "#,##0")
                    GunaTextBox57.Text = Format(Forfait.Rows(0)("VIN_ROSE_MONTANT"), "#,##0")
                    GunaTextBox64.Text = Format(Forfait.Rows(0)("BOISSONS_EXT_MONTANT"), "#,##0")
                    GunaTextBoxDroitDeBouchon.Text = Format(Forfait.Rows(0)("DROIT_DE_BOUCHON"), "#,##0")

                    If Forfait.Rows(0)("VIDEO_PROJ") = 1 Then
                        GunaCheckBoxVidOui.Checked = True
                        GunaCheckBoxVidNon.Checked = False
                    Else
                        GunaCheckBoxVidNon.Checked = True
                        GunaCheckBoxVidOui.Checked = False
                    End If

                    If Forfait.Rows(0)("SONO") = 1 Then
                        GunaCheckBoxSonoOui.Checked = True
                        GunaCheckBoxSonoNon.Checked = False
                    Else
                        GunaCheckBoxSonoNon.Checked = True
                        GunaCheckBoxSonoOui.Checked = False
                    End If

                    If Forfait.Rows(0)("COUVERTS") = 1 Then
                        GunaCheckBoxCouvOui.Checked = True
                        GunaCheckBoxCouvNon.Checked = False
                    Else
                        GunaCheckBoxCouvNon.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    End If

                    If Forfait.Rows(0)("TABLE_CHAISE") = 1 Then
                        GunaCheckBoxTableOui.Checked = True
                        GunaCheckBoxTableNon.Checked = False
                    Else
                        GunaCheckBoxTableNon.Checked = True
                        GunaCheckBoxTableOui.Checked = False
                    End If

                    If Forfait.Rows(0)("MISE_EN_PLACE") = 1 Then
                        GunaCheckBoxEcole.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 2 Then
                        GunaCheckBoxTheatre.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 3 Then
                        GunaCheckBoxRectangle.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 4 Then
                        GunaCheckBoxCocktail.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 5 Then
                        GunaCheckBoxBanquet.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 0 Then
                        GunaCheckBoxU.Checked = True
                    End If

                    If Forfait.Rows(0)("CLOISONNEMENT") = 2 Then
                        GunaCheckBox2.Checked = True
                    ElseIf Forfait.Rows(0)("CLOISONNEMENT") = 3 Then
                        GunaCheckBox9.Checked = True
                    End If

                End If

            End If

            affectingValuesToFields()

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    'RESERVATION GRID
    Private Sub GunaDataGridViewReservationList_CellDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewReservationList.CellDoubleClick

        viderDocumentDatagrids()
        VidageDesChampsPourNouvelleReservation()

        If e.RowIndex >= 0 Then

            LabelNatureReservation.Visible = True

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewReservationList.Rows(e.RowIndex)

            GlobalVariable.codeReservationToUpdate = row.Cells("RESERVATION").Value.ToString

            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                'not found in reservation so, we search in reserve_conf
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

                'GESTION DES ETATS DE RESERVATIONS CONFIRMEE
                If GlobalVariable.ReservationToUpdate.Rows(0)("ETAT_RESERVATION") = 1 Then
                    If GlobalVariable.typeChambreOuSalle = "chambre" Then
                        If GlobalVariable.actualLanguageValue = 1 Then
                            LabelNatureReservation.Text = "EN CHAMBRE"

                        Else
                            LabelNatureReservation.Text = "IN HOUSE"

                        End If
                    ElseIf GlobalVariable.typeChambreOuSalle = "salle" Then

                        If GlobalVariable.actualLanguageValue = 1 Then
                            LabelNatureReservation.Text = "EN SALLE"
                        Else
                            LabelNatureReservation.Text = "IN HALL"
                        End If
                    End If
                Else
                    LabelNatureReservation.Text = "CHECKOUT"

                End If

            Else

                'GESTION DES ETATS DE RESERVATIONS
                If GlobalVariable.ReservationToUpdate.Rows(0)("ETAT_RESERVATION") = 0 Then
                    If GlobalVariable.actualLanguageValue = 1 Then
                        LabelNatureReservation.Text = "ATTENDUES"

                    Else
                        LabelNatureReservation.Text = "EXPECTED"

                    End If
                Else

                    If GlobalVariable.actualLanguageValue = 1 Then
                        LabelNatureReservation.Text = "ANNULEE"

                    Else
                        LabelNatureReservation.Text = "CANCELED"

                    End If
                End If

            End If

            'Variable to print or not checkout button
            GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")

            'MessageBox.Show(GlobalVariable.codeClientToUpdate & " - " & GlobalVariable.codeReservationToUpdate & "-" & GlobalVariable.ReservationToUpdate(0)("CLIENT_ID"))
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION", 0, "ETAT_MAIN_COURANTE")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")

            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            'Dim tableMainCouranteJournaliere As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")

            Dim tableMainCouranteJournaliere As DataTable

            'ON DOIT PRENDRE LA MAINCOURANTE SELON L'ETAT DE LA RESERVATION EN CE QUI CONCERNE LA LISTE DE TOUTES LES RESERVATIONS

            'MessageBox.Show(LabelNatureReservation.Text & " " & GlobalVariable.codeReservationToUpdate & " YES")

            If Trim(LabelNatureReservation.Text) = "CHECKOUT" Then
                tableMainCouranteJournaliere = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 1, "ETAT_MAIN_COURANTE")
            ElseIf Trim(LabelNatureReservation.Text) = "EN CHAMBRE" Or LabelNatureReservation.Text = "EN SALLE" Or Trim(LabelNatureReservation.Text) = "IN HOUSE" Or LabelNatureReservation.Text = "IN HALL" Then
                tableMainCouranteJournaliere = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")
            ElseIf Trim(LabelNatureReservation.Text) = "ANNULEE" Or Trim(LabelNatureReservation.Text) = "CANCELED" Then
                tableMainCouranteJournaliere = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 2, "ETAT_MAIN_COURANTE")
            ElseIf Trim(LabelNatureReservation.Text) = "ATTENDUES" Or Trim(LabelNatureReservation.Text) = "EXPECTED" Then
                tableMainCouranteJournaliere = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")
            Else
                'GESTION DES DAY USE
                tableMainCouranteJournaliere = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 1, "ETAT_MAIN_COURANTE")
            End If

            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
                mainCouranteJournaliere = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate

            If GunaRadioButtonSalleFete.Checked Then

                Dim chambrePourType As DataTable
                Dim typeChambre As DataTable

                If GlobalVariable.ChambreToUpdate.Rows.Count > 0 Then
                    typeChambre = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")
                Else
                    chambrePourType = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")
                    If chambrePourType.Rows.Count > 0 Then
                        Dim CODE_TYPE_CHAMBRE As String = chambrePourType.Rows(0)("CODE_TYPE_CHAMBRE")
                        typeChambre = Functions.getElementByCode(CODE_TYPE_CHAMBRE, "type_chambre", "CODE_TYPE_CHAMBRE")
                    End If
                End If

                If Not typeChambre Is Nothing Then

                    If typeChambre.Rows.Count > 0 Then
                        GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                        GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")
                    End If

                End If

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                    GunaTextBoxMateriel.Text = Format(Forfait.Rows(0)("LOCATION_MATERIEL"), "#,##0")
                    GunaTextBoxAutres.Text = Format(Forfait.Rows(0)("AUTRES"), "#,##0")

                    GunaComboBoxEvenement.SelectedValue = Forfait.Rows(0)("CODE_EVENEMENT")


                    '------------- addition -----------------------------------------------

                    GunaTextBoxQteGouter.Text = Forfait.Rows(0)("NBRE_GOUTER")
                    GunaTextBoxPrixGouter.Text = Format(Forfait.Rows(0)("PU_GOUTER"), "#,##0")

                    GunaTextBoxCocktail.Text = Format(Forfait.Rows(0)("NBRE_COCKTAIL"), "#,##0")
                    GunaTextBoxPUCocktail.Text = Format(Forfait.Rows(0)("PU_COCKTAIL"), "#,##0")

                    GunaComboBoxHeureCafe.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_CAFE"))
                    GunaComboBoxHeureCafe.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_CAFE")
                    GunaComboBoxHeureDej.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER"))
                    GunaComboBoxHeureDej.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER")
                    GunaComboBoxHeureDiner.Items.Add(Forfait.Rows(0)("HEURE_DINER"))
                    GunaComboBoxHeureDiner.SelectedItem = Forfait.Rows(0)("HEURE_DINER")
                    GunaComboBoxHeureGouter.Items.Add(Forfait.Rows(0)("HEURE_GOUTER"))
                    GunaComboBoxHeureGouter.SelectedItem = Forfait.Rows(0)("HEURE_GOUTER")
                    GunaComboBoxHeureCocktail.Items.Add(Forfait.Rows(0)("HEURE_COCKTAIL"))
                    GunaComboBoxHeureCocktail.SelectedItem = Forfait.Rows(0)("HEURE_COCKTAIL")

                    'QUANTITE

                    GunaTextBox47.Text = Forfait.Rows(0)("EAU_PTE_QTE")
                    GunaTextBox48.Text = Forfait.Rows(0)("BOISSONS_GAZEUSES_QTE")
                    GunaTextBox54.Text = Forfait.Rows(0)("VIN_ROUGE_QTE")
                    GunaTextBox63.Text = Forfait.Rows(0)("VIN_ROSE_QTE")
                    GunaTextBox10.Text = Forfait.Rows(0)("EAU_GRDE_QTE")
                    GunaTextBox50.Text = Forfait.Rows(0)("BIERES_QTE")
                    GunaTextBox36.Text = Forfait.Rows(0)("BOISSONS_EXT_QTE")

                    'MONTANT
                    GunaTextBoxMontantEauPetiteBouteille.Text = Format(Forfait.Rows(0)("EAU_PTE_MONTANT"), "#,##0")
                    GunaTextBox68.Text = Format(Forfait.Rows(0)("EAU_GRDE_MONTANT"), "#,##0")
                    GunaTextBox62.Text = Format(Forfait.Rows(0)("BOISSONS_GAZEUSES_MONTANT"), "#,##0")
                    GunaTextBox61.Text = Format(Forfait.Rows(0)("BIERES_MONTANT"), "#,##0")
                    GunaTextBox59.Text = Format(Forfait.Rows(0)("VIN_ROUGE_MONTANT"), "#,##0")
                    GunaTextBox57.Text = Format(Forfait.Rows(0)("VIN_ROSE_MONTANT"), "#,##0")
                    GunaTextBox64.Text = Format(Forfait.Rows(0)("BOISSONS_EXT_MONTANT"), "#,##0")
                    GunaTextBoxDroitDeBouchon.Text = Format(Forfait.Rows(0)("DROIT_DE_BOUCHON"), "#,##0")

                    If Forfait.Rows(0)("VIDEO_PROJ") = 1 Then
                        GunaCheckBoxVidOui.Checked = True
                        GunaCheckBoxVidNon.Checked = False
                    Else
                        GunaCheckBoxVidNon.Checked = True
                        GunaCheckBoxVidOui.Checked = False
                    End If

                    If Forfait.Rows(0)("SONO") = 1 Then
                        GunaCheckBoxSonoOui.Checked = True
                        GunaCheckBoxSonoNon.Checked = False
                    Else
                        GunaCheckBoxSonoNon.Checked = True
                        GunaCheckBoxSonoOui.Checked = False
                    End If

                    If Forfait.Rows(0)("COUVERTS") = 1 Then
                        GunaCheckBoxCouvOui.Checked = True
                        GunaCheckBoxCouvNon.Checked = False
                    Else
                        GunaCheckBoxCouvNon.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    End If

                    If Forfait.Rows(0)("TABLE_CHAISE") = 1 Then
                        GunaCheckBoxTableOui.Checked = True
                        GunaCheckBoxTableNon.Checked = False
                    Else
                        GunaCheckBoxTableNon.Checked = True
                        GunaCheckBoxTableOui.Checked = False
                    End If

                    If Forfait.Rows(0)("MISE_EN_PLACE") = 1 Then
                        GunaCheckBoxEcole.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 2 Then
                        GunaCheckBoxTheatre.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 3 Then
                        GunaCheckBoxRectangle.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 4 Then
                        GunaCheckBoxCocktail.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 5 Then
                        GunaCheckBoxBanquet.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 0 Then
                        GunaCheckBoxU.Checked = True
                    End If

                    If Forfait.Rows(0)("CLOISONNEMENT") = 2 Then
                        GunaCheckBox2.Checked = True
                    ElseIf Forfait.Rows(0)("CLOISONNEMENT") = 3 Then
                        GunaCheckBox9.Checked = True
                    End If

                End If

            End If

            GunaDataGridViewRoomType.Visible = False

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            'TabControlHbergement.SelectedIndex = 0

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

            affectingValuesToFields()
            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    'ATTENDUS GRID
    Private Sub DataGridViewAttenduPanel_CellContentClick(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridViewAttenduPanel.CellDoubleClick

        viderDocumentDatagrids()
        VidageDesChampsPourNouvelleReservation()

        If e.RowIndex >= 0 Then


            If GlobalVariable.actualLanguageValue = 1 Then
                LabelNatureReservation.Text = "ATTENDUE"

            Else
                LabelNatureReservation.Text = "EXPECTED"

            End If

            Dim row As DataGridViewRow

            row = Me.DataGridViewAttenduPanel.Rows(e.RowIndex)

            GlobalVariable.codeReservationToUpdate = row.Cells("RESERVATION").Value.ToString


            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                'not found in reservation so, we search in reserve_conf
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

            End If

            'Variable to print or not checkout button
            GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION", 0, "ETAT_MAIN_COURANTE")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")

            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")

            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
                mainCouranteJournaliere = tableMainCouranteJournaliere

            Else

                GlobalVariable.codeMainCouranteJournaliereToUpdate = ""
                GlobalVariable.MainCouranteJournaliereToUpdate = Nothing
                mainCouranteJournaliere = Nothing

            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate


            If GunaRadioButtonSalleFete.Checked Then

                Dim chambrePourType As DataTable
                Dim typeChambre As DataTable

                If GlobalVariable.ChambreToUpdate.Rows.Count > 0 Then
                    typeChambre = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")
                Else
                    chambrePourType = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")
                    If chambrePourType.Rows.Count > 0 Then
                        Dim CODE_TYPE_CHAMBRE As String = chambrePourType.Rows(0)("CODE_TYPE_CHAMBRE")
                        typeChambre = Functions.getElementByCode(CODE_TYPE_CHAMBRE, "type_chambre", "CODE_TYPE_CHAMBRE")
                    End If
                End If

                If Not typeChambre Is Nothing Then

                    If typeChambre.Rows.Count > 0 Then
                        GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                        GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")
                    End If

                End If

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                    GunaTextBoxMateriel.Text = Format(Forfait.Rows(0)("LOCATION_MATERIEL"), "#,##0")
                    GunaTextBoxAutres.Text = Format(Forfait.Rows(0)("AUTRES"), "#,##0")

                    GunaComboBoxEvenement.SelectedValue = Forfait.Rows(0)("CODE_EVENEMENT")


                    '------------- addition -----------------------------------------------

                    GunaTextBoxQteGouter.Text = Forfait.Rows(0)("NBRE_GOUTER")
                    GunaTextBoxPrixGouter.Text = Format(Forfait.Rows(0)("PU_GOUTER"), "#,##0")

                    GunaTextBoxCocktail.Text = Format(Forfait.Rows(0)("NBRE_COCKTAIL"), "#,##0")
                    GunaTextBoxPUCocktail.Text = Format(Forfait.Rows(0)("PU_COCKTAIL"), "#,##0")

                    GunaComboBoxHeureCafe.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_CAFE"))
                    GunaComboBoxHeureCafe.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_CAFE")
                    GunaComboBoxHeureDej.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER"))
                    GunaComboBoxHeureDej.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER")
                    GunaComboBoxHeureDiner.Items.Add(Forfait.Rows(0)("HEURE_DINER"))
                    GunaComboBoxHeureDiner.SelectedItem = Forfait.Rows(0)("HEURE_DINER")
                    GunaComboBoxHeureGouter.Items.Add(Forfait.Rows(0)("HEURE_GOUTER"))
                    GunaComboBoxHeureGouter.SelectedItem = Forfait.Rows(0)("HEURE_GOUTER")
                    GunaComboBoxHeureCocktail.Items.Add(Forfait.Rows(0)("HEURE_COCKTAIL"))
                    GunaComboBoxHeureCocktail.SelectedItem = Forfait.Rows(0)("HEURE_COCKTAIL")

                    'QUANTITE

                    GunaTextBox47.Text = Forfait.Rows(0)("EAU_PTE_QTE")
                    GunaTextBox48.Text = Forfait.Rows(0)("BOISSONS_GAZEUSES_QTE")
                    GunaTextBox54.Text = Forfait.Rows(0)("VIN_ROUGE_QTE")
                    GunaTextBox63.Text = Forfait.Rows(0)("VIN_ROSE_QTE")
                    GunaTextBox10.Text = Forfait.Rows(0)("EAU_GRDE_QTE")
                    GunaTextBox50.Text = Forfait.Rows(0)("BIERES_QTE")
                    GunaTextBox36.Text = Forfait.Rows(0)("BOISSONS_EXT_QTE")

                    'MONTANT
                    GunaTextBoxMontantEauPetiteBouteille.Text = Format(Forfait.Rows(0)("EAU_PTE_MONTANT"), "#,##0")
                    GunaTextBox68.Text = Format(Forfait.Rows(0)("EAU_GRDE_MONTANT"), "#,##0")
                    GunaTextBox62.Text = Format(Forfait.Rows(0)("BOISSONS_GAZEUSES_MONTANT"), "#,##0")
                    GunaTextBox61.Text = Format(Forfait.Rows(0)("BIERES_MONTANT"), "#,##0")
                    GunaTextBox59.Text = Format(Forfait.Rows(0)("VIN_ROUGE_MONTANT"), "#,##0")
                    GunaTextBox57.Text = Format(Forfait.Rows(0)("VIN_ROSE_MONTANT"), "#,##0")
                    GunaTextBox64.Text = Format(Forfait.Rows(0)("BOISSONS_EXT_MONTANT"), "#,##0")
                    GunaTextBoxDroitDeBouchon.Text = Format(Forfait.Rows(0)("DROIT_DE_BOUCHON"), "#,##0")

                    If Forfait.Rows(0)("VIDEO_PROJ") = 1 Then
                        GunaCheckBoxVidOui.Checked = True
                        GunaCheckBoxVidNon.Checked = False
                    Else
                        GunaCheckBoxVidNon.Checked = True
                        GunaCheckBoxVidOui.Checked = False
                    End If

                    If Forfait.Rows(0)("SONO") = 1 Then
                        GunaCheckBoxSonoOui.Checked = True
                        GunaCheckBoxSonoNon.Checked = False
                    Else
                        GunaCheckBoxSonoNon.Checked = True
                        GunaCheckBoxSonoOui.Checked = False
                    End If

                    If Forfait.Rows(0)("COUVERTS") = 1 Then
                        GunaCheckBoxCouvOui.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    Else
                        GunaCheckBoxCouvNon.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    End If

                    If Forfait.Rows(0)("TABLE_CHAISE") = 1 Then
                        GunaCheckBoxTableOui.Checked = True
                        GunaCheckBoxTableNon.Checked = False
                    Else
                        GunaCheckBoxTableNon.Checked = True
                        GunaCheckBoxTableOui.Checked = False
                    End If

                    If Forfait.Rows(0)("MISE_EN_PLACE") = 1 Then
                        GunaCheckBoxEcole.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 2 Then
                        GunaCheckBoxTheatre.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 3 Then
                        GunaCheckBoxRectangle.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 4 Then
                        GunaCheckBoxCocktail.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 5 Then
                        GunaCheckBoxBanquet.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 0 Then
                        GunaCheckBoxU.Checked = True
                    End If

                    If Forfait.Rows(0)("CLOISONNEMENT") = 2 Then
                        GunaCheckBox2.Checked = True
                    ElseIf Forfait.Rows(0)("CLOISONNEMENT") = 3 Then
                        GunaCheckBox9.Checked = True
                    End If

                End If

            End If

            'Affecting values mostly for calculations
            affectingValuesToFields()

            GunaDataGridViewRoomType.Visible = False

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            TabControlHbergement.SelectedIndex = 0

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    'DEPART GRID
    Private Sub DataGridViewDepartTab_CellDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridViewDepartTab.CellDoubleClick

        viderDocumentDatagrids()
        VidageDesChampsPourNouvelleReservation()

        If e.RowIndex >= 0 Then

            If GlobalVariable.actualLanguageValue = 1 Then
                LabelNatureReservation.Text = "EN CHAMBRE"
            Else
                LabelNatureReservation.Text = "IN HOUSE"
            End If

            Dim row As DataGridViewRow

            row = Me.DataGridViewDepartTab.Rows(e.RowIndex)

            GlobalVariable.codeReservationToUpdate = Trim(row.Cells("RESERVATION").Value.ToString)

            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                'not found in reservation so, we search in reserve
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

                'Variable to print or not checkout button
                GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")
            End If

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION", 0, "ETAT_MAIN_COURANTE")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")

            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")

            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
                mainCouranteJournaliere = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate

            If GunaRadioButtonSalleFete.Checked Then

                Dim chambrePourType As DataTable
                Dim typeChambre As DataTable

                If GlobalVariable.ChambreToUpdate.Rows.Count > 0 Then
                    typeChambre = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")
                Else
                    chambrePourType = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")
                    If chambrePourType.Rows.Count > 0 Then
                        Dim CODE_TYPE_CHAMBRE As String = chambrePourType.Rows(0)("CODE_TYPE_CHAMBRE")
                        typeChambre = Functions.getElementByCode(CODE_TYPE_CHAMBRE, "type_chambre", "CODE_TYPE_CHAMBRE")
                    End If
                End If

                If Not typeChambre Is Nothing Then

                    If typeChambre.Rows.Count > 0 Then
                        GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                        GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")
                    End If

                End If

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                    GunaTextBoxMateriel.Text = Format(Forfait.Rows(0)("LOCATION_MATERIEL"), "#,##0")
                    GunaTextBoxAutres.Text = Format(Forfait.Rows(0)("AUTRES"), "#,##0")

                    GunaComboBoxEvenement.SelectedValue = Forfait.Rows(0)("CODE_EVENEMENT")

                    '------------- addition -----------------------------------------------

                    GunaTextBoxQteGouter.Text = Forfait.Rows(0)("NBRE_GOUTER")
                    GunaTextBoxPrixGouter.Text = Format(Forfait.Rows(0)("PU_GOUTER"), "#,##0")

                    GunaTextBoxCocktail.Text = Format(Forfait.Rows(0)("NBRE_COCKTAIL"), "#,##0")
                    GunaTextBoxPUCocktail.Text = Format(Forfait.Rows(0)("PU_COCKTAIL"), "#,##0")

                    GunaComboBoxHeureCafe.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_CAFE"))
                    GunaComboBoxHeureCafe.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_CAFE")
                    GunaComboBoxHeureDej.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER"))
                    GunaComboBoxHeureDej.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER")
                    GunaComboBoxHeureDiner.Items.Add(Forfait.Rows(0)("HEURE_DINER"))
                    GunaComboBoxHeureDiner.SelectedItem = Forfait.Rows(0)("HEURE_DINER")
                    GunaComboBoxHeureGouter.Items.Add(Forfait.Rows(0)("HEURE_GOUTER"))
                    GunaComboBoxHeureGouter.SelectedItem = Forfait.Rows(0)("HEURE_GOUTER")
                    GunaComboBoxHeureCocktail.Items.Add(Forfait.Rows(0)("HEURE_COCKTAIL"))
                    GunaComboBoxHeureCocktail.SelectedItem = Forfait.Rows(0)("HEURE_COCKTAIL")

                    'QUANTITE

                    GunaTextBox47.Text = Forfait.Rows(0)("EAU_PTE_QTE")
                    GunaTextBox48.Text = Forfait.Rows(0)("BOISSONS_GAZEUSES_QTE")
                    GunaTextBox54.Text = Forfait.Rows(0)("VIN_ROUGE_QTE")
                    GunaTextBox63.Text = Forfait.Rows(0)("VIN_ROSE_QTE")
                    GunaTextBox10.Text = Forfait.Rows(0)("EAU_GRDE_QTE")
                    GunaTextBox50.Text = Forfait.Rows(0)("BIERES_QTE")
                    GunaTextBox36.Text = Forfait.Rows(0)("BOISSONS_EXT_QTE")

                    'MONTANT
                    GunaTextBoxMontantEauPetiteBouteille.Text = Format(Forfait.Rows(0)("EAU_PTE_MONTANT"), "#,##0")
                    GunaTextBox68.Text = Format(Forfait.Rows(0)("EAU_GRDE_MONTANT"), "#,##0")
                    GunaTextBox62.Text = Format(Forfait.Rows(0)("BOISSONS_GAZEUSES_MONTANT"), "#,##0")
                    GunaTextBox61.Text = Format(Forfait.Rows(0)("BIERES_MONTANT"), "#,##0")
                    GunaTextBox59.Text = Format(Forfait.Rows(0)("VIN_ROUGE_MONTANT"), "#,##0")
                    GunaTextBox57.Text = Format(Forfait.Rows(0)("VIN_ROSE_MONTANT"), "#,##0")
                    GunaTextBox64.Text = Format(Forfait.Rows(0)("BOISSONS_EXT_MONTANT"), "#,##0")
                    GunaTextBoxDroitDeBouchon.Text = Format(Forfait.Rows(0)("DROIT_DE_BOUCHON"), "#,##0")

                    If Forfait.Rows(0)("VIDEO_PROJ") = 1 Then
                        GunaCheckBoxVidOui.Checked = True
                        GunaCheckBoxVidNon.Checked = False
                    Else
                        GunaCheckBoxVidNon.Checked = True
                        GunaCheckBoxVidOui.Checked = False
                    End If

                    If Forfait.Rows(0)("SONO") = 1 Then
                        GunaCheckBoxSonoOui.Checked = True
                        GunaCheckBoxSonoNon.Checked = False
                    Else
                        GunaCheckBoxSonoNon.Checked = True
                        GunaCheckBoxSonoOui.Checked = False
                    End If

                    If Forfait.Rows(0)("COUVERTS") = 1 Then
                        GunaCheckBoxCouvOui.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    Else
                        GunaCheckBoxCouvNon.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    End If

                    If Forfait.Rows(0)("TABLE_CHAISE") = 1 Then
                        GunaCheckBoxTableOui.Checked = True
                        GunaCheckBoxTableNon.Checked = False
                    Else
                        GunaCheckBoxTableNon.Checked = True
                        GunaCheckBoxTableOui.Checked = False
                    End If

                    If Forfait.Rows(0)("MISE_EN_PLACE") = 1 Then
                        GunaCheckBoxEcole.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 2 Then
                        GunaCheckBoxTheatre.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 3 Then
                        GunaCheckBoxRectangle.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 4 Then
                        GunaCheckBoxCocktail.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 5 Then
                        GunaCheckBoxBanquet.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 0 Then
                        GunaCheckBoxU.Checked = True
                    End If

                    If Forfait.Rows(0)("CLOISONNEMENT") = 2 Then
                        GunaCheckBox2.Checked = True
                    ElseIf Forfait.Rows(0)("CLOISONNEMENT") = 3 Then
                        GunaCheckBox9.Checked = True
                    End If

                End If

            End If

            affectingValuesToFields()

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False
            'We hide all the Datagrid used for custom filling

            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    '--------------------------------------------------- END GESTION DES ENTENDUS - EN CHAMBRES - DEPARTS ---------------

    '--------------------------------------------- PLANNING PANNEL MANEGEMNT ----------------------------------------------

    Dim dateEntree As Date
    Dim dateDeSortie As Date
    Dim codeChambreSelectionnee As String
    Dim firstCell As Boolean = True
    Dim secondCell As Boolean = True

    'Coordinate of the selected cells OnMouseUp and OnMouseDown
    Dim m As Integer
    Dim r As Integer
    Dim n As Integer
    Dim s As Integer

    'Coordinates of the first and last cell
    Dim DisplayPoint1 As Point
    Dim DisplayPoint2 As Point

    'Used to dtermine the lenght of the selected cells
    Dim numberOfCellsSelected As Integer = 0
    Dim widthOfSelectedCells As Integer = 0

    Dim heightOfCells As Integer = 0

    Public Sub planningReservation(ByVal DateDebut As Date, DateFin As Date)

        GunaDataGridViewPlanning.Columns.Clear()

        legendeEnCodificationColour(DateDebut, DateFin)

        '0- ON SELECTIONNE CHAQUE CHAMBRE

        Dim existQuery As String = "SELECT * From chambre WHERE TYPE=@TYPE AND ETAT_CHAMBRE_NOTE NOT IN ('Hors service') ORDER BY CODE_CHAMBRE ASC"

        Dim command As New MySqlCommand(existQuery, GlobalVariable.connect)

        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

        Dim adapter As New MySqlDataAdapter(command)
        Dim chambre As New DataTable()
        adapter.Fill(chambre)

        Dim dateDuJour As Date = GlobalVariable.DateDeTravail.ToShortDateString()

        Dim nombreDeJour As Integer = DateDiff(DateInterval.Day, DateDebut, DateFin)

        If chambre.Rows.Count > 0 Then

            GunaDataGridViewPlanning.Columns.Add("CHAMBRE", "CHAMBRE")
            GunaDataGridViewPlanning.Columns.Add("ETAT", "ETAT")

            For k = 0 To nombreDeJour
                '1- ON AFFICHE LES DATES DU JOURS
                GunaDataGridViewPlanning.Columns.Add(DateDebut.AddDays(k).ToString("ddd d MMM"), DateDebut.AddDays(k).ToString("ddd d MMM"))
                'GunaDataGridViewPlanning.Columns.Item(DateDebut.AddDays(2).ToString("ddd d MMM")).Width = 500
                GunaDataGridViewPlanning.Columns(k + 2).Width = 300
            Next

            'VARIABLE UTILISEE POUR DETERMINER LES LIGNES DE DONNEES A AFFICHER
            Dim j As Integer = 0

            Dim n = 6 'NOMBRE DE LIGNE SANS TARIFICATIONS POUR CHAQUE TYPE DE CHAMBRE
            Dim t = 0 'NOMBRE DE TARIFICATION ASSOCIE A UN TYPE DE CHAMBRE

            'GunaDataGridViewPlanning.Rows.Add("", "")

            For i = 0 To chambre.Rows.Count - 1

                GunaDataGridViewPlanning.Rows.Add(chambre.Rows(i)("CODE_CHAMBRE"), chambre.Rows(i)("ETAT_CHAMBRE_NOTE"))

                GunaDataGridViewPlanning.Columns("CHAMBRE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
                'GunaDataGridViewPlanning.Columns("CHAMBRE").DefaultCellStyle.BackColor = Color.Indigo
                GunaDataGridViewPlanning.Rows(i).Height = 20

            Next

            GunaDataGridViewPlanning.Columns("CHAMBRE").Frozen = True
            GunaDataGridViewPlanning.Columns("ETAT").Frozen = True

        End If

        'REMPLISAGE DU CONTENU DU TABLEAU

        Dim query01 As String = "SELECT * FROM reserve_conf WHERE DATE_ENTTRE <= '" & dateDuJour.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & dateDuJour.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command01 As New MySqlCommand(query01, GlobalVariable.connect)
        command01.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

        Dim adapter01 As New MySqlDataAdapter(command01)
        Dim enChambre As New DataTable()
        adapter01.Fill(enChambre)

        Dim query02 As String = "SELECT * FROM reservation WHERE DATE_ENTTRE <= '" & dateDuJour.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & dateDuJour.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 0 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command02 As New MySqlCommand(query02, GlobalVariable.connect)
        command02.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
        command02.Parameters.Add("@DAY_USE", MySqlDbType.Int64).Value = 0 ' ON NE TRAITE PAS LES DAY USE

        Dim adapter02 As New MySqlDataAdapter(command02)
        Dim resa As New DataTable()
        adapter02.Fill(resa)

        enChambre.Merge(resa)

        Dim dureeDuSejours As Integer = 0
        Dim valeurDateDebutResa As Date
        Dim valeurDateFinResa As Date

        Dim DateEntree As Date
        Dim DateDepart As Date

        Dim chambreResa As String = ""

        Dim rowIndex As Integer = 0

        Dim colIndexDebut As Integer = 0
        Dim colIndexFin As Integer = 0

        Dim CODE_RESERVATION As String = ""

        Dim resaColor As Color
        Dim resaForeColor As Color

        If enChambre.Rows.Count > 0 Then

            For i = 0 To enChambre.Rows.Count - 1

                colIndexDebut = 0
                colIndexFin = 0

                '* ON DOIT DETERMINER SI IL S'AGIT D'UN EN CHAMBRE OU D'UNE RESERVATION 

                '----------------------------------------------------------------------------------------------------------------------------
                'WORKING SMOOTHLY
                CODE_RESERVATION = enChambre.Rows(i)("CODE_RESERVATION")


                Dim colorString As String = ""
                Dim colorForeString As String = ""

                Dim infoSupSourceResa As DataTable = Functions.getElementByCode(enChambre.Rows(i)("SOURCE_RESERVATION"), "source_reservation", "CODE_SOURCE_RESERVATION")

                If infoSupSourceResa.Rows.Count > 0 Then

                    colorString = infoSupSourceResa.Rows(0)("COULEUR")
                    colorForeString = infoSupSourceResa.Rows(0)("COULEUR_FONT")


                    Dim paramCouleur() As String

                    'Dim resaColor As Color

                    paramCouleur = Functions.returningColorFromString(colorString)

                    If paramCouleur(1).Equals("") Then
                        resaColor = Color.FromName(paramCouleur(0))
                    Else
                        resaColor = Color.FromArgb(Integer.Parse(paramCouleur(0)), Integer.Parse(paramCouleur(1)), Integer.Parse(paramCouleur(2)), Integer.Parse(paramCouleur(3)))
                    End If

                    If Trim(colorForeString.ToString).Equals("") Then
                        resaForeColor = Color.FromArgb(255, 64, 0, 128)
                    Else

                        paramCouleur = Functions.returningColorFromString(colorForeString)

                        If paramCouleur(1).Equals("") Then
                            resaForeColor = Color.FromName(paramCouleur(0))
                        Else
                            resaForeColor = Color.FromArgb(Integer.Parse(paramCouleur(0)), Integer.Parse(paramCouleur(1)), Integer.Parse(paramCouleur(2)), Integer.Parse(paramCouleur(3)))
                        End If

                    End If
                Else

                    Dim infoSupResa As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reservation", "CODE_RESERVATION")

                    If infoSupResa.Rows.Count > 0 Then
                        resaColor = Color.Green
                    Else
                        resaColor = Color.Crimson
                    End If

                End If

                '-----------------------------------------------------------------------------------------------------------------------------

                '* POUR CHAQUE RESERVATION ON DOIT DETERMINER LA DATE D'ENTREE ET LA DATE DE SORTIE ET FAIRE UN TRAITEMENT CONSEQUENT *'.

                '1- ON DETERMINE LA DUREER DU SEJOUR
                DateEntree = CDate(enChambre.Rows(i)("DATE_ENTTRE")).ToShortDateString
                DateDepart = CDate(enChambre.Rows(i)("DATE_SORTIE")).ToShortDateString

                dureeDuSejours = DateDiff(DateInterval.Day, DateEntree, DateDepart)

                '2- ON DETARMINE LES DATES D'UNE RESA A AFFICHER PAR APPORT AU EXTREMUM DE L'AFFICHAGE 

                '2.1- ON FAIT UNE COMPARAISON ENTRE LA PREMIERE DATE AFFICHABLE ET LA DATE D'ENTREE D'UNE PART
                valeurDateDebutResa = CDate(comparaisonDeDatePourPositionnementEntree(DateDebut, DateEntree)).ToShortDateString

                '2.2- ET D'AUTRE PART ENTRE LA DERNIERE DATE AFFICHABLE ET LA DATE DE DEPART
                valeurDateFinResa = CDate(comparaisonDeDatePourPositionnementSortie(DateFin, DateDepart)).ToShortDateString

                '3- ON DOIT DETERMINER LES COORDONNEES DES CELLULES DE DEPART ET D'ARRIVER POUR LA RESERVATION (COLONNE ET RANGEE)

                '3.1- RANGEE: DETERMINONS LA RANGEE A PARTIR DU NUMERO DE CHAMBRE
                chambreResa = enChambre.Rows(i)("CHAMBRE_ID")

                For j = 0 To GunaDataGridViewPlanning.Rows.Count - 1

                    'ON NE TRAITE PAS LES CELLULES VIDES
                    If Not Trim(GunaDataGridViewPlanning.Rows(j).Cells(0).Value.ToString).Equals("") Then

                        If Trim(chambreResa) = Trim(GunaDataGridViewPlanning.Rows(j).Cells(0).Value.ToString) Then
                            rowIndex = j
                            Exit For
                        End If

                    End If

                Next

                '3.2- COLONNE: DETERMINONS LES COLONNES DE DEPART ET D'ARRIVEE

                For k = 0 To nombreDeJour

                    If DateDebut.AddDays(k).ToString("yyyy-MM-dd") = valeurDateDebutResa.ToString("yyyy-MM-dd") Then
                        colIndexDebut = k
                    End If

                    If DateDebut.AddDays(k).ToString("yyyy-MM-dd") = valeurDateFinResa.ToString("yyyy-MM-dd") Then
                        colIndexFin = k
                        Exit For
                    End If

                Next

                'SI LE DATE DE SORTIE EST EN DEHORS DU NOMBRE DE JOUR ALORS (colIndexFin = 0 car k = 0)

                If colIndexFin = 0 Then

                    If DateDebut.ToString("yyyy-MM-dd") <= valeurDateDebutResa.ToString("yyyy-MM-dd") Then
                        'colIndexFin = 0
                    ElseIf DateFin.ToString("yyyy-MM-dd") <= valeurDateFinResa.ToString("yyyy-MM-dd") Then
                        colIndexFin = nombreDeJour
                    End If

                End If

                colIndexDebut += 2 'ON AJOUTE 2 CAR L'AFFICAGE DES COLONNES COMMENCE APRES LE SAUT DE DEUX COLONNES

                colIndexFin += 2 'ON AJOUTE 2 CAR L'AFFICAGE DES COLONNES COMMENCE APRES LE SAUT DE DEUX COLONNES

                'CELLULE DE DEPART : (rowIndex, colIndexDebut)
                'GunaDataGridViewPlanning.Rows(rowIndex).Cells(6 + i).Selected = True

                GunaDataGridViewPlanning.Rows(rowIndex).Cells(colIndexDebut).Style.BackColor = resaColor

                'GunaDataGridViewPlanning.Rows(rowIndex).Cells(colIndexDebut).Value = valeurDateDebutResa.ToShortDateString

                'CELLULE DE FIN : (rowIndex, colIndexFin)
                'GunaDataGridViewPlanning.Rows(rowIndex).Cells(colIndexFin).Selected = True

                GunaDataGridViewPlanning.Rows(rowIndex).Cells(colIndexFin).Style.BackColor = resaColor

                'GunaDataGridViewPlanning.Rows(rowIndex).Cells(colIndexFin).Value = colIndexFin
                'GunaDataGridViewPlanning.Rows(rowIndex).Cells(colIndexFin).Value = valeurDateFinResa.ToShortDateString

                numberOfCellsSelected = 0

                Dim clientInfo As DataTable = Functions.getElementByCode(enChambre.Rows(i)("CLIENT_ID"), "client", "CODE_CLIENT")

                Dim NOM_CLIENT As String = ""
                Dim SOLDE As Double = 0

                If clientInfo.Rows.Count > 0 Then

                    NOM_CLIENT = clientInfo.Rows(0)("NOM_CLIENT")
                    SOLDE = enChambre.Rows(i)("SOLDE_RESERVATION")
                    GunaDataGridViewPlanning.Rows(rowIndex).Cells(colIndexDebut).Value = clientInfo.Rows(0)("NOM_CLIENT")
                    GunaDataGridViewPlanning.Rows(rowIndex).Cells(colIndexDebut).Style.ForeColor = Color.White
                    GunaDataGridViewPlanning.Rows(rowIndex).Cells(colIndexDebut).Style.Alignment = DataGridViewContentAlignment.MiddleLeft

                End If

                Dim ToolTip As New ToolTip()
                Dim CELLULE As DataGridViewCell

                For m = colIndexDebut To colIndexFin

                    CELLULE = GunaDataGridViewPlanning.Rows(rowIndex).Cells(m)

                    If GlobalVariable.actualLanguageValue = 1 Then
                        CELLULE.ToolTipText = enChambre.Rows(i)("NOM_CLIENT") & Chr(13) & "ARRIVEE : " & enChambre.Rows(i)("DATE_ENTTRE") & " " & CDate(enChambre.Rows(i)("HEURE_ENTREE")).ToShortTimeString & Chr(13) & " DEPART : " & enChambre.Rows(i)("DATE_SORTIE") & " " & CDate(enChambre.Rows(i)("HEURE_SORTIE")).ToShortTimeString & Chr(13) & " SOLDE : " & SOLDE

                    Else
                        CELLULE.ToolTipText = enChambre.Rows(i)("NOM_CLIENT") & Chr(13) & "ARRIVAL : " & enChambre.Rows(i)("DATE_ENTTRE") & " " & CDate(enChambre.Rows(i)("HEURE_ENTREE")).ToShortTimeString & Chr(13) & " DEPARTURE : " & enChambre.Rows(i)("DATE_SORTIE") & " " & CDate(enChambre.Rows(i)("HEURE_SORTIE")).ToShortTimeString & Chr(13) & " BALANCE : " & SOLDE

                    End If

                    'toolTip.ToolTipTitle = enChambre.Rows(i)("CODE_CHAMBRE")

                    'ToolTip.SetToolTip(CELLULE, enChambre.Rows(i)("NOM_CLIENT") & " SOLDE : " & SOLDE)
                    'ToolTip.SetToolTip(CELLULE, enChambre.Rows(i)("NOM_CLIENT") & " SOLDE : " & SOLDE)

                    'GunaDataGridViewPlanning.Rows(rowIndex).Cells(m + 1).Selected = True
                    GunaDataGridViewPlanning.Rows(rowIndex).Cells(m).Style.BackColor = resaColor
                    GunaDataGridViewPlanning.Rows(rowIndex).Cells(m).Style.ForeColor = resaForeColor
                    'GunaDataGridViewPlanning.Rows(rowIndex).Cells(m).BorderStyle = Color.Green

                    numberOfCellsSelected += 1

                Next

                '4- AFFICHAGE DES INFORMATIONS DYNAMIQUE DU CLIENT EN CHAMBRE

                '4.1- ON DETERMINE LES COORDONNEES DES DEUX POINTS (CELLULE D'ARRIVEE ET CELLULE DE DEPART)

                'DisplayPoint1 = GunaDataGridViewPlanning.PointToScreen(GunaDataGridViewPlanning.GetCellDisplayRectangle(rowIndex, colIndexDebut, False).Location)
                'DisplayPoint2 = GunaDataGridViewPlanning.PointToScreen(GunaDataGridViewPlanning.GetCellDisplayRectangle(rowIndex, colIndexFin, False).Location)

                'Coordinates of the first and last cell
                'MessageBox.Show(DisplayPoint1.X & "-" & DisplayPoint1.Y)
                'MessageBox.Show(DisplayPoint2.X & "-" & DisplayPoint2.Y)

                '4.2- ON DETERMINE LE NOMBRE DE CEULLUE SELECTIONNE A FIN DE SAVOIR QUELLE EST LA LARGEUR TOTAL OCCUPEE PAR LA RESERVATION

                'numberOfCellsSelected = colIndexFin - rowIndex
                'GunaDataGridViewPlanning.Rows(rowIndex).Cells(colIndexFin).Value = numberOfCellsSelected

            Next

            resaForeColor = Color.Black

            legendeEnCodificationColour(DateDebut, DateFin)


        End If

    End Sub

    Private Function comparaisonDeDatePourPositionnementEntree(ByVal Date_1 As Date, ByVal Date_2 As Date) As Date

        Dim numberOfDays As Integer = DateDiff(DateInterval.Day, Date_1, Date_2)

        'If Date_1.ToShortDateString = Date_2.ToShortDateString Then
        If numberOfDays = 0 Then
            'ON AFFICHE LA RESA A PARTIR DE LA DATE D'ENTREE = LA DATE DE DEBUT
            Return Date_1 'OU Return Date_2
            'ElseIf Date_1.ToShortDateString > Date_2.ToShortDateString Then
        ElseIf numberOfDays < 0 Then
            'ON AFFICHE LA RESA A PARTIR DE LA DATE DE DEBUT
            Return Date_1
            ' ElseIf Date_1.ToShortDateString < Date_2.ToShortDateString Then
        ElseIf numberOfDays > 0 Then
            'ON AFFICHE LA RESA A PARTIR DE LA DATE D'ENTREE
            Return Date_2
        End If

    End Function

    Private Function comparaisonDeDatePourPositionnementSortie(ByVal Date_1 As Date, ByVal Date_2 As Date) As Date

        Dim numberOfDays As Integer = DateDiff(DateInterval.Day, Date_1, Date_2)

        'If Date_1.ToShortDateString = Date_2.ToShortDateString Then
        If numberOfDays = 0 Then
            'ON AFFICHE LA RESA A PARTIR DE LA DATE D'ENTREE = LA DATE DE DEBUT
            Return Date_1 'OU Return Date_2
            'ElseIf Date_1.ToShortDateString > Date_2.ToShortDateString Then
        ElseIf numberOfDays < 0 Then
            'ON AFFICHE LA RESA A PARTIR DE LA DATE DE DEBUT
            Return Date_2
            ' ElseIf Date_1.ToShortDateString < Date_2.ToShortDateString Then
        ElseIf numberOfDays > 0 Then
            'ON AFFICHE LA RESA A PARTIR DE LA DATE D'ENTREE
            Return Date_1
        End If

    End Function

    'CREATION DE RESERVATION A PARTIR DU TABLEAU DISPONNIBILITE ET TARIFS

    Private Sub GunaDataGridViewDispoEtTarifs_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewDispoEtTarifs.CellClick

        'On mouse out I need 
        'For the first cell
        '- The column so as to obtain the date1 (1, r) since first cell has coordinate (m,r) with r > 1 : mouseDown
        'For the second cell
        '- The column so as to obtain the date2 (1, s) since second cell has coordinate (n, s) with s > 1 : mouseUp
        '- s > r and m = n
        '- With one of the above I obtain the room
        '- To obtain the room code (m, 0) with m > 0

        '------------------------- Obtaining the room ---------------------------
        'm/n : row and r/s : column

        'Coordinate (n,s)

        If e.RowIndex Then

            Dim row As DataGridViewRow

            Dim mouseDown As String = GunaDataGridViewDispoEtTarifs.CurrentCell.ColumnIndex & " - " & GunaDataGridViewDispoEtTarifs.CurrentCell.ColumnIndex

            'The coordinate of the last cell will be given by (m,r)
            Dim t As Integer = 0

            If firstCell Then

                m = GunaDataGridViewDispoEtTarifs.CurrentCell.RowIndex
                r = GunaDataGridViewDispoEtTarifs.CurrentCell.ColumnIndex

                GunaDataGridViewDispoEtTarifs.Rows(m).Cells(r).Selected = True
                GunaDataGridViewDispoEtTarifs.Rows(m).Cells(r).Style.SelectionBackColor = Color.LightPink

                DisplayPoint1 = GunaDataGridViewDispoEtTarifs.PointToScreen(GunaDataGridViewDispoEtTarifs.GetCellDisplayRectangle(e.ColumnIndex, e.RowIndex, False).Location)

                firstCell = False

            ElseIf secondCell Then

                n = GunaDataGridViewDispoEtTarifs.CurrentCell.RowIndex
                s = GunaDataGridViewDispoEtTarifs.CurrentCell.ColumnIndex

                GunaDataGridViewDispoEtTarifs.Rows(n).Cells(s).Selected = True
                GunaDataGridViewDispoEtTarifs.Rows(n).Cells(s).Style.SelectionBackColor = Color.LightPink

                If (m = n) And s > r Then

                    'secondCell = False

                    row = GunaDataGridViewDispoEtTarifs.Rows(m)

                    'row = GunaDataGridViewDispoEtTarifs.Rows(0)

                    'Selction of cells between the range

                    numberOfCellsSelected = s - r + 1

                    For i = r To s
                        GunaDataGridViewDispoEtTarifs.Rows(m).Cells(i).Selected = True
                        GunaDataGridViewDispoEtTarifs.Rows(m).Cells(i).Style.SelectionBackColor = Color.LightPink
                    Next

                    'Width of selected cells
                    widthOfSelectedCells = numberOfCellsSelected * GunaDataGridViewDispoEtTarifs.Columns(0).Width
                    heightOfCells = GunaDataGridViewDispoEtTarifs.Rows(0).Height

                    Dim roomType As DataTable = Functions.getElementByCode(row.Cells(0).Value.ToString(), "type_chambre", "LIBELLE_TYPE_CHAMBRE")

                    Dim dialog As DialogResult

                    If roomType.Rows.Count > 0 Then

                        Using form = New Form() With {.TopMost = True}


                            If GlobalVariable.actualLanguageValue = 1 Then
                                dialog = MessageBox.Show("Voulez-vous faire une Réservation d'une chambre " & row.Cells(0).Value.ToString() & " du " & GunaDateTimePickerDispoDebut.Value.AddDays(r - 2) & " au " & GunaDateTimePickerDispoDebut.Value.AddDays(s - 2), "Barcles HotelSoft", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                            Else
                                dialog = MessageBox.Show("Do you really want to book a room " & row.Cells(0).Value.ToString() & " from " & GunaDateTimePickerDispoDebut.Value.AddDays(r - 2) & " from " & GunaDateTimePickerDispoDebut.Value.AddDays(s - 2), "Barcles HotelSoft", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                            End If

                            firstCell = True
                            secondCell = True

                        End Using

                        If Not dialog = DialogResult.No Then

                            If roomType.Rows.Count > 0 Then

                                GunaDateTimePickerArrivee.Value = GunaDateTimePickerDispoDebut.Value.AddDays(r - 2)
                                GunaDateTimePickerDepart.Value = GunaDateTimePickerDispoDebut.Value.AddDays(s - 2)

                                'GunaTextBoxLibelleChambre.Text = room.Rows(0)("LIBELLE_CHAMBRE")
                                GunaTextBoxCodeTypeDeChambre.Text = roomType.Rows(0)("CODE_TYPE_CHAMBRE")
                                GunaTextBoxLibelleTYpe.Text = roomType.Rows(0)("LIBELLE_TYPE_CHAMBRE")
                                'GunaTextBoxNumeroChambre.Text = room.Rows(0)("CODE_CHAMBRE").ToString()
                                'GunaTextBoxLibelleChambre.Text = room.Rows(0)("LOCALISATION").ToString()

                                GunaTextBoxpPrixAffiche.Text = Format(roomType.Rows(0)("PRIX"), "#,##0")

                                GunaTextBoxMontantAccorde.Text = GunaTextBoxpPrixAffiche.Text

                                GunaTextBoxPrixParNuitee.Text = GunaTextBoxMontantAccorde.Text
                                GunaTextBoxNombreDeJourTotal.Text = CType(GunaTextBoxTempsAFaire.Text, Int32)

                                GunaDataGridViewRoomType.Visible = False
                                GunaDataGridViewClient.Visible = False
                                GunaDataGridViewRoom.Visible = False
                                GunaDataGridViewPhone.Visible = False

                                reservationButtonToDisplay()

                                PanelTableauDeBords.Hide()
                                GunaPanelDisponibilite.Hide()
                                GunaPanelDisponibilite.Visible = False
                                PanelPlanning.Visible = False

                                PanelEnregistrement.Show()
                                PanelEnregistrement.BringToFront()

                                TabControlHbergement.SelectedIndex = 0

                            End If

                        End If

                    Else
                        'ON NE SE TROUVE PAS SUR LA RANGEE D'UN TYPE DE CHAMBRE
                        Using form = New Form() With {.TopMost = True}


                            If GlobalVariable.actualLanguageValue = 1 Then
                                dialog = MessageBox.Show("Bien vouloir faire la sélection sur un type de chambre !!", "Barcles HotelSoft", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                            Else
                                dialog = MessageBox.Show("Please select a room type !!", "Barcles HotelSoft", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                            End If

                            firstCell = True
                            secondCell = True

                        End Using

                    End If


                Else

                    firstCell = True
                    secondCell = True

                End If

            End If

        End If

    End Sub

    'CREATION DE RESERVATION A PARTIR DE TABLEAU PLANNING

    Private Sub GunaDataGridViewPlanning_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewPlanning.CellClick

        'On mouse out I need 
        'For the first cell
        '- The column so as to obtain the date1 (1, r) since first cell has coordinate (m,r) with r > 1 : mouseDown
        'For the second cell
        '- The column so as to obtain the date2 (1, s) since second cell has coordinate (n, s) with s > 1 : mouseUp
        '- s > r and m = n
        '- With one of the above I obtain the room
        '- To obtain the room code (m, 0) with m > 0

        '------------------------- Obtaining the room ---------------------------
        'm/n : row and r/s : column

        'Coordinate (n,s)

        If e.RowIndex Then

            Dim row As DataGridViewRow

            Dim mouseDown As String = GunaDataGridViewPlanning.CurrentCell.ColumnIndex & " - " & GunaDataGridViewPlanning.CurrentCell.ColumnIndex

            'The coordinate of the last cell will be given by (m,r)
            Dim t As Integer = 0

            If firstCell Then

                m = GunaDataGridViewPlanning.CurrentCell.RowIndex
                r = GunaDataGridViewPlanning.CurrentCell.ColumnIndex

                GunaDataGridViewPlanning.Rows(m).Cells(r).Selected = True
                GunaDataGridViewPlanning.Rows(m).Cells(r).Style.SelectionBackColor = Color.LightPink

                DisplayPoint1 = GunaDataGridViewPlanning.PointToScreen(GunaDataGridViewPlanning.GetCellDisplayRectangle(e.ColumnIndex, e.RowIndex, False).Location)

                firstCell = False

            ElseIf secondCell Then

                n = GunaDataGridViewPlanning.CurrentCell.RowIndex
                s = GunaDataGridViewPlanning.CurrentCell.ColumnIndex

                GunaDataGridViewPlanning.Rows(n).Cells(s).Selected = True
                GunaDataGridViewPlanning.Rows(n).Cells(s).Style.SelectionBackColor = Color.LightPink

                If (m = n) And s > r Then

                    'secondCell = False

                    row = GunaDataGridViewPlanning.Rows(m)


                    'row = GunaDataGridViewPlanning.Rows(0)

                    'Selction of cells between the range

                    numberOfCellsSelected = s - r + 1

                    For i = r To s
                        GunaDataGridViewPlanning.Rows(m).Cells(i).Selected = True
                        GunaDataGridViewPlanning.Rows(m).Cells(i).Style.SelectionBackColor = Color.LightPink
                    Next

                    'Coordinate of second cell
                    'DisplayPoint2 = GunaDataGridViewPlanning.PointToScreen(GunaDataGridViewPlanning.GetCellDisplayRectangle(e.ColumnIndex, e.RowIndex, False).Location)

                    'Coordinates of the first and last cell
                    'MessageBox.Show(DisplayPoint1.X & "-" & DisplayPoint1.Y)
                    ' MessageBox.Show(DisplayPoint2.X & "-" & DisplayPoint2.Y)

                    ' MessageBox.Show(numberOfCellsSelected)

                    'Width of selected cells
                    widthOfSelectedCells = numberOfCellsSelected * GunaDataGridViewPlanning.Columns(0).Width
                    heightOfCells = GunaDataGridViewPlanning.Rows(0).Height

                    'MessageBox.Show(widthOfSelectedCells)

                    'Creation of label to display on the selected datagrid cells

                    GunaLabelOccupant.Size = New System.Drawing.Size(widthOfSelectedCells, heightOfCells)
                    GunaLabelOccupant.Location = New System.Drawing.Point(DisplayPoint1.X + (widthOfSelectedCells / 4) + 40, DisplayPoint1.Y - 116)
                    'GunaLabelOccupant.Text = "NEMBOT BILIE LINDA " & Chr(13) & "nembolinda@yahoo.fr"

                    Dim room As DataTable = Functions.getElementByCode(row.Cells(0).Value.ToString(), "chambre", "CODE_CHAMBRE")

                    Dim roomType As DataTable
                    Dim codeType As String = ""

                    If room.Rows.Count > 0 Then

                        codeType = room.Rows(0)("CODE_TYPE_CHAMBRE")

                        roomType = Functions.getElementByCode(codeType, "type_chambre", "CODE_TYPE_CHAMBRE")

                    End If

                    Dim dialog As DialogResult

                    Using form = New Form() With {.TopMost = True}

                        If GlobalVariable.actualLanguageValue = 1 Then
                            dialog = MessageBox.Show("Voulez-vous faire une Réservation de la chambre " & row.Cells(0).Value.ToString() & " (" & codeType & ") du " & GunaDateTimePickerPlanningDebut.Value.AddDays(r - 2) & " au " & GunaDateTimePickerPlanningDebut.Value.AddDays(s - 2), "Fermer lyte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                        Else
                            dialog = MessageBox.Show("Do you want to book the room " & row.Cells(0).Value.ToString() & " (" & codeType & ") du " & GunaDateTimePickerPlanningDebut.Value.AddDays(r - 2) & " au " & GunaDateTimePickerPlanningDebut.Value.AddDays(s - 2), "Fermer lyte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                        End If

                        firstCell = True
                        secondCell = True

                    End Using

                    If Not dialog = DialogResult.No Then

                        If room.Rows.Count > 0 Then

                            GunaDateTimePickerArrivee.Value = GunaDateTimePickerPlanningDebut.Value.AddDays(r - 2)
                            GunaDateTimePickerDepart.Value = GunaDateTimePickerPlanningDebut.Value.AddDays(s - 2)

                            GunaTextBoxLibelleChambre.Text = room.Rows(0)("LIBELLE_CHAMBRE")
                            GunaTextBoxCodeTypeDeChambre.Text = room.Rows(0)("CODE_TYPE_CHAMBRE")
                            GunaTextBoxLibelleTYpe.Text = roomType.Rows(0)("LIBELLE_TYPE_CHAMBRE")
                            GunaTextBoxNumeroChambre.Text = room.Rows(0)("CODE_CHAMBRE").ToString()
                            GunaTextBoxLibelleChambre.Text = room.Rows(0)("LOCALISATION").ToString()

                            GunaTextBoxpPrixAffiche.Text = Format(roomType.Rows(0)("PRIX"), "#,##0")

                            GunaTextBoxMontantAccorde.Text = GunaTextBoxpPrixAffiche.Text

                            GunaTextBoxPrixParNuitee.Text = GunaTextBoxMontantAccorde.Text
                            GunaTextBoxNombreDeJourTotal.Text = CType(GunaTextBoxTempsAFaire.Text, Int32)

                            GunaDataGridViewRoomType.Visible = False
                            GunaDataGridViewClient.Visible = False
                            GunaDataGridViewRoom.Visible = False
                            GunaDataGridViewPhone.Visible = False

                            reservationButtonToDisplay()

                            PanelTableauDeBords.Hide()
                            PanelPlanning.Hide()

                            PanelEnregistrement.Show()
                            PanelEnregistrement.BringToFront()

                            TabControlHbergement.SelectedIndex = 0

                        End If

                    End If

                Else

                    firstCell = True
                    secondCell = True

                End If

            End If

        End If

    End Sub

    Public Function dateAPartiDeIndexDelaColonne(ByVal premiereDateAffichable As Date, ByVal colonneIndex As Integer) As Date

        Return premiereDateAffichable.AddDays(colonneIndex)

    End Function

    'We change the label of the front desk depending on the active tab
    Public Sub nomDuLabelAAficher()

        If GunaRadioButtonChambre.Checked Then

            If TabControlHbergement.SelectedIndex = 0 Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaFrontDeskLabel.Text = "RESERVATION CHAMBRE"
                Else
                    GunaFrontDeskLabel.Text = "ROOM RESERVATION"
                End If

            ElseIf TabControlHbergement.SelectedIndex = 1 Then


                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaFrontDeskLabel.Text = "RESERVATIONS"
                Else
                    GunaFrontDeskLabel.Text = "BOOKING"
                End If
            ElseIf TabControlHbergement.SelectedIndex = 2 Then


                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaFrontDeskLabel.Text = "ARRIVEES"
                Else
                    GunaFrontDeskLabel.Text = "ARRIVALS"
                End If
            ElseIf TabControlHbergement.SelectedIndex = 3 Then


                If GlobalVariable.actualLanguageValue = 1 Then
                    TabControlHbergement.SelectedTab.Text = "En chambre"
                    GunaFrontDeskLabel.Text = "EN CHAMBRES"
                Else
                    TabControlHbergement.SelectedTab.Text = "In House"
                    GunaFrontDeskLabel.Text = "IN HOUSE"
                End If
            ElseIf TabControlHbergement.SelectedIndex = 4 Then


                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaFrontDeskLabel.Text = "DEPARTS"
                Else
                    GunaFrontDeskLabel.Text = "DUE OUT"
                End If
            End If

        ElseIf GunaRadioButtonSalleFete.Checked Then

            If TabControlHbergement.SelectedIndex = 0 Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaFrontDeskLabel.Text = "RESERVATION SALLE DE FETE"

                Else
                    GunaFrontDeskLabel.Text = "PARTY HALL BOOKING"

                End If
            ElseIf TabControlHbergement.SelectedIndex = 1 Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaFrontDeskLabel.Text = "RESERVATIONS"

                Else
                    GunaFrontDeskLabel.Text = "BOOKINGS"

                End If
            ElseIf TabControlHbergement.SelectedIndex = 2 Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaFrontDeskLabel.Text = "SALLES RESERVEES"

                Else
                    GunaFrontDeskLabel.Text = "BOOKED HALLS"

                End If
            ElseIf TabControlHbergement.SelectedIndex = 3 Then


                If GlobalVariable.actualLanguageValue = 1 Then
                    TabControlHbergement.SelectedTab.Text = "Salle Occupée"
                    GunaFrontDeskLabel.Text = "SALLES OCCUPEES"
                Else
                    TabControlHbergement.SelectedTab.Text = "Occupied Halls"
                    GunaFrontDeskLabel.Text = "OCCUPIED HALLS"
                End If
            ElseIf TabControlHbergement.SelectedIndex = 4 Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaFrontDeskLabel.Text = "DEPARTS"

                Else
                    GunaFrontDeskLabel.Text = "DUE OUT"

                End If
            End If

        End If

    End Sub

    Private Sub emptySearchFieldReservation()

        'Clearing of search form field
        GunaTextBoxClient.Clear()
        GunaTextBoxNumResa.Clear()
        GunaTextBoxParEntreprise.Clear()
        GunaTextBoxSourceResa.Clear()
        GunaTextBoxNumGroupe.Clear()
        GunaTextBoxTypeChambre.Clear()

    End Sub

    Private Sub TabControlHbergement_SelectedIndexChanged(sender As Object, e As EventArgs) Handles TabControlHbergement.SelectedIndexChanged

        GunaLabelNbreDeparts.Text = "(0)"
        GunaLabelNbreEnChambre.Text = "(0)"
        GunaLabelNbreAttendu.Text = "(0)"
        GunaLabelNbreResa.Text = "(0)"

        If GunaRadioButtonChambre.Checked Then
            GlobalVariable.typeChambreOuSalle = "chambre"
        ElseIf GunaRadioButtonSalleFete.Checked Then
            GlobalVariable.typeChambreOuSalle = "salle"
        End If

        'On s'aasutre les tabs des arrivé est vide à l'ouverture
        DataGridViewAttenduPanel.Columns.Clear()
        DataGridViewEnChambre.Columns.Clear()
        DataGridViewDepartTab.Columns.Clear()
        GunaDataGridViewReservationList.Columns.Clear()

        nomDuLabelAAficher()

        If Not TabControlHbergement.SelectedIndex = 1 Then
            GunaDataGridViewReservationList.Columns.Clear()
        End If

        If TabControlHbergement.SelectedIndex = 0 Then

            GunaLabelTypeDeSejour.Visible = True
            GunaButtonVider.Visible = True
            GunaButtonQuitter.Visible = True

            If GlobalVariable.typeChambreOuSalle = "chambre" Then
                GunaComboBoxImpressionSalle.Visible = False
                GunaComboBoxImpressionChambre.Visible = True
            Else
                GunaComboBoxImpressionSalle.Visible = True
                GunaComboBoxImpressionChambre.Visible = False
            End If

            ImprimerDocChambreSalle.Visible = True
            GunaButtonEnvoyer.Visible = True

        Else

            GunaLabelTypeDeSejour.Visible = False
            ImprimerDocChambreSalle.Visible = False
            GunaButtonEnvoyer.Visible = False
            GunaButtonVider.Visible = False
            GunaButtonQuitter.Visible = False

            GunaComboBoxImpressionSalle.Visible = False
            GunaComboBoxImpressionChambre.Visible = False

        End If

        'POUR NE PERMETTRE QUE D'AFFICHER LES RESERVATIONS SANS CHAMBRES SI TELLE EST LE CAS
        If Not TabControlHbergement.SelectedIndex = 2 Then
            If GlobalVariable.attribuerChambre = True Then
                GlobalVariable.attribuerChambre = False
            End If
        End If

        'Le statut ne doit être visible que en cas de modification

        If Not GlobalVariable.codeReservationToUpdate = "" Then
            LabelNatureReservation.Visible = True

            If GlobalVariable.ReservationToUpdate IsNot Nothing Then
                If GlobalVariable.ReservationToUpdate.Rows(0)("CHECKIN") = "OUI" Then
                    If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("CORRECTIONS") = 1 Then
                        GunaTextBoxMontantAccorde.Enabled = True
                    Else
                        GunaTextBoxMontantAccorde.Enabled = False
                    End If
                Else
                    GunaTextBoxMontantAccorde.Enabled = True
                End If
            Else
                GunaTextBoxMontantAccorde.Enabled = True
            End If

        Else
            LabelNatureReservation.Visible = False
            GunaTextBoxMontantAccorde.Enabled = True
        End If

        If Trim(GunaLabelNumReservation.Text).Equals("num") Then
            GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")
        End If

    End Sub

    ' ------------------------------------------------ END PLANNING MANAGAMENT ----------------------------------------------


    '------------------------------------------------ FILLING OF CLIENT INFORMATION USING THE PHONE NUMBER ------------------------------

    'We select a client from front desk depending on his number

    Private Sub GunaTextBoxTelClient_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxTelClient.TextChanged

        GunaDataGridViewPhone.Visible = True

        If Not Trim(GunaTextBoxTelClient.Text).Equals("") Then

            Dim Query As String = "SELECT NOM_PRENOM, EMAIL From client WHERE TELEPHONE LIKE '%" & GunaTextBoxTelClient.Text & "%'"
            Dim command As New MySqlCommand(Query, GlobalVariable.connect)
            Dim table As New DataTable
            Dim adapter_1 As New MySqlDataAdapter(command)
            adapter_1.Fill(table)

            If (table.Rows.Count > 0) Then
                GunaDataGridViewPhone.DataSource = table
            Else
                GunaDataGridViewPhone.Columns.Clear()
                GunaDataGridViewPhone.Visible = False
            End If

            If Trim(GunaTextBoxTelClient.Text).Equals("") Then
                GunaDataGridViewPhone.Visible = False
                GunaRadioButtonWhatsAppNon.Checked = True
            Else

                If Trim(GlobalVariable.codeReservationToUpdate).Equals("") Then
                    If GunaTextBoxTelClient.TextLength = 13 Then
                        GunaRadioButtonWhatsAppOui.Checked = True
                    Else
                        GunaRadioButtonWhatsAppNon.Checked = True
                    End If

                Else
                    GunaRadioButtonWhatsAppNon.Checked = True
                End If

            End If

        Else

            GunaDataGridViewPhone.Visible = False

        End If

    End Sub

    'Filling the other fields concerning the room type when we click on the custom Datagrid
    Private Sub GunaDataGridViewPhone_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewPhone.CellClick

        'Exacte code also used for filling client part from phone number 

        GunaDataGridViewPhone.Visible = False

        Dim row As DataGridViewRow

        row = Me.GunaDataGridViewPhone.Rows(e.RowIndex)

        Dim query As String = "SELECT * FROM client WHERE NOM_PRENOM = @NOM_PRENOM AND EMAIL=@EMAIL ORDER BY NOM_PRENOM ASC"

        Dim client As New DataTable()
        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@NOM_PRENOM", MySqlDbType.VarChar).Value = row.Cells("NOM_PRENOM").Value.ToString()
        command.Parameters.Add("@EMAIL", MySqlDbType.VarChar).Value = row.Cells("EMAIL").Value.ToString()
        Dim adapter As New MySqlDataAdapter(command)
        adapter.Fill(client)

        If (client.Rows.Count > 0) Then

            'Gathering of some information concernit the client to be use later

            GlobalVariable.idClient = client.Rows(0)("ID_CLIENT").ToString

            GlobalVariable.codeClient = client.Rows(0)("CODE_CLIENT").ToString

            GlobalVariable.codeCompteClient = client.Rows(0)("NUM_COMPTE").ToString

            GunaTextBoxNomPrenom.Text = row.Cells("NOM_PRENOM").Value.ToString()
            GunaTextBoxTelClient.Text = client.Rows(0)("TELEPHONE").ToString
            GunaTextBoxClientEmail.Text = client.Rows(0)("EMAIL").ToString
            GunaTextBoxCNI.Text = client.Rows(0)("CNI").ToString
            GunaTextBoxRefClient.Text = client.Rows(0)("CODE_CLIENT").ToString
            GunaTextBoxSiteWeb.Text = client.Rows(0)("SITE_INTERNET").ToString

            GunaTextBoxCNI.Text = client.Rows(0)("CNI")

            GunaTextBoxNomJeuneFille.Text = client.Rows(0)("NOM_JEUNE_FILLE")
            GunaTextBoxTypeClient.Text = client.Rows(0)("TYPE_CLIENT")
            GunaDateTimePickerDateNaissance.Value = client.Rows(0)("DATE_DE_NAISSANCE")
            GunaTextBoxLieu.Text = client.Rows(0)("LIEU_DE_NAISSANCE")
            GunaTextBoxNationalite.Text = client.Rows(0)("NATIONALITE")
            GunaTextBoxPaysResidence.Text = client.Rows(0)("PAYS_RESIDENCE")
            GunaTextBoxProfession.Text = client.Rows(0)("PROFESSION")
            GunaTextBoxNumeroCompte.Text = client.Rows(0)("NUM_COMPTE")
            GunaTextBoxRue.Text = client.Rows(0)("ADRESSE")
            GunaTextBoxVilleDeResidence.Text = client.Rows(0)("VILLE_DE_RESIDENCE")
            GunaTextBoxModeTransport.Text = client.Rows(0)("MODE_TRANSPORT")
            GunaTextBoxNumVehicule.Text = client.Rows(0)("NUM_VEHICULE")

            Dim Entreprise As DataTable = Functions.getElementByCode(client.Rows(0)("CODE_ENTREPRISE"), "client", "CODE_CLIENT")

            If Entreprise.Rows.Count > 0 Then
                GunaTextBoxEntrepriseDuclient.Text = Trim(Entreprise.Rows(0)("NOM_PRENOM"))
            End If

            GunaDataGridViewRoom.Visible = False

            GunaDataGridViewClient.Visible = False

        Else

            GunaTextBoxTelClient.Clear()

        End If

        GunaDataGridViewPhone.Visible = False

        'connect.closeConnection()

        'We display buttons
        reservationButtonToDisplay()

    End Sub

    Private Sub GunaButtonListeDesCategorieDeChambre_Click(sender As Object, e As EventArgs) Handles GunaButtonListeDesCategorieDeChambre.Click

        If GunaRadioButtonSalleFete.Checked Then
            GlobalVariable.typeChambreOuSalle = "salle"
        ElseIf GunaRadioButtonChambre.Checked Then
            GlobalVariable.typeChambreOuSalle = "chambre"
        End If
        'To be set back after a double click on the categorie list

        GlobalVariable.addCategorieFromFrontOffice = True

        RoomTypeForm.Show()

    End Sub

    '------------------------------------------------ END FILLING OF CLIENT INFORMATION USING THE PHONE NUMBER ---------------------------


    '------------------------------------------------ MANAGING SEJOUR AND PETIT DEJEUNER CHECK BOX --------------------------
    Private Sub GunaCheckBoxTaxeSejour_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxTaxeSejour.CheckedChanged

        If GunaCheckBoxTaxeSejour.Checked Then

            GunaTextBoxTaxeSejour.Visible = True

            Dim adapter As New MySqlDataAdapter
            Dim table As New DataTable
            Dim getUserQuery = "SELECT LIBELLE, CATEGORIE_HOTEL, MONTANT_TAXE FROM category_hotel_taxe_sejour_collectee INNER JOIN agence WHERE category_hotel_taxe_sejour_collectee.LIBELLE = agence.CATEGORIE_HOTEL"
            Dim Command As New MySqlCommand(getUserQuery, GlobalVariable.connect)

            adapter.SelectCommand = Command
            adapter.Fill(table)

            If table.Rows.Count > 0 Then

                Dim TaxeSejour As Double
                Double.TryParse(table.Rows(0)("MONTANT_TAXE"), TaxeSejour)
                GunaTextBoxTaxeSejour.Visible = True
                GunaTextBoxTaxeSejour.Text = Format(TaxeSejour, "#,##0")

            Else

            End If

        Else
            GunaTextBoxTaxeSejour.Visible = False
            GunaTextBoxTaxeSejour.Clear()
        End If

    End Sub

    Private Sub GunaCheckBoxPetitDejeuenerInclus_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxPetitDejeuenerInclus.CheckedChanged

        If GunaCheckBoxPetitDejeuenerInclus.Checked Then

            GunaTextBoxPetitDejeuner.Visible = True
            GunaTextBoxPetitDejeuner.Text = 1
            GunaTextBoxBreakFastCost.Visible = True

        Else

            GunaTextBoxPetitDejeuner.Visible = False
            GunaTextBoxPetitDejeuner.Text = 0
            GunaTextBoxBreakFastCost.Visible = False
            GunaTextBoxBreakFastCost.Text = 0

        End If

    End Sub

    Private Sub GunaCheckBoxPetitDejRoutage_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxPetitDejRoutage.CheckedChanged

        If GunaCheckBoxPetitDejRoutage.Checked Then
            GunaTextBoxPetitDejeunerRoutage.Visible = False
            GunaTextBoxPetitDejeunerRoutage.Text = 1
        Else
            GunaTextBoxPetitDejeunerRoutage.Visible = False
            GunaTextBoxPetitDejeunerRoutage.Text = 0
        End If

    End Sub

    Private Sub GunaCheckBoxChambreRoutage_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxChambreRoutage.Click

        If GunaCheckBoxChambreRoutage.Checked Then

            GunaTextBoxPrixChambreRoutage.Visible = True
            GunaTextBoxPrixChambreRoutage.Text = GunaTextBoxMontantAccorde.Text

        Else

            GunaTextBoxPrixChambreRoutage.Visible = False

        End If

    End Sub

    '------------------------------------------------------ END CHECK BOX -----------------------------------------------------------


    '---------------------------GESTION DES CHECKBOXES POUR RESERVATION CHAMBRE OU SALLE DE FETE -------------------------------

    '--------------------------------- CHAMBRES 

    Private Sub GunaRadioButtonChambre_Click(sender As Object, e As EventArgs) Handles GunaRadioButtonChambre.Click

        GunaDataGridViewReservationList.Columns.Clear()

        GunaTextBoxNbreAdulte.Text = 0
        GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text
        setTableUsedForAutocompletionToFalse()

        If GlobalVariable.actualLanguageValue = 1 Then
            TabPage3.Text = "En Chambre"

        Else
            TabPage3.Text = "In House"

        End If
        GunaLabelSolde.Text = 0

        If GunaRadioButtonChambre.Checked Then

            GunaTextBoxSerendantA.Text = GlobalVariable.AgenceActuelle.Rows(0)("VILLE")

            GunaTextBoxNbrePersonne.BaseColor = Color.PowderBlue
            GunaTextBoxNbrePersonne.Enabled = False

            GunaButtonPromo.Visible = True

            GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")

            nomDuLabelAAficher()

            GlobalVariable.typeChambreOuSalle = "chambre"

            GunaCheckBoxPetitDejeuenerInclus.Visible = True
            GunaCheckBoxTaxeSejour.Visible = True

            emtptyRegistrationFields()



            If GlobalVariable.actualLanguageValue = 1 Then
                TabPage3.Text = "En Chambre"
                GunaLabel52.Text = "EN CHAMBRE DU : "

            Else
                TabPage3.Text = "In House"
                GunaLabel52.Text = "IN HOUSE FROM : "

            End If


            GlobalVariable.typeChambreOuSalle = "chambre"

            If TabControlHbergement.SelectedIndex = 3 Then
                If GlobalVariable.actualLanguageValue = 1 Then

                    TabControlHbergement.SelectedTab.Text = "En Chambre"
                    GunaFrontDeskLabel.Text = "EN CHAMBRE"
                Else

                    TabControlHbergement.SelectedTab.Text = "In House"
                    GunaFrontDeskLabel.Text = "IN HOUSE"
                End If
            End If

            If TabControlHbergement.SelectedIndex = 0 Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaFrontDeskLabel.Text = "RESERVATION CHAMBRE"
                Else
                    GunaFrontDeskLabel.Text = "ROOM BOOKING"
                End If

            End If

            If TabControlHbergement.SelectedIndex = 1 Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaFrontDeskLabel.Text = "RESERVATIONS"

                Else
                    GunaFrontDeskLabel.Text = "BOOKINGS"

                End If
            End If

            GunaRadioButtonChambre.Visible = True
            GunaRadioButtonSalleFete.Visible = True

            GunaComboBoxImpressionChambre.Visible = True
            GunaButtonLectureDeCarte.Visible = True
            GunaComboBoxImpressionSalle.Visible = False

            GunaTextBoxSuperficie.Visible = False

            '----------------------------- LEFT TAB -----------------

            '------------------------------- DETAILS CHAMBRE


            If GlobalVariable.actualLanguageValue = 1 Then
                GunaGroupBoxDetailChambre.Text = "Détails de la Chambre"
                GunaLabelLibelleTypeChambreSalle.Text = "Type Chambre"
                GunaLabelNumeroChambre.Text = "Chambre N°"
            Else
                GunaGroupBoxDetailChambre.Text = "Romm details"
                GunaLabelLibelleTypeChambreSalle.Text = "Room Type"
                GunaLabelNumeroChambre.Text = "Room N°"
            End If

            TabControlGestionReservation.SelectedIndex = 0

            GunaPanelSalleReservation.Visible = False
            GunaTextBoxCapacite.Visible = False

            Functions.SiplifiedClearTextBox(Me)


            If GlobalVariable.actualLanguageValue = 1 Then
                GunaAdvenceButtonEnChambre.Text = "EN CHAMBRE"
                GunaAdvenceButtonAttribuerChambre.Text = "ATTRIBUER CHAMBRE"
            Else
                GunaAdvenceButtonEnChambre.Text = "IN HOUSE"
                GunaAdvenceButtonAttribuerChambre.Text = "ATTRIBUTE ROOM"
            End If

            GunaTextBoxNbreAdulte.Text = 0
            GunaTextBoxNbreEnfant.Text = 0
            GunaTextBoxpPrixAffiche.Text = 0
            GunaTextBoxMontantAccorde.Text = 0

            If GunaCheckBoxDayUse.Checked Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaLabelTotalHeure.Text = "Nombre de heures"
                    GunaLabelPrixParNuitee.Text = "Prix par heure"
                    GunaLabelPrixSejours.Text = "Prix de la sieste"
                    GunaLabelTempsAFaire.Text = "Total heure(s)"
                Else
                    GunaLabelTotalHeure.Text = "Number of hours"
                    GunaLabelPrixParNuitee.Text = "Price per hour"
                    GunaLabelPrixSejours.Text = "Price of day use"
                    GunaLabelTempsAFaire.Text = "Total Hour(s)"

                End If

            ElseIf GunaCheckBoxMensuel.Checked Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaLabelTotalHeure.Text = "Nombre de jour(s)"
                    GunaLabelPrixParNuitee.Text = "Prix Mensuel"
                    GunaLabelPrixSejours.Text = "Total Mensuel"
                    GunaLabelTempsAFaire.Text = "Total jour(s)"
                Else
                    GunaLabelTotalHeure.Text = "Number of days"
                    GunaLabelPrixParNuitee.Text = "Monthly Price"
                    GunaLabelPrixSejours.Text = "Total Monthly"
                    GunaLabelTempsAFaire.Text = "Total days(s)"

                End If

            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaLabelTotalHeure.Text = "Nombre de nuitée(s)"
                    GunaLabelPrixParNuitee.Text = "Prix par nuitée"
                    GunaLabelPrixSejours.Text = "Prix du séjours"
                    GunaLabelTempsAFaire.Text = "Total nuitées"
                Else
                    GunaLabelTotalHeure.Text = "Number of days"
                    GunaLabelPrixParNuitee.Text = "Price per nights"
                    GunaLabelPrixSejours.Text = "Price of stay"
                    GunaLabelTempsAFaire.Text = "Total nights"
                End If


            End If

            VidageDesChampsPourNouvelleReservation()

        End If

        GestionDesButtonDImpressionDesDocuments()

    End Sub

    '--------------------------------- SALLE DE FETE

    Public Sub setTableUsedForAutocompletionToFalse()

        GunaDataGridViewRoomType.Visible = False
        GunaDataGridViewClient.Visible = False
        GunaDataGridViewRoom.Visible = False
        GunaDataGridViewPhone.Visible = False

    End Sub

    Public Sub valeurAZero()

        GunaTextBoxForfaitCafe.Text = 0
        GunaTextBoxForfatiDejeuner.Text = 0
        GunaTextBoxForfaitDiner.Text = 0
        GunaTextBoxForfaitTraiteur.Text = 0
        GunaTextBoxPrixGouter.Text = 0
        GunaTextBoxPUCocktail.Text = 0

        GunaTextBoxDecoration.Text = 0
        GunaTextBoxMateriel.Text = 0
        GunaTextBoxAutres.Text = 0
        GunaTextBoxMontantReelSalle.Text = 0

    End Sub


    Private Sub GunaRadioButtonSalleFete_Click(sender As Object, e As EventArgs) Handles GunaRadioButtonSalleFete.Click

        GunaDataGridViewReservationList.Columns.Clear()

        setTableUsedForAutocompletionToFalse()

        GunaTextBoxNbreAdulte.Text = 0
        GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text

        GunaLabelSolde.Text = 0

        If GunaRadioButtonSalleFete.Checked Then

            GunaTextBoxSerendantA.Text = GlobalVariable.AgenceActuelle.Rows(0)("VILLE")

            GunaTextBoxNbrePersonne.Text = 0

            GunaTextBox35.Text = GunaTextBoxNbrePersonne.Text
            GunaTextBox30.Text = GunaTextBoxNbrePersonne.Text
            GunaTextBox25.Text = GunaTextBoxNbrePersonne.Text
            GunaTextBox13.Text = GunaTextBoxNbrePersonne.Text
            GunaTextBoxQteGouter.Text = GunaTextBoxNbrePersonne.Text
            GunaTextBoxCocktail.Text = GunaTextBoxNbrePersonne.Text

            GunaTextBoxNbrePersonne.BaseColor = Color.PowderBlue
            GunaTextBoxNbrePersonne.Enabled = True

            GunaButtonPromo.Visible = False

            GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")

            nomDuLabelAAficher()

            GlobalVariable.typeChambreOuSalle = "salle"

            GunaCheckBoxPetitDejeuenerInclus.Visible = False
            GunaCheckBoxTaxeSejour.Visible = False

            emtptyRegistrationFields()


            GlobalVariable.typeChambreOuSalle = "salle"

            If GlobalVariable.actualLanguageValue = 1 Then
                GunaLabel52.Text = "SALLES OCCUPEES DU : "
                TabPage3.Text = "Salle Occupée"
                If TabControlHbergement.SelectedIndex = 3 Then
                    TabControlHbergement.SelectedTab.Text = "Salle Occupée"
                    GunaFrontDeskLabel.Text = "SALLE(S) OCCUPEE(S)"
                End If

                If TabControlHbergement.SelectedIndex = 0 Then
                    GunaFrontDeskLabel.Text = "RESERVATION SALLE DE FETE"
                End If

                If TabControlHbergement.SelectedIndex = 1 Then
                    GunaFrontDeskLabel.Text = "RESERVATIONS"
                End If
            Else
                GunaLabel52.Text = "HALL OCCUPIED FROM : "
                TabPage3.Text = "Occupied Hall"
                If TabControlHbergement.SelectedIndex = 3 Then
                    TabControlHbergement.SelectedTab.Text = "Occupied Hall"
                    GunaFrontDeskLabel.Text = "OCCUPIED HALL(S)"
                End If

                If TabControlHbergement.SelectedIndex = 0 Then
                    GunaFrontDeskLabel.Text = "PARTY HALL BOOKING"
                End If

                If TabControlHbergement.SelectedIndex = 1 Then
                    GunaFrontDeskLabel.Text = "BOOKINGS"
                End If
            End If

            GunaRadioButtonChambre.Visible = True
            GunaRadioButtonSalleFete.Visible = True
            GunaComboBoxImpressionChambre.Visible = False
            GunaComboBoxImpressionSalle.Visible = True

            GunaTextBoxSuperficie.Visible = True
            GunaButtonLectureDeCarte.Visible = False

            '----------------------------- LEFT TAB -----------------

            '------------------------------- DETAILS SALLE

            If GlobalVariable.actualLanguageValue = 1 Then

                GunaGroupBoxDetailChambre.Text = "Détails de la Salle"
                GunaLabelLibelleTypeChambreSalle.Text = "Type de Salle"
                GunaLabelNumeroChambre.Text = "Nom Salle"

                TabControlGestionReservation.SelectedIndex = 0

                GunaPanelSalleReservation.Visible = True
                GunaTextBoxCapacite.Visible = True

                GunaAdvenceButtonEnChambre.Text = "EN SALLE"
                GunaAdvenceButtonAttribuerChambre.Text = "ATTRIBUER SALLE"


            Else

                GunaGroupBoxDetailChambre.Text = "Hall details"
                GunaLabelLibelleTypeChambreSalle.Text = "Hall Type"
                GunaLabelNumeroChambre.Text = "Hall Name"

                TabControlGestionReservation.SelectedIndex = 0

                GunaPanelSalleReservation.Visible = True
                GunaTextBoxCapacite.Visible = True

                GunaAdvenceButtonEnChambre.Text = "IN HALL"
                GunaAdvenceButtonAttribuerChambre.Text = "ATTRIBUTE HALL"


            End If

            valeurAZero()

            'ON CHARGE DYNAMIQUEMENT LA LISTE DES EVENEMENTS

            AutoLoadEventList()

            VidageDesChampsPourNouvelleReservation()

        End If

        GestionDesButtonDImpressionDesDocuments()

    End Sub

    Public Sub GestionDesButtonDImpressionDesDocuments()

        If TabControlHbergement.SelectedIndex = 0 Then

            If GlobalVariable.typeChambreOuSalle = "chambre" Then

                GunaComboBoxImpressionSalle.Visible = False
                GunaComboBoxImpressionChambre.Visible = True

            ElseIf GlobalVariable.typeChambreOuSalle = "salle" Then

                GunaComboBoxImpressionSalle.Visible = True
                GunaComboBoxImpressionChambre.Visible = False

            End If

        End If

    End Sub
    '------------------------- GESTION DU CALCUL TOTAL DU COUT DE LA SALLE

    Public Function sumAReglerPourSalle()

        Dim val1 = 0
        Dim val2 = 0
        Dim val3 = 0
        Dim val4 = 0
        Dim val5 = 0
        Dim val6 = 0
        Dim val7 = 0
        Dim val8 = 0
        Dim val9 = 0
        Dim val10 = 0
        Dim val11 = 0
        Dim val12 = 0
        Dim val13 = 0
        Dim val14 = 0
        Dim val15 = 0
        Dim val16 = 0
        Dim val17 = 0
        Dim val18 = 0

        Double.TryParse(GunaTextBox37.Text, val1)
        Double.TryParse(GunaTextBox33.Text, val2)
        Double.TryParse(GunaTextBox31.Text, val3)
        Double.TryParse(GunaTextBox29.Text, val4)
        Double.TryParse(GunaTextBoxMontantReelSalle.Text, val5)
        Double.TryParse(GunaTextBoxDecoration.Text, val6)
        Double.TryParse(GunaTextBoxMateriel.Text, val7)
        Double.TryParse(GunaTextBoxAutres.Text, val8)
        Double.TryParse(GunaTextBoxPrixTotalGouter.Text, val9)
        Double.TryParse(GunaTextBox7.Text, val10)

        Double.TryParse(GunaTextBoxMontantEauPetiteBouteille.Text, val11)
        Double.TryParse(GunaTextBox62.Text, val12)
        Double.TryParse(GunaTextBox59.Text, val13)
        Double.TryParse(GunaTextBox64.Text, val14)
        Double.TryParse(GunaTextBox68.Text, val15)
        Double.TryParse(GunaTextBox61.Text, val16)
        Double.TryParse(GunaTextBox57.Text, val17)
        Double.TryParse(GunaTextBoxDroitDeBouchon.Text, val18)

        Return val1 + val2 + val3 + val4 + val5 + val6 + val7 + val8 + val9 + val10 + val11 + val12 + val13 + val14 + val15 + val16 + val17 + val18

    End Function

    'Café
    Private Sub GunaTextBox40_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxForfaitCafe.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0

        Double.TryParse(GunaTextBoxForfaitCafe.Text, prix)
        Integer.TryParse(GunaTextBox35.Text, quantite)
        GunaTextBox37.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        montanTotalDeLocationSalle(nombreDeJourTotal)

    End Sub

    Private Sub montanTotalDeLocationSalle(ByVal nombreDeJourTotal As Integer)

        If GunaCheckBoxDayUse.Checked Then
            nombreDeJourTotal = 1
        End If

        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub

    Private Sub GunaTextBox35_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox35.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfaitCafe.Text, prix)
        Integer.TryParse(GunaTextBox35.Text, quantite)
        GunaTextBox37.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        montanTotalDeLocationSalle(nombreDeJourTotal)

        If Trim(GunaTextBoxNombreDePersonneDelaSalleDeFete.Text) = "" Then
            GunaTextBoxNombreDePersonneDelaSalleDeFete.Text = 0
        End If

        GunaTextBoxNombreDePersonneDelaSalleDeFete.Text += quantite

    End Sub

    'Déjeuner

    Private Sub GunaTextBoxForfatiDejeuner_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxForfatiDejeuner.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfatiDejeuner.Text, prix)
        Integer.TryParse(GunaTextBox30.Text, quantite)
        GunaTextBox33.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        montanTotalDeLocationSalle(nombreDeJourTotal)

    End Sub

    Private Sub GunaTextBox30_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox30.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfatiDejeuner.Text, prix)
        Integer.TryParse(GunaTextBox30.Text, quantite)
        GunaTextBox33.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        montanTotalDeLocationSalle(nombreDeJourTotal)

        If Trim(GunaTextBoxNombreDePersonneDelaSalleDeFete.Text) = "" Then
            GunaTextBoxNombreDePersonneDelaSalleDeFete.Text = 0
        End If

        GunaTextBoxNombreDePersonneDelaSalleDeFete.Text += quantite

    End Sub

    'Dinner

    Private Sub GunaTextBoxForfaitDiner_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxForfaitDiner.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfaitDiner.Text, prix)
        Integer.TryParse(GunaTextBox25.Text, quantite)
        GunaTextBox31.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")
        montanTotalDeLocationSalle(nombreDeJourTotal)

    End Sub

    Private Sub GunaTextBox25_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox25.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfaitDiner.Text, prix)
        Integer.TryParse(GunaTextBox25.Text, quantite)
        GunaTextBox31.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")
        montanTotalDeLocationSalle(nombreDeJourTotal)
        If Trim(GunaTextBoxNombreDePersonneDelaSalleDeFete.Text) = "" Then
            GunaTextBoxNombreDePersonneDelaSalleDeFete.Text = 0
        End If

        GunaTextBoxNombreDePersonneDelaSalleDeFete.Text += quantite

    End Sub


    'Traiteur
    Private Sub GunaTextBox34_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxForfaitTraiteur.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfaitTraiteur.Text, prix)
        Integer.TryParse(GunaTextBox13.Text, quantite)
        GunaTextBox29.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")
        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub

    Private Sub GunaTextBox13_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox13.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfaitTraiteur.Text, prix)
        Integer.TryParse(GunaTextBox13.Text, quantite)
        GunaTextBox29.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

        montanTotalDeLocationSalle(nombreDeJourTotal)

        If Trim(GunaTextBoxNombreDePersonneDelaSalleDeFete.Text) = "" Then
            GunaTextBoxNombreDePersonneDelaSalleDeFete.Text = 0
        End If

        GunaTextBoxNombreDePersonneDelaSalleDeFete.Text += quantite

    End Sub


    Private Sub GunaTextBoxMontantReelSalle_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxMontantReelSalle.TextChanged

        Dim montantAccorde As Double = 0
        'Conservation du montant accordé
        Double.TryParse(GunaTextBoxMontantReelSalle.Text, montantAccorde)
        GlobalVariable.MONTANT_ACCORDE = montantAccorde
        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")
        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub

    Private Sub GunaTextBoxDecoration_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxDecoration.TextChanged

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")
        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub


    'CASHIER FORM
    Private Sub ToolStripMenuItem76_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem76.Click
        CashierForm.Show()
    End Sub
    '------------------------------- GESTION DES IMPRESSIONS DES DOCUMENTS -------------------------------------------------------------
    ' DOCS LIES AUX CHAMBRES 
    '-------CONFIRMATION DE RESERVATION ---------------------

    Private Sub Imprimer_Click(sender As Object, e As EventArgs) Handles ImprimerDocChambreSalle.Click

        Dim montantParNuitee As Double = 0

        If GunaLabelNumReservation.Text = "num" Then

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Aucune Réservation sélectionnée !", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)
            Else
                MessageBox.Show("No room selected !", "Print document", MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If
        End If

        'Génération des documents concernants les salles Confirmation de réservation
        If GunaRadioButtonSalleFete.Checked Then

            If GunaComboBoxImpressionSalle.SelectedIndex = 0 Then

                'CONFIRMATION DE RESERVATION

                Double.TryParse(GunaTextBoxMontantReelSalle.Text, montantParNuitee)

                Functions.GenerationDeConfirmationReservation(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)

            ElseIf GunaComboBoxImpressionSalle.SelectedIndex = 1 Then
                'CONTRAT DE POLICE
                If Not Trim(GlobalVariable.codeReservationToUpdate) = "" Then

                    'Functions.GenerationDeFicheDePolice(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)

                    Impression.contratDeLocationDeSalleDeFete(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)

                Else


                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Bien vouloir enregistrer la réservation", "Generate PDF", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    Else
                        MessageBox.Show("Please save the booking", "Generate PDF", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If
                End If

            ElseIf GunaComboBoxImpressionSalle.SelectedIndex = 2 Then
                Impression.devisEstimatifDeSalleDeFete(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)
            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Sélectionner un Document à imprimer !", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                Else
                    MessageBox.Show("Choose a document to print !", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If
            End If

            GunaComboBoxImpressionSalle.SelectedIndex = -1

        ElseIf GunaRadioButtonChambre.Checked Then
            'Génération des documents concernants les chambres confirmation de réservation

            If GunaComboBoxImpressionChambre.SelectedIndex = 0 Then
                'CONFIRMATION DE RESERVATION
                Double.TryParse(GunaTextBoxMontantAccorde.Text, montantParNuitee)

                If Not Trim(GlobalVariable.codeReservationToUpdate) = "" Then

                    Functions.GenerationDeConfirmationReservation(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)

                Else

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Bien vouloir enregistrer la réservation", "Generate PDF", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    Else
                        MessageBox.Show("Please save the booking", "Generate PDF", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If
                End If

            ElseIf GunaComboBoxImpressionChambre.SelectedIndex = 1 Then
                'FICHE DE POLICE
                'Génératiion de la fiche de police pour les chambres
                Functions.GenerationDeFicheDePolice(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle)
            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Sélectionner un Document à imprimer !", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                Else
                    MessageBox.Show("Please choose a document to print !", "Print Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If
            End If

            GunaComboBoxImpressionChambre.SelectedIndex = -1

        End If

    End Sub

    Private Sub GunaButtonEnvoyer_Click(sender As Object, e As EventArgs) Handles GunaButtonEnvoyer.Click

        Dim args As ArgumentType = New ArgumentType()

        args.CODE_RESERVATAION = GunaLabelNumReservation.Text
        args.NOM_PRENOM = GunaTextBoxNomPrenom.Text
        args.ARRIVAL = GunaDateTimePickerArrivee.Value.ToShortDateString()
        args.DEPART = GunaDateTimePickerDepart.Value.ToShortDateString()
        args.TEMP_A_FAIRE = GunaTextBoxTempsAFaire.Text
        args.TYPE_CHAMBRE = GunaTextBoxLibelleTYpe.Text
        args.NUM_CHAMBRE = GunaTextBoxNumeroChambre.Text
        args.HEURE_ARRIVEE = GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem
        args.HEURE_DEPART = GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem
        args.TYPE_CHAMBRE_SALLE = GlobalVariable.typeChambreOuSalle
        args.EMAIL = GunaTextBoxClientEmail.Text
        args.TELEPHONE_CLIENT = GunaTextBoxTelClient.Text

        Dim WHATSAPP_MAIL As Integer = 2

        Dim montantParNuitee As Double = 0

        If GunaRadioButtonMailOui.Checked Then
            WHATSAPP_MAIL = 1
        End If

        If GunaRadioButtonWhatsAppOui.Checked Then
            WHATSAPP_MAIL = 0
        End If

        args.WHATSAPP_OU_EMAIL = WHATSAPP_MAIL

        If WHATSAPP_MAIL = 2 Then
            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Bien vouloir sélectionner une méthode d'envoie ", "Envoie de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("Please choose a mean to send  ", "Send Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If
        Else

            'Génération des documents concernants les salles Confirmation de réservation
            If GunaRadioButtonSalleFete.Checked Then

                If GunaComboBoxImpressionSalle.SelectedIndex = 0 Then

                    'CONFIRMATION DE RESERVATION

                    Double.TryParse(GunaTextBoxMontantReelSalle.Text, montantParNuitee)

                    args.action = 1
                    'RapportApresCloture.GenerationDeConfirmationReservation(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle, GunaTextBoxClientEmail.Text, GunaTextBoxTelClient.Text, WHATSAPP_MAIL)

                ElseIf GunaComboBoxImpressionSalle.SelectedIndex = 1 Then
                    'CONTRAT DE POLICE
                    If Not Trim(GlobalVariable.codeReservationToUpdate) = "" Then
                        args.action = 5
                        'RapportApresCloture.contratDeLocationDeSalleDeFete(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle, GunaTextBoxClientEmail.Text, GunaTextBoxTelClient.Text, WHATSAPP_MAIL)
                    Else
                        If GlobalVariable.actualLanguageValue = 1 Then
                            MessageBox.Show("Bien vouloir enregistrer la réservation", "Generate PDF", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        Else
                            MessageBox.Show("Please save then booking", "Generate PDF", MessageBoxButtons.OK, MessageBoxIcon.Information)
                        End If
                    End If

                ElseIf GunaComboBoxImpressionSalle.SelectedIndex = 2 Then
                    args.action = 2
                    'RapportApresCloture.devisEstimatifDeSalleDeFete(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle, GunaTextBoxClientEmail.Text, GunaTextBoxTelClient.Text, WHATSAPP_MAIL)
                Else
                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Sélectionner un Document à envoyer!", "Envoi de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    Else
                        MessageBox.Show("Select a Document to be sent !", "Send Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If
                End If

                If WHATSAPP_MAIL = 1 Or WHATSAPP_MAIL = 0 Then
                    backGroundWorkerToCall(args)
                End If

                GunaComboBoxImpressionSalle.SelectedIndex = -1

            ElseIf GunaRadioButtonChambre.Checked Then
                'Génération des documents concernants les chambres confirmation de réservation

                If GunaComboBoxImpressionChambre.SelectedIndex = 0 Then
                    'CONFIRMATION DE RESERVATION
                    Double.TryParse(GunaTextBoxMontantAccorde.Text, montantParNuitee)

                    If Not Trim(GlobalVariable.codeReservationToUpdate) = "" Then
                        args.action = 3
                        'RapportApresCloture.GenerationDeConfirmationReservation(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle, GunaTextBoxClientEmail.Text, GunaTextBoxTelClient.Text, WHATSAPP_MAIL)
                    Else
                        If GlobalVariable.actualLanguageValue = 1 Then
                            MessageBox.Show("Bien vouloir enregistrer la réservation", "Generate PDF", MessageBoxButtons.OK, MessageBoxIcon.Information)

                        Else
                            MessageBox.Show("Please save the booking", "Generate PDF", MessageBoxButtons.OK, MessageBoxIcon.Information)

                        End If
                    End If

                ElseIf GunaComboBoxImpressionChambre.SelectedIndex = 1 Then
                    'FICHE DE POLICE
                    'Génératiion de la fiche de police pour les chambres
                    args.action = 4
                    'RapportApresCloture.GenerationDeFicheDePolice(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.SelectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.SelectedItem, GlobalVariable.typeChambreOuSalle, GunaTextBoxClientEmail.Text, WHATSAPP_MAIL)
                Else

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Sélectionner un Document à envoyer !", "Envoi de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    Else
                        MessageBox.Show("Select a document to be sent !", "Send Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If

                End If

                If WHATSAPP_MAIL = 1 Or WHATSAPP_MAIL = 0 Then
                    backGroundWorkerToCall(args)
                End If

                GunaComboBoxImpressionChambre.SelectedIndex = -1

            End If

        End If

    End Sub

    '----------------------------------------------------------------------------------------------------------------------------
    'vidage des datagrid DOCUMENT
    Public Sub viderDocumentDatagrids()

        GunaDataGridViewDesFactures.Columns.Clear()
        GunaDataGridViewListeDesReglement.Columns.Clear()

    End Sub

    'Listing the room
    Private Sub GunaButtonRoomSearchButton_Click(sender As Object, e As EventArgs) Handles GunaButtonRoomSearchButton.Click

        If GunaRadioButtonSalleFete.Checked Then
            GlobalVariable.typeChambreOuSalle = "salle"
        ElseIf GunaRadioButtonChambre.Checked Then
            GlobalVariable.typeChambreOuSalle = "chambre"
        End If

        'To load a room from a window based on conditions
        GlobalVariable.chambreOuSalleFromFrontDesk = Trim(GunaTextBoxCodeTypeDeChambre.Text)

        RoomForm.Close()
        RoomForm.Show()
        RoomForm.TopMost = True

    End Sub

    'BUtton to Load a promo code when chambre is selected
    Private Sub GunaButtonPromo_Click(sender As Object, e As EventArgs) Handles GunaButtonPromoSalle.Click, GunaButtonPromo.Click

        TarifForm.Close()

        GlobalVariable.tarifFromFrontDesk = True

        TarifForm.Show()
        TarifForm.TopMost = True

    End Sub

    ' Card paiment management
    Private Sub GunaTextBoxPaiement_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxPaiement.TextChanged

        If Not Trim(GunaTextBoxPaiement.Text).Equals("") Then
            Dim paiement As Double = 0
            Double.TryParse(GunaTextBoxPaiement.Text, paiement)
            GlobalVariable.cardPaiement = paiement
        End If

    End Sub

    'GEstion du contenu du bouton paiment au niveau du front desk
    Private Sub GunaButtonPayer_Click(sender As Object, e As EventArgs) Handles GunaButtonPayer.Click

        GlobalVariable.typeDeClientAFacturer = ""

        GlobalVariable.ouvertureDelaFenetreDeReglementApArtirDu = "reception"

        ReglementForm.Close()
        ReglementForm.Show()
        ReglementForm.TopMost = True

    End Sub

    Private Sub GunaButton3_Click_1(sender As Object, e As EventArgs) Handles GunaButtonVider.Click

        GunaButtonCheckOut.Visible = False

        LabelNatureReservation.Visible = False

        Dim dialog As DialogResult

        If GlobalVariable.actualLanguageValue = 1 Then
            dialog = MessageBox.Show("Ceci aura pour effet de vider tous les champs! " & Chr(13) & "Voulez-vous continuer", "Effacement du Front desk ", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

        Else

            dialog = MessageBox.Show("This action will empty all the fields ! " & Chr(13) & "Do you want to continue ", "Erase from Front desk ", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

        End If

        If dialog = DialogResult.Yes Then

            VidageDesChampsPourNouvelleReservation()

            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    'Client form
    Private Sub GunaButtonModifierClient_Click(sender As Object, e As EventArgs) Handles GunaButtonModifierClient.Click

        GlobalVariable.editUserFromFrontOffice = True

        Dim CODE_CLIENT As String = GunaTextBoxRefClient.Text

        Dim client As DataTable = Functions.getElementByCode(CODE_CLIENT, "client", "CODE_CLIENT")

        If client.Rows.Count > 0 Then

            ClientForm.Show()

            ClientForm.TabControl1.SelectedIndex = 0

            ClientForm.GunaTextBoxCodeClient.Text = client.Rows(0)("CODE_CLIENT")
            ClientForm.GunaTextBoxNomRaisonSociale.Text = client.Rows(0)("NOM_CLIENT")
            ClientForm.GunaDataGridViewClientExistant.Visible = False
            ClientForm.GunaTextBoxPrenom.Text = client.Rows(0)("PRENOMS")
            ClientForm.GunaTextBox12.Text = client.Rows(0)("ADRESSE")
            ClientForm.MaskedTextBoxTelephone.Text = client.Rows(0)("TELEPHONE")
            ClientForm.GunaDateTimePicker1.Value = client.Rows(0)("DATE_DE_NAISSANCE")
            ClientForm.GunaTextBox6.Text = client.Rows(0)("LIEU_DE_NAISSANCE")
            ClientForm.GunaTextBoxNomDeJeunneFille.Text = client.Rows(0)("NOM_JEUNE_FILLE")
            ClientForm.GunaTextBoxFax.Text = client.Rows(0)("FAX")
            ClientForm.GunaTextBoxEmail.Text = client.Rows(0)("EMAIL")

            '------------------------------------------------------------------------
            'GunaTextBoxNationalite.Text = client.Rows(0)("NATIONALITE")

            'GunaComboBoxPays.SelectedValue = client.Rows(0)("PAYS_RESIDENCE")

            ClientForm.GunaComboBoxPays.SelectedValue = client.Rows(0)("PAYS_RESIDENCE")

            If Trim(ClientForm.GunaTextBoxNationalite.Text).Equals("") Then

                'ClientForm.FillingAllComboxBox()

                Dim PAYS As String = ClientForm.GunaComboBoxPays.SelectedValue.ToString()
                Dim infoSup As DataTable

                If GlobalVariable.actualLanguageValue = 0 Then

                    infoSup = Functions.getElementByCode(PAYS, "pays", "NOM_PAYS_EN")

                    If infoSup.Rows.Count > 0 Then
                        ClientForm.GunaTextBoxNationalite.Text = infoSup.Rows(0)("NATIONALITE_EN")
                    End If

                Else

                    infoSup = Functions.getElementByCode(PAYS, "pays", "NOM_PAYS_FR")

                    If infoSup.Rows.Count > 0 Then
                        ClientForm.GunaTextBoxNationalite.Text = infoSup.Rows(0)("NATIONALITE_FR")
                    End If

                End If

            End If

            '-------------------------------------------------------------------------
            'GUnaTextBoxNumCompteReal.Text = client.Rows(0)("NUM_COMPTE_COLLECTIF")
            ClientForm.GunaComboBoxTypeClient.SelectedValue = client.Rows(0)("TYPE_CLIENT")
            ClientForm.GunaTextBoxSiteWeb.Text = client.Rows(0)("SITE_INTERNET")
            ClientForm.GunaTextBoxProfession.Text = client.Rows(0)("PROFESSION")
            ClientForm.GunaTextBoxCni.Text = client.Rows(0)("CNI")
            'GunaComboBoxVille.SelectedValue = client.Rows(0)("VILLE_DE_RESIDENCE")
            ClientForm.GunaTextBox5.Text = client.Rows(0)("VILLE_DE_RESIDENCE")
            ClientForm.GunaComboBoxModeReglement.SelectedItem = client.Rows(0)("CODE_MODE_PAIEMENT")
            ClientForm.GunaComboBoxModeTransport.SelectedItem = client.Rows(0)("MODE_TRANSPORT")
            ClientForm.GunaTextBoxNumVehicule.Text = client.Rows(0)("NUM_VEHICULE")

            ClientForm.GunaTextBoxMarqueVehicule.Text = client.Rows(0)("MARQUE_VEHICULE")

            ClientForm.GunaTextBoxEntreprise.Text = client.Rows(0)("CODE_ENTREPRISE")

            'LE NUMERO DE COMPTE N'EXISTE PAS DONC NUMERO DE COMPTE PROVIENT DES INFOS DU CLIENT
            ClientForm.GUnaTextBoxNumCompteReal.Text = client.Rows(0)("NUM_COMPTE")

            'ATTRIBUTION DES INFORMATION DE COMPTE FINANCE

            Dim compte As DataTable = Functions.getElementByCode(ClientForm.GunaTextBoxCodeClient.Text, "compte", "CODE_CLIENT")

            If compte.Rows.Count > 0 Then

                If Not Trim(compte.Rows(0)("NUMERO_COMPTE")) = "" Then
                    'LE NUMERO DE COMPTE EXISTE
                    ClientForm.GUnaTextBoxNumCompteReal.Text = Trim(compte.Rows(0)("NUMERO_COMPTE")) ' NUMERO DE COMPTE
                Else
                    'ClientForm.GUnaTextBoxNumCompteReal.Text = Trim(Functions.GeneratingRandomCodeAccountNumber("compte", INDICE_DE_COMPTE))
                End If

                ClientForm.GunaTextBoxIntituleDeCompte.Text = Trim(compte.Rows(0)("INTITULE")) ' INTITULE DE COMPTE

                ClientForm.GunaTextBoxPersonneAContacter.Text = Trim(compte.Rows(0)("PERSONNE_A_CONTACTER")) ' INTITULE DE COMPTE
                ClientForm.GunaTextBoxContactPourPaiement.Text = Trim(compte.Rows(0)("CONTACT_PAIEMENT")) ' INTITULE DE COMPTE
                ClientForm.GunaTextBoxAdresseDeFacturation.Text = Trim(compte.Rows(0)("ADRESSE_DE_FACTURATION")) ' INTITULE DE COMPTE

                If compte.Rows(0)("PLAFONDS_DU_COMPTE") >= 0 Then
                    ClientForm.GunaTextBoxMontantPlafondsDuCompte.Text = Format(compte.Rows(0)("PLAFONDS_DU_COMPTE"), "#,##0.00")
                Else
                    ClientForm.GunaTextBoxMontantPlafondsDuCompte.Text = 0
                End If

                If compte.Rows(0)("DELAI_DE_PAIEMENT") >= 0 Then
                    ClientForm.NumericUpDownDelaiDePaiement.Text = Trim(compte.Rows(0)("DELAI_DE_PAIEMENT"))
                Else
                    ClientForm.NumericUpDownDelaiDePaiement.Text = 0
                End If

                If compte.Rows(0)("ETAT_DU_COMPTE") = 1 Then
                    ClientForm.GunaCheckBoxActivationDesactivationDuCompte.Checked = True
                Else
                    ClientForm.GunaCheckBoxActivationDesactivationDuCompte.Checked = False
                End If

            Else

                'ClientForm.GUnaTextBoxNumCompteReal.Text = Trim(Functions.GeneratingRandomCodeAccountNumber("compte", INDICE_DE_COMPTE))

            End If

            '-------------------------------------------------------------

            If Not Trim(ClientForm.GunaTextBoxEntreprise.Text).Equals("") Then

                Dim infoSupEntreprise As DataTable = Functions.getElementByCode(ClientForm.GunaTextBoxEntreprise.Text, "client", "CODE_CLIENT")
                If infoSupEntreprise.Rows.Count > 0 Then
                    ClientForm.GunaTextBoxCompanyName.Text = infoSupEntreprise.Rows(0)("NOM_PRENOM")
                Else
                    ClientForm.GunaTextBoxEntreprise.Clear()
                End If

            End If

            Functions.AffectingTitleToAForm(ClientForm.GunaTextBoxNomRaisonSociale.Text + " " + ClientForm.GunaTextBoxPrenom.Text, ClientForm.GunaLabelTitreForm)

            'AssignACompanyToClient()

            'ONT CHARGENT LES DONNEES DES TARIF DU CLIENT

            Dim tarifs As New Tarifs

            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Clear()

            If tarifs.SelectionDesForfaitsDuClient(client.Rows(0)("CODE_CLIENT")).Rows.Count > 0 Then
                ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.DataSource = tarifs.SelectionDesForfaitsDuClient(client.Rows(0)("CODE_CLIENT"))
            End If

            'connect.closeConnection()

            'ON rempli les entetes du datagrid des tarif pour éviterqu'il ne se répète
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.BringToFront()
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("ID_TARIF_PRIX", "ID")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("CODE_TARIF", "CODE APPLIQUE")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("TYPE_TARIF", "TYPE TARIF")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("CODE_TYPE", "CODE TYPE")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF_ENCOURS", "PRIX ENCOURS")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF1", "PRIX 1")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF2", "PRIX 2")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF3", "PRIX 3")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF4", "PRIX 4")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF5", "PRIX 5")


            If GlobalVariable.actualLanguageValue = 1 Then
                ClientForm.GunaButtonEnregistrerClient.Text = "Sauvegarder"

            Else
                ClientForm.GunaButtonEnregistrerClient.Text = "Update"
            End If

            ClientForm.TopMost = True

        End If

    End Sub

    'GENERAL ACCOUNT
    Private Sub ToolStripMenuItem75_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem75.Click
        GeneralAccountForm.Show()
    End Sub

    '---------------------------------------------------- GESTION DU TABLEAU DE BORDS - DASHBOARD ---------------------------------------------------------------
    'ARRIVEES
    Private Sub GunaAdvenceButtonArrivee_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonArrivee.Click


        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabel51.Text = "ATTENDUES"

        Else
            GunaLabel51.Text = "EXPECTED"

        End If

        GunaLabel51.Visible = True
        'Dim DateDebut As Date = GunaDateTimePickerArriveeDepart.Value.ToString("yyyy-MM-dd")
        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")
        'Dim DateFin As Date = GunaDateTimePickerDepartDepert.Value.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        If (DateDebut <= DateFin) Then

            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION = @ETAT_RESERVATION ORDER BY CHAMBRE_ID ASC"

            Dim ETAT_RESERVATION As Integer = 0
            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
            command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int64).Value = ETAT_RESERVATION

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaDataGridViewResaDashBoard.DataSource = table
                GunaDataGridViewResaDashBoard.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                GunaDataGridViewResaDashBoard.DefaultCellStyle.SelectionForeColor = Color.White
                GunaDataGridViewResaDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewResaDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewResaDashBoard.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewResaDashBoard.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewResaDashBoard.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

            Else

                GunaDataGridViewResaDashBoard.Columns.Clear()

            End If

            'connect.closeConnection()
        End If

    End Sub

    'DEPARTS
    Private Sub GunaAdvenceButtonDeparts_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonDeparts.Click


        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabel51.Text = "DEPARTS"

        Else
            GunaLabel51.Text = "DUE OUT"

        End If
        GunaLabel51.Visible = True

        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        If (DateDebut <= DateFin) Then

            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_SORTIE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaDataGridViewResaDashBoard.DataSource = table
                GunaDataGridViewResaDashBoard.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                GunaDataGridViewResaDashBoard.DefaultCellStyle.SelectionForeColor = Color.White
                GunaDataGridViewResaDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewResaDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewResaDashBoard.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewResaDashBoard.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewResaDashBoard.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
            Else

                GunaDataGridViewResaDashBoard.Columns.Clear()

            End If

            'connect.closeConnection()

        End If

    End Sub

    'EN CHAMBRE
    Private Sub GunaAdvenceButtonSejour_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonSejour.Click


        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabel51.Text = "SEJOURS"

        Else
            GunaLabel51.Text = "STAY"

        End If

        GunaLabel51.Visible = True

        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        Dim query As String = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()
        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            GunaDataGridViewResaDashBoard.DataSource = table
            GunaDataGridViewResaDashBoard.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
            GunaDataGridViewResaDashBoard.DefaultCellStyle.SelectionForeColor = Color.White
            GunaDataGridViewResaDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewResaDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            GunaDataGridViewResaDashBoard.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewResaDashBoard.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            GunaDataGridViewResaDashBoard.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

        Else

            GunaDataGridViewResaDashBoard.Columns.Clear()

        End If

        'connect.closeConnection()

    End Sub

    'NO SHOW
    Private Sub GunaAdvenceButtoNoShow_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtoNoShow.Click

        GunaLabel51.Text = "NO SHOW"

        GunaLabel51.Visible = True

        Dim DateDebut As Date = GlobalVariable.DateDeTravail.AddDays(-1)
        Dim DateFin As Date = GlobalVariable.DateDeTravail.AddDays(-1)

        If (DateDebut <= DateFin) Then

            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_temp WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE >='" & DateFin.ToString("yyyy-MM-dd") & "' ORDER BY CHAMBRE_ID ASC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            'command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaDataGridViewResaDashBoard.DataSource = table
                GunaDataGridViewResaDashBoard.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                GunaDataGridViewResaDashBoard.DefaultCellStyle.SelectionForeColor = Color.White
                GunaDataGridViewResaDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewResaDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewResaDashBoard.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewResaDashBoard.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewResaDashBoard.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

            Else

                GunaDataGridViewResaDashBoard.Columns.Clear()

            End If

            'connect.closeConnection()

        End If

    End Sub

    'GESTION DES ELEMENTS DU PANNEAU GAUCHE DU DASHBOARD APRES UN DOUBLE CLICK
    Private Sub GunaDataGridViewCLientDashBoard_CellDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewResaDashBoard.CellDoubleClick

        If e.RowIndex >= 0 Then
            LabelNatureReservation.Visible = True
            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewResaDashBoard.Rows(e.RowIndex)

            GlobalVariable.codeReservationToUpdate = row.Cells("RESERVATION").Value.ToString

            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If GlobalVariable.actualLanguageValue = 1 Then
                LabelNatureReservation.Text = "ATTENDUE"

            Else
                LabelNatureReservation.Text = "EXPECTED"

            End If

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_temp", "CODE_RESERVATION")
                If GlobalVariable.actualLanguageValue = 1 Then
                    LabelNatureReservation.Text = "ANNULEE"

                Else
                    LabelNatureReservation.Text = "CANCELED"

                End If
                If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                    'not found in reservation so, we search in reserve_conf
                    GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

                    If GlobalVariable.actualLanguageValue = 1 Then

                        LabelNatureReservation.Text = "EN CHAMBRE"

                    Else
                        LabelNatureReservation.Text = "IN HOUSE"

                    End If

                End If

            End If

            'Variable to print or not checkout button
            GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION")
            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")
            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
                mainCouranteJournaliere = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate


            If GunaRadioButtonSalleFete.Checked Then

                Dim typeChambre As DataTable = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                    GunaTextBoxMateriel.Text = Format(Forfait.Rows(0)("LOCATION_MATERIEL"), "#,##0")
                    GunaTextBoxAutres.Text = Format(Forfait.Rows(0)("AUTRES"), "#,##0")

                    GunaComboBoxEvenement.SelectedValue = Forfait.Rows(0)("CODE_EVENEMENT")

                    '------------- addition -----------------------------------------------

                    GunaTextBoxQteGouter.Text = Forfait.Rows(0)("NBRE_GOUTER")
                    GunaTextBoxPrixGouter.Text = Format(Forfait.Rows(0)("PU_GOUTER"), "#,##0")

                    GunaTextBoxCocktail.Text = Format(Forfait.Rows(0)("NBRE_COCKTAIL"), "#,##0")
                    GunaTextBoxPUCocktail.Text = Format(Forfait.Rows(0)("PU_COCKTAIL"), "#,##0")

                    GunaComboBoxHeureCafe.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_CAFE"))
                    GunaComboBoxHeureCafe.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_CAFE")
                    GunaComboBoxHeureDej.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER"))
                    GunaComboBoxHeureDej.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER")
                    GunaComboBoxHeureDiner.Items.Add(Forfait.Rows(0)("HEURE_DINER"))
                    GunaComboBoxHeureDiner.SelectedItem = Forfait.Rows(0)("HEURE_DINER")
                    GunaComboBoxHeureGouter.Items.Add(Forfait.Rows(0)("HEURE_GOUTER"))
                    GunaComboBoxHeureGouter.SelectedItem = Forfait.Rows(0)("HEURE_GOUTER")
                    GunaComboBoxHeureCocktail.Items.Add(Forfait.Rows(0)("HEURE_COCKTAIL"))
                    GunaComboBoxHeureCocktail.SelectedItem = Forfait.Rows(0)("HEURE_COCKTAIL")

                    'QUANTITE

                    GunaTextBox47.Text = Forfait.Rows(0)("EAU_PTE_QTE")
                    GunaTextBox48.Text = Forfait.Rows(0)("BOISSONS_GAZEUSES_QTE")
                    GunaTextBox54.Text = Forfait.Rows(0)("VIN_ROUGE_QTE")
                    GunaTextBox63.Text = Forfait.Rows(0)("VIN_ROSE_QTE")
                    GunaTextBox10.Text = Forfait.Rows(0)("EAU_GRDE_QTE")
                    GunaTextBox50.Text = Forfait.Rows(0)("BIERES_QTE")
                    GunaTextBox36.Text = Forfait.Rows(0)("BOISSONS_EXT_QTE")

                    'MONTANT
                    GunaTextBoxMontantEauPetiteBouteille.Text = Format(Forfait.Rows(0)("EAU_PTE_MONTANT"), "#,##0")
                    GunaTextBox68.Text = Format(Forfait.Rows(0)("EAU_GRDE_MONTANT"), "#,##0")
                    GunaTextBox62.Text = Format(Forfait.Rows(0)("BOISSONS_GAZEUSES_MONTANT"), "#,##0")
                    GunaTextBox61.Text = Format(Forfait.Rows(0)("BIERES_MONTANT"), "#,##0")
                    GunaTextBox59.Text = Format(Forfait.Rows(0)("VIN_ROUGE_MONTANT"), "#,##0")
                    GunaTextBox57.Text = Format(Forfait.Rows(0)("VIN_ROSE_MONTANT"), "#,##0")
                    GunaTextBox64.Text = Format(Forfait.Rows(0)("BOISSONS_EXT_MONTANT"), "#,##0")
                    GunaTextBoxDroitDeBouchon.Text = Format(Forfait.Rows(0)("DROIT_DE_BOUCHON"), "#,##0")

                    If Forfait.Rows(0)("VIDEO_PROJ") = 1 Then
                        GunaCheckBoxVidOui.Checked = True
                        GunaCheckBoxVidNon.Checked = False
                    Else
                        GunaCheckBoxVidNon.Checked = True
                        GunaCheckBoxVidOui.Checked = False
                    End If

                    If Forfait.Rows(0)("SONO") = 1 Then
                        GunaCheckBoxSonoOui.Checked = True
                        GunaCheckBoxSonoNon.Checked = False
                    Else
                        GunaCheckBoxSonoNon.Checked = True
                        GunaCheckBoxSonoOui.Checked = False
                    End If

                    If Forfait.Rows(0)("COUVERTS") = 1 Then
                        GunaCheckBoxCouvOui.Checked = True
                        GunaCheckBoxCouvNon.Checked = False
                    Else
                        GunaCheckBoxCouvNon.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    End If

                    If Forfait.Rows(0)("TABLE_CHAISE") = 1 Then
                        GunaCheckBoxTableOui.Checked = True
                        GunaCheckBoxTableNon.Checked = False
                    Else
                        GunaCheckBoxTableNon.Checked = True
                        GunaCheckBoxTableOui.Checked = False
                    End If

                    If Forfait.Rows(0)("MISE_EN_PLACE") = 1 Then
                        GunaCheckBoxEcole.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 2 Then
                        GunaCheckBoxTheatre.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 3 Then
                        GunaCheckBoxRectangle.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 4 Then
                        GunaCheckBoxCocktail.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 5 Then
                        GunaCheckBoxBanquet.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 0 Then
                        GunaCheckBoxU.Checked = True
                    End If

                    If Forfait.Rows(0)("CLOISONNEMENT") = 2 Then
                        GunaCheckBox2.Checked = True
                    ElseIf Forfait.Rows(0)("CLOISONNEMENT") = 3 Then
                        GunaCheckBox9.Checked = True
                    End If
                End If

            End If

            TabControlHbergement.SelectedIndex = 0

            'Affecting values mostly for calculations
            affectingValuesToFields()

            GunaDataGridViewRoomType.Visible = False

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

        End If

        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

        TabControlHbergement.SelectedIndex = 0

    End Sub

    '-------------------------------------- GESTION DE PANNEAU DU MILIEU ---------------------------------------

    'STATS DU DASHBOARD

    'Cette fonction contient l'ensemble des informations pour les statistiques
    Public Sub contenuStatistique()

        'Obtention des informations pour les statistiques
        Dim stat As New statistiques()

        stat.ObtenirDerniereStatistique()

        Dim codeDelaDerniereStatistique As String = stat.ObtenirDerniereStatistique()

        GlobalVariable.informationDesStatistiques = Functions.getElementByCode(codeDelaDerniereStatistique, "statistiques", "CODE_STATISTIQUE")

        ' End of obtention des informations statistique

    End Sub

    'PANNEAU LATERAL GAUCHE

    Public Sub StatistiquesDesChambres()

        contenuStatistique()

        Dim rooms As New Room()
        Dim HSRooms As Integer = rooms.HSRoomsOnly().Rows.Count

        Dim departAEffectue As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_DEPART_INITIAL")
        Dim dtDepartEffectue As DataTable = Functions.departEffectueDuJour(GlobalVariable.DateDeTravail)
        Dim departEffectue As Integer = 0
        If dtDepartEffectue.Rows.Count > 0 Then
            departEffectue = dtDepartEffectue.Rows.Count
        End If

        Dim departTotal As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_DEPART_FINAL")

        'Dim arriveeEffectuee As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_ARRIVEE_INITIAL")
        Dim arriveeAEffectuee As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_ARRIVEE_INITIAL")
        Dim arriveeEffectuee As Integer = 0
        Dim dtArriveeEffectuee As DataTable = Functions.checkInEffectueDuJour(GlobalVariable.DateDeTravail)
        If dtArriveeEffectuee.Rows.Count > 0 Then
            arriveeEffectuee = dtArriveeEffectuee.Rows.Count
        End If

        Dim nbreDayUse As Integer = 0
        Dim dtDayUse As DataTable = Functions.dayUseEffectueDuJour(GlobalVariable.DateDeTravail)
        If dtDayUse.Rows.Count > 0 Then
            nbreDayUse = dtDayUse.Rows.Count
        End If

        Dim arrriveeTotal As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_ARRIVEE_FINAL")

        Dim nombreTotalDeChambre As Integer = rooms.ActiveRoomsOnly().Rows.Count
        'Dim nombreTotalDeChambre As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_CHAMBRE_TOTAL")

        Dim nombreDeChambreOccupee As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_CHAMBRE_OCCUPEE") 'EN CHAMBRE + ATTENDUS
        Dim nombreDeChambreLibre As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_CHAMBRE_LIBRE") - HSRooms

        Dim stat As New statistiques()

        'Dim nombreArriveeActuel As Integer = stat.informationSurLesReservations("arrivee")
        Dim nombreDeDepartActuel As Integer = stat.informationSurLesReservations("depart")

        GunaLabelCodeMonnaie.Text = GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
        GunaLabelMonnaieCode.Text = GlobalVariable.societe.Rows(0)("CODE_MONNAIE")

        Dim roundedValue As Double = Math.Round(GlobalVariable.informationDesStatistiques.Rows(0)("RECETTE_TOTAL_PAR_CHAMBRE"), 0)

        Dim xValue As Integer = 22
        Dim yValue As Integer = 43

        For m = 0 To 6

            Dim customPanel As New Panel
            customPanel.Text = "Test" & m
            customPanel.Name = "a" & m
            customPanel.Location = New Point(xValue, yValue)

            If m = 0 Then
                'customPanel.BackColor = Color.LightSkyBlue
                customPanel.Size = New Size(185, 70)
                'customPanel.BackColor = Color.CadetBlue
            ElseIf m = 1 Then
                'customPanel.BackColor = Color.LightSkyBlue
                customPanel.Size = New Size(185, 70)
                'customPanel.BackColor = Color.YellowGreen
            ElseIf m = 2 Then
                customPanel.Size = New Size(185, 70)
                'customPanel.BackColor = Color.LightSkyBlue
            ElseIf m = 3 Then
                'customPanel.BackColor = Color.Peru
                'customPanel.BackColor = Color.LightSkyBlue
                customPanel.Size = New Size(185, 70)
            ElseIf m = 4 Then
                'customPanel.BackColor = Color.Peru
                'customPanel.BackColor = Color.LightSkyBlue
                customPanel.Size = New Size(185, 70)
            ElseIf m = 5 Then
                'customPanel.BackColor = Color.Peru
                'customPanel.BackColor = Color.LightSkyBlue
                customPanel.Size = New Size(185, 95)
            ElseIf m = 6 Then
                'customPanel.BackColor = Color.Peru
                'customPanel.BackColor = Color.LightSkyBlue
                customPanel.Size = New Size(185, 95)
                'customPanel.BackColor = Color.Goldenrod
            End If

            customPanel.BackColor = Color.CornflowerBlue
            customPanel.ForeColor = Color.White
            'customPanel.Size = New Size(75, 103)

            customPanel.Anchor = AnchorStyles.None

            Dim customLabel As New Label

            customLabel.AutoSize = True
            customLabel.Font = New System.Drawing.Font("Maiandra GD", 11.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))

            customLabel.Name = "customLabel"
            customLabel.Size = New System.Drawing.Size(67, 81)
            customLabel.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            customLabel.TabIndex = 4

            Dim customLabelValue As New Label

            customLabelValue.AutoSize = True
            customLabelValue.Font = New System.Drawing.Font("Maiandra GD", 35.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
            customLabelValue.Location = New System.Drawing.Point(55, -10)
            customLabelValue.Name = "customLabelValue"
            customLabelValue.Size = New System.Drawing.Size(67, 65)
            customLabelValue.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            customLabelValue.TabIndex = 4

            Dim customLabelValue1 As New Label

            customLabelValue1.AutoSize = True
            customLabelValue1.Font = New System.Drawing.Font("Maiandra GD", 14.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
            customLabelValue1.Location = New System.Drawing.Point(65, 65)
            customLabelValue1.Name = "customLabelValue1"
            customLabelValue1.Size = New System.Drawing.Size(67, 81)
            customLabelValue1.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            customLabelValue1.TabIndex = 4

            If departTotal = 1 Then
                'departTotal *= 2
            End If

            'Gestion de l'etat en plus du nombre
            If m = 0 Then
                'customLabelValue.Text = departTotal - departEffectue
                customLabelValue.Text = departAEffectue

                'customLabelValue1.Text = departEffectue & " / " & departTotal
                'customLabelValue1.Text = departTotal - departEffectue & " / " & departTotal

                customLabel.Location = New System.Drawing.Point(35, 43)

                If GlobalVariable.actualLanguageValue = 1 Then
                    customLabel.Text = "Départs Restants"
                Else
                    customLabel.Text = "Left Due Out"
                End If

                AddHandler customLabel.Click, AddressOf onDepartureClick
                AddHandler customPanel.Click, AddressOf onDepartureClick
                AddHandler customLabelValue.Click, AddressOf onDepartureClick

            ElseIf m = 1 Then

                customLabelValue.Text = departEffectue

                'customLabelValue1.Text = (arrriveeTotal / 2) - arriveeEffectuee & " / " & arrriveeTotal / 2

                customLabel.Location = New System.Drawing.Point(30, 43)

                If GlobalVariable.actualLanguageValue = 1 Then
                    customLabel.Text = "Départs effectués"
                Else
                    customLabel.Text = "Departure"
                End If

                AddHandler customLabel.Click, AddressOf onDepartedClick
                AddHandler customPanel.Click, AddressOf onDepartedClick
                AddHandler customLabelValue.Click, AddressOf onDepartedClick

            ElseIf m = 2 Then

                customLabelValue.Text = arriveeAEffectuee

                'customLabelValue1.Text = (arrriveeTotal / 2) - arriveeEffectuee & " / " & arrriveeTotal / 2

                customLabel.Location = New System.Drawing.Point(30, 43)

                If GlobalVariable.actualLanguageValue = 1 Then
                    customLabel.Text = "Clients Attendues"
                Else
                    customLabel.Text = "Expected Client"
                End If

                AddHandler customLabel.Click, AddressOf onArrivalsClick
                AddHandler customPanel.Click, AddressOf onArrivalsClick
                AddHandler customLabelValue.Click, AddressOf onArrivalsClick

            ElseIf m = 3 Then

                customLabelValue.Text = arriveeEffectuee

                'customLabelValue1.Text = (arrriveeTotal / 2) - arriveeEffectuee & " / " & arrriveeTotal / 2

                customLabel.Location = New System.Drawing.Point(60, 43)

                If GlobalVariable.actualLanguageValue = 1 Then
                    customLabel.Text = "Arrivées"
                Else
                    customLabel.Text = "Arrivals"
                End If

                AddHandler customLabel.Click, AddressOf onCheckedInClick
                AddHandler customPanel.Click, AddressOf onCheckedInClick
                AddHandler customLabelValue.Click, AddressOf onCheckedInClick

            ElseIf m = 4 Then

                customLabel.Location = New System.Drawing.Point(60, 43)
                customLabelValue.Text = nbreDayUse
                'customLabelValue1.Text = nombreDeChambreOccupee & " / " & nombreTotalDeChambre

                If GlobalVariable.actualLanguageValue = 1 Then
                    customLabel.Text = "Day Use"
                Else
                    customLabel.Text = "Day Use"
                End If

                AddHandler customLabel.Click, AddressOf onDayUseClick
                AddHandler customPanel.Click, AddressOf onDayUseClick
                AddHandler customLabelValue.Click, AddressOf onDayUseClick

            ElseIf m = 5 Then

                customLabel.Location = New System.Drawing.Point(20, 43)

                customLabelValue.Text = nombreDeChambreOccupee

                customLabelValue1.Text = nombreDeChambreOccupee & " / " & nombreTotalDeChambre

                If GlobalVariable.actualLanguageValue = 1 Then
                    customLabel.Text = "Chambres occupées"

                Else
                    customLabel.Text = "Occupied Rooms"

                End If

                AddHandler customLabel.Click, AddressOf onOccupiedRoomsClick
                AddHandler customPanel.Click, AddressOf onOccupiedRoomsClick
                AddHandler customLabelValue.Click, AddressOf onOccupiedRoomsClick

            ElseIf m = 6 Then

                customLabelValue.Text = nombreDeChambreLibre

                customLabelValue1.Text = nombreDeChambreLibre & " / " & nombreTotalDeChambre

                customLabel.Location = New System.Drawing.Point(40, 43)

                If GlobalVariable.actualLanguageValue = 1 Then
                    customLabel.Text = "Chambres libres"
                Else
                    customLabel.Text = "Free Rooms"
                End If

                AddHandler customLabel.Click, AddressOf onFreeRoomsClick
                AddHandler customPanel.Click, AddressOf onFreeRoomsClick
                AddHandler customLabelValue.Click, AddressOf onFreeRoomsClick

            End If

            customPanel.Controls.Add(customLabel)
            customPanel.Controls.Add(customLabelValue)
            customPanel.Controls.Add(customLabelValue1)

            GunaGroupBoxStatistiques.Controls.Add(customPanel)

            If m < 5 Then
                yValue += 75
            Else
                yValue += 100
            End If


        Next

        'CREATION DU STATUT DES CHAMBRES

        Dim roomList As New Room()
        Dim Room As DataTable = roomList.roomsOnly()

        Dim sale As Integer = 0
        Dim propre As Integer = 0
        Dim horsService As Integer = 0
        Dim aInspecter As Integer = 0
        Dim enCours As Integer = 0

        If Room.Rows.Count > 0 Then

            For i = 0 To Room.Rows.Count - 1

                If GlobalVariable.actualLanguageValue = 1 Then

                    If Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée sale" Or Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre sale" Then
                        'Chambre sale
                        sale += 1
                    ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée propre" Or Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre propre" Then
                        propre += 1
                    ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Hors Service" Then
                        horsService += 1
                    ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Nettoyage" Then
                        'En cours de nettoyage
                        enCours += 1
                    ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Attente" Then
                        'Chambre dont le nettoyage est termine et en attente de validation
                        aInspecter += 1
                    End If

                Else

                    If Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupied dirty" Or Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Free dirty" Then
                        'Chambre sale
                        sale += 1
                    ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupied clean" Or Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Free clean" Then
                        propre += 1
                    ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Out of service" Then
                        horsService += 1
                    ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Cleaning" Then
                        'En cours de nettoyage
                        enCours += 1
                    ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Pending" Then
                        'Chambre dont le nettoyage est termine et en attente de validation
                        aInspecter += 1
                    End If

                End If


            Next

        End If

        Dim xValueStatus As Integer = 420
        Dim yValueStatus As Integer = 300
        Dim compteur As Integer = 0

        For m = 0 To 4

            compteur += 1
            Dim customPanel As New Panel
            customPanel.Text = "Test" & m
            customPanel.Name = "a" & m
            customPanel.Location = New Point(xValueStatus, yValueStatus)

            If m = 0 Then
                customPanel.BackColor = Color.Red
            ElseIf m = 3 Then
                customPanel.BackColor = Color.Green
            ElseIf m = 2 Then
                customPanel.BackColor = Color.Orange
            ElseIf m = 1 Then
                customPanel.BackColor = Color.OrangeRed
            ElseIf m = 4 Then
                customPanel.BackColor = Color.Black
            End If

            customPanel.ForeColor = Color.White
            'customPanel.Size = New Size(75, 103)
            customPanel.Size = New Size(130, 30)
            customPanel.Anchor = AnchorStyles.None


            Dim customLabel As New Label
            customLabel.BringToFront()
            customLabel.AutoSize = True
            customLabel.ForeColor = Color.White
            customLabel.Font = New System.Drawing.Font("Maiandra GD", 11.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))

            customLabel.Name = "customLabelDashboard"
            customLabel.Size = New System.Drawing.Size(75, 15)
            customLabel.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            customLabel.TabIndex = 4

            Dim customLabelValue As New Label

            customLabelValue.AutoSize = True
            customLabelValue.ForeColor = Color.White
            customLabelValue.Font = New System.Drawing.Font("Maiandra GD", 12.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
            customLabelValue.Location = New System.Drawing.Point(332, 378)
            customLabelValue.Name = "customLabelDashBoardValue"
            customLabelValue.Size = New System.Drawing.Size(15, 80)
            customLabelValue.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            customLabelValue.TabIndex = 4

            'Gestion de l'etat en plus du nombre
            If m = 0 Then

                customLabelValue.Text = "(" & sale & ")"
                customLabel.BackColor = Color.Red
                customLabelValue.BackColor = Color.Red
                customLabel.Location = New System.Drawing.Point(xValueStatus + 40, yValueStatus + 5)
                'customLabelValue.Location = New System.Drawing.Point(xValueStatus, yValueStatus + 2)

                If GlobalVariable.actualLanguageValue = 1 Then
                    If sale > 0 Then
                        customLabel.Text = "Sales"
                    Else
                        customLabel.Text = "Sale"
                    End If

                Else
                    customLabel.Text = "Dirty"
                End If

            ElseIf m = 3 Then
                customLabel.BackColor = Color.Green
                customLabelValue.BackColor = Color.Green
                customLabelValue.Text = "(" & propre & ")"
                customLabel.Location = New System.Drawing.Point(xValueStatus + 40, yValueStatus + 5)
                'customLabelValue.Location = New System.Drawing.Point(xValueStatus, yValueStatus + 2)

                If GlobalVariable.actualLanguageValue = 1 Then
                    If propre > 0 Then
                        customLabel.Text = "Propres"
                    Else
                        customLabel.Text = "Propre"
                    End If
                Else

                    customLabel.Text = "Clean"

                End If

            ElseIf m = 2 Then
                customLabel.BackColor = Color.Orange
                customLabelValue.BackColor = Color.Orange
                customLabel.Location = New System.Drawing.Point(xValueStatus + 40, yValueStatus + 5)
                'customLabelValue.Location = New System.Drawing.Point(xValueStatus, yValueStatus + 2)
                customLabelValue.Text = "(" & aInspecter & ")"

                If aInspecter > 0 Then
                    customLabel.Text = "A inspecters"
                Else
                    customLabel.Text = "A inspecter"
                End If

                If GlobalVariable.actualLanguageValue = 1 Then
                    If aInspecter > 0 Then
                        customLabel.Text = "A inspecters"
                    Else
                        customLabel.Text = "A inspecter"
                    End If
                Else
                    customLabel.Text = "To Inspect"

                End If


            ElseIf m = 1 Then
                customLabelValue.Text = "(" & enCours & ")"
                customLabel.BackColor = Color.OrangeRed
                customLabelValue.BackColor = Color.OrangeRed
                customLabel.Location = New System.Drawing.Point(xValueStatus + 40, yValueStatus + 5)
                'customLabelValue.Location = New System.Drawing.Point(xValueStatus, yValueStatus + 2)


                If GlobalVariable.actualLanguageValue = 1 Then
                    If enCours > 0 Then
                        customLabel.Text = "En cours"
                    Else
                        customLabel.Text = "En cours"
                    End If
                Else
                    customLabel.Text = "On going"

                End If

            ElseIf m = 4 Then
                customLabelValue.BackColor = Color.Black
                customLabel.BackColor = Color.Black
                customLabelValue.Text = "(" & horsService & ")"
                customLabel.Location = New System.Drawing.Point(xValueStatus + 40, yValueStatus + 5)
                'customLabelValue.Location = New System.Drawing.Point(xValueStatus, yValueStatus + 2)


                If GlobalVariable.actualLanguageValue = 1 Then

                    If horsService > 0 Then
                        customLabel.Text = "Hors services"
                    Else
                        customLabel.Text = "Hors service"
                    End If

                Else

                    customLabel.Text = "Out of service"


                End If

            End If

            xValueStatus += 140

            If compteur Mod 2 = 0 Then

                xValueStatus = 420

                yValueStatus += 42

            End If
        Next

    End Sub

    'EVENEMENT SUR LES INDICATEURS CHIFFRES DU STATUTSDESCHAMBRES()

    Private Sub onDayUseClick(ByVal sender As Object, ByVal e As System.EventArgs)

        TabControlHbergement.SelectedIndex = 3
        PanelTableauDeBords.Hide()
        PanelEnregistrement.BringToFront()
        PanelEnregistrement.Show()
        PanelPlanning.Hide()

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewEnChambre.Columns.Clear()

        ListeDesUsesDuJour(GlobalVariable.DateDeTravail)

        If DataGridViewEnChambre.Rows.Count > 0 Then
            GunaLabelNbreEnChambre.Text = "(" & DataGridViewEnChambre.Rows.Count & ")"
        Else
            GunaLabelNbreEnChambre.Text = "(0)"
        End If

        PanelTableauDeBords.BringToFront()

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabel52.Text = "DAY USE OF :"
        Else
            GunaLabel52.Text = "DAY USE OF :"
        End If

    End Sub

    Private Sub onCheckedInClick(ByVal sender As Object, ByVal e As System.EventArgs)

        TabControlHbergement.SelectedIndex = 3
        PanelTableauDeBords.Hide()
        PanelEnregistrement.BringToFront()
        PanelEnregistrement.Show()
        PanelPlanning.Hide()

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewEnChambre.Columns.Clear()
        'DataGridViewEnChambre.DataSource = Nothing

        ListeDesEnChambresDuJour(GlobalVariable.DateDeTravail)

        If DataGridViewEnChambre.Rows.Count > 0 Then
            GunaLabelNbreEnChambre.Text = "(" & DataGridViewEnChambre.Rows.Count & ")"
        Else
            GunaLabelNbreEnChambre.Text = "(0)"
        End If

        PanelTableauDeBords.BringToFront()


        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabel56.Text = "ARRIVEES DU :"
        Else
            GunaLabel56.Text = "ARRIVALS OF :"
        End If

    End Sub

    Private Sub onDepartedClick(ByVal sender As Object, ByVal e As System.EventArgs)

        PanelTableauDeBords.Hide()
        TabControlHbergement.SelectedIndex = 4
        PanelEnregistrement.Show()
        PanelPlanning.Hide()

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewDepartTab.Columns.Clear()

        ListeDesDepartsEffectues(GlobalVariable.DateDeTravail)

        If DataGridViewDepartTab.Rows.Count > 0 Then
            GunaLabelNbreDeparts.Text = "(" & DataGridViewDepartTab.Rows.Count & ")"
        Else
            GunaLabelNbreDeparts.Text = "(0)"
        End If

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabel47.Text = "SEJOURS CLOTURES DU :"
        Else
            GunaLabel47.Text = "CHECKED OUT OF :"
        End If

    End Sub

    Private Sub onFreeRoomsClick(ByVal sender As Object, ByVal e As System.EventArgs)

        GunaWinSwitch1.Checked = True

        If GunaWinSwitch1.Checked Then
            PanelGraphiques.Visible = False
        Else
            PanelGraphiques.BringToFront()
            PanelGraphiques.Visible = True
        End If

    End Sub

    Private Sub onOccupiedRoomsClick(ByVal sender As Object, ByVal e As System.EventArgs)

        TabControlHbergement.SelectedIndex = 3
        PanelTableauDeBords.Hide()
        PanelEnregistrement.BringToFront()
        PanelEnregistrement.Show()
        PanelPlanning.Hide()

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewEnChambre.Columns.Clear()

        ListeDesEnChambres()

        If DataGridViewEnChambre.Rows.Count > 0 Then
            GunaLabelNbreEnChambre.Text = "(" & DataGridViewEnChambre.Rows.Count & ")"
        Else
            GunaLabelNbreEnChambre.Text = "(0)"
        End If

        PanelTableauDeBords.BringToFront()

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabel52.Text = "EN CHAMBRE :"
        Else
            GunaLabel52.Text = "IN HOUSE :"
        End If

    End Sub

    Private Sub onArrivalsClick(ByVal sender As Object, ByVal e As System.EventArgs)

        GlobalVariable.attribuerChambre = False

        GunaFrontDeskLabel.Text = "ARRIVEES"
        If GlobalVariable.actualLanguageValue = 0 Then
            GunaFrontDeskLabel.Text = "ARRIVALS"
        End If
        DataGridViewAttenduPanel.Columns.Clear()
        TabControlHbergement.SelectedIndex = 2
        PanelTableauDeBords.Hide()
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()
        PanelPlanning.Hide()

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewAttenduPanel.Columns.Clear()

        ListeDesAttendues()

        If DataGridViewAttenduPanel.Rows.Count > 0 Then
            GunaLabelNbreAttendu.Text = "(" & DataGridViewAttenduPanel.Rows.Count & ")"
        Else
            GunaLabelNbreAttendu.Text = "(0)"
        End If

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabel56.Text = "ATTENDUES OF :"
        Else
            GunaLabel56.Text = "EXPECTED OF :"
        End If

    End Sub

    Private Sub onDepartureClick(ByVal sender As Object, ByVal e As System.EventArgs)

        PanelTableauDeBords.Hide()
        TabControlHbergement.SelectedIndex = 4
        PanelEnregistrement.Show()
        PanelPlanning.Hide()

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewDepartTab.Columns.Clear()

        ListeDesDeparts()

        If DataGridViewDepartTab.Rows.Count > 0 Then
            GunaLabelNbreDeparts.Text = "(" & DataGridViewDepartTab.Rows.Count & ")"
        Else
            GunaLabelNbreDeparts.Text = "(0)"
        End If

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabel47.Text = "DEPARTS DU : "
        Else
            GunaLabel47.Text = "DUE OUT OF : "
        End If

    End Sub

    '************************** --------------- ********************************

    Public Sub StatusDesChambres(ByVal page As Integer)

        GunaGroupBoxRoomStatus.Controls.Clear()

        Dim roomList As New Room()
        Dim rooms As DataTable = roomList.roomsOnly()
        'Dim rooms As DataTable = roomList.ActiveRoomsOnly()

        Dim xValue As Integer = 0
        Dim yValue As Integer = 0
        Dim apartirDelaPage As Integer = 0

        If page = 1 Then
            apartirDelaPage = 0
        ElseIf page = 2 Then
            apartirDelaPage = 63
        End If

        If rooms.Rows.Count > 62 Then
            numberPages = 2
        End If

        If rooms.Rows.Count > 0 Then

            For i As Integer = apartirDelaPage To rooms.Rows.Count - 1 Step 1

                Dim nomCLient As String = ""
                Dim emailCLient As String = ""

                Dim toolTip As New ToolTip()

                Dim buttonColor As Color
                Dim ClientInRoom As DataTable
                ' --------------------------------------------------------------------------------------------
                Dim customPanel As New Panel
                customPanel.Text = "Test" & i
                customPanel.Name = "a" & i
                customPanel.Location = New Point(50 + xValue, 37 + yValue)
                customPanel.BackColor = Color.White
                'customPanel.Size = New Size(75, 103)
                customPanel.Size = New Size(60, 75)
                customPanel.Anchor = AnchorStyles.None

                'Dim customPictureBox = New Guna.UI.WinForms.GunaCirclePictureBox
                Dim customPictureBox = New PictureBox

                'customPictureBox.BaseColor = System.Drawing.Color.White
                If rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre propre" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Free clean" Then
                    'customPictureBox.Image = Global.lyte.My.Resources.Resources.ROOM_STATE_FREE
                    customPictureBox.Image = Global.Lyte.My.Resources.Resources.FREE_ROOM
                    AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick
                ElseIf rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre sale" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Free dirty" Then
                    'customPictureBox.Image = Global.lyte.My.Resources.Resources.ROOM_STATE_FREE_SALE
                    customPictureBox.Image = Global.Lyte.My.Resources.Resources.FREE_ROOM
                    AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick
                ElseIf rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée propre" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupied clean" Then
                    'customPictureBox.Image = Global.lyte.My.Resources.Resources.ROOM_STATE_OCCUPIED
                    customPictureBox.Image = Global.Lyte.My.Resources.Resources.RESERVEE

                    'Dim reservationConfirmee As DataTable = Functions.GetAllElementsOnTwoConditions(rooms.Rows(i)("CODE_CHAMBRE"), "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION")
                    Dim reservationConfirmee As DataTable = Functions.InfoDUnEnChambre(rooms.Rows(i)("CODE_CHAMBRE"), GlobalVariable.DateDeTravail)

                    'La chambre étant occupé on va chercher sa réservation
                    If reservationConfirmee.Rows.Count > 0 Then

                        If reservationConfirmee.Rows(0)("DATE_ENTTRE") <= GlobalVariable.DateDeTravail Or reservationConfirmee.Rows(0)("DATE_SORTIE") >= GlobalVariable.DateDeTravail Then
                            If reservationConfirmee.Rows(0)("DATE_SORTIE") = GlobalVariable.DateDeTravail Then
                                customPictureBox.Image = Global.Lyte.My.Resources.Resources.CHECK_OUT
                            Else
                                customPictureBox.Image = Global.Lyte.My.Resources.Resources.OCCUPIED
                            End If
                        Else
                            customPictureBox.Image = Global.Lyte.My.Resources.Resources.FREE_ROOM
                            'AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick
                        End If

                    Else

                        Dim reservation As DataTable = Functions.GetAllElementsOnTwoConditions(rooms.Rows(i)("CODE_CHAMBRE"), "reservation", "CHAMBRE_ID", 0, "ETAT_RESERVATION")

                        If reservation.Rows.Count > 0 Then

                            If reservation.Rows(0)("DATE_ENTTRE") = GlobalVariable.DateDeTravail Then
                                customPictureBox.Image = Global.Lyte.My.Resources.Resources.RESERVEE
                            Else
                                customPictureBox.Image = Global.Lyte.My.Resources.Resources.FREE_ROOM
                                'AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick
                            End If

                        Else

                            customPictureBox.Image = Global.Lyte.My.Resources.Resources.FREE_ROOM
                            AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick

                        End If

                    End If

                    AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick

                ElseIf rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée sale" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupied dirty" Then
                    'customPictureBox.Image = Global.lyte.My.Resources.Resources.ROOM_STATE_OCCUPIED_SALE
                    customPictureBox.Image = Global.Lyte.My.Resources.Resources.RESERVEE
                    'La chambre étant occupé on va chercher sa réservation
                    'Dim reservationConfirmee As DataTable = Functions.GetAllElementsOnTwoConditions(rooms.Rows(i)("CODE_CHAMBRE"), "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION")
                    Dim reservationConfirmee As DataTable = Functions.InfoDUnEnChambre(rooms.Rows(i)("CODE_CHAMBRE"), GlobalVariable.DateDeTravail)

                    If reservationConfirmee.Rows.Count > 0 Then
                        'On affiche le bouton du check out
                        If reservationConfirmee.Rows(0)("DATE_ENTTRE") <= GlobalVariable.DateDeTravail Or reservationConfirmee.Rows(0)("DATE_SORTIE") >= GlobalVariable.DateDeTravail Then

                            If reservationConfirmee.Rows(0)("DATE_SORTIE") = GlobalVariable.DateDeTravail Then
                                customPictureBox.Image = Global.Lyte.My.Resources.Resources.CHECK_OUT
                            Else
                                customPictureBox.Image = Global.Lyte.My.Resources.Resources.OCCUPIED
                            End If

                        Else
                            customPictureBox.Image = Global.Lyte.My.Resources.Resources.FREE_ROOM
                            'AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick
                        End If

                    End If

                    AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick

                ElseIf rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Hors Service" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Out of service" Then
                    'customPictureBox.Image = Global.lyte.My.Resources.Resources.ROOM_STATE_HORS
                    customPictureBox.Image = Global.Lyte.My.Resources.Resources.MAINTENANCE
                Else
                    'customPictureBox.Image = Global.lyte.My.Resources.Resources.ROOM_STATE_FREE
                    customPictureBox.Image = Global.lyte.My.Resources.Resources.FREE_ROOM
                End If

                'customPictureBox.Location = New System.Drawing.Point(3, 18)
                customPictureBox.Location = New System.Drawing.Point(3, 0)
                customPictureBox.Name = rooms.Rows(i)("CODE_CHAMBRE")
                customPictureBox.Size = New System.Drawing.Size(50, 50)
                customPictureBox.SizeMode = System.Windows.Forms.PictureBoxSizeMode.Zoom
                customPictureBox.TabIndex = 2
                customPictureBox.TabStop = False
                'customPictureBox.UseTransfarantBackground = False

                customPanel.Controls.Add(customPictureBox)

                If rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre propre" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre sale" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Free clean" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Free dirty" Then

                    buttonColor = Color.Green
                    toolTip.ToolTipTitle = rooms.Rows(i)("CODE_CHAMBRE")
                    toolTip.SetToolTip(customPictureBox, rooms.Rows(i)("ETAT_CHAMBRE_NOTE"))

                ElseIf rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée propre" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée sale" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupied clean" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupied dirty" Then

                    buttonColor = Color.Orange
                    toolTip.ToolTipTitle = rooms.Rows(i)("CODE_CHAMBRE")
                    toolTip.SetToolTip(customPictureBox, rooms.Rows(i)("ETAT_CHAMBRE_NOTE"))

                ElseIf rooms.Rows(i)("ETAT_CHAMBRE") = 1 Or rooms.Rows(i)("ETAT_CHAMBRE") = 5 Then
                    buttonColor = Color.Red
                    toolTip.ToolTipTitle = rooms.Rows(i)("CODE_CHAMBRE")
                    toolTip.SetToolTip(customPictureBox, rooms.Rows(i)("ETAT_CHAMBRE_NOTE"))
                End If

                GunaGroupBoxRoomStatus.Controls.Add(customPanel)

                Dim customLabel As New Label

                customLabel.AutoSize = True
                customLabel.Font = New System.Drawing.Font("Maiandra GD", 12.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
                'customLabel.Location = New System.Drawing.Point(13, 0)
                customLabel.Location = New System.Drawing.Point(13, 48)
                customLabel.Name = "customLabel"
                customLabel.Size = New System.Drawing.Size(37, 21)
                customLabel.TabIndex = 4
                customLabel.Text = rooms.Rows(i)("CODE_CHAMBRE")

                customPanel.Controls.Add(customLabel)

                Dim customButton As New Guna.UI.WinForms.GunaCircleButton()

                customButton.AnimationHoverSpeed = 0.07!
                customButton.AnimationSpeed = 0.03!
                customButton.BaseColor = buttonColor
                customButton.BorderColor = System.Drawing.Color.Black
                customButton.DialogResult = System.Windows.Forms.DialogResult.None
                customButton.FocusedColor = System.Drawing.Color.Empty
                customButton.Font = New System.Drawing.Font("Maiandra GD", 9.0!)
                customButton.ForeColor = System.Drawing.Color.White
                customButton.Image = Nothing
                customButton.ImageSize = New System.Drawing.Size(52, 52)
                customButton.Location = New System.Drawing.Point(29, 83)
                customButton.Name = "GunaCircleButton35" & i
                customButton.OnHoverBaseColor = buttonColor
                customButton.OnHoverBorderColor = buttonColor
                customButton.OnHoverForeColor = System.Drawing.Color.White
                customButton.OnHoverImage = Nothing
                customButton.OnPressedColor = System.Drawing.Color.Black
                customButton.Size = New System.Drawing.Size(15, 16)
                customButton.TabIndex = 3

                'customPanel.Controls.Add(customButton)

                toolTip.ShowAlways = True

                toolTip.UseFading = True
                toolTip.UseAnimation = True
                toolTip.IsBalloon = True
                toolTip.AutoPopDelay = 5000

                xValue = xValue + 70

                If (i + 1) Mod 9 = 0 Then
                    xValue = 0
                    yValue = yValue + 78
                End If

                If i + 1 = 63 Then
                    If numberPages > 1 And page = 1 Then
                        GunaLabel7.Visible = True
                    End If
                    Exit For
                End If

            Next

        End If

    End Sub


    'Gestion du bouton sur lequel on click pour afficher ses informations dans l
    Private Sub onDoubleClick(ByVal sender As Object, ByVal e As System.EventArgs)

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        VidageDesChampsPourNouvelleReservation()

        Dim customPictureBox = CType(sender, PictureBox)
        LabelNatureReservation.Visible = True
        'Affichage d'une réservaion depuis son icon du dashboard

        'GESTION DES EN CHAMBRES A PARTIR DES ICONS

        Dim dateDuJour As Date = GlobalVariable.DateDeTravail.ToShortDateString

        '--------------------------------------------------------- NEW WAY OF DOING ------------------------------------------------------------------------------------------------

        Dim CHAMBRE_ID As String = customPictureBox.Name

        Dim query01 As String = "SELECT * FROM reserve_conf WHERE DATE_ENTTRE <= '" & dateDuJour.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & dateDuJour.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND CHAMBRE_ID=@CHAMBRE_ID AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command01 As New MySqlCommand(query01, GlobalVariable.connect)
        command01.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
        command01.Parameters.Add("@CHAMBRE_ID", MySqlDbType.VarChar).Value = CHAMBRE_ID

        Dim adapter01 As New MySqlDataAdapter(command01)
        Dim enChambre As New DataTable()
        adapter01.Fill(enChambre)

        Dim query02 As String = "SELECT * FROM reservation WHERE DATE_ENTTRE >= '" & dateDuJour.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & dateDuJour.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 0 AND CHAMBRE_ID=@CHAMBRE_ID AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command02 As New MySqlCommand(query02, GlobalVariable.connect)
        command02.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
        command02.Parameters.Add("@CHAMBRE_ID", MySqlDbType.VarChar).Value = CHAMBRE_ID

        Dim adapter02 As New MySqlDataAdapter(command02)
        Dim attendu As New DataTable()
        adapter02.Fill(attendu)

        enChambre.Merge(attendu)

        If enChambre.Rows.Count > 0 Then

            GlobalVariable.codeReservationToUpdate = enChambre.Rows(0)("CODE_RESERVATION")

            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = enChambre

            LabelNatureReservation.Visible = True
            LabelNatureReservation.Text = enChambre.Rows(0)("ETAT_NOTE_RESERVATION")

            'Variable to print or not checkout button
            GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")
            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
                mainCouranteJournaliere = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate

            TabControlHbergement.SelectedIndex = 0

            affectingValuesToFields()

            GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            'Dim solde As Double = Double.Parse(Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate))
            Dim solde As Double = Double.Parse(Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate))
            GunaLabelSolde.Text = Format(solde, "#,##0")

            If 0 > solde Then
                GunaLabelSolde.ForeColor = Color.Red
            ElseIf solde = 0 Then
                GunaLabelSolde.ForeColor = Color.Black
            Else
                GunaLabelSolde.ForeColor = Color.Green
            End If

            If GunaRadioButtonChambre.Checked Then
                totalAReglerPourLeDuSejour()
            End If

            If GunaRadioButtonSalleFete.Checked Then

                Dim typeChambre As DataTable = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                    GunaTextBoxMateriel.Text = Format(Forfait.Rows(0)("LOCATION_MATERIEL"), "#,##0")
                    GunaTextBoxAutres.Text = Format(Forfait.Rows(0)("AUTRES"), "#,##0")

                    GunaComboBoxEvenement.SelectedValue = Forfait.Rows(0)("CODE_EVENEMENT")

                    '------------- addition -----------------------------------------------

                    GunaTextBoxQteGouter.Text = Forfait.Rows(0)("NBRE_GOUTER")
                    GunaTextBoxPrixGouter.Text = Format(Forfait.Rows(0)("PU_GOUTER"), "#,##0")

                    GunaTextBoxCocktail.Text = Format(Forfait.Rows(0)("NBRE_COCKTAIL"), "#,##0")
                    GunaTextBoxPUCocktail.Text = Format(Forfait.Rows(0)("PU_COCKTAIL"), "#,##0")

                    GunaComboBoxHeureCafe.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_CAFE"))
                    GunaComboBoxHeureCafe.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_CAFE")
                    GunaComboBoxHeureDej.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER"))
                    GunaComboBoxHeureDej.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER")
                    GunaComboBoxHeureDiner.Items.Add(Forfait.Rows(0)("HEURE_DINER"))
                    GunaComboBoxHeureDiner.SelectedItem = Forfait.Rows(0)("HEURE_DINER")
                    GunaComboBoxHeureGouter.Items.Add(Forfait.Rows(0)("HEURE_GOUTER"))
                    GunaComboBoxHeureGouter.SelectedItem = Forfait.Rows(0)("HEURE_GOUTER")
                    GunaComboBoxHeureCocktail.Items.Add(Forfait.Rows(0)("HEURE_COCKTAIL"))
                    GunaComboBoxHeureCocktail.SelectedItem = Forfait.Rows(0)("HEURE_COCKTAIL")

                    'QUANTITE

                    GunaTextBox47.Text = Forfait.Rows(0)("EAU_PTE_QTE")
                    GunaTextBox48.Text = Forfait.Rows(0)("BOISSONS_GAZEUSES_QTE")
                    GunaTextBox54.Text = Forfait.Rows(0)("VIN_ROUGE_QTE")
                    GunaTextBox63.Text = Forfait.Rows(0)("VIN_ROSE_QTE")
                    GunaTextBox10.Text = Forfait.Rows(0)("EAU_GRDE_QTE")
                    GunaTextBox50.Text = Forfait.Rows(0)("BIERES_QTE")
                    GunaTextBox36.Text = Forfait.Rows(0)("BOISSONS_EXT_QTE")

                    'MONTANT
                    GunaTextBoxMontantEauPetiteBouteille.Text = Format(Forfait.Rows(0)("EAU_PTE_MONTANT"), "#,##0")
                    GunaTextBox68.Text = Format(Forfait.Rows(0)("EAU_GRDE_MONTANT"), "#,##0")
                    GunaTextBox62.Text = Format(Forfait.Rows(0)("BOISSONS_GAZEUSES_MONTANT"), "#,##0")
                    GunaTextBox61.Text = Format(Forfait.Rows(0)("BIERES_MONTANT"), "#,##0")
                    GunaTextBox59.Text = Format(Forfait.Rows(0)("VIN_ROUGE_MONTANT"), "#,##0")
                    GunaTextBox57.Text = Format(Forfait.Rows(0)("VIN_ROSE_MONTANT"), "#,##0")
                    GunaTextBox64.Text = Format(Forfait.Rows(0)("BOISSONS_EXT_MONTANT"), "#,##0")
                    GunaTextBoxDroitDeBouchon.Text = Format(Forfait.Rows(0)("DROIT_DE_BOUCHON"), "#,##0")

                    If Forfait.Rows(0)("VIDEO_PROJ") = 1 Then
                        GunaCheckBoxVidOui.Checked = True
                        GunaCheckBoxVidNon.Checked = False
                    Else
                        GunaCheckBoxVidNon.Checked = True
                        GunaCheckBoxVidOui.Checked = False
                    End If

                    If Forfait.Rows(0)("SONO") = 1 Then
                        GunaCheckBoxSonoOui.Checked = True
                        GunaCheckBoxSonoNon.Checked = False
                    Else
                        GunaCheckBoxSonoNon.Checked = True
                        GunaCheckBoxSonoOui.Checked = False
                    End If

                    If Forfait.Rows(0)("COUVERTS") = 1 Then
                        GunaCheckBoxCouvOui.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    Else
                        GunaCheckBoxCouvNon.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    End If

                    If Forfait.Rows(0)("TABLE_CHAISE") = 1 Then
                        GunaCheckBoxTableOui.Checked = True
                        GunaCheckBoxTableNon.Checked = False
                    Else
                        GunaCheckBoxTableNon.Checked = True
                        GunaCheckBoxTableOui.Checked = False
                    End If

                    If Forfait.Rows(0)("MISE_EN_PLACE") = 1 Then
                        GunaCheckBoxEcole.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 2 Then
                        GunaCheckBoxTheatre.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 3 Then
                        GunaCheckBoxRectangle.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 4 Then
                        GunaCheckBoxCocktail.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 5 Then
                        GunaCheckBoxBanquet.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 0 Then
                        GunaCheckBoxU.Checked = True
                    End If

                    If Forfait.Rows(0)("CLOISONNEMENT") = 2 Then
                        GunaCheckBox2.Checked = True
                    ElseIf Forfait.Rows(0)("CLOISONNEMENT") = 3 Then
                        GunaCheckBox9.Checked = True
                    End If
                End If

            End If

        Else

            'RESERVATION INEXISTANTE
            'RESERVATION D'UNE CHAMBRE A PARTIR DES ICONS
            Dim infoChambrePourReservation As DataTable = Functions.getElementByCode(CHAMBRE_ID, "chambre", "CODE_CHAMBRE")

            If infoChambrePourReservation.Rows.Count > 0 Then

                TabControlHbergement.SelectedIndex = 0

                LabelNatureReservation.Visible = True

                If GlobalVariable.actualLanguageValue = 1 Then
                    LabelNatureReservation.Text = "COURS SEJOURS"

                Else
                    LabelNatureReservation.Text = "SHORT STAY"

                End If

                Dim infoTypeDeChambrePourReservation As DataTable = Functions.getElementByCode(infoChambrePourReservation.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                If infoTypeDeChambrePourReservation.Rows.Count > 0 Then

                    GunaTextBoxCodeTypeDeChambre.Text = infoChambrePourReservation.Rows(0)("CODE_TYPE_CHAMBRE")
                    GunaTextBoxLibelleTYpe.Text = infoTypeDeChambrePourReservation.Rows(0)("LIBELLE_TYPE_CHAMBRE")

                    Dim prix As Double = 0
                    Double.TryParse(infoTypeDeChambrePourReservation.Rows(0)("PRIX"), prix)
                    GunaTextBoxpPrixAffiche.Text = Format(prix, "#,##0")
                    GunaTextBoxMontantAccorde.Text = Format(prix, "#,##0")

                End If

                'On n'a le numéro de chambre alors seulement on pourra remplir les inforamtion de la chambre
                GunaTextBoxNumeroChambre.Text = infoChambrePourReservation.Rows(0)("CODE_CHAMBRE")
                GunaTextBoxLibelleChambre.Text = infoChambrePourReservation.Rows(0)("LOCALISATION")
                'GunaTextBoxLibelleChambre.Text = infoChambrePourReservation.Rows(0)("LIBELLE_CHAMBRE")


                GunaDataGridViewRoomType.Visible = False

                'We hide all the Datagrid used for custom filling

                GunaDataGridViewRoomType.Visible = False
                GunaDataGridViewClient.Visible = False
                GunaDataGridViewRoom.Visible = False
                GunaDataGridViewPhone.Visible = False


                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")

                TabControlHbergement.SelectedIndex = 0

                ' GunaComboBoxHeureArrivee.SelectedItem = "120000"
                'GunaComboBoxHeureDepart.SelectedItem = "120000"

            End If

        End If

        '---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        'PanelEnregistrement.Show()
        'PanelEnregistrement.BringToFront()

        GunaDataGridViewRoomType.Visible = False
        GunaDataGridViewRoom.Visible = False


    End Sub

    'Rafraichissement du stauts des chambres
    Private Sub RafraichirToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles RafraichirToolStripMenuItem.Click
        GunaGroupBoxRoomStatus.Controls.Clear()
        'PanelGraphiques.Controls.Clear()
        GunaGroupBoxStatistiques.Controls.Clear()
        contenuStatistique()
        elementsDesChambres() ' POUR LES PETITS TO
        StatistiquesDesChambres() ' POUR LE PANNEAU LATERAL GAUCHE
        StatusDesChambres(page) 'Icon des chambres au niveau du dashboard
    End Sub

    '-------------------------------------- GESTION DU PANNEAU DE GAUCHE

    'Dim nombreDeChambreOccupee As integer 

    'PETIT TO
    Public Sub elementsDesChambres()

        contenuStatistique()

        Dim firstDayOfMonth As Date = Functions.firstDayOfMonth(GlobalVariable.DateDeTravail)
        Dim lastDayOfMonth As Date = Functions.lastDayOfMonth(GlobalVariable.DateDeTravail)

        Dim room As New Room()

        Dim Total As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_CHAMBRE_TOTAL")

        GunaCircleProgressBarTauxOccupation.Maximum = Total

        GunaCircleProgressBar2.Maximum = Total
        GunaCircleProgressBar3.Maximum = Total
        GunaCircleProgressBar4.Maximum = Total

        Dim moi As Integer = 0
        Dim annee As Integer = 0

        Integer.TryParse(Month(Now), moi)
        Integer.TryParse(Year(Now), annee)

        Dim nombreDejourDuMoi As Integer = GetDaysInAMonth(annee, moi)

        Dim jourDuMois As Integer = GetDaysInAMonth(annee, moi) ' NOUS RETOURNE LE NOMBRE DE JOUR DU MOIS

        Dim numerDuMoisActuel As Integer = Month(Now())
        Dim numerDuMoisDeLaResa As Integer = 0

        If jourDuMois <= 0 Then
            jourDuMois = 1
        End If

        Dim jourActuelDuMois As Integer = 1

        Dim nombreDeNuiteeDesArrivees As DataTable = Functions.getElementByCode(0, "reservation", "ETAT_RESERVATION")

        Dim nombreDeNuiteeDesEnChambres As DataTable = Functions.getElementByCode(1, "reserve_conf", "ETAT_RESERVATION")

        Dim nombreDeNuiteeDesEnChambresAnnuler As DataTable = Functions.getElementByCode(0, "reserve_conf", "ETAT_RESERVATION")

        Dim nombreDeNuiteeTotal As Integer = 0
        Dim nombreDeReservation As Integer = 0

        Dim nombreDeReservationDuMoisPourGrandTOJournalier As Integer = 0

        Dim stat As New statistiques()

        For i = 0 To nombreDeNuiteeDesArrivees.Rows.Count - 1

            Dim DATE_ENTREE = nombreDeNuiteeDesArrivees.Rows(i)("DATE_ENTTRE")
            Dim DATE_SORTIE = CDate(GlobalVariable.DateDeTravail).ToShortDateString

            nombreDeReservation += 1
            'SE REASSURER QUE LES RESERVATIONS FIGURES DANS CEUX DU MOIS
            'nombreDeNuiteeTotal += DateDiff(DateInterval.Day, nombreDeNuiteeDesArrivees.Rows(i)("DATE_ENTTRE"), nombreDeNuiteeDesArrivees.Rows(i)("DATE_SORTIE"))
            nombreDeNuiteeTotal = stat.nombreDeNuiteeDuneReservationPourLeMoisEnCours(DATE_ENTREE, DATE_SORTIE)

        Next

        For i = 0 To nombreDeNuiteeDesEnChambres.Rows.Count - 1

            Dim DATE_ENTREE = nombreDeNuiteeDesEnChambres.Rows(i)("DATE_ENTTRE")
            Dim DATE_SORTIE = CDate(GlobalVariable.DateDeTravail).ToShortDateString

            nombreDeReservation += 1

            nombreDeNuiteeTotal += stat.nombreDeNuiteeDuneReservationPourLeMoisEnCours(DATE_ENTREE, DATE_SORTIE)

        Next

        For i = 0 To nombreDeNuiteeDesEnChambresAnnuler.Rows.Count - 1 ' CHECKOUT NORMAL

            Dim DATE_ENTREE = nombreDeNuiteeDesEnChambresAnnuler.Rows(i)("DATE_ENTTRE")
            Dim DATE_SORTIE = CDate(GlobalVariable.DateDeTravail).ToShortDateString

            nombreDeReservation += 1

            nombreDeNuiteeTotal += stat.nombreDeNuiteeDuneReservationPourLeMoisEnCours(DATE_ENTREE, DATE_SORTIE)

            GunaLabelEncours.Text = nombreDeNuiteeTotal

        Next

        GunaLabelDuMois.Text = Format(Functions.tauxOccupationDuMois(GlobalVariable.DateDeTravail, 1), "#,##0.00")

        GunaLabelDuMoiDernier.Text = Format(Functions.tauxOccupationDuMois(GlobalVariable.DateDeTravail, 0), "#,##0.00")

        Dim statistiques As New statistiques()

        Dim chmabreTotalOccupeeSelonLesReservations As Integer = 0

        chmabreTotalOccupeeSelonLesReservations = statistiques.tauxDoccupationGenerale(GlobalVariable.DateDeTravail, GlobalVariable.DateDeTravail)

        If chmabreTotalOccupeeSelonLesReservations < 0 Then
            chmabreTotalOccupeeSelonLesReservations = 0
        End If

        'Dim departEffectue As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_DEPART_INITIAL")

        'GunaCircleProgressBarTauxOccupation.Value = nombreDeNuiteeDesArrivees.Rows.Count + nombreDeNuiteeDesEnChambres.Rows.Count
        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        'EN CHAMBRE
        Dim queryEnChambre As String = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim commandEnChambre As New MySqlCommand(queryEnChambre, GlobalVariable.connect)
        commandEnChambre.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim adapterEnChambre As New MySqlDataAdapter(commandEnChambre)
        Dim tableEnChambre As New DataTable()
        adapterEnChambre.Fill(tableEnChambre)

        If (tableEnChambre.Rows.Count > 0) Then
            nombreDeReservationDuMoisPourGrandTOJournalier = tableEnChambre.Rows.Count

            'nombreDeChambreOccupee = tableEnChambre.Rows.Count
        End If

        'ATTENDUES
        'Dim DateFin As Date = GunaDateTimePickerDepartDepert.Value.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        If (DateDebut <= DateFin) Then

            Dim queryAttendue As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION = @ETAT_RESERVATION ORDER BY CHAMBRE_ID ASC"

            Dim ETAT_RESERVATION As Integer = 0
            Dim commandAttendue As New MySqlCommand(queryAttendue, GlobalVariable.connect)
            commandAttendue.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
            commandAttendue.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int64).Value = ETAT_RESERVATION

            Dim adapterAttendue As New MySqlDataAdapter(commandAttendue)
            Dim tableAttendue As New DataTable()
            adapterAttendue.Fill(tableAttendue)

            If (tableAttendue.Rows.Count > 0) Then
                nombreDeReservationDuMoisPourGrandTOJournalier += tableAttendue.Rows.Count
            End If

        End If

        GunaCircleProgressBarTauxOccupation.Value = nombreDeReservationDuMoisPourGrandTOJournalier

        Dim rooms As DataTable = room.roomsOnly()

        With RoomStatChart

            Dim dataSet As DataSet = New DataSet()
            Dim dt As DataTable = New DataTable()
            dt.Columns.Add("Text", GetType(String))
            dt.Columns.Add("Value", GetType(Integer))

            Dim roomTypes As DataTable = Functions.GetAllElementsOnCondition("chambre", "type_chambre", "TYPE")

            For i = 0 To roomTypes.Rows.Count - 1

                Dim nombreDeChambreDUnCertainType As DataTable = Functions.getElementByCode(roomTypes.Rows(i)("CODE_TYPE_CHAMBRE"), "chambre", "CODE_TYPE_CHAMBRE")

                If nombreDeChambreDUnCertainType.Rows.Count > 0 Then
                    Total = nombreDeChambreDUnCertainType.Rows.Count
                End If

                Dim nombreArrivee As Integer = 0
                Dim nombreenChambre As Integer = 0

                Dim arrivee As DataTable = Functions.getElementByCodeIncludedDate(0, "reservation", "ETAT_RESERVATION", "arrivee")

                For j = 0 To arrivee.Rows.Count - 1

                    'ON COMPTE LE NOMBRE DES CHAMBRES DE LA RESERVATION ASSOCIE A UN CERTAIN TYPE
                    Dim nombreDeChambreOccupeDeCetype As DataTable = Functions.GetAllElementsOnTwoConditions(roomTypes.Rows(i)("CODE_TYPE_CHAMBRE"), "chambre", "CODE_TYPE_CHAMBRE", arrivee.Rows(j)("CHAMBRE_ID"), "CODE_CHAMBRE")

                    If nombreDeChambreOccupeDeCetype.Rows.Count > 0 Then
                        nombreArrivee += 1
                    End If

                Next

                Dim enChambre As DataTable = Functions.getElementByCodeIncludedDate(1, "reserve_conf", "ETAT_RESERVATION", "en chambre")

                For k = 0 To enChambre.Rows.Count - 1

                    'ON COMPTE LE NOMBRE DES CHAMBRES DE LA RESERVATION ASSOCIE A UN CERTAIN TYPE
                    Dim nombreDeChambreOccupeDeCetype As DataTable = Functions.GetAllElementsOnTwoConditions(roomTypes.Rows(i)("CODE_TYPE_CHAMBRE"), "chambre", "CODE_TYPE_CHAMBRE", enChambre.Rows(k)("CHAMBRE_ID"), "CODE_CHAMBRE")

                    If nombreDeChambreOccupeDeCetype.Rows.Count > 0 Then
                        nombreenChambre += 1
                    End If

                Next

                Dim nombreDeChambreOccupeDunCertainType As Integer = nombreArrivee + nombreenChambre

                If i = 0 Then
                    GunaCircleProgressBar2.Maximum = Total
                    GunaCircleProgressBar2.Value = nombreDeChambreOccupeDunCertainType
                    GunaTextBoxProgBar1.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                ElseIf i = 1 Then
                    GunaCircleProgressBar3.Maximum = Total
                    GunaCircleProgressBar3.Value = nombreDeChambreOccupeDunCertainType
                    GunaTextBoxProgBar2.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                ElseIf i = 2 Then
                    GunaCircleProgressBar4.Maximum = Total
                    GunaCircleProgressBar4.Value = nombreDeChambreOccupeDunCertainType
                    GunaTextBoxProgBar3.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                ElseIf i = 3 Then
                    GunaCircleProgressBar5.Visible = True
                    GunaCircleProgressBar5.Maximum = Total
                    GunaCircleProgressBar5.Value = nombreDeChambreOccupeDunCertainType
                    GunaTextBox1.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                    GunaTextBox1.Visible = True
                ElseIf i = 4 Then
                    GunaCircleProgressBar6.Visible = True
                    GunaCircleProgressBar6.Maximum = Total
                    GunaCircleProgressBar6.Value = nombreDeChambreOccupeDunCertainType
                    GunaTextBox2.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                    GunaTextBox2.Visible = True
                ElseIf i = 5 Then
                    GunaCircleProgressBar7.Visible = True
                    GunaCircleProgressBar7.Maximum = Total
                    GunaCircleProgressBar7.Value = nombreDeChambreOccupeDunCertainType
                    GunaTextBox3.Visible = True
                    GunaTextBox3.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                End If

            Next

            dataSet.Tables.Add(dt)
            RoomStatChart.DataSource = dataSet.Tables(0)
            'ChartRevenuParFamille.Width = 380
            'ChartRevenuParFamille.Height = 209
            .Series("Series1").BorderColor = Color.FromArgb(164, 164, 164)
            '.Series("Series1").ChartType = SeriesChartType.Doughnut
            .Series("Series1").BorderDashStyle = ChartDashStyle.Solid
            .Series("Series1").BorderWidth = 1
            .Series("Series1").ShadowOffset = 1
            .Series("Series1").IsValueShownAsLabel = True
            .Series("Series1").XValueMember = "Text"
            .Series("Series1").YValueMembers = "Value"
            .Series("Series1").LabelFormat = "#,##0.0"
            '.Series("Series1").Font = New Font("Tahoma", 14.0F)
            .Series("Series1").BackSecondaryColor = Color.Transparent
            .Series("Series1").LabelForeColor = Color.Black
            .Series(0).Color = Color.Red
            .Series("Series1").LegendText = "#VALX (#PERCENT)"

        End With

        If IsDBNull(GlobalVariable.societe.Rows(0)("CODE_MONNAIE")) Then

            Dim societe As DataTable = Functions.allTableFields("societe")

            If societe.Rows.Count > 0 Then
                GunaLabelSymboleMonnaie.Text = societe.Rows(0)("CODE_MONNAIE")
                'GunaLabelCodeMonnaieSymbole.Text = societe.Rows(0)("CODE_MONNAIE")
            End If

        End If

        GunaLabelSymboleMonnaie.Text = GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
        'GunaLabelCodeMonnaieSymbole.Text = GlobalVariable.societe.Rows(0)("CODE_MONNAIE")

        'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies
        'Dim query As String = "SELECT * FROM main_courante_journaliere WHERE DATE_MAIN_COURANTE >= '" & GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd") & "' AND DATE_MAIN_COURANTE <='" & GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd") & "' AND ETAT_MAIN_COURANTE =@ETAT_MAIN_COURANTE"
        Dim query As String = "SELECT * FROM main_courante_journaliere WHERE DATE_MAIN_COURANTE >= '" & GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd") & "' AND DATE_MAIN_COURANTE <='" & GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd") & "'"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        'command.Parameters.Add("@ETAT_MAIN_COURANTE", MySqlDbType.VarChar).Value = 0
        'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()
        adapter.Fill(table)

        Dim query1 As String = "SELECT * FROM main_courante_autres WHERE DATE_MAIN_COURANTE >= '" & GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd") & "' AND DATE_MAIN_COURANTE <='" & GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd") & "'"

        Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
        'command.Parameters.Add("@ETAT_MAIN_COURANTE", MySqlDbType.VarChar).Value = 0
        'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

        Dim adapter1 As New MySqlDataAdapter(command1)
        Dim table1 As New DataTable()
        adapter1.Fill(table1)

        Dim hebergement As Double = 0
        Dim barRestau As Double = 0
        Dim autre As Double = 0

        table.Merge(table1)

        If table.Rows.Count > 0 Then

            For i = 0 To table.Rows.Count - 1

                hebergement += Double.Parse(table.Rows(i)("MONTANT_ACCORDE"))
                barRestau += Double.Parse(table.Rows(i)("BAR_RESTAURANT"))
                autre += Double.Parse(table.Rows(i)("SERVICES")) + Double.Parse(table.Rows(i)("BOUTIQE")) + Double.Parse(table.Rows(i)("CYBERCAFE")) + Double.Parse(table.Rows(i)("AUTRES")) + Double.Parse(table.Rows(i)("BOUTIQE")) + Double.Parse(table.Rows(i)("SPORTS")) + Double.Parse(table.Rows(i)("LOISIRS")) + Double.Parse(table.Rows(i)("KIOSQUE_A_JOURNAUX")) + Double.Parse(table.Rows(i)("BLANCHISSERIE"))

            Next

        End If

        Dim grandTotal As Double = 0

        '------------------------------------- INDICATEURS DE PERFORMANCE -------------------------------------------------------------

        '------------------------------------- INDICATEURS DE PERFORMANCE -------------------------------------------------------------

        Dim roomList As New Room()

        Dim chifreAffaireDesChambres As Double = 0

        nombreDeNuiteeTotal = 0
        nombreDeReservation = 0

        Dim NOMBRE_DE_NUITEE As Integer = 0

        Dim query_ As String = "SELECT * FROM reserve_conf WHERE DATE_ENTTRE >= '" & firstDayOfMonth.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & lastDayOfMonth.ToString("yyyy-MM-dd") & "'"

        Dim command_ As New MySqlCommand(query_, GlobalVariable.connect)

        Dim adapter_ As New MySqlDataAdapter(command_)
        Dim enChambreIndi As New DataTable()
        adapter_.Fill(enChambreIndi)

        If enChambreIndi.Rows.Count > 0 Then

            For j = 0 To enChambreIndi.Rows.Count - 1

                Dim DATE_ENTREE = enChambreIndi.Rows(j)("DATE_ENTTRE")
                Dim DATE_SORTIE = CDate(enChambreIndi.Rows(j)("DATE_SORTIE")).ToShortDateString

                nombreDeReservation += 1

                nombreDeNuiteeTotal += stat.nombreDeNuiteeDuneReservationPourLeMoisEnCours(DATE_ENTREE, DATE_SORTIE)

                chifreAffaireDesChambres += (enChambreIndi.Rows(j)("MONTANT_ACCORDE") * (nombreDeNuiteeTotal + 1))

                NOMBRE_DE_NUITEE += nombreDeNuiteeTotal + 1

            Next

        End If


        Dim TOTAL_DES_CHAMBRES As Integer = Functions.getElementByCode("chambre", "chambre", "TYPE").Rows.Count

        If TOTAL_DES_CHAMBRES = 0 Then
            TOTAL_DES_CHAMBRES = 1
        End If

        If NOMBRE_DE_NUITEE = 0 Then
            NOMBRE_DE_NUITEE = 1
        End If

        GunaLabelTrevPar.Text = Format(chifreAffaireDesChambres / (TOTAL_DES_CHAMBRES * jourDuMois), "#,##0")

        GunaLabelRmc.Text = Format(chifreAffaireDesChambres / NOMBRE_DE_NUITEE, "#,##0")
        '----------------------------------- END INDICATEURS DE PERFORMANCE -------------------------------------------------------------
        'POUR LES AUTRES CLIENT COMPTOIRE 

        Dim ETAT_MAIN_COURANTE As Integer = 0

        Dim mainCouranteDuJours As DataTable = Functions.getElementByOnCodeAndDate(ETAT_MAIN_COURANTE, "main_courante_autres", "ETAT_MAIN_COURANTE", GlobalVariable.DateDeTravail, "main_courante_autres")

        If mainCouranteDuJours.Rows.Count > 0 Then

            For i = 0 To mainCouranteDuJours.Rows.Count - 1

                barRestau += Double.Parse(mainCouranteDuJours.Rows(i)("BAR_RESTAURANT"))
                autre += Double.Parse(mainCouranteDuJours.Rows(i)("SERVICES")) + Double.Parse(mainCouranteDuJours.Rows(i)("BOUTIQE")) + Double.Parse(mainCouranteDuJours.Rows(i)("CYBERCAFE")) + Double.Parse(mainCouranteDuJours.Rows(i)("AUTRES")) + Double.Parse(mainCouranteDuJours.Rows(i)("BOUTIQE")) + Double.Parse(mainCouranteDuJours.Rows(i)("SPORTS")) + Double.Parse(mainCouranteDuJours.Rows(i)("LOISIRS")) + Double.Parse(mainCouranteDuJours.Rows(i)("KIOSQUE_A_JOURNAUX")) + Double.Parse(mainCouranteDuJours.Rows(i)("BLANCHISSERIE"))

            Next

        End If

        grandTotal = hebergement + barRestau + autre

        If Not grandTotal = 0 Then
            GunaGaugeHebergement.Value = Math.Round((hebergement / grandTotal) * 100, 0)
            GunaGaugeBarRestaurant.Value = (barRestau / grandTotal) * 100
            GunaGaugeAutres.Value = (autre / grandTotal) * 100
        Else
            GunaGaugeHebergement.Value = 0
            GunaGaugeBarRestaurant.Value = 0
            GunaGaugeAutres.Value = 0
        End If

        GunaLabelRevenuTotal.Text = Format(grandTotal, "#,##0")
        GunaTextBoxHebergementMontant.Text = Format(hebergement, "#,##0")
        GunaTextBoxBarRestauMontant.Text = Format(barRestau, "#,##0")
        GunaTextBoxAutresMontant.Text = Format(autre, "#,##0")

        With ChartRevenuParFamille

            Dim dataSet As DataSet = New DataSet()
            Dim dt As DataTable = New DataTable()
            dt.Columns.Add("Text", GetType(String))
            dt.Columns.Add("Value", GetType(Integer))
            dt.Rows.Add("HEBERGEMENT", hebergement)
            dt.Rows.Add("BAR-RESTAURANT", barRestau)
            dt.Rows.Add("AUTRES", autre)
            dataSet.Tables.Add(dt)
            ChartRevenuParFamille.DataSource = dataSet.Tables(0)
            'ChartRevenuParFamille.Width = 380
            'ChartRevenuParFamille.Height = 209
            .Series("Series1").BorderColor = Color.FromArgb(164, 164, 164)
            .Series("Series1").ChartType = SeriesChartType.Doughnut
            .Series("Series1").BorderDashStyle = ChartDashStyle.Solid
            .Series("Series1").BorderWidth = 1
            .Series("Series1").ShadowOffset = 1
            .Series("Series1").IsValueShownAsLabel = True
            .Series("Series1").XValueMember = "Text"
            .Series("Series1").YValueMembers = "Value"
            .Series("Series1").LabelFormat = "#,##0.0"
            '.Series("Series1").Font = New Font("Tahoma", 14.0F)
            .Series("Series1").BackSecondaryColor = Color.Transparent
            .Series("Series1").LabelForeColor = Color.Black
            .Series(0).Color = Color.Red
            .Series("Series1").LegendText = "#VALX"

        End With

        Dim RoomOnly As DataTable = roomList.roomsOnly()
        Dim nombreTotalDeChambre As Integer = RoomOnly.Rows.Count

        Dim sale As Integer = 0
        Dim propre As Integer = 0
        Dim horsService As Integer = 0
        Dim aInspecter As Integer = 0
        Dim enCours As Integer = 0

        If RoomOnly.Rows.Count > 0 Then

            For i = 0 To RoomOnly.Rows.Count - 1

                If RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée sale" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre sale" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupied dirty" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Free dirty" Then
                    'Chambre sale
                    sale += 1
                ElseIf RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée propre" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre propre" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupied clean" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Free clean" Then
                    propre += 1
                ElseIf RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Hors Service" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Out of service" Then
                    horsService += 1
                ElseIf RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Nettoyage" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Cleaning" Then
                    'En cours de nettoyage
                    enCours += 1
                ElseIf RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Attente" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Pending" Then
                    'Chambre dont le nettoyage est termine et en attente de validation
                    aInspecter += 1
                End If

            Next

        End If

        GunaProgressBarSale.Maximum = nombreTotalDeChambre
        GunaProgressBarSale.Value = sale

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelSale.Text = " Sale (" & sale & "/" & nombreTotalDeChambre & ")"

        Else
            GunaLabelSale.Text = " Dirty (" & sale & "/" & nombreTotalDeChambre & ")"

        End If

        GunaProgressBarEncours.Maximum = nombreTotalDeChambre
        GunaProgressBarEncours.Value = enCours
        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelEncours.Text = " En cours (" & enCours & "/" & nombreTotalDeChambre & ")"

        Else
            GunaLabelEncours.Text = " On going (" & enCours & "/" & nombreTotalDeChambre & ")"

        End If

        GunaProgressBarAinspecter.Maximum = nombreTotalDeChambre
        GunaProgressBarAinspecter.Value = aInspecter
        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelAinspecter.Text = "A inspecter (" & aInspecter & "/" & nombreTotalDeChambre & ")"

        Else
            GunaLabelAinspecter.Text = "To inspect (" & aInspecter & "/" & nombreTotalDeChambre & ")"

        End If

        GunaProgressBarPropre.Maximum = nombreTotalDeChambre
        GunaProgressBarPropre.Value = propre
        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelPropre.Text = "Propre (" & propre & "/" & nombreTotalDeChambre & ")"

        Else
            GunaLabelPropre.Text = "Clean (" & propre & "/" & nombreTotalDeChambre & ")"

        End If

        GunaProgressBarHorsService.Maximum = nombreTotalDeChambre
        GunaProgressBarHorsService.Value = horsService

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelHorsService.Text = "Hor service (" & horsService & "/" & nombreTotalDeChambre & ")"

        Else
            GunaLabelHorsService.Text = "Out of service (" & horsService & "/" & nombreTotalDeChambre & ")"

        End If

    End Sub

    '-------------------------------------END DASH BOARD -------------------------------------------

    '------------------------------------- MODULE RESERVATION --------------------------------------------------------
    'PANNEAU DU MODULE RESERVATION
    Private Sub BarRestaurationToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles BarRestaurationToolStripMenuItem.Click

        GlobalVariable.typeDeClientAFacturer = "comptoir"

        BarRestaurantForm.Show()

        Me.Close()

    End Sub

    '------------------------------------- MODULE RECEPTION --------------------------------------------------------
    'PANNEAU DU MODULE RECEPTION
    Private Sub ReceptionToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ReceptionToolStripMenuItem.Click  'RECEPTION
        'klg
        'GunaDataGridViewResaDashBoard.DataSource = Nothing

        'Functions.EmtyGlobalVariablesContainingCodeToUpdate()

        'GunaShadowPanelReception.Show()
        'PanelTableauDeBords.Show()

        'GunaShadowPanelReservation.Hide()
        'PanelEnregistrement.Hide()

    End Sub

    'PANNEAU DU MODULE RESERVATION
    Private Sub RESERVATIONToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles RESERVATIONToolStripMenuItem.Click

        TabControlHbergement.SelectedIndex = 1

        PanelEnregistrement.Show()

        PanelTableauDeBords.Hide()
        'GunaShadowPanelReception.Hide()

    End Sub

    'PANNEAU DU MODULE RECEPTION
    Private Sub SERVICEDETAGEToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles SERVICEDETAGEToolStripMenuItem.Click

        GlobalVariable.typeChambreOuSalle = "chambre"

        Me.Hide()

        MainWindowServiceEtageForm.Show()

    End Sub

    'PANNEAU DU MODULE COMPTABILITE
    Private Sub ComptabilitéToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ComptabilitéToolStripMenuItem.Click

        MainWindowComptabiliteForm.Visible = True

        Me.Visible = False

    End Sub

    'PANNEAU DU MODULE ECONOMAT
    Private Sub ECONOMATToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ECONOMATToolStripMenuItem.Click

        MainWindowEconomat.Show()

        Me.Visible = False

    End Sub

    'GESTION DES BOUTONS DU MENU RECEPTION
    'EN CHAMBRE
    Private Sub GunaAdvenceButton13_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonEnChambre.Click

        TabControlHbergement.SelectedIndex = 3
        PanelTableauDeBords.Hide()
        PanelEnregistrement.BringToFront()
        PanelEnregistrement.Show()
        PanelPlanning.Hide()

    End Sub

    'FACTURATION
    Private Sub GunaAdvenceButton21_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton21.Click

        'GESTION DES PETITES CAISSES

        If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("PETITE_CAISSE") = 1 Then

            Dim CODE_UTILISATEUR As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
            Dim detenteurDePetiteCaisse As DataTable = Functions.getElementByCode(CODE_UTILISATEUR, "utilisateur_caisse", "CODE_UTILISATEUR")

            If detenteurDePetiteCaisse.Rows.Count > 0 Then

                Dim CODE_CAISSE As String = detenteurDePetiteCaisse.Rows(0)("CODE_CAISSE")
                Dim infoPetiteCaissse As DataTable = Functions.getElementByCode(CODE_CAISSE, "petite_caisse", "CODE_CAISSE")

                If infoPetiteCaissse.Rows.Count > 0 Then

                    PetiteCaisseForm.Close()
                    PetiteCaisseForm.Show()
                    PetiteCaisseForm.TopMost = True

                    PetiteCaisseForm.GunaLabelGestCompteGeneraux.Text = infoPetiteCaissse.Rows(0)("LIBELLE_CAISSE") & " " & GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR").ToString.ToUpper
                    PetiteCaisseForm.GunaTextBoxCodePetiteCaisse.Text = infoPetiteCaissse.Rows(0)("CODE_CAISSE")
                    PetiteCaisseForm.GunaTextBoxPLafonds.Text = Format(infoPetiteCaissse.Rows(0)("MONTANT_PLAFONDS"), "#,##0")
                    PetiteCaisseForm.GunaLabelIndexTitreMouvement.Visible = True

                Else

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Pas d'existence de Petite Caissse !!", "Gestion Petite Caisse", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                    Else
                        MessageBox.Show("Petty cash flow not existing !!", "Petty Cash flow", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                    End If

                End If

            Else
                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Aucune petite caisse ne vous a été attribuée !!", "Gestion Petite Caisse", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                Else
                    MessageBox.Show("You don't have a petty cash flow !!", "Petty Cash Flow", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                End If

            End If
        Else

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Vous n'avez pas droit à la petite caissse !", "Gestion Petite Caisse", MessageBoxButtons.OK, MessageBoxIcon.Warning)

            Else
                MessageBox.Show("You don't have the right to have a petty cash flow !", "Petty cash Flow", MessageBoxButtons.OK, MessageBoxIcon.Warning)

            End If
        End If

    End Sub

    'ARRIVEES
    Private Sub GunaAdvenceButton27_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton27.Click

        GlobalVariable.attribuerChambre = False



        If GlobalVariable.actualLanguageValue = 1 Then
            GunaFrontDeskLabel.Text = "ARRIVEES"
        Else
            GunaFrontDeskLabel.Text = "ARRIVALS"
        End If

        DataGridViewAttenduPanel.Columns.Clear()
        TabControlHbergement.SelectedIndex = 2
        PanelTableauDeBords.Hide()
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()
        PanelPlanning.Hide()

    End Sub

    Dim attribuerChambre As Boolean = True

    'ATTRIBUER CHAMBRE
    Private Sub GunaAdvenceButton14_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonAttribuerChambre.Click

        GlobalVariable.attribuerChambre = True

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaFrontDeskLabel.Text = "ATTRIBUER CHAMBRE"
        Else
            GunaFrontDeskLabel.Text = "ASSIGN ROOM"
        End If

        DataGridViewAttenduPanel.Columns.Clear()
        TabControlHbergement.SelectedIndex = 2
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

    End Sub

    ' MODULE DE RESERVATION 
    'CARDEX
    Private Sub GunaAdvenceButton6_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton6.Click
        ClientForm.Show()
        ClientForm.TopMost = True
    End Sub

    Public Sub VidageDesChampsPourNouvelleReservation()

        'GlobalVariable.connectClose()

        'GlobalVariable.connecFunction()

        GunaComboBoxHeureArrivee.Enabled = True

        GunaLabelCodeTarif.Text = "CODE TARIF"
        GunaLabelCodeTarif.Visible = False

        suivieDesReservationsVisibilte()

        GunaTextBoxMontantAccorde.Enabled = True

        'GunaRadioButtonWhatsAppNon.Checked = True
        GunaRadioButtonWhatsAppOui.Checked = True
        GunaRadioButtonWhatsAppOui.Enabled = True

        AutoLoadRoomForRouting()

        If GlobalVariable.actualLanguageValue = 0 Then
            GunaButtonReservation.Text = "Booking"
        Else
            GunaButtonReservation.Text = "Réserver"
        End If

        GunaComboBoxHeureArrivee.Enabled = True
        GunaComboBoxHeureDepart.Enabled = True

        nettoyageDesInfoPriseEnCharge()

        nettoyageDesGratuitees()

        GunaCheckBoxGratuitee.Enabled = True
        GunaCheckBoxDayUse.Enabled = True
        GunaCheckBoxMensuel.Enabled = True

        'REINISIALISATION DES BOUTONS DE GESTION DES RESERVATIONDE GROUPE
        If GunaCheckBoxReservationDeGroupe.Checked Then

            GunaCheckBoxReservationDeGroupe.Checked = False

            EtatDuBoutonDeGestionDesReservationDeGroupe()

            GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")

        End If

        GunaTextBoxPetitDejeuner.Text = 0
        GunaCheckBoxGratuitee.Checked = False
        'CHECK BOXE TAXE SEJOUR COLLECTE ET PETIT DEJEUENER
        GunaCheckBoxTaxeSejour.Checked = False
        GunaTextBoxTaxeSejour.Visible = False

        GunaCheckBoxPetitDejeuenerInclus.Checked = False
        GunaTextBoxPetitDejeuner.Visible = False

        'Document du front desk
        GunaDataGridViewDesFactures.Columns.Clear()
        GunaDataGridViewListeDesReglement.Columns.Clear()

        'Instruction de routage
        GunaCheckBoxPetitDejRoutage.Checked = False
        GunaCheckBoxChambreRoutage.Checked = False
        GunaTextBoxPetitDejeunerRoutage.Visible = False
        GunaTextBoxPrixChambreRoutage.Visible = False

        Functions.ClearTextBox(Me)
        GunaLabelSolde.Text = 0
        GunaLabelSolde.ForeColor = Color.Black

        GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()

        ReinitialisationDesDates()

        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

        'Initialisation du nombre de personne
        GunaTextBoxNbreAdulte.Text = 0
        GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text
        GunaTextBoxNbreEnfant.Text = 0

        GunaCheckBoxPetitDejeuenerInclus.Checked = False
        GunaCheckBoxTaxeSejour.Checked = False

        GunaTextBoxCompteDebiteur.Visible = False
        GunaTextBoxBC.Visible = False

        GunaDateTimePickerArrivee.Enabled = True
        GunaDateTimePickerDepart.Enabled = True
        GunaButtonReservation.Enabled = True
        GunaButtonCheckIn.Enabled = True
        GunaButtonAnnulerResa.Enabled = True

        GunaButtonCheckOut.Enabled = True
        GunaCheckBoxDayUse.Enabled = True
        GunaCheckBoxMensuel.Enabled = True
        GunaCheckBoxGratuitee.Enabled = True
        GunaCheckBoxReservationDeGroupe.Enabled = True

        GunaTextBoxCodeTypeDeChambre.Enabled = True
        'GunaTextBoxLibelleTYpe.Enabled = True
        GunaButtonListeDesCategorieDeChambre.Enabled = True
        GunaTextBoxNumeroChambre.Enabled = True
        'GunaTextBoxLibelleChambre.Enabled = True
        GunaTextBoxNomPrenom.Enabled = True
        GunaTextBoxEntrepriseDuclient.Enabled = True

        GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail.AddDays(1)

        GunaLabelNumReservation.Visible = True
        GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")

        If GunaComboBoxTypeReservation.Items.Count > 0 Then

            GunaComboBoxTypeReservation.SelectedIndex = 0

        End If


        If GunaComboBoxSourceReservation.Items.Count > 0 Then

            Dim infoSupSource As New DataTable()

            If GlobalVariable.actualLanguageValue = 0 Then

                infoSupSource = Functions.getElementByCode("WALK IN", "SOURCE_RESERVATION", "SOURCE_RESERVATION")

                If infoSupSource.Rows.Count > 0 Then
                    'GunaComboBoxSourceReservation.SelectedValue = infoSupSource.Rows(0)("CODE_SOURCE_RESERVATION")
                End If

            Else

                infoSupSource = Functions.getElementByCode("COMPTOIR", "SOURCE_RESERVATION", "SOURCE_RESERVATION")

                If infoSupSource.Rows.Count > 0 Then
                    'GunaComboBoxSourceReservation.SelectedValue = infoSupSource.Rows(0)("CODE_SOURCE_RESERVATION")
                End If

            End If

        End If

        GunaComboBoxSourceReservation.SelectedIndex = -1

    End Sub

    'NOUVELLE RESERVATION
    Private Sub GunaAdvenceButton5_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton5.Click

        VidageDesChampsPourNouvelleReservation()

        TabControlHbergement.SelectedIndex = 0

        GunaLabelNumReservation.Visible = True
        GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")

        GunaPanelDisponibilite.Visible = False
        PanelPlanning.Visible = False
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

    End Sub

    'MODIFIER RESERVATION
    Private Sub GunaAdvenceButton4_Click(sender As Object, e As EventArgs)

        TabControlHbergement.SelectedIndex = 1
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

    End Sub

    'TOP LEVEL MENU
    Private Sub TarifsToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles TarifsToolStripMenuItem.Click
        TarifForm.Show()
        TarifForm.TopMost = True
    End Sub

    'SOCIETE
    Private Sub ToolStripMenuItem133_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem133.Click
        CompanyForm.Show()
        CompanyForm.TopMost = True
    End Sub

    'AGENCE
    Private Sub ToolStripMenuItem134_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem134.Click
        AgencyForm.Show()
        AgencyForm.TopMost = True
    End Sub

    'UTILISATEUR
    Private Sub ToolStripMenuItem136_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem136.Click
        UserForm.TopMost() = True
        UserForm.Show()
    End Sub


    'LECTURE DE LA CARTE

    '--------------- GESTION D'ENCODAGES

    Private Declare Function StartSession Lib "LockDll.Dll" (ByVal Software As Integer, ByVal DBServer As String, ByVal LogUser As String, ByVal DBFlag As Integer) As Integer
    Private Declare Function EndSession Lib "LockDll.Dll" () As Integer
    Private Declare Function ChangeLogUser Lib "LockDll.Dll" (ByVal LogUser As String) As Integer

    Private Declare Function NewKey Lib "LockDll.Dll" (ByVal Port As Integer, ByVal RoomNo As String, ByVal Door As String, ByVal Floor As String, ByVal TimeStr As String, ByVal Holder As String, ByVal IDNo As String, ByVal breakfast As Integer, ByVal overflag As Integer, ByVal CardNo As Integer) As Integer
    Private Declare Function AddKey Lib "LockDll.Dll" (ByVal Port As Integer, ByVal RoomNo As String, ByVal Door As String, ByVal Floor As String, ByVal TimeStr As String, ByVal Holder As String, ByVal IDNo As String, ByVal breakfast As Integer, ByVal overflag As Integer, ByVal CardNo As Integer) As Integer
    Private Declare Function DupKey Lib "LockDll.Dll" (ByVal Port As Integer, ByVal RoomNo As String, ByVal Door As String, ByVal Floor As String, ByVal TimeStr As String, ByVal Holder As String, ByVal IDNo As String, ByVal breakfast As Integer, ByVal overflag As Integer, ByVal CardNo As Integer) As Integer

    'Private Declare Function ReadKeyCard Lib "LockDll.Dll" (ByVal Port As Integer, ByVal RoomNo As String, ByVal Gate As String, ByVal TimeStr As String, ByVal Holder As String, ByVal IDNo As String, ByVal CardNo As Integer, ByVal ByValCardStatus As Integer, ByVal breakfast As Integer) As Integer

    Private Declare Function ReadKeyCard Lib "LockDll.Dll" (ByVal Port As Integer, ByVal RoomNo As String, ByVal Door As String, ByVal Floor As String, ByVal TimeStr As String, ByVal Holder As String, ByVal IDNo As String, ByVal CardNo As Integer, ByVal ByValCardStatus As Integer, ByVal breakfast As Integer) As Integer

    Private Declare Function EraseKeyCard Lib "LockDll.Dll" (ByVal Port As Integer, ByVal cardno As Integer) As Integer
    Private Declare Function CheckOut Lib "LockDll.Dll" (ByVal RoomNo As String, ByVal CardNo As Integer) As Integer

    'Lecture de la carte du client pour un affichage directe de ses informations

    Public Sub LectureDeCarte()


        'Lecture de la carte du client pour un affichage directe de ses informations

        CB_Software.SelectedIndex = 0
        CB_Port.SelectedIndex = 0
        CB_Breakfast.SelectedIndex = 1
        CB_DB.SelectedIndex = 0
        tb_server.Text = GlobalVariable.AgenceActuelle.Rows(0)("CHEMIN_HOTEL_LOCK_SYSTEM")

        'Demarrage de session
        Dim server As String
        Dim user As String
        Dim LockSoftware As Integer
        Dim lStatus As Integer
        Dim db_flag As Long

        server = tb_server.Text
        user = "DllUser"
        LockSoftware = CB_Software.SelectedIndex + 1

        TB_Result.Text = "Executing..."
        db_flag = CB_DB.SelectedIndex
        TB_Result.Refresh()

        lStatus = StartSession(LockSoftware, server, user, CB_DB.SelectedIndex)
        'lStatus = StartSession(LockSoftware, server, user, db_flag)

        TB_Result.Text = lStatus.ToString("X")

        'Lecture de carte
        Dim lReadStatus As Integer
        Dim Port As Integer
        Dim CardNo As Integer
        Dim CardStatus As Integer
        Dim Breakfast As Integer

        Dim RoomNo As String
        Dim Holder As String
        Dim IDNo As String
        Dim TimeStr As String
        Dim Door As String
        Dim lift As String

        RoomNo = New String("", 64)
        Holder = New String("", 64)
        IDNo = New String("", 64)
        TimeStr = New String("", 64)
        Door = New String("", 128)
        lift = New String("", 128)

        Port = CB_Port.SelectedIndex

        CardNo = 0
        CardStatus = 0
        Breakfast = 0

        TB_Result.Text = "Executing..."
        TB_Result.Refresh()

        lReadStatus = ReadKeyCard(Port, RoomNo, Door, lift, TimeStr, Holder, IDNo, CardNo, CardStatus, Breakfast)

        'TB_Result.Text = Hex(lStatus)
        TB_Result.Text = lReadStatus.ToString("X")

        'lStatus = ReadKeyCard(Port, RoomNo, Door, lift, TimeStr, Holder, IDNo, CardNo, CardStatus, Breakfast)

        'TB_Result.Text = lStatus.ToString("X")

        If (lReadStatus = 0) Then
            TB_CardNo.Text = CardNo.ToString()
            TB_Status.Text = CardStatus.ToString()
            CB_Breakfast.SelectedIndex = Breakfast

            TB_RoomNo.Text = RoomNo.ToString()
            'TB_Holder.Text = Holder.ToString()
            'GunaTextBoxNom_Prenom.Text = Holder.ToString()
            TB_IDNo.Text = IDNo.ToString()
            TB_Time.Text = TimeStr.ToString()
        End If

        'Arret de la session
        Dim lEndStatus As Integer

        TB_Result.Text = "Executing..."

        TB_Result.Refresh()

        lEndStatus = EndSession()

        TB_Result.Text = lStatus.ToString("X")

        'On recherche le numéro de réservation du client en chambre

        If Functions.GetAllElementsOnTwoConditions(TB_RoomNo.Text, "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION").Rows.Count > 0 Then

            GunaLabelNumReservation.Visible = True
            GunaLabelNumReservation.Text = TB_RoomNo.Text

            'On rempli le panel avant son affichage

            GunaLabelNumReservation.Text = Functions.GetAllElementsOnTwoConditions(TB_RoomNo.Text, "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION").Rows(0)("CODE_RESERVATION")

            GlobalVariable.codeReservationToUpdate = GunaLabelNumReservation.Text
            GlobalVariable.codeChambreToUpdate = GunaLabelNumReservation.Text

            'We first search in reservation 

            'not found in reservation so, we search in reserve
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

            'Variable to print or not checkout button
            GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION")
            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION", 0, "ETAT_MAIN_COURANTE")
            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
                mainCouranteJournaliere = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")

            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate

            If GunaRadioButtonSalleFete.Checked Then

                Dim typeChambre As DataTable = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                    GunaTextBoxMateriel.Text = Format(Forfait.Rows(0)("LOCATION_MATERIEL"), "#,##0")
                    GunaTextBoxAutres.Text = Format(Forfait.Rows(0)("AUTRES"), "#,##0")

                    GunaComboBoxEvenement.SelectedValue = Forfait.Rows(0)("CODE_EVENEMENT")

                    '------------- addition -----------------------------------------------

                    GunaTextBoxQteGouter.Text = Forfait.Rows(0)("NBRE_GOUTER")
                    GunaTextBoxPrixGouter.Text = Format(Forfait.Rows(0)("PU_GOUTER"), "#,##0")

                    GunaTextBoxCocktail.Text = Format(Forfait.Rows(0)("NBRE_COCKTAIL"), "#,##0")
                    GunaTextBoxPUCocktail.Text = Format(Forfait.Rows(0)("PU_COCKTAIL"), "#,##0")

                    GunaComboBoxHeureCafe.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_CAFE"))
                    GunaComboBoxHeureCafe.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_CAFE")
                    GunaComboBoxHeureDej.Items.Add(Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER"))
                    GunaComboBoxHeureDej.SelectedItem = Forfait.Rows(0)("HEURE_PAUSE_DEJEUNER")
                    GunaComboBoxHeureDiner.Items.Add(Forfait.Rows(0)("HEURE_DINER"))
                    GunaComboBoxHeureDiner.SelectedItem = Forfait.Rows(0)("HEURE_DINER")
                    GunaComboBoxHeureGouter.Items.Add(Forfait.Rows(0)("HEURE_GOUTER"))
                    GunaComboBoxHeureGouter.SelectedItem = Forfait.Rows(0)("HEURE_GOUTER")
                    GunaComboBoxHeureCocktail.Items.Add(Forfait.Rows(0)("HEURE_COCKTAIL"))
                    GunaComboBoxHeureCocktail.SelectedItem = Forfait.Rows(0)("HEURE_COCKTAIL")

                    'QUANTITE

                    GunaTextBox47.Text = Forfait.Rows(0)("EAU_PTE_QTE")
                    GunaTextBox48.Text = Forfait.Rows(0)("BOISSONS_GAZEUSES_QTE")
                    GunaTextBox54.Text = Forfait.Rows(0)("VIN_ROUGE_QTE")
                    GunaTextBox63.Text = Forfait.Rows(0)("VIN_ROSE_QTE")
                    GunaTextBox10.Text = Forfait.Rows(0)("EAU_GRDE_QTE")
                    GunaTextBox50.Text = Forfait.Rows(0)("BIERES_QTE")
                    GunaTextBox36.Text = Forfait.Rows(0)("BOISSONS_EXT_QTE")

                    'MONTANT
                    GunaTextBoxMontantEauPetiteBouteille.Text = Format(Forfait.Rows(0)("EAU_PTE_MONTANT"), "#,##0")
                    GunaTextBox68.Text = Format(Forfait.Rows(0)("EAU_GRDE_MONTANT"), "#,##0")
                    GunaTextBox62.Text = Format(Forfait.Rows(0)("BOISSONS_GAZEUSES_MONTANT"), "#,##0")
                    GunaTextBox61.Text = Format(Forfait.Rows(0)("BIERES_MONTANT"), "#,##0")
                    GunaTextBox59.Text = Format(Forfait.Rows(0)("VIN_ROUGE_MONTANT"), "#,##0")
                    GunaTextBox57.Text = Format(Forfait.Rows(0)("VIN_ROSE_MONTANT"), "#,##0")
                    GunaTextBox64.Text = Format(Forfait.Rows(0)("BOISSONS_EXT_MONTANT"), "#,##0")
                    GunaTextBoxDroitDeBouchon.Text = Format(Forfait.Rows(0)("DROIT_DE_BOUCHON"), "#,##0")

                    If Forfait.Rows(0)("VIDEO_PROJ") = 1 Then
                        GunaCheckBoxVidOui.Checked = True
                        GunaCheckBoxVidNon.Checked = False
                    Else
                        GunaCheckBoxVidNon.Checked = True
                        GunaCheckBoxVidOui.Checked = False
                    End If

                    If Forfait.Rows(0)("SONO") = 1 Then
                        GunaCheckBoxSonoOui.Checked = True
                        GunaCheckBoxSonoNon.Checked = False
                    Else
                        GunaCheckBoxSonoNon.Checked = True
                        GunaCheckBoxSonoOui.Checked = False
                    End If

                    If Forfait.Rows(0)("COUVERTS") = 1 Then
                        GunaCheckBoxCouvOui.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    Else
                        GunaCheckBoxCouvNon.Checked = True
                        GunaCheckBoxCouvOui.Checked = False
                    End If

                    If Forfait.Rows(0)("TABLE_CHAISE") = 1 Then
                        GunaCheckBoxTableOui.Checked = True
                        GunaCheckBoxTableNon.Checked = False
                    Else
                        GunaCheckBoxTableNon.Checked = True
                        GunaCheckBoxTableOui.Checked = False
                    End If

                    If Forfait.Rows(0)("MISE_EN_PLACE") = 1 Then
                        GunaCheckBoxEcole.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 2 Then
                        GunaCheckBoxTheatre.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 3 Then
                        GunaCheckBoxRectangle.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 4 Then
                        GunaCheckBoxCocktail.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 5 Then
                        GunaCheckBoxBanquet.Checked = True
                    ElseIf Forfait.Rows(0)("MISE_EN_PLACE") = 0 Then
                        GunaCheckBoxU.Checked = True
                    End If

                    If Forfait.Rows(0)("CLOISONNEMENT") = 2 Then
                        GunaCheckBox2.Checked = True
                    ElseIf Forfait.Rows(0)("CLOISONNEMENT") = 3 Then
                        GunaCheckBox9.Checked = True
                    End If
                End If

            Else

            End If

            affectingValuesToFields()

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            PanelEnregistrement.Show()
            PanelEnregistrement.BringToFront()
            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    Private Sub GunaAdvenceButton33_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton33.Click

        'LectureDeCarte()

        CahierDeConsigneForm.Show()
        CahierDeConsigneForm.TopMost = True

        'GunaTextBoxNomPrenomClient.Text = Functions.GetAllElementsOnTwoConditions(TB_RoomNo.Text, "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION").Rows(0)("CLIENT_ID")

    End Sub

    ' REGISTRE
    Private Sub ToolStripMenuItem137_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem137.Click
        RegisterForm.Show()
    End Sub

    'TAXE SEJOURS - CONFIGURATION DU NOMBRE D'HOTEL
    Private Sub ToolStripMenuItem112_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem112.Click
        TaxeSejourForm.Show()
    End Sub

    '--------------------------------------------- GESTION DU LEFT PANEL MENUSTRIP -------------------------------------------
    '-------------------------------------- SESSION
    'CHANGER MOT DE PASSE
    Private Sub ToolStripMenuItem117_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem117.Click

        'PERMET DE DETERMINER QUELLE FENETRE DOIT ETRE FERMEE AVEC CHANGEMENT DU MOT POUR RECONNECTION AVEC LE NOUVEAU MOT DE PASSE
        GlobalVariable.changerMotDePasseDepuis = "reception"

        ChangePasswordForm.Show()
        ChangePasswordForm.TopMost = True

    End Sub

    'QUITTER
    Private Sub ToolStripMenuItem119_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem119.Click

        Dim dialog As DialogResult

        If GlobalVariable.actualLanguageValue = 1 Then
            dialog = MessageBox.Show("Voulez-vous vraiment fermer ", "Fermer lyte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

        Else
            dialog = MessageBox.Show("Do you really want to close your session ", "Close lyte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

        End If

        If dialog = DialogResult.No Then
            'e.Cancel = True
        Else

            Dim CODE_UTILISATEUR = GlobalVariable.ConnectedUser(0)("CODE_UTILISATEUR")

            Dim CODE_CAISSE As String = ""

            Dim CAISSE_UTILISATEUR As DataTable = Functions.getElementByCode(CODE_UTILISATEUR, "caisse", "CODE_UTILISATEUR")

            If CAISSE_UTILISATEUR.Rows.Count > 0 Then

                CODE_CAISSE = CAISSE_UTILISATEUR.Rows(0)("CODE_CAISSE")

            End If

            Dim ETAT_CAISSE As Integer = 0
            Dim caissier As New Caisse()

            'caissier.ouvertureFermetureDeCaisse(CODE_CAISSE, ETAT_CAISSE)

            Dim Action As String = ""

            If GlobalVariable.actualLanguageValue = 1 Then
                Action = "DECONNEXION DE " & GlobalVariable.ConnectedUser(0)("NOM_UTILISATEUR")

            Else
                Action = "LOG OUT OF " & GlobalVariable.ConnectedUser(0)("NOM_UTILISATEUR")

            End If

            User.mouchard(Action)

            HomeForm.Close()

            AccueilForm.Close()

            AccueilForm.Show()

            Me.Close()

        End If

    End Sub


    '-------------------------------------- CONFIGURATION ------------------------------------------------------

    'SOURCE DE RESERVATION
    Private Sub ToolStripMenuItem111_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem111.Click
        SourceReservation.TopMost() = True
        SourceReservation.Show()
    End Sub

    'TYPE PERSONNEL
    Private Sub ToolStripMenuItem103_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem103.Click
        TypePersonnelForm.TopMost() = True
        TypePersonnelForm.Show()
    End Sub

    'PERSONNEL
    Private Sub ToolStripMenuItem104_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem104.Click
        PersonnelForm.TopMost() = True
        PersonnelForm.Show()
    End Sub

    'FAMILLE ARTICLE
    Private Sub ToolStripMenuItem82_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem82.Click

        ArticleFamilyForm.Close()

        GlobalVariable.typeFamilleOuSousFamille = "famille" 'POINT DE VENTE

        ArticleFamilyForm.Show()

        ArticleFamilyForm.TopMost = True

    End Sub

    'SOUS FAMILLE ARTICLE
    Private Sub ToolStripMenuItem83_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem83.Click

        ArticleFamilyForm.Close()

        GlobalVariable.typeFamilleOuSousFamille = "sous famille" 'FAMILLE
        ArticleFamilyForm.TopMost() = True
        ArticleFamilyForm.Show()

    End Sub

    '
    Private Sub FamilleDArToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles FamilleDArToolStripMenuItem.Click

        ArticleFamilyForm.Close()

        GlobalVariable.typeFamilleOuSousFamille = "sous sous famille" 'SOUS FAMILLE
        ArticleFamilyForm.TopMost() = True
        ArticleFamilyForm.Show()
        'Dim MainWindow As New MainWindow()
        'MainWindow.TabControlHbergement.SelectedIndex = 1

    End Sub

    'CATEGORIE D'ARTICLES
    Private Sub CatégoriesToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles CatégoriesToolStripMenuItem.Click

        ArticleFamilyForm.Close()

        GlobalVariable.typeFamilleOuSousFamille = "categorie" 'CATEGORIE

        ArticleFamilyForm.Show()

        ArticleFamilyForm.TopMost() = True

    End Sub

    'ARTICLES
    Private Sub ToolStripMenuItem86_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem86.Click

        ArticleForm.Close()

        GlobalVariable.typeArticle = "article"
        ArticleForm.TopMost() = True
        ArticleForm.Show()

    End Sub

    'MATIERES
    Private Sub MatièresToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles MatièresToolStripMenuItem.Click
        GlobalVariable.typeArticle = "matiere"
        ArticleForm.TopMost() = True
        ArticleForm.Show()
    End Sub

    'CATEGORIE CLIENT
    Private Sub ToolStripMenuItem99_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem99.Click
        ClientForm.TopMost = True
        ClientCategoryForm.Show()
    End Sub

    'CLIENT
    Private Sub ToolStripMenuItem100_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem100.Click
        ClientForm.Show()
        ClientForm.TopMost = True
    End Sub

    'TYPE CHAMBRE
    Private Sub ToolStripMenuItem107_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem107.Click
        RoomTypeForm.TopMost = True
        RoomTypeForm.Show()
    End Sub

    'TYPE SALLE
    Private Sub ToolStripMenuItem109_Click(sender As Object, e As EventArgs)
        RoomTypeForm.TopMost = True
        RoomTypeForm.Show()
    End Sub

    'CHAMBRE
    Private Sub ToolStripMenuItem108_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem108.Click
        RoomForm.TopMost = True
        RoomForm.Show()
    End Sub

    'SALLE
    Private Sub ToolStripMenuItem110_Click(sender As Object, e As EventArgs)
        RoomForm.TopMost = True
        RoomForm.Show()
    End Sub

    'CHECKBOX PERMETTAN LA GESTION DES RESERVATION DE GROUPE

    Private Sub EtatDuBoutonDeGestionDesReservationDeGroupe()

        'On affiche code du groupe selon si le bouton est cochet et 
        'ne doit être modifiable que si c'est une réservation n'étant pas liée a une entreprise

        If GunaCheckBoxReservationDeGroupe.Checked Then

            GunaTextBoxCodeDeGroupe.Visible = True

            If GlobalVariable.codeReservationToUpdate = "" Then
                GunaTextBoxCodeDeGroupe.Text = Functions.GeneratingRandomCodeWithSpecifications("reservation", "")
            Else
                GunaTextBoxCodeDeGroupe.Text = GlobalVariable.ReservationToUpdate.Rows(0)("GROUPE")
            End If

            GunaTextBoxCodeDeGroupe.Visible = True
        Else
            GunaTextBoxCodeDeGroupe.Clear()
            GunaTextBoxCodeDeGroupe.Visible = False
        End If

    End Sub

    'CLICK SUR LE BOUTON DE RESERVATION EN GROUPE
    Private Sub GunaCheckBoxReservationDeGroupe_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxReservationDeGroupe.Click

        EtatDuBoutonDeGestionDesReservationDeGroupe()

    End Sub

    'SOUS FAMILLE D'ARTICLE
    Private Sub GunaButtonSousFamilleArticle_Click(sender As Object, e As EventArgs) Handles GunaButtonSousFamilleArticle.Click

        ArticleFamilyForm.Close()

        GlobalVariable.typeFamilleOuSousFamille = "sous sous famille"

        Dim MainWindow As New MainWindow()
        MainWindow.TabControlHbergement.SelectedIndex = 1
        ArticleFamilyForm.Show()
        ArticleFamilyForm.TopMost = True

    End Sub

    '------------------------------------------------- GESTION DES MENUS CONTEXTUEL DUPLIQUER - DELETE

    'Duplication de reservation
    Private Sub ToolStripMenuItem5_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem5.Click

        If GunaDataGridViewReservationList.Rows.Count > 0 Then

            GlobalVariable.duplicationDeReservation = True

            Dim dialog As DialogResult

            If GlobalVariable.actualLanguageValue = 1 Then
                dialog = MessageBox.Show("Voulez-vous vraiment Dupliquer cette Réservation ", "Duplication", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            Else
                dialog = MessageBox.Show("Do you really want to duplicate the booking ", "Duplication", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            End If

            If Not dialog = DialogResult.No Then

                Dim myValue As String = ""

                If GlobalVariable.actualLanguageValue = 1 Then
                    myValue = InputBox("Nombre de Duplication", "Duplication", "")
                Else
                    myValue = InputBox("Number of Duplication", "Duplication", "")
                End If

                Dim nombreDeDuplication As Integer = 0

                Integer.TryParse(myValue, nombreDeDuplication)

                If nombreDeDuplication > 0 Then

                    'On doit determiner si la reseravtion est dans reservation ou dans reserve_conf
                    Dim reservation As DataTable = Functions.getElementByCode(GunaDataGridViewReservationList.CurrentRow.Cells("Reservation").Value.ToString, "reservation", "CODE_RESERVATION")

                    If reservation.Rows.Count > 0 Then

                        For i = 1 To nombreDeDuplication
                            Functions.DuplicateRowFromDataGrid(GunaDataGridViewReservationList, GunaDataGridViewReservationList.CurrentRow.Cells("Reservation").Value.ToString, "reservation", "ID_RESERVATION")
                        Next

                    Else

                        For i = 1 To nombreDeDuplication
                            Functions.DuplicateRowFromDataGrid(GunaDataGridViewReservationList, GunaDataGridViewReservationList.CurrentRow.Cells("Reservation").Value.ToString, "reserve_conf", "ID_RESERVATION")
                        Next

                    End If

                    GunaDataGridViewReservationList.Columns.Clear()

                    ReservationList("all", "none")

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Réservation dupliquée avec succès", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Else
                        MessageBox.Show("Reservation duplicated successfully", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    End If

                End If

            End If
        Else

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Aucune ligne à Dupliquer !", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("No line to duplicate !", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If


        End If

    End Sub

    'SUpressions des réservations
    Private Sub ToolStripMenuItem7_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem7.Click

        If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("CORRECTIONS") = 1 Then

            If GunaDataGridViewReservationList.Rows.Count > 0 Then

                Dim DeleteRow As Boolean = False
                Dim rowToDelete As String = GunaDataGridViewReservationList.CurrentRow.Cells("Reservation").Value.ToString

                Dim dialog As DialogResult

                If GlobalVariable.actualLanguageValue = 1 Then
                    dialog = MessageBox.Show("Voulez-vous vraiment Supprimer cette Réservation " & rowToDelete, "Demande de suppression", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                Else

                    dialog = MessageBox.Show("Do you reaaly want to delete this booking " & rowToDelete, "Delete", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                End If

                If dialog = DialogResult.No Then
                    'e.Cancel = True
                Else

                    DeleteRow = True

                End If

                If DeleteRow Then

                    Functions.DeleteRowFromDataGrid(GunaDataGridViewReservationList, rowToDelete, "reserve_conf", "CODE_RESERVATION")

                    Functions.DeleteRowFromDataGrid(GunaDataGridViewReservationList, rowToDelete, "reservation", "CODE_RESERVATION")

                    GunaDataGridViewReservationList.Columns.Clear()

                    ReservationList("all", "none")

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Vous avez supprimé avec succès", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    Else
                        MessageBox.Show("Booking successfully deleted", "Delete", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If
                End If

            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Aucune ligne à suprimer !", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

                Else
                    MessageBox.Show("No line to delete !", "Delete", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If
            End If

        Else

            If GlobalVariable.actualLanguageValue = 0 Then
                languageMessage = "You don't have the necessary right to delete"
                languageTitle = "Correction"
            ElseIf GlobalVariable.actualLanguageValue = 1 Then
                languageMessage = "Vous n'avez pas le droit necessaire pour supprimer"
                languageTitle = "Correction"
            End If

            MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Warning)

        End If


    End Sub

    'Supression d'une réservation attendue
    ' ATTENDU TAB DELETE
    Private Sub ToolStripMenuItemSupprimer_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItemSupprimer.Click

        If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("CORRECTIONS") = 1 Then

            If DataGridViewAttenduPanel.Rows.Count > 0 Then

                Dim DeleteRow As Boolean = False

                Dim rowToDelete As String = ""

                If rowToDelete = "" Then
                    rowToDelete = DataGridViewAttenduPanel.CurrentRow.Cells("Reservation").Value.ToString
                End If

                Dim dialog As DialogResult

                If GlobalVariable.actualLanguageValue = 1 Then
                    dialog = MessageBox.Show("Voulez-vous vraiment Supprimer cette Réservation ", "Demande de suppression", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                Else
                    dialog = MessageBox.Show("Do you reaaly want to delete this booking ", "Delete", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                End If

                If dialog = DialogResult.No Then
                    'e.Cancel = True
                Else
                    DeleteRow = True
                End If

                If DeleteRow Then

                    Functions.DeleteRowFromDataGrid(DataGridViewAttenduPanel, rowToDelete, "reservation", "CODE_RESERVATION")

                    DataGridViewAttenduPanel.Columns.Clear()

                    ListeDesAttendues()

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Vous avez supprimé avec succès", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    Else
                        MessageBox.Show("You deleted successfully", "Delete", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If
                End If

            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Aucune ligne à supprimer !", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

                Else
                    MessageBox.Show("No Ligne to delete !", "Delete", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If
            End If

        Else

            If GlobalVariable.actualLanguageValue = 0 Then
                languageMessage = "You don't have the necessary right to delete"
                languageTitle = "Correction"
            ElseIf GlobalVariable.actualLanguageValue = 1 Then
                languageMessage = "Vous n'avez pas le droit necessaire pour supprimer"
                languageTitle = "Correction"
            End If

            MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Warning)

        End If


    End Sub

    'Duplication d'une réservation attendu
    ' ATTENDU TAB DUPILCATION
    Private Sub ToolStripMenuItemDupliquer_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItemDupliquer.Click

        If DataGridViewAttenduPanel.Rows.Count > 0 Then

            Dim dialog As DialogResult
            If GlobalVariable.actualLanguageValue = 1 Then
                dialog = MessageBox.Show("Voulez-vous vraiment Dupliquer cette Réservation ", "Duplication", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            Else
                dialog = MessageBox.Show("Do you reaaly want to duplicate this booking", "Duplication", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            End If
            If Not dialog = DialogResult.No Then

                Dim myValue As String = ""

                If GlobalVariable.actualLanguageValue = 1 Then
                    myValue = InputBox("Nombre de Duplication", "Duplication", "")

                Else
                    myValue = InputBox("Number of Duplications", "Duplication", "")

                End If

                Dim nombreDeDuplication As Integer = 0

                Integer.TryParse(myValue, nombreDeDuplication)

                If nombreDeDuplication > 0 Then

                    For i = 1 To nombreDeDuplication
                        Functions.DuplicateRowFromDataGrid(DataGridViewAttenduPanel, DataGridViewAttenduPanel.CurrentRow.Cells("Reservation").Value.ToString, "reservation", "ID_RESERVATION")
                    Next

                    DataGridViewAttenduPanel.Columns.Clear()

                    ListeDesAttendues()

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Réservation dupliquée avec succès", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    Else
                        MessageBox.Show("Booking successfully duplicated", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If

                End If

            End If
        Else


            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Aucune ligne à Dupliquer !", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("No line to duplicate !", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If


        End If

    End Sub

    ' EN CHAMBRE TAB DUPILCATION

    Private Sub ToolStripMenuItem1_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem1.Click

        If DataGridViewEnChambre.Rows.Count > 0 Then

            Dim dialog As DialogResult
            If GlobalVariable.actualLanguageValue = 1 Then
                dialog = MessageBox.Show("Voulez-vous vraiment Dupliquer cette Réservation", "Duplication", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            Else
                dialog = MessageBox.Show("Do you really want to duplicate the reservation", "Duplication", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            End If
            If Not dialog = DialogResult.No Then

                Dim myValue As String = ""
                If GlobalVariable.actualLanguageValue = 1 Then
                    myValue = InputBox("Nombre de Duplication", "Duplication", "")

                Else
                    myValue = InputBox("Number of Duplication", "Duplication", "")

                End If
                Dim nombreDeDuplication As Integer = 0

                Integer.TryParse(myValue, nombreDeDuplication)

                If nombreDeDuplication > 0 Then

                    For i = 1 To nombreDeDuplication
                        Functions.DuplicateRowFromDataGrid(DataGridViewEnChambre, DataGridViewEnChambre.CurrentRow.Cells("Reservation").Value.ToString, "reserve_conf", "ID_RESERVATION")
                    Next

                    DataGridViewEnChambre.Columns.Clear()

                    ListeDesEnChambres()

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Réservation dupliquée avec succès", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    Else
                        MessageBox.Show("Booking duplicated successfully", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If

                End If

            End If

        Else

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Aucune ligne à Dupliquer !", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("No liine to duplicate !", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

        End If

    End Sub

    Dim compteur As Integer = 0

    'EN CHAMBRE SUPRESSION
    Private Sub ToolStripMenuItem3_Click_1(sender As Object, e As EventArgs) Handles ToolStripMenuItem3.Click

        If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("CORRECTIONS") = 1 Then

            If DataGridViewEnChambre.Rows.Count > 0 Then

                Dim DeleteRow As Boolean = False

                Dim rowToDelete As String = ""

                If rowToDelete = "" Then
                    rowToDelete = DataGridViewEnChambre.CurrentRow.Cells("Reservation").Value.ToString
                End If

                Dim dialog As DialogResult


                If GlobalVariable.actualLanguageValue = 1 Then
                    dialog = MessageBox.Show("Voulez-vous vraiment Supprimer cette Réservation", "Demande de suppression", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                Else
                    dialog = MessageBox.Show("Do you really want to duplicate thi booking", "Delete", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                End If

                If dialog = DialogResult.No Then
                    'e.Cancel = True
                Else
                    DeleteRow = True
                End If

                If DeleteRow Then

                    Functions.DeleteRowFromDataGrid(DataGridViewEnChambre, rowToDelete, "reserve_conf", "CODE_RESERVATION")

                    DataGridViewEnChambre.Columns.Clear()

                    ListeDesEnChambres()

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Vous avez supprimé avec succès", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    Else
                        MessageBox.Show("You deleted the booking successfully", "Delete", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If
                End If

            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Aucune ligne à suprimer !", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

                Else
                    MessageBox.Show("No line to delete !", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If
            End If

        Else
            If GlobalVariable.actualLanguageValue = 0 Then
                languageMessage = "You don't have the necessary right to delete"
                languageTitle = "Correction"
            ElseIf GlobalVariable.actualLanguageValue = 1 Then
                languageMessage = "Vous n'avez pas le droit necessaire pour supprimer"
                languageTitle = "Correction"
            End If

            MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Warning)
        End If

    End Sub

    '----------------------------------------GESTION DU PENNEAU DISPONIBILITE ET TARIFS -----------------------------------------

    'CREATION D"UNE STRUCTURE DEVRANT CONTENIR CHAQUE TYPE DE CHAMBRE / RANGEE / COLONNE

    Structure enteteDuTableauDispobiliteEtTarif
        Dim nomDuTypeDeChambre As String
        Dim rowIndex As Integer
        Dim colonneIndex As Integer
    End Structure

    Public Function TauxOccupationGlobal(ByVal dateActuelle As Date) As Double

        Dim rooms As New Room()
        Dim room As DataTable = rooms.ActiveRoomsOnly()

        Dim DateDebut As Date = dateActuelle.ToString("yyyy-MM-dd")

        Dim nobreDeReservations As Integer = 0

        'EN CHAMBRE
        Dim queryEnChambre As String = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim commandEnChambre As New MySqlCommand(queryEnChambre, GlobalVariable.connect)
        commandEnChambre.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim adapterEnChambre As New MySqlDataAdapter(commandEnChambre)
        Dim tableEnChambre As New DataTable()
        adapterEnChambre.Fill(tableEnChambre)

        If (tableEnChambre.Rows.Count > 0) Then
            nobreDeReservations = tableEnChambre.Rows.Count
        End If

        'ATTENDUES
        'Dim DateFin As Date = GunaDateTimePickerDepartDepert.Value.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        If (DateDebut <= DateFin) Then

            Dim queryAttendue As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION = @ETAT_RESERVATION ORDER BY CHAMBRE_ID ASC"

            Dim ETAT_RESERVATION As Integer = 0
            Dim commandAttendue As New MySqlCommand(queryAttendue, GlobalVariable.connect)
            commandAttendue.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
            commandAttendue.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int64).Value = ETAT_RESERVATION

            Dim adapterAttendue As New MySqlDataAdapter(commandAttendue)
            Dim tableAttendue As New DataTable()
            adapterAttendue.Fill(tableAttendue)

            If (tableAttendue.Rows.Count > 0) Then
                nobreDeReservations += tableAttendue.Rows.Count
            End If

        End If

        If room.Rows.Count > 0 Then
            Return (nobreDeReservations / room.Rows.Count) * 100
        Else
            Return 0
        End If

    End Function

    Public Sub DisponibiliteEtTarifs(ByVal DateDebut As Date, DateFin As Date)

        GunaDataGridViewDispoEtTarifs.Columns.Clear()

        '0- ON SELECTIONNE CHAQUE TYPE DE CHAMBRE

        Dim existQuery As String = "SELECT * From type_chambre WHERE TYPE=@TYPE ORDER BY CODE_TYPE_CHAMBRE ASC"

        Dim command As New MySqlCommand(existQuery, GlobalVariable.connect)

        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

        Dim adapter As New MySqlDataAdapter(command)
        Dim typeChambre As New DataTable()
        adapter.Fill(typeChambre)

        Dim TauxTotal As Double = 0

        Dim totalDesChambreVendable As Integer = 0
        Dim totalDesReservationsNettes As Integer = 0
        Dim dateDuJour As Date
        Dim TOSpecific As Double = 0

        Dim TOGlobal As Double = 0

        If typeChambre.Rows.Count > 0 Then

            Dim listeDesTypeChambreEtLocalisation(typeChambre.Rows.Count) As enteteDuTableauDispobiliteEtTarif

            If GlobalVariable.actualLanguageValue = 1 Then
                GunaDataGridViewDispoEtTarifs.Columns.Add("CHAMBRE", "")
                GunaDataGridViewDispoEtTarifs.Columns.Add("DATA", "")

            Else
                GunaDataGridViewDispoEtTarifs.Columns.Add("ROOM", "")
                GunaDataGridViewDispoEtTarifs.Columns.Add("DATA", "")

            End If

            Dim nombreDeJour As Integer = DateDiff(DateInterval.Day, DateDebut, DateFin)

            For k = 0 To nombreDeJour - 1
                '1- ON AFFICHE LES DATES DU JOURS
                GunaDataGridViewDispoEtTarifs.Columns.Add(DateDebut.AddDays(k).ToString("ddd d MMM"), DateDebut.AddDays(k).ToString("ddd d MMM"))
            Next

            'VARIABLE UTILISEE POUR DETERMINER LES LIGNES DE DONNEES A AFFICHER
            Dim j As Integer = 0

            Dim n = 6 'NOMBRE DE LIGNE SANS TARIFICATIONS POUR CHAQUE TYPE DE CHAMBRE
            Dim t = 0 'NOMBRE DE TARIFICATION ASSOCIE A UN TYPE DE CHAMBRE
            Dim r = 2 'NOMBRE DE SAUT AVANT DEBUT D'ECRITURE D'UN TYPE DE CHAMBRE

            Dim rowTypeChambre = 0
            Dim rowHebergementAVendre = 0
            Dim rowResaNet = 0
            Dim rowLibre = 0
            Dim rowTO = 0
            Dim rowDebutTarif = 0

            Dim actuelRow As Integer = 0

            For i = 0 To typeChambre.Rows.Count - 1

                totalDesChambreVendable = 0
                totalDesReservationsNettes = 0
                TOSpecific = 0

                actuelRow += 1
                GunaDataGridViewDispoEtTarifs.Rows.Add("")

                actuelRow += 1
                rowTypeChambre = actuelRow
                GunaDataGridViewDispoEtTarifs.Rows.Add(typeChambre.Rows(i)("LIBELLE_TYPE_CHAMBRE"))

                listeDesTypeChambreEtLocalisation(i).nomDuTypeDeChambre = typeChambre.Rows(i)("LIBELLE_TYPE_CHAMBRE")
                listeDesTypeChambreEtLocalisation(i).rowIndex = actuelRow
                listeDesTypeChambreEtLocalisation(i).colonneIndex = 0

                actuelRow += 1
                rowHebergementAVendre = actuelRow

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaDataGridViewDispoEtTarifs.Rows.Add("Hébergement à vendre : ")

                Else
                    GunaDataGridViewDispoEtTarifs.Rows.Add("Accommodation for sale : ")

                End If

                actuelRow += 1
                rowResaNet = actuelRow

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaDataGridViewDispoEtTarifs.Rows.Add("Réservation nette : ")

                Else
                    GunaDataGridViewDispoEtTarifs.Rows.Add("Net booking : ")

                End If
                actuelRow += 1
                rowLibre = actuelRow

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaDataGridViewDispoEtTarifs.Rows.Add("Libre : ")

                Else
                    GunaDataGridViewDispoEtTarifs.Rows.Add("Free : ")

                End If

                actuelRow += 1
                rowTO = actuelRow

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaDataGridViewDispoEtTarifs.Rows.Add("Taux d'occupation : ")

                Else
                    GunaDataGridViewDispoEtTarifs.Rows.Add("Occupation rate : ")

                End If

                If GlobalVariable.actualLanguageValue = 1 Then
                    GunaDataGridViewDispoEtTarifs.Columns("CHAMBRE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
                    GunaDataGridViewDispoEtTarifs.Columns("CHAMBRE").Frozen = True

                Else
                    GunaDataGridViewDispoEtTarifs.Columns("ROOM").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
                    GunaDataGridViewDispoEtTarifs.Columns("ROOM").Frozen = True

                End If


                '3- GESTION DES TARIFICATIONS
                '-----------------------------------------------------------------------------------------------------------------------------------------

                'ON PRENDS LES prix_tarif associé a la tarification_dynamique activé (ETAT = 1)
                'AINSI L'ACTIVATION OU DESACTIVATION D'UN TARIF DYNAMIQUE DETERMINE SON AFFICHAGE OU NON

                'Dim existQuerytarif As String = "SELECT * From tarif_prix WHERE LIBELLE_TARIF NOT IN ('GRATUITEE') AND CODE_TYPE=@CODE_TYPE_CHAMBRE ORDER BY LIBELLE_TARIF ASC"
                Dim existQuerytarif As String = "SELECT * From tarif_prix, tarification_dynamique WHERE LIBELLE_TARIF NOT IN ('GRATUITEE') AND CODE_TYPE=@CODE_TYPE_CHAMBRE AND tarif_prix.CODE_TARIF_DYNAMIQUE = tarification_dynamique.CODE_TARIF_DYNAMIQUE AND tarification_dynamique.ETAT=@ETAT ORDER BY LIBELLE_TARIF ASC"

                Dim commandtarif As New MySqlCommand(existQuerytarif, GlobalVariable.connect)
                Dim ETAT As Integer = 1

                commandtarif.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = typeChambre.Rows(i)("CODE_TYPE_CHAMBRE")
                commandtarif.Parameters.Add("@ETAT", MySqlDbType.Int64).Value = ETAT

                Dim adaptertarif As New MySqlDataAdapter(commandtarif)
                Dim tarif As New DataTable()

                adaptertarif.Fill(tarif)

                '-----------------------------------------------------------------------------------------------------------------------------------------

                'Dim tarif As DataTable = Functions.getElementByCode(typeChambre.Rows(i)("CODE_TYPE_CHAMBRE"), "tarif_prix", "CODE_TYPE")
                Dim PRIX_TARIF1 As Double = 0

                If tarif.Rows.Count > 0 Then
                    rowDebutTarif = actuelRow 'L'INDEX DE LA RANGEE AVANT LE DEBUT DE LA RANGEE DES TARIFS
                    For m = 0 To tarif.Rows.Count - 1
                        'If Not Trim(tarif.Rows(m)("LIBELLE_TARIF")).Equals("GRATUITEE") Then
                        actuelRow += 1
                        GunaDataGridViewDispoEtTarifs.Rows.Add(tarif.Rows(m)("LIBELLE_TARIF"))
                        t = tarif.Rows.Count
                        'End If
                    Next

                Else

                    'AFFICHAGE DES TARIFS PUBLIC
                    rowDebutTarif = actuelRow
                    actuelRow += 1

                    If GlobalVariable.actualLanguageValue = 1 Then
                        GunaDataGridViewDispoEtTarifs.Rows.Add("PRIX AFFICHE")

                    Else
                        GunaDataGridViewDispoEtTarifs.Rows.Add("BASE PRICE")

                    End If

                End If

                'If i = 0 Then
                'j = 2
                'Else
                'j = (i * n) + t + r
                'End If

                GunaDataGridViewDispoEtTarifs.Rows(rowTypeChambre - 1).DefaultCellStyle.BackColor = Color.Indigo
                GunaDataGridViewDispoEtTarifs.Rows(rowTypeChambre - 1).DefaultCellStyle.ForeColor = Color.White

                'CHANGE THE COLOR A ROW : LIBRE
                'GunaDataGridViewDispo1.Rows(rowLibre - 1).DefaultCellStyle.BackColor = Color.Blue
                'GunaDataGridViewDispo1.Rows(rowLibre - 1).DefaultCellStyle.ForeColor = Color.White

                'REMPLISSAGE DE CHAQUE LIGNE AVEC DES DONNEES

                For k = 0 To nombreDeJour - 1

                    dateDuJour = DateDebut.AddDays(k).ToShortDateString

                    totalDesChambreVendable = 0
                    totalDesReservationsNettes = 0
                    TOSpecific = 0

                    '1- DETERMINONS LES CHAMBRES VENDABLES
                    Dim existQuery1 As String = "SELECT * From chambre WHERE CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND ETAT_CHAMBRE_NOTE NOT IN ('Hors Service') ORDER BY CODE_CHAMBRE ASC"

                    Dim command1 As New MySqlCommand(existQuery1, GlobalVariable.connect)

                    command1.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = typeChambre.Rows(i)("CODE_TYPE_CHAMBRE")
                    Dim adapter1 As New MySqlDataAdapter(command1)
                    Dim chambreVendable As New DataTable()

                    adapter1.Fill(chambreVendable)

                    If chambreVendable.Rows.Count > 0 Then
                        totalDesChambreVendable = chambreVendable.Rows.Count
                        GunaDataGridViewDispoEtTarifs.Rows(rowHebergementAVendre - 1).Cells(k + 2).Value = totalDesChambreVendable
                    End If

                    '2- DETERMINONS LES RESERVATIONS NETTES

                    '2.1- EN CHAMBRES

                    Dim query01 As String = "SELECT CHAMBRE_ID FROM reserve_conf WHERE DATE_ENTTRE <= '" & dateDuJour.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & dateDuJour.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE AND TYPE_CHAMBRE = @TYPE_CHAMBRE ORDER BY CHAMBRE_ID ASC"

                    Dim command01 As New MySqlCommand(query01, GlobalVariable.connect)
                    command01.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
                    command01.Parameters.Add("@TYPE_CHAMBRE", MySqlDbType.VarChar).Value = typeChambre.Rows(i)("CODE_TYPE_CHAMBRE")

                    Dim adapter01 As New MySqlDataAdapter(command01)
                    Dim enChambre As New DataTable()
                    adapter01.Fill(enChambre)

                    If enChambre.Rows.Count > 0 Then
                        totalDesReservationsNettes = enChambre.Rows.Count
                    End If

                    '2.2- LES DEPARTS 
                    Dim query02 As String = "SELECT CHAMBRE_ID FROM reserve_conf WHERE DATE_SORTIE >= '" & dateDuJour.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE <='" & dateDuJour.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE AND TYPE_CHAMBRE=@TYPE_CHAMBRE ORDER BY CHAMBRE_ID ASC"

                    Dim command02 As New MySqlCommand(query02, GlobalVariable.connect)
                    command02.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
                    command02.Parameters.Add("@TYPE_CHAMBRE", MySqlDbType.VarChar).Value = typeChambre.Rows(i)("CODE_TYPE_CHAMBRE")

                    Dim adapter02 As New MySqlDataAdapter(command02)
                    Dim depart As New DataTable()
                    adapter02.Fill(depart)

                    If (depart.Rows.Count > 0) Then
                        totalDesReservationsNettes -= depart.Rows.Count
                    End If

                    '2.3- ATTENDUES

                    Dim query03 As String = "SELECT CHAMBRE_ID FROM reservation WHERE DATE_SORTIE >= '" & dateDuJour.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & dateDuJour.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION= 0 AND TYPE_CHAMBRE=@TYPE_CHAMBRE ORDER BY CHAMBRE_ID ASC"

                    Dim command03 As New MySqlCommand(query03, GlobalVariable.connect)
                    command03.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
                    command03.Parameters.Add("@TYPE_CHAMBRE", MySqlDbType.VarChar).Value = typeChambre.Rows(i)("CODE_TYPE_CHAMBRE")

                    Dim adapter03 As New MySqlDataAdapter(command03)
                    Dim attendu As New DataTable()
                    adapter03.Fill(attendu)

                    If attendu.Rows.Count > 0 Then
                        totalDesReservationsNettes += attendu.Rows.Count
                    End If

                    'GunaDataGridViewDispo1.Columns.Add("jour", DateDebut.AddDays(k).ToString("ddd d MMM"))

                    GunaDataGridViewDispoEtTarifs.Rows(rowResaNet - 1).Cells(k + 2).Value = totalDesReservationsNettes

                    '2.4- CALCUL DU TAUX D'OCCUPATION
                    If totalDesChambreVendable > 0 Then
                        TOSpecific = (totalDesReservationsNettes / totalDesChambreVendable) * 100
                    End If

                    GunaDataGridViewDispoEtTarifs.Rows(rowLibre - 1).Cells(k + 2).Value = totalDesChambreVendable - totalDesReservationsNettes 'NOMBRE DE CHAMBRE LIBRE
                    GunaDataGridViewDispoEtTarifs.Rows(rowLibre - 1).Cells(k + 2).Style.ForeColor = Color.FromArgb(0, 153, 0)

                    Dim colorToUse As Color

                    If TOSpecific < 20 Then
                        colorToUse = Color.Red
                    ElseIf TOSpecific < 40 Then
                        colorToUse = Color.OrangeRed
                    ElseIf TOSpecific < 60 Then
                        colorToUse = Color.Orange
                    ElseIf TOSpecific < 80 Then
                        colorToUse = Color.LightGreen
                    ElseIf TOSpecific <= 100 Then
                        colorToUse = Color.DarkGreen
                    End If

                    GunaDataGridViewDispoEtTarifs.Rows(rowTO - 1).Cells(k + 2).Value = Format(TOSpecific, "#,##0") & " %"
                    'GunaDataGridViewDispoEtTarifs.Rows(rowTO - 1).Cells(k + 2).Style.BackColor = colorToUse
                    GunaDataGridViewDispoEtTarifs.Rows(rowTO - 1).Cells(k + 2).Style.ForeColor = colorToUse
                    'GunaDataGridViewDispoEtTarifs.Rows(rowTO - 1).Cells(k + 2). = Color.White

                    GunaDataGridViewDispoEtTarifs.Columns(DateDebut.AddDays(k).ToString("ddd d MMM")).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

                    'AJOUT DES TARIFICATIONS

                    Dim s = 0

                    Dim PRIX_A_AFFICHER As Double = 0

                    'SI ON FAIT LE TRAITEMENT DES TARIF DYNAMIQUE ACTIVE

                    If tarif.Rows.Count > 0 Then

                        For m = 0 To tarif.Rows.Count - 1

                            If Not Trim(tarif.Rows(m)("LIBELLE_TARIF")).Equals("GRATUITEE") Then

                                'ON AFFICHE UN TYPE DE PRIX A SAVOIR LA TARIFICATION DYNAMQUE AU DETRIMANT DU MONTANT AFFICHE OU TARIF PUBLIC

                                Dim TAUX_OCCUPATION As Double = TOSpecific
                                Dim CODE_TYPE As String = typeChambre.Rows(i)("CODE_TYPE_CHAMBRE")
                                Dim CODE_TARIF As String = tarif.Rows(m)("CODE_TARIF")

                                PRIX_A_AFFICHER = prixDelaTarificationAAfficherParApportAuCritereDeTarificationDynamique(TAUX_OCCUPATION, CODE_TARIF, CODE_TYPE)

                                'AUCUNE TARIFICATION PERIODQUE DONC AFFICHAGE NORMAL
                                If tarif.Rows.Count = 1 Then
                                    'GunaDataGridViewDispo1.Rows(j + 4).Cells(k + 2).Value = Format(tarif.Rows(m)("PRIX_TARIF1"), "#,##0")
                                    GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif).Cells(k + 2).Value = Format(PRIX_A_AFFICHER, "#,##0")
                                    'GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif).Cells(k + 2).Style.BackColor = Color.LightBlue
                                    GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif).Cells(k + 2).Style.ForeColor = Color.Blue
                                Else

                                    If tarif.Rows.Count > 1 Then
                                        'GunaDataGridViewDispo1.Rows(j + 3 + m).Cells(k + 2).Value = Format(tarif.Rows(m)("PRIX_TARIF1"), "#,##0")
                                        GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif + m).Cells(k + 2).Value = Format(PRIX_A_AFFICHER, "#,##0")
                                        'GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif + m).Cells(k + 2).Style.BackColor = Color.LightBlue
                                        GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif + m).Cells(k + 2).Style.ForeColor = Color.Blue
                                    End If

                                End If

                                'CHANGE THE COLOR A ROW : PROMOTION

                                'GunaDataGridViewDispo1.Rows(rowDebutTarif + m).DefaultCellStyle.BackColor = Color.Green
                                'GunaDataGridViewDispo1.Rows(rowDebutTarif + m).DefaultCellStyle.ForeColor = Color.White

                            End If

                        Next

                    Else

                        'ON DETERMINE SI ON A UNE TARIFICATION SPECIFIQUE PERIODIQUE (EDITION DE MASSE) QUI DEVRA REMPLACER LE TARIF PUBLIC EN CETTE DATE LA 
                        'PAR APPORT A CE TYPE DE CHAMBRE ET LA DATE EN COURS DONC LA DATE QUE NOUS SOMMES ENTRAINE DE PARCOURIR
                        'ELLE DEVRA ETRE ACTIVE

                        Dim query04 As String = "SELECT * FROM `disponibilite_tarif_specifique_periodique` WHERE ETAT=@ETAT AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE"
                        Dim ETAT_EDITION_DE_MASSE As Integer = 1

                        Dim command04 As New MySqlCommand(query04, GlobalVariable.connect)
                        command04.Parameters.Add("@ETAT", MySqlDbType.Int64).Value = ETAT_EDITION_DE_MASSE
                        command04.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = typeChambre.Rows(i)("CODE_TYPE_CHAMBRE")

                        Dim adapter04 As New MySqlDataAdapter(command04)
                        Dim tarifSpecifiquePeriodique As New DataTable()
                        adapter04.Fill(tarifSpecifiquePeriodique)

                        If tarifSpecifiquePeriodique.Rows.Count > 0 Then

                            For p = 0 To tarifSpecifiquePeriodique.Rows.Count - 1

                                'SI LA DATE ACTUEL SE TROUVE DANS L'INTERVALE PERIODIQUE LE MONTANT A AFFICHER DOIT ETRE CELUI DE L'INTERVALE
                                'disponibilite_tarif_specifique_periodique

                                Dim DEBUT_PERIODE As Date = CDate(tarifSpecifiquePeriodique.Rows(p)("DEBUT_PERIODE")).ToShortDateString
                                Dim FIN_PERIODE As Date = CDate(tarifSpecifiquePeriodique.Rows(p)("FIN_PERIODE")).ToShortDateString

                                If DEBUT_PERIODE.ToString("yyyy-MM-dd") <= dateDuJour.ToString("yyyy-MM-dd") And FIN_PERIODE.ToString("yyyy-MM-dd") >= dateDuJour.ToString("yyyy-MM-dd") Then

                                    'GESTION D'UNE TARIFICATION
                                    GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif).Cells(k + 2).Value = Format(tarifSpecifiquePeriodique.Rows(p)("MONTANT"), "#,##0")
                                    'GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif).Cells(k + 2).Style.BackColor = Color.LightBlue
                                    GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif).Cells(k + 2).Style.ForeColor = Color.Blue

                                Else

                                    'PRIX_A_AFFICHER = typeChambre.Rows(i)("PRIX") ' OK

                                    '-------------------------------------------------- NEW 

                                    Dim ANCIENNE_EDITION As Integer = 0
                                    'DANS L'ETAT ACTUEL C'EST UNE DITION DE MASSE A LA FOIS
                                    'POUR POUVOIR APPLIQUER PLUSIEURS EDITION DE MASSE ON DOIT DETERMINER SI IL N'Y A AUCUNE EDITION DE MASSE
                                    'DONT LA DATE EST ANTERIEUR A CELLE QUE L'ON EST ENTRAIN DE TRAITER

                                    For j = 0 To p - 1

                                        DEBUT_PERIODE = CDate(tarifSpecifiquePeriodique.Rows(j)("DEBUT_PERIODE")).ToShortDateString
                                        FIN_PERIODE = CDate(tarifSpecifiquePeriodique.Rows(j)("FIN_PERIODE")).ToShortDateString

                                        If DEBUT_PERIODE.ToString("yyyy-MM-dd") <= dateDuJour.ToString("yyyy-MM-dd") And FIN_PERIODE.ToString("yyyy-MM-dd") >= dateDuJour.ToString("yyyy-MM-dd") Then

                                            PRIX_A_AFFICHER = tarifSpecifiquePeriodique.Rows(j)("MONTANT")

                                            ANCIENNE_EDITION = 1

                                        End If

                                    Next

                                    If ANCIENNE_EDITION = 0 Then
                                        PRIX_A_AFFICHER = typeChambre.Rows(i)("PRIX")
                                    End If
                                    '-------------------------------------------------- END NEW

                                    Dim m As Integer = 0

                                    GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif + m).Cells(k + 2).Value = Format(PRIX_A_AFFICHER, "#,##0")
                                    'GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif + m).Cells(k + 2).Style.BackColor = Color.LightBlue
                                    GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif + m).Cells(k + 2).Style.ForeColor = Color.Blue

                                End If

                            Next

                        Else

                            PRIX_A_AFFICHER = typeChambre.Rows(i)("PRIX")

                            Dim m As Integer = 0

                            GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif + m).Cells(k + 2).Value = Format(PRIX_A_AFFICHER, "#,##0")
                            'GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif + m).Cells(k + 2).Style.BackColor = Color.LightBlue
                            GunaDataGridViewDispoEtTarifs.Rows(rowDebutTarif + m).Cells(k + 2).Style.ForeColor = Color.Blue

                        End If

                    End If

                Next


                'GunaDataGridViewDispoEtTarifs.Rows(0).Cells(0).Style.SelectionForeColor = Color.White
                'GunaDataGridViewDispoEtTarifs.Rows(0).Cells(0).Style.ForeColor = Color.White

            Next


            If GlobalVariable.actualLanguageValue = 1 Then
                GunaDataGridViewDispoEtTarifs.Rows(0).Cells(0).Value = "Taux d'Occupation Global"

            Else
                GunaDataGridViewDispoEtTarifs.Rows(0).Cells(0).Value = "Global Occupation Rate"

            End If

            'GunaDataGridViewDispoEtTarifs.Rows(0).Cells(0).Style.BackColor = TOGlobalColor
            'GunaDataGridViewDispoEtTarifs.Rows(0).Cells(0).Style.SelectionBackColor = TOGlobalColor
            GunaDataGridViewDispoEtTarifs.Rows(0).Cells(0).Style.SelectionForeColor = Color.Black
            GunaDataGridViewDispoEtTarifs.Rows(0).Cells(0).Style.ForeColor = Color.Black

            For k = 0 To nombreDeJour - 1

                dateDuJour = DateDebut.AddDays(k).ToShortDateString

                TOGlobal = TauxOccupationGlobal(dateDuJour)

                Dim TOGlobalColor As Color

                If TOGlobal < 20 Then
                    TOGlobalColor = Color.Red
                ElseIf TOGlobal < 40 Then
                    TOGlobalColor = Color.OrangeRed
                ElseIf TOGlobal < 60 Then
                    TOGlobalColor = Color.Orange
                ElseIf TOGlobal < 80 Then
                    TOGlobalColor = Color.LightGreen
                ElseIf TOGlobal <= 100 Then
                    TOGlobalColor = Color.DarkGreen
                End If

                GunaDataGridViewDispoEtTarifs.Rows(0).Cells(k + 2).Value = Format(Math.Floor(TOGlobal), "#,##0") & " %"
                'GunaDataGridViewDispoEtTarifs.Rows(0).Cells(0k + 2).Style.BackColor = TOGlobalColor
                GunaDataGridViewDispoEtTarifs.Rows(0).Cells(k + 2).Style.ForeColor = TOGlobalColor

            Next

        End If

    End Sub

    Public Function prixDelaTarificationAAfficherParApportAuCritereDeTarificationDynamique(ByVal TAUX_OCCUPATION As Double, ByVal CODE_TARIF As String, ByVal CODE_TYPE As String) As Double

        'ON RECUPERE LE CODE DE LA TARIFICATION DYNAMQIUE ASSOCIE AU TARIF PRIX

        Dim tarif As DataTable = Functions.GetAllElementsOnTwoConditions(CODE_TARIF, "tarif_prix", "CODE_TARIF", CODE_TYPE, "CODE_TYPE")

        If tarif.Rows.Count > 0 Then

            Dim CODE_TARIF_DYNAMIQUE As String = tarif.Rows(0)("CODE_TARIF_DYNAMIQUE")

            Dim infoTarifDynamique As DataTable = Functions.getElementByCode(CODE_TARIF_DYNAMIQUE, "tarification_dynamique", "CODE_TARIF_DYNAMIQUE")

            If infoTarifDynamique.Rows.Count > 0 Then
                'ON DETERMINE QUEL PRIX DE 1 a 5 A AFFICHER PAR POUR LE CRITERE DU TAUX D'OCCUPATION EN E BASANT SUR LES INTERVALES
                If infoTarifDynamique.Rows(0)("CRITERE") = 0 Then
                    'SELON LE TAUX D'OCCUPATION

                    If 0 <= TAUX_OCCUPATION And TAUX_OCCUPATION <= infoTarifDynamique.Rows(0)("INTERVAL_1") Then
                        Return tarif.Rows(0)("PRIX_TARIF1")
                    ElseIf infoTarifDynamique.Rows(0)("INTERVAL_1") < TAUX_OCCUPATION And TAUX_OCCUPATION <= infoTarifDynamique.Rows(0)("INTERVAL_2") Then
                        Return tarif.Rows(0)("PRIX_TARIF2")
                    ElseIf infoTarifDynamique.Rows(0)("INTERVAL_2") < TAUX_OCCUPATION And TAUX_OCCUPATION <= infoTarifDynamique.Rows(0)("INTERVAL_3") Then
                        Return tarif.Rows(0)("PRIX_TARIF3")
                    ElseIf infoTarifDynamique.Rows(0)("INTERVAL_3") < TAUX_OCCUPATION And TAUX_OCCUPATION <= infoTarifDynamique.Rows(0)("INTERVAL_4") Then
                        Return tarif.Rows(0)("PRIX_TARIF4")
                    ElseIf infoTarifDynamique.Rows(0)("INTERVAL_4") < TAUX_OCCUPATION And TAUX_OCCUPATION <= infoTarifDynamique.Rows(0)("INTERVAL_5") Then
                        Return tarif.Rows(0)("PRIX_TARIF5")
                    Else
                        Return tarif.Rows(0)("PRIX_TARIF5")
                    End If

                ElseIf infoTarifDynamique.Rows(0)("CRITERE") = 1 Then
                    'SELON LE NOMBRE DE NUITEE
                End If

            Else

                Return 5000

            End If

        End If

    End Function

    Private Sub GunaAdvenceButton23_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton23.Click

        firstCell = True
        secondCell = True

        GunaDateTimePickerDispoDebut.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDispoFin.Value = GlobalVariable.DateDeTravail.AddDays(31)

        GunaPanelDisponibilite.Visible = True
        GunaPanelDisponibilite.BringToFront()

        DisponibiliteEtTarifs(GunaDateTimePickerDispoDebut.Value.ToShortDateString, GunaDateTimePickerDispoFin.Value.ToShortDateString)

    End Sub

    Private Sub GunaButtonQuitter_Click(sender As Object, e As EventArgs) Handles GunaButtonQuitter.Click

        LabelNatureReservation.Visible = False

        'Chaque fois qu'on sort de la fenêtre de reservation on vide le formulaire
        VidageDesChampsPourNouvelleReservation()

        LabelNatureReservation.Visible = False
        PanelTableauDeBords.Show()
        PanelTableauDeBords.BringToFront()

    End Sub

    'Fermer DashBoard
    Private Sub Quitter_Click(sender As Object, e As EventArgs) Handles Quitter.Click
        HomeForm.Show()
        Me.Close()
    End Sub

    Private Sub suivieDesReservationsVisibilte()

        GunaLabelResa.Visible = False
        GunaLabel155.Visible = False
        GunaLabel153.Visible = False
        GunaLabel156.Visible = False
        GunaLabel154.Visible = False
        GunaLabel157.Visible = False
        GunaLabel158.Visible = False
        GunaLabel159.Visible = False
        GunaLabel160.Visible = False
        GunaLabel161.Visible = False

    End Sub

    '------------------------------ GESTION DES IMPRESSION DES FACTURES ET REGLEMENT DU CLIENT -----------------------------------------------

    Dim TotalFacture As Double = 0

    Private Sub ImprimerToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ImprimerToolStripMenuItem.Click

        GlobalVariable.DocumentToGenerate = "facture"

        If GunaDataGridViewDesFactures.Rows.Count > 0 Then
            Functions.DocumentToPrint(GunaDataGridViewDesFactures.CurrentRow.Cells("CODE").Value.ToString, "lign_facture", "CODE_FACTURE", GlobalVariable.codeClientToUpdate, GunaLabelNumReservation.Text)
        End If

    End Sub

    Private Sub GunaButtonPrintFromDetailsClick(sender As Object, e As EventArgs) Handles GunaButtonPrintFactureDetails.Click

        GlobalVariable.DocumentToGenerate = "facture"

        If GunaDataGridViewDesFactures.Rows.Count > 0 Then
            Functions.DocumentToPrint(GunaDataGridViewDesFactures.CurrentRow.Cells("CODE").Value.ToString, "lign_facture", "CODE_FACTURE", GlobalVariable.codeClientToUpdate, GunaLabelNumReservation.Text)
        End If

    End Sub

    Private Sub ToolStripMenuItem2_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem2.Click

        GlobalVariable.DocumentToGenerate = "reglement"

        If GunaDataGridViewListeDesReglement.Rows.Count > 0 Then

            If Not Trim(GlobalVariable.codeReservationToUpdate) = "" Then
                'Functions.DocumentToPrint(GunaDataGridViewListeDesReglement.CurrentRow.Cells("CODE").Value.ToString, "reglement", "NUM_REGLEMENT", GlobalVariable.codeClientToUpdate, GunaLabelNumReservation.Text)

                Functions.DocumentToPrintDeuxExemplaiare(GunaDataGridViewListeDesReglement.CurrentRow.Cells("CODE").Value.ToString, "reglement", "NUM_REGLEMENT", GlobalVariable.codeClientToUpdate, GunaLabelNumReservation.Text)

            End If

        End If

    End Sub

    'RECHERCHER BOUTON - RESERVATION
    Private Sub GunaAdvenceButton22_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton22.Click

        If GunaRadioButtonSalleFete.Checked Then
            GlobalVariable.typeChambreOuSalle = "salle"
        Else
            GlobalVariable.typeChambreOuSalle = "chambre"
        End If

        TabControlHbergement.SelectedIndex = 1
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

    End Sub

    'ANNULATION DE RESERVATION
    Private Sub GunaButtonAnnulerReservation_Click(sender As Object, e As EventArgs) Handles GunaButtonAnnulerResa.Click

        '-------------------------------- OCCUPATION CHAMBRE ------------------------------

        Dim CODE_OCCUPATION_CHAMBRE = Functions.GeneratingRandomCodeWithSpecifications("occupation_chambre", "")
        Dim MONTANT_HT As Double = 0

        If Not Trim(GunaTextBoxMontantAccorde.Text) = "" Then
            MONTANT_HT = Double.Parse(GunaTextBoxMontantAccorde.Text)
        End If

        Dim TAXE As Double = 0
        Dim MONTANT_TTC As Double = 0
        Dim DATE_OCCUPATION As Date = GunaDateTimePickerArrivee.Value.ToShortDateString()
        'Dim OBSERVATIONS As String =""
        Dim COMMENTAIRE1 As String = ""
        Dim COMMENTAIRE2 As String = ""
        Dim COMMENTAIRE3 As String = ""
        Dim COMMENTAIRE4 As String = ""
        Dim DATE_LIBERATION As Date = GunaDateTimePickerDepart.Value.ToShortDateString()
        Dim CODE_UTILISATEUR_CREA As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
        Dim DATE_PREMIERE_ARRIVEE As Date = GlobalVariable.DateDeTravail
        Dim TYPE_RESERVATION As String = GlobalVariable.typeChambreOuSalle
        Dim PDJ_INCLUS As String = ""
        Dim TAXE_SEJOURS_INCLUS As String = ""
        Dim TVA_INCLUS As String = ""
        Dim CODE_CLIENT_REEL As String = GunaTextBoxRefClient.Text
        Dim OBSERVATIONS As String = ""
        Dim CODE_CHAMBRE = GunaTextBoxNumeroChambre.Text
        Dim CODE_AGENCE As String = GlobalVariable.AgenceActuelle.Rows(0)("CODE_AGENCE")
        Dim STATUT_RESERVATION As String = ""

        If GlobalVariable.actualLanguageValue = 1 Then
            STATUT_RESERVATION = "ANNULEE"
        Else
            STATUT_RESERVATION = "CANCELED"
        End If


        Dim Reservation As New Reservation
        Dim occupationChambre As New OccupationChambre()
        Dim CODE_RESERVATION As String = GlobalVariable.codeReservationToUpdate
        Dim dialog As DialogResult

        Dim dayDiff = CType((GlobalVariable.DateDeTravail - GunaDateTimePickerDepart.Value).TotalHours, Int32)

        If dayDiff >= 0 Then

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Bien vouloir vérifier la date de départ", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
            Else
                MessageBox.Show("Please check the departure date", "Reservation", MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If

        Else

            If GlobalVariable.actualLanguageValue = 1 Then
                dialog = MessageBox.Show("Voulez vous vraiment Annuler cette réservation ", "Annulation de réservation", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            Else
                dialog = MessageBox.Show("Do you really want to cancel this booking ", "Booking cancelation", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            End If

            If dialog = DialogResult.No Then

            Else

                Me.Cursor = Cursors.WaitCursor

                'MOTIF ANNULATION
                '----------------------------------------------
                Dim motifDelogement As String = ""

                If GlobalVariable.actualLanguageValue = 1 Then
                    motifDelogement = InputBox("ANNULATION ", "Motif de l'annulation", "")

                Else
                    motifDelogement = InputBox("CANCELATION ", "Reason for canceling", "")

                End If

                OBSERVATIONS = motifDelogement

                '------------------------------------------------
                Dim ETAT_RESERVATION As Integer

                'ANNULATION DE LA RESERVATION 
                Dim reservationToUpdateInReservation As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reservation", "CODE_RESERVATION")

                'SOIT DANS RESERVATION
                If reservationToUpdateInReservation.Rows.Count > 0 Then

                    'ANNULATION DE LA RESERVATION
                    ETAT_RESERVATION = 2 'RESERVATION ANNULEE
                    Reservation.AnnulationDeReservation(CODE_RESERVATION, "reservation", ETAT_RESERVATION, STATUT_RESERVATION)

                Else

                    'OU DANS RESERVATION
                    Dim reservationToUpdateInReserve_conf As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

                    If reservationToUpdateInReserve_conf.Rows.Count > 0 Then

                        ETAT_RESERVATION = 2
                        '2 = RESERVATION ANNULEE; 1 = RESERVATION ABOUTI ; 0 = RESERVATION ANNULEE NORMALEMENT VIA UN CHECK OUT A LA BONNE DATE DE DEPART
                        'Reservation.AnnulationDeReservation(CODE_RESERVATION, "reserve_conf", ETAT_RESERVATION)

                    End If

                End If

                Dim ETAT_NOTE_RESERVATION As String = "ANNULEE"
                If GlobalVariable.actualLanguageValue = 0 Then
                    ETAT_NOTE_RESERVATION = "CANCELED"
                End If
                If reservationToUpdateInReservation.Rows.Count > 0 Then

                    Dim ACTION_FAITE As String = GunaButtonAnnulerResa.Text
                    Dim FAITE_PAR As String = GlobalVariable.ConnectedUser.Rows(0)("NOM_UTILISATEUR")

                    Dim CLIENT_ID = reservationToUpdateInReservation.Rows(0)("CLIENT_ID")
                    Dim UTILISATEUR_ID = reservationToUpdateInReservation.Rows(0)("UTILISATEUR_ID")
                    Dim CHAMBRE_ID = reservationToUpdateInReservation.Rows(0)("CHAMBRE_ID")
                    Dim AGENCE_ID = reservationToUpdateInReservation.Rows(0)("AGENCE_ID")
                    Dim NOM_CLIENT = reservationToUpdateInReservation.Rows(0)("NOM_CLIENT")
                    Dim DATE_ENTTRE = reservationToUpdateInReservation.Rows(0)("DATE_ENTTRE")
                    Dim HEURE_ENTREE = reservationToUpdateInReservation.Rows(0)("HEURE_ENTREE")
                    Dim DATE_SORTIE = reservationToUpdateInReservation.Rows(0)("DATE_SORTIE")
                    Dim HEURE_SORTIE = reservationToUpdateInReservation.Rows(0)("HEURE_SORTIE")
                    Dim ADULTES = reservationToUpdateInReservation.Rows(0)("ADULTES")
                    Dim NB_PERSONNES = reservationToUpdateInReservation.Rows(0)("NB_PERSONNES")
                    Dim ENFANTS = reservationToUpdateInReservation.Rows(0)("ENFANTS")
                    Dim RECEVOIR_EMAIL = reservationToUpdateInReservation.Rows(0)("RECEVOIR_EMAIL")
                    Dim RECEVOIR_SMS = reservationToUpdateInReservation.Rows(0)("RECEVOIR_SMS")
                    Dim DATE_CREATION = reservationToUpdateInReservation.Rows(0)("DATE_CREATION")
                    Dim HEURE_CREATION = reservationToUpdateInReservation.Rows(0)("HEURE_CREATION")
                    Dim MONTANT_TOTAL_CAUTION = reservationToUpdateInReservation.Rows(0)("MONTANT_TOTAL_CAUTION")
                    Dim MOTIF_ETAT = reservationToUpdateInReservation.Rows(0)("MOTIF_ETAT")
                    Dim DATE_ETAT = reservationToUpdateInReservation.Rows(0)("DATE_ETAT")
                    Dim MONTANT_ACCORDE = reservationToUpdateInReservation.Rows(0)("MONTANT_ACCORDE")
                    Dim GROUPE = reservationToUpdateInReservation.Rows(0)("GROUPE")
                    Dim DEPOT_DE_GARANTIE = reservationToUpdateInReservation.Rows(0)("DEPOT_DE_GARANTIE")
                    Dim DAY_USE = reservationToUpdateInReservation.Rows(0)("DAY_USE")
                    Dim MENSUEL = reservationToUpdateInReservation.Rows(0)("MENSUEL")
                    Dim BC_ENTREPRISE = reservationToUpdateInReservation.Rows(0)("BC_ENTREPRISE")
                    Dim TYPE_CHAMBRE = reservationToUpdateInReservation.Rows(0)("TYPE_CHAMBRE")
                    Dim TYPE_CHAMBRE_OU_SALLE = reservationToUpdateInReservation.Rows(0)("TYPE")
                    Dim PETIT_DEJEUNER_ROUTAGE = reservationToUpdateInReservation.Rows(0)("PETIT_DEJEUNER_ROUTAGE")
                    Dim CHAMBRE_ROUTAGE = reservationToUpdateInReservation.Rows(0)("CHAMBRE_ROUTAGE")
                    Dim VENANT_DE = reservationToUpdateInReservation.Rows(0)("VENANT_DE")
                    Dim SE_RENDANT_A = reservationToUpdateInReservation.Rows(0)("SE_RENDANT_A")
                    Dim RAISON = reservationToUpdateInReservation.Rows(0)("RAISON")
                    Dim SOURCE_RESERVATION = reservationToUpdateInReservation.Rows(0)("SOURCE_RESERVATION")
                    Dim ROUTAGE = reservationToUpdateInReservation.Rows(0)("ROUTAGE")
                    Dim CODE_ENTREPRISE = reservationToUpdateInReservation.Rows(0)("CODE_ENTREPRISE")
                    Dim NOM_ENTREPRISE = reservationToUpdateInReservation.Rows(0)("NOM_ENTREPRISE")

                    Reservation.insertTrace(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, DEPOT_DE_GARANTIE, DAY_USE, MENSUEL, BC_ENTREPRISE, TYPE_CHAMBRE, ACTION_FAITE, FAITE_PAR, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE)


                End If

                '-------------------------------------- MOUCHARDS ---------------------------------------------------
                Dim ACTION As String = ""

                If GlobalVariable.actualLanguageValue = 1 Then
                    ACTION = "ANNULATION DE LA RESERVATION [CHAMBRE " & GunaTextBoxNumeroChambre.Text & " / " & GunaTextBoxNomPrenom.Text & "  MOTIF : " & OBSERVATIONS & "]"

                Else
                    ACTION = "BOOKING CANCELATION [ROOM " & GunaTextBoxNumeroChambre.Text & " / " & GunaTextBoxNomPrenom.Text & "  REASON : " & OBSERVATIONS & "]"

                End If

                User.mouchard(ACTION)
                '----------------------------------------------------------------------------------------------------

                User.updateSuiviDesReservations("ANNULER_PAR", GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR"), CODE_RESERVATION)

                'UPDATE THE ROOM
                Dim updateQuery1 As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code"

                Dim command1 As New MySqlCommand(updateQuery1, GlobalVariable.connect)

                command1.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                command1.Parameters.Add("@code", MySqlDbType.VarChar).Value = GlobalVariable.codeChambre
                command1.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"

                If (command1.ExecuteNonQuery() = 1) Then
                    'connect.closeConnection()
                End If

                'trace de l'annulation de reservation 
                Dim ETAT_CHAMBRE As Integer = 1

                If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                End If

                'ANNULATIIO DE RESERVATION MAINCOURANTE = 2
                'MISE A JOURS DE LA MAIN COURANTE JOURNALIERE DE LA CHAMBRE ANNULEE

                Dim updateQuery2 As String = "UPDATE `main_courante_journaliere` SET `ETAT_MAIN_COURANTE`=@ETAT_MAIN_COURANTE WHERE NUM_RESERVATION=@NUM_RESERVATION"

                Dim command2 As New MySqlCommand(updateQuery2, GlobalVariable.connect)

                command2.Parameters.Add("@ETAT_MAIN_COURANTE", MySqlDbType.Int32).Value = 2
                command2.Parameters.Add("@NUM_RESERVATION", MySqlDbType.VarChar).Value = CODE_RESERVATION

                If (command2.ExecuteNonQuery() = 1) Then
                    'connect.closeConnection()
                End If

                'MISE A JOURS DE LA MAIN COURANTE GENERALE DE LA CHAMBRE ANNULEE

                Dim updateQuery3 As String = "UPDATE `main_courante_generale` SET `ETAT_MAIN_COURANTE`=@ETAT_MAIN_COURANTE WHERE NUM_RESERVATION=@NUM_RESERVATION"

                Dim command3 As New MySqlCommand(updateQuery3, GlobalVariable.connect)

                command3.Parameters.Add("@ETAT_MAIN_COURANTE", MySqlDbType.Int32).Value = 2
                command3.Parameters.Add("@NUM_RESERVATION", MySqlDbType.VarChar).Value = CODE_RESERVATION

                If (command3.ExecuteNonQuery() = 1) Then
                    'connect.closeConnection()
                End If

                Reservation.updateEtatReservationNote(CODE_RESERVATION, "reservation", ETAT_NOTE_RESERVATION)

                'RSERVATION NORMALE

                'Clearing all the informations found in the the reseravtion field
                emtptyRegistrationFields()

                'We set all the global variables used for update to their original values
                Functions.EmtyGlobalVariablesContainingCodeToUpdate()

                'Renitialisation des dates en plus de la date de travail après avoir vidé les variables globales
                ReinitialisationDesDates()

                Functions.SiplifiedClearTextBox(Me)

                'On masque les tarifs associés au client si existe 
                GunaComboBoxCodeTarif.Visible = False
                GunaLabelCodeTarif.Visible = False

                'Desactivation du bouton de gestion de groupe
                GunaCheckBoxReservationDeGroupe.Checked = False

                ReservationList("all", "none")

                'Used to know which button to display among enregistrer, checkin, checkout, annuler
                reservationButtonToDisplay()

                GunaCheckBoxPetitDejeuenerInclus.Checked = False
                GunaCheckBoxTaxeSejour.Checked = False
                GunaTextBoxPetitDejeuner.Visible = False
                GunaTextBoxPetitDejeunerRoutage.Visible = False


                'Obtention des informations pour les statistiques
                Dim stat As New statistiques()

                stat.ObtenirDerniereStatistique()

                Dim codeDelaDerniereStatistique As String = stat.ObtenirDerniereStatistique()

                'DERNIER STATISTIQUE
                GlobalVariable.informationDesStatistiques = Functions.getElementByCode(codeDelaDerniereStatistique, "statistiques", "CODE_STATISTIQUE")

                GlobalVariable.entierAnnulation = -1

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Réservation annulée avec succès", "Annulation de Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)

                Else
                    MessageBox.Show("Booking successfully canceled", "Booking cancelation", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If

                GunaButtonCheckOut.Visible = False

                GlobalVariable.entierAnnulation = 0

                VidageDesChampsPourNouvelleReservation()

                Me.Cursor = Cursors.Default

            End If

        End If



    End Sub

    ' ----------------------------------------------- LIVE SEARCH NEW MODEL --------------------------------------------------

    Private Sub GunaTextBoxClient_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxClient.TextChanged

        If Trim(GunaTextBoxClient.Text) = "" Then
            GunaDataGridViewNameSearch.Visible = False
        Else
            Recherche.RechercherClient(GunaDataGridViewNameSearch, GunaTextBoxClient.Text, "NOM_PRENOM")
        End If

    End Sub

    Private Sub GunaTextBoxNumResa_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNumResa.TextChanged

        If Trim(GunaTextBoxNumResa.Text) = "" Then
            GunaDataGridViewNumRea.Visible = False
        Else
            Recherche.RechercherParText(GunaDataGridViewNumRea, GunaTextBoxNumResa.Text, "CODE_RESERVATION")
        End If

    End Sub

    Private Sub GunaTextBoxParEntreprise_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxParEntreprise.TextChanged

        If Trim(GunaTextBoxParEntreprise.Text) = "" Then
            GunaDataGridViewEntrepriseSearch.Visible = False
        Else
            Recherche.RechercherClient(GunaDataGridViewEntrepriseSearch, GunaTextBoxParEntreprise.Text, "NOM_PRENOM", "ENTREPRISE")
        End If

    End Sub

    Private Sub GunaTextBoxNumGroupe_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNumGroupe.TextChanged

        If Trim(GunaTextBoxNumGroupe.Text) = "" Then
            GunaDataGridViewGroupe.Visible = False
        Else
            Recherche.RechercherParText(GunaDataGridViewGroupe, GunaTextBoxNumGroupe.Text, "GROUPE")
        End If

    End Sub

    Private Sub GunaTextBoxTypeChambre_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxTypeChambre.TextChanged

        If Trim(GunaTextBoxTypeChambre.Text) = "" Then
            GunaDataGridViewTypeChambre.Visible = False
        Else
            Recherche.RechercherParText(GunaDataGridViewTypeChambre, GunaTextBoxTypeChambre.Text, "CHAMBRE_ID")
        End If

    End Sub

    Private Sub GunaTextBoxSourceResa_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxSourceResa.TextChanged

        If Trim(GunaTextBoxSourceResa.Text) = "" Then
            GunaDataGridViewSourceRea.Visible = False
        Else
            Recherche.RechercherParText(GunaDataGridViewSourceRea, GunaTextBoxSourceResa.Text, "SOURCE_RESERVATION")
        End If

    End Sub

    Private Sub GunaDateTimePickerParDateArrivee_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerParDateArrivee.ValueChanged
        'Recherche.RechercherParDateArrivee(GunaDataGridViewReservationList, GunaDateTimePickerParDateArrivee.Value, "DATE_ENTTRE")
    End Sub

    Private Sub GunaDateTimePickerParDateDepart_Validated(sender As Object, e As EventArgs) Handles GunaDateTimePickerParDateDepart.ValueChanged
        'Recherche.RechercherParDateDepart(GunaDataGridViewReservationList, GunaDateTimePickerParDateDepart.Value, "DATE_SORTIE")
    End Sub

    'RAFRICHISSEMENT DES LISTES DES TABS RESERVATION - ARRIVEES - EN CHAMBRES - DEPARTS
    Private Sub TabControlHbergement_Click(sender As Object, e As EventArgs) Handles TabControlHbergement.Click
        'Permet de supprimer tous filtre existant
        'ReservationList()
    End Sub

    'GESTION DES PANNES
    Private Sub FamilleDePannesToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles FamilleDePannesToolStripMenuItem.Click
        GlobalVariable.TypePanne = "famille"
        PannesForm.Show()
    End Sub

    Private Sub SousFamillesDePannesToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles SousFamillesDePannesToolStripMenuItem.Click
        GlobalVariable.TypePanne = "sous famille"
        PannesForm.Show()
    End Sub

    'DEMANDE D'INTERVENTION
    Private Sub ToolStripMenuItem123_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem123.Click
        DemandeInterventionForm.TopMost = True
        DemandeInterventionForm.Location = New System.Drawing.Point(10, 115)
        DemandeInterventionForm.Show()
    End Sub

    'BON D'INTERVENTION OU INTERVENTION
    Private Sub ToolStripMenuItem128_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem128.Click
        BonInterventionForm.TopMost = True
        BonInterventionForm.Location = New System.Drawing.Point(10, 115)
        BonInterventionForm.Show()
    End Sub

    'PANNEAU TECHNIQUE
    Private Sub TECHNIQUEToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles TECHNIQUEToolStripMenuItem.Click

        MainWindowTechnique.Show()

        Me.Visible = False

    End Sub

    'Rapport de la Reception 
    Private Sub GunaAdvenceButton28_Click(sender As Object, e As EventArgs) Handles GunaAdvenceRapports.Click

        GunaDateTimePickerAu.Value = GlobalVariable.DateDeTravail

        PanelRapports.BringToFront()
        PanelRapports.Show()

        'Raports de la réception
        TabControlRapport.SelectedIndex = 0

    End Sub

    'Affichage des elements de la liste destinees a la DST dans un datatgrid
    Private Sub GunaButtonAfficherDst_Click(sender As Object, e As EventArgs) Handles GunaButtonAfficherDst.Click

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        GunaDataGridViewRapportDST.DataSource = Nothing

        GunaDataGridViewRapportDST.Columns.Clear()

        If GlobalVariable.DocumentToGenerate = "rapport dst" Then
            ListeDesAttenduesRapportDST(GunaDateTimePickerDu.Value.ToString("yyyy-MM-dd"), GunaDateTimePickerAu.Value.ToString("yyyy-MM-dd"))
        ElseIf GlobalVariable.DocumentToGenerate = "reservations" Then
            ListeDesAttenduesRapportDST(GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString(), GunaComboBoxFiltres.SelectedIndex)
        ElseIf GlobalVariable.DocumentToGenerate = "evenements" Then
            ListeDesAttenduesRapportDST(GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "day use" Then
            ListeDesAttenduesRapportDST(GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "non day use" Then
            ListeDesAttenduesRapportDST(GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "source" Then
            ListeDesAttenduesRapportDST(GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "no show" Then
            listeDesNoShow(GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "ecart de prix" Then
            ecartsDePrix(GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "verification solde" Then
            verificationDesSoldes(GunaDateTimePickerDu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "bloc notes" Then
            listeDesblocNoteSurUnePeriode(GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString(), GunaComboBoxFiltres.SelectedIndex)
        End If

    End Sub

    Private Sub listeDesblocNoteSurUnePeriode(ByVal dateDebut As Date, ByVal dateFin As Date, ByVal filtre As Integer)

        Dim caisse As New Caisse()

        Dim CODE_CAISSIER_ACTUEL = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

        Dim blocNoteSurUnePeriode As DataTable

        Dim ETAT_NOTE As String = ""

        'ETAT_FACTURE = 0 : ESPECES, CHEQUE...
        'ETAT_FACTURE = 1 : EN CHAMBRE
        'ETAT_FACTURE = 2 : GRATUITEE
        'ETAT_FACTURE = 3 : VERS COMPTE

        If filtre = 0 Then
            blocNoteSurUnePeriode = caisse.blocNOteSurUnePeriodeFiltre(dateDebut, dateFin, filtre)
        ElseIf filtre = 1 Then
            blocNoteSurUnePeriode = caisse.blocNOteSurUnePeriodeFiltre(dateDebut, dateFin, filtre)
        ElseIf filtre = 2 Then
            blocNoteSurUnePeriode = caisse.blocNOteSurUnePeriodeFiltre(dateDebut, dateFin, filtre)
        ElseIf filtre = 3 Then
            blocNoteSurUnePeriode = caisse.blocNOteSurUnePeriodeFiltre(dateDebut, dateFin, filtre)
        ElseIf filtre = 4 Then
            blocNoteSurUnePeriode = caisse.blocNOteSurUnePeriode(dateDebut, dateFin)
        ElseIf filtre = 5 Then
            blocNoteSurUnePeriode = caisse.venteEnSalleSurUnePeriode(dateDebut, dateFin)
        End If

        If blocNoteSurUnePeriode.Rows.Count > 0 Then

            Dim STATUT As String = ""

            Dim montantTotalDesBlocNotes As Double = 0

            GunaDataGridViewRapportDST.Columns.Clear()

            If GlobalVariable.actualLanguageValue = 0 Then

                GunaDataGridViewRapportDST.Columns.Add("RECEIPT NUMBER", "RECEIPT NUMBER")
                GunaDataGridViewRapportDST.Columns.Add("SALE AMOUNT", "SALE AMOUNT")
                GunaDataGridViewRapportDST.Columns.Add("STATUS", "STATUS")
                GunaDataGridViewRapportDST.Columns.Add("CASHIER", "CASHIER")

            Else

                GunaDataGridViewRapportDST.Columns.Add("NUMERO BLOC NOTE", "NUMERO BLOC NOTE")
                GunaDataGridViewRapportDST.Columns.Add("MONTANT VENDU", "MONTANT VENDU")
                GunaDataGridViewRapportDST.Columns.Add("STATUT", "STATUT")
                GunaDataGridViewRapportDST.Columns.Add("CAISSIER", "CAISSIER")

            End If

            For i = 0 To blocNoteSurUnePeriode.Rows.Count - 1

                If GlobalVariable.actualLanguageValue = 0 Then

                    ETAT_NOTE = Functions.etatNoteBlocNote(blocNoteSurUnePeriode.Rows(i)("STATE"))

                    Dim infoSup As DataTable = Functions.getElementByCode(blocNoteSurUnePeriode.Rows(i)("RECEIPT NUMBER"), "ligne_facture_bloc_note", "NUMERO_BLOC_NOTE")

                    Dim CODE_CAISSIER As String = ""

                    If infoSup.Rows.Count > 0 Then

                        CODE_CAISSIER = infoSup.Rows(0)("CODE_CAISSIER")

                        infoSup = Functions.getElementByCode(CODE_CAISSIER, "utilisateurs", "CODE_UTILISATEUR")

                        If infoSup.Rows.Count > 0 Then
                            CODE_CAISSIER = infoSup.Rows(0)("NOM_UTILISATEUR")
                        End If

                    End If

                    GunaDataGridViewRapportDST.Rows.Add(blocNoteSurUnePeriode.Rows(i)("RECEIPT NUMBER"), Format(blocNoteSurUnePeriode.Rows(i)("AMOUNT"), "#,##0"), ETAT_NOTE, CODE_CAISSIER)

                    montantTotalDesBlocNotes += blocNoteSurUnePeriode.Rows(i)("AMOUNT")
                ElseIf GlobalVariable.actualLanguageValue = 1 Then

                    ETAT_NOTE = Functions.etatNoteBlocNote(blocNoteSurUnePeriode.Rows(i)("ETAT"))

                    Dim infoSup As DataTable = Functions.getElementByCode(blocNoteSurUnePeriode.Rows(i)("NUMERO BLOC NOTE"), "ligne_facture_bloc_note", "NUMERO_BLOC_NOTE")

                    Dim CODE_CAISSIER As String = ""

                    If infoSup.Rows.Count > 0 Then

                        CODE_CAISSIER = infoSup.Rows(0)("CODE_CAISSIER")

                        infoSup = Functions.getElementByCode(CODE_CAISSIER, "utilisateurs", "CODE_UTILISATEUR")

                        If infoSup.Rows.Count > 0 Then
                            CODE_CAISSIER = infoSup.Rows(0)("NOM_UTILISATEUR")
                        End If

                    End If

                    GunaDataGridViewRapportDST.Rows.Add(blocNoteSurUnePeriode.Rows(i)("NUMERO BLOC NOTE"), Format(blocNoteSurUnePeriode.Rows(i)("MONTANT"), "#,##0"), ETAT_NOTE, CODE_CAISSIER)

                    montantTotalDesBlocNotes += blocNoteSurUnePeriode.Rows(i)("MONTANT")
                End If

            Next

            GunaButtonImpressionPourDST.Visible = True

        Else
            GunaDataGridViewRapportDST.Columns.Clear()
        End If

    End Sub

    Private Sub ecartsDePrix(ByVal DateDebut As Date, ByVal DateFin As Date)

        If DateDebut <= DateFin Then

            Dim query As String = "SELECT NUM_RESERVATION, main_courante_journaliere.NOM_CLIENT As 'NOM CLIENT', reserve_conf.TYPE_CHAMBRE, CHAMBRE_ID AS 'CHAMBRE', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', main_courante_journaliere.MONTANT_ACCORDE AS 'PRIX/NUITEE', source_reservation.SOURCE_RESERVATION AS SOURCE FROM reserve_conf, source_reservation, main_courante_journaliere WHERE main_courante_journaliere.NUM_RESERVATION = reserve_conf.CODE_RESERVATION AND DATE_MAIN_COURANTE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_MAIN_COURANTE <='" & DateDebut.ToString("yyyy-MM-dd") & "' AND reserve_conf.SOURCE_RESERVATION = source_reservation.CODE_SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            'command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            GunaDataGridViewRapportDST.Columns.Clear()

            If (table.Rows.Count > 0) Then

                GunaDataGridViewRapportDST.Columns.Add("CHAMBRE", "CHAMBRE")
                GunaDataGridViewRapportDST.Columns.Add("TYPE", "TYPE")
                GunaDataGridViewRapportDST.Columns.Add("NOM CLIENT", "NOM CLIENT")
                GunaDataGridViewRapportDST.Columns.Add("DATE ENTREE", "DATE ENTREE")
                GunaDataGridViewRapportDST.Columns.Add("DATE SORTIE", "DATE SORTIE")
                GunaDataGridViewRapportDST.Columns.Add("NUITEES", "NUITEES")
                GunaDataGridViewRapportDST.Columns.Add("TARIF DE BASE", "TARIF DE BASE")
                GunaDataGridViewRapportDST.Columns.Add("MONTANT ACCORDE", "MONTANT ACCORDE")
                GunaDataGridViewRapportDST.Columns.Add("ECART", "ECART")
                GunaDataGridViewRapportDST.Columns.Add("POURCENTAGE", "POURCENTAGE")
                GunaDataGridViewRapportDST.Columns.Add("SOURCE", "SOURCE")

                GunaButtonImpressionPourDST.Visible = True

                'GunaDataGridViewRapportDST.DataSource = table

                Dim NUITEES As Integer = 0
                Dim ECART As Double = 0
                Dim POURCENTAGE As Integer = 0
                Dim TARIF_DE_BASE As Double = 0
                Dim TYPE_CHAMBRE As String = ""
                Dim infoSupChambre As DataTable

                Dim MONTANT_TAXE_DE_SEJOUR As Double = 0

                Dim taxe_sejour As DataTable

                Dim NUM_RESERVATION As String = ""

                For i = 0 To table.Rows.Count - 1

                    NUM_RESERVATION = table.Rows(i)("NUM_RESERVATION")
                    taxe_sejour = Functions.getElementByCode(NUM_RESERVATION, "taxe_sejour_collectee", "NUM_RESERVATION")

                    If taxe_sejour.Rows.Count > 0 Then
                        MONTANT_TAXE_DE_SEJOUR = taxe_sejour.Rows(0)("TAXE_SEJOUR_COLLECTEE")
                    End If

                    infoSupChambre = Functions.getElementByCode(table(i)("TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                    TYPE_CHAMBRE = table(i)("TYPE_CHAMBRE")

                    If infoSupChambre.Rows.Count > 0 Then
                        TARIF_DE_BASE = infoSupChambre.Rows(0)("PRIX") + MONTANT_TAXE_DE_SEJOUR
                    End If

                    Dim DEBUT As Date = CDate(table(i)("DATE ENTREE")).ToShortDateString
                    Dim FIN As Date = CDate(table(i)("DATE SORTIE")).ToShortDateString

                    ECART = TARIF_DE_BASE - table(i)("PRIX/NUITEE")

                    If TARIF_DE_BASE > 0 Then
                        POURCENTAGE = (ECART / TARIF_DE_BASE) * 100
                    End If

                    NUITEES = CType((FIN - DEBUT).TotalDays, Int64)

                    GunaDataGridViewRapportDST.Rows.Add(table(i)("CHAMBRE"), TYPE_CHAMBRE, table(i)("NOM CLIENT"), CDate(table(i)("DATE ENTREE")).ToShortDateString, CDate(table(i)("DATE SORTIE")).ToShortDateString, NUITEES, TARIF_DE_BASE, table(i)("PRIX/NUITEE"), ECART, POURCENTAGE & " % ", table(i)("SOURCE"))

                Next

                GunaDataGridViewRapportDST.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                GunaDataGridViewRapportDST.DefaultCellStyle.SelectionForeColor = Color.White
                GunaDataGridViewRapportDST.Columns("MONTANT ACCORDE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewRapportDST.Columns("MONTANT ACCORDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

                GunaDataGridViewRapportDST.Columns("ECART").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewRapportDST.Columns("ECART").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

                GunaDataGridViewRapportDST.Columns("TARIF DE BASE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewRapportDST.Columns("TARIF DE BASE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

                GunaDataGridViewRapportDST.Columns("POURCENTAGE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewRapportDST.Columns("POURCENTAGE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
                'GunaDataGridViewRapportDST.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

            Else

                GunaButtonImpressionPourDST.Visible = False
                GunaDataGridViewRapportDST.Columns.Clear()

            End If

            'connect.closeConnection()

        Else

        End If

    End Sub

    Private Sub listeDesNoShow(ByVal DateDebut As Date, ByVal DateFin As Date)

        If DateDebut <= DateFin Then

            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', TYPE_CHAMBRE , CHAMBRE_ID AS 'CHAMBRE', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', NB_PERSONNES As 'PERSONNE(S)', source_reservation.SOURCE_RESERVATION AS SOURCE FROM reserve_temp, source_reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND reserve_temp.SOURCE_RESERVATION = source_reservation.CODE_SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            'command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            GunaDataGridViewRapportDST.Columns.Clear()

            If (table.Rows.Count > 0) Then

                GunaButtonImpressionPourDST.Visible = True

                GunaDataGridViewRapportDST.Columns.Add("NOM CLIENT", "NOM CLIENT")
                GunaDataGridViewRapportDST.Columns.Add("CHAMBRE", "CHAMBRE")
                GunaDataGridViewRapportDST.Columns.Add("TYPE", "TYPE")
                GunaDataGridViewRapportDST.Columns.Add("DATE ENTREE", "DATE ENTREE")
                GunaDataGridViewRapportDST.Columns.Add("DATE SORTIE", "DATE SORTIE")
                GunaDataGridViewRapportDST.Columns.Add("PAX", "PAX")
                GunaDataGridViewRapportDST.Columns.Add("PRIX/NUITEE", "PRIX/NUITEE")
                GunaDataGridViewRapportDST.Columns.Add("STATUT", "STATUT")
                GunaDataGridViewRapportDST.Columns.Add("SOURCE", "SOOURCE")


                For i = 0 To table.Rows.Count - 1
                    GunaDataGridViewRapportDST.Rows.Add(table.Rows(i)("NOM CLIENT"), table.Rows(i)("CHAMBRE"), table.Rows(i)("TYPE_CHAMBRE"), CDate(table.Rows(i)("DATE ENTREE")).ToShortDateString, CDate(table.Rows(i)("DATE SORTIE")).ToShortDateString, table.Rows(i)("PERSONNE(S)"), table.Rows(i)("PRIX/NUITEE"), "NO SHOW", table.Rows(i)("SOURCE"))
                Next

                '----------------------- ANNULATION ---------------------------------------------------
                Dim query01 As String = "SELECT NOM_CLIENT As 'NOM CLIENT', TYPE_CHAMBRE , CHAMBRE_ID AS 'CHAMBRE', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE, NB_PERSONNES As 'PERSONNE(S)', source_reservation.SOURCE_RESERVATION AS SOURCE FROM reservation, source_reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND reservation.SOURCE_RESERVATION = source_reservation.CODE_SOURCE_RESERVATION AND ETAT_RESERVATION=@ETAT_RESERVATION ORDER BY CHAMBRE_ID ASC"

                Dim command01 As New MySqlCommand(query01, GlobalVariable.connect)
                command01.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 2

                Dim adapter01 As New MySqlDataAdapter(command01)
                Dim table01 As New DataTable()
                adapter01.Fill(table01)

                If table01.Rows.Count > 0 Then
                    For j = 0 To table01.Rows.Count - 1
                        GunaDataGridViewRapportDST.Rows.Add(table01.Rows(j)("NOM CLIENT"), table01.Rows(j)("CHAMBRE"), table01.Rows(j)("TYPE_CHAMBRE"), CDate(table01.Rows(j)("DATE ENTREE")).ToShortDateString, CDate(table01.Rows(j)("DATE SORTIE")).ToShortDateString, table01.Rows(j)("PERSONNE(S)"), table01.Rows(j)("MONTANT_ACCORDE"), "ANNULATION", table01.Rows(j)("SOURCE"))
                    Next
                End If

                GunaDataGridViewRapportDST.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                GunaDataGridViewRapportDST.DefaultCellStyle.SelectionForeColor = Color.White
                GunaDataGridViewRapportDST.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewRapportDST.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
                'GunaDataGridViewRapportDST.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                'GunaDataGridViewRapportDST.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                'GunaDataGridViewRapportDST.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

                'GunaDataGridViewRapportDST.Columns("RESERVATION").Visible = False

            Else

                GunaDataGridViewRapportDST.Columns.Add("NOM CLIENT", "NOM CLIENT")
                GunaDataGridViewRapportDST.Columns.Add("CHAMBRE", "CHAMBRE")
                GunaDataGridViewRapportDST.Columns.Add("TYPE", "TYPE")
                GunaDataGridViewRapportDST.Columns.Add("DATE ENTREE", "DATE ENTREE")
                GunaDataGridViewRapportDST.Columns.Add("DATE SORTIE", "DATE SORTIE")
                GunaDataGridViewRapportDST.Columns.Add("PAX", "PAX")
                GunaDataGridViewRapportDST.Columns.Add("PRIX/NUITEE", "PRIX/NUITEE")
                GunaDataGridViewRapportDST.Columns.Add("STATUT", "STATUT")
                GunaDataGridViewRapportDST.Columns.Add("SOURCE", "SOOURCE")

                '----------------------- ANNULATION ---------------------------------------------------
                Dim query01 As String = "SELECT NOM_CLIENT As 'NOM CLIENT', TYPE_CHAMBRE , CHAMBRE_ID AS 'CHAMBRE', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE, NB_PERSONNES As 'PERSONNE(S)', source_reservation.SOURCE_RESERVATION AS SOURCE FROM reservation, source_reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND reservation.SOURCE_RESERVATION = source_reservation.CODE_SOURCE_RESERVATION AND ETAT_RESERVATION=@ETAT_RESERVATION ORDER BY CHAMBRE_ID ASC"

                Dim command01 As New MySqlCommand(query01, GlobalVariable.connect)
                command01.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 2

                Dim adapter01 As New MySqlDataAdapter(command01)
                Dim table01 As New DataTable()
                adapter01.Fill(table01)

                If table01.Rows.Count > 0 Then

                    For j = 0 To table01.Rows.Count - 1
                        GunaDataGridViewRapportDST.Rows.Add(table01.Rows(j)("NOM CLIENT"), table01.Rows(j)("CHAMBRE"), table01.Rows(j)("TYPE_CHAMBRE"), CDate(table01.Rows(j)("DATE ENTREE")).ToShortDateString, CDate(table01.Rows(j)("DATE SORTIE")).ToShortDateString, table01.Rows(j)("PERSONNE(S)"), table01.Rows(j)("MONTANT_ACCORDE"), "ANNULATION", table01.Rows(j)("SOURCE"))
                    Next

                    GunaDataGridViewRapportDST.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                    GunaDataGridViewRapportDST.DefaultCellStyle.SelectionForeColor = Color.White
                    GunaDataGridViewRapportDST.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                    GunaDataGridViewRapportDST.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

                Else


                    GunaButtonImpressionPourDST.Visible = False
                    GunaDataGridViewRapportDST.Columns.Clear()

                End If

            End If

        Else

        End If

    End Sub

    'Impression de la liste pour la DST
    Private Sub GunaButton3_Click(sender As Object, e As EventArgs) Handles GunaButtonImpressionPourDST.Click

        If GlobalVariable.DocumentToGenerate = "reservations" Then
            Impression.DocumentToPrintDSTResa(GunaDataGridViewRapportDST, GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString(), GunaComboBoxFiltres.SelectedIndex)
        ElseIf GlobalVariable.DocumentToGenerate = "rapport dst" Then
            GlobalVariable.DocumentToGenerate = "DST"
            Functions.DocumentToPrintDST(GunaDataGridViewRapportDST, GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "source" Or GlobalVariable.DocumentToGenerate = "type" Then

            If GunaCheckBoxToutesLesSource.Checked Then
                Impression.resaParSourceOuType(GlobalVariable.DocumentToGenerate, GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
            Else

                Dim CODE_SOURCE_RESERVATION As String = ""

                If GunaComboBoxSourceResaRapport.SelectedIndex > 0 Then
                    CODE_SOURCE_RESERVATION = GunaComboBoxSourceResaRapport.SelectedValue.ToString
                End If

                Impression.resaParSourceOuTypeSpecifique(GlobalVariable.DocumentToGenerate, GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString(), CODE_SOURCE_RESERVATION)

            End If

        ElseIf GlobalVariable.DocumentToGenerate = "evenements" Then
            Functions.DocumentToPrintDST(GunaDataGridViewRapportDST, GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "day use" Then
            Functions.listeDesDayuSe(GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "non day use" Then
            Functions.listeDesDayuSe(GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "no show" Then
            Impression.listeDesNoShow(GunaDataGridViewRapportDST, "NO SHOW", GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "verification solde" Then
            Impression.verificationDesSoldes(GunaDataGridViewRapportDST, GunaDateTimePickerDu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "ecart de prix" Then
            Impression.ecartDesPrix(GunaDataGridViewRapportDST, GunaDateTimePickerDu.Value.ToShortDateString())
        ElseIf GlobalVariable.DocumentToGenerate = "bloc notes" Then
            Impression.DocumentToPrintDSTBlocNOte(GunaDataGridViewRapportDST, GunaDateTimePickerDu.Value.ToShortDateString(), GunaDateTimePickerAu.Value.ToShortDateString(), GunaComboBoxFiltres.SelectedIndex)
        End If

    End Sub

    'PANNEAU DE RESERVATION 
    Public Sub tarifToDisplay(ByVal CODE_ENTREPRISE As String, ByVal CODE_TYPE_CEHAMBRE As String)

        Dim prixParNuitee As Double = 0

        If (Not CODE_ENTREPRISE = "") And (Not CODE_TYPE_CEHAMBRE = "") Then

            Dim tarif As New Tarifs

            'ON SELECTIONNE L'ENSEMBLE DES TARIFS
            Dim ListOftarif As DataTable = tarif.SelectDistinctTarif()

            GunaComboBoxCodeTarif.DataSource = ListOftarif
            GunaComboBoxCodeTarif.ValueMember = "CODE_TARIF"
            GunaComboBoxCodeTarif.DisplayMember = "LIBELLE_TARIF"

            Dim TarifDuclientActuel As DataTable

            'L'entreprise existe et est associée a un tarif
            Dim FillingListquery As String = "SELECT PRIX_TARIF1,LIBELLE_TARIF, PRIX_TARIF_ENCOURS, CODE_CLIENT,CODE_TARIF FROM tarif_client INNER JOIN tarif_prix WHERE tarif_client.ID_TARIF_PRIX = tarif_prix.ID_TARIF AND CODE_CLIENT=@CODE_CLIENT AND CODE_TYPE=@CODE_TYPE"


            Dim command As New MySqlCommand(FillingListquery, GlobalVariable.connect)
            command.Parameters.Add("@CODE_CLIENT", MySqlDbType.VarChar).Value = Trim(CODE_ENTREPRISE)
            command.Parameters.Add("@CODE_TYPE", MySqlDbType.VarChar).Value = Trim(CODE_TYPE_CEHAMBRE)

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()

            adapter.Fill(table)

            TarifDuclientActuel = table

            Dim prixDuTarif As Double = 0

            If TarifDuclientActuel.Rows.Count > 0 Then

                If TarifDuclientActuel.Rows(0)("PRIX_TARIF_ENCOURS") = 0 Then

                    prixDuTarif = TarifDuclientActuel.Rows(0)("TARIF_PRIX1")

                Else

                    prixDuTarif = TarifDuclientActuel.Rows(0)("PRIX_TARIF_ENCOURS")

                End If

            End If

            If TarifDuclientActuel.Rows.Count > 0 Then

                If GunaRadioButtonChambre.Checked Then

                    GunaTextBoxMontantAccorde.Text = Format(prixDuTarif, "#,##0")
                    prixParNuitee = GunaTextBoxMontantAccorde.Text

                    GunaComboBoxCodeTarif.Visible = True
                    GunaLabelCodeTarif.Visible = True

                    'LE TARIF GRATUIT NE DOIT APPARAITRE QUE SI LE BOUTON DE GRATUITE EST COCHE
                    If TarifDuclientActuel.Rows(0)("CODE_TARIF") = "GRATUITEE" Or TarifDuclientActuel.Rows(0)("CODE_TARIF") = "FREE" Then
                        If GunaCheckBoxGratuitee.Checked Then
                            GunaComboBoxCodeTarif.SelectedValue = TarifDuclientActuel.Rows(0)("CODE_TARIF")
                        Else
                            GunaComboBoxCodeTarif.DataSource = Nothing
                            GunaComboBoxCodeTarif.Visible = False
                            GunaLabelCodeTarif.Visible = False
                        End If
                    Else
                        GunaComboBoxCodeTarif.SelectedValue = TarifDuclientActuel.Rows(0)("CODE_TARIF")
                    End If

                    'GunaComboBoxCodeTarif.SelectedValue = TarifDuclientActuel.Rows(0)("CODE_TARIF")
                End If

                If GunaRadioButtonSalleFete.Checked Then
                    GunaTextBoxMontantReelSalle.Text = Format(prixDuTarif, "#,##0")
                    GunaComboBoxCodeTarif.Visible = False
                    GunaLabelCodeTarif.Visible = False
                End If

            Else


            End If

        End If

    End Sub

    Private Sub GunaTextBoxEntrepriseDuclient_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxEntrepriseDuclient.TextChanged

        If Trim(GunaTextBoxEntrepriseDuclient.Text) = "" Then

            GunaTextBoxCompteDebiteur.Visible = False
            GunaTextBoxBC.Visible = False
            GunaDataGridViewEntrepriseDuClient.Visible = False
            GunaTextBoxCodeEntrepriseDuClient.Clear()

            'SI ON EFFACE L'ENTREPRISE ASSOCIE A L'INVIDU ON  DOIT RECHERCHER LE COMPTE DE L'INDIVIDU POUR L'AFFICHER SI ACTIVER
            If Not Trim(GunaTextBoxRefClient.Text).Equals("") Then
                gestionDesComptesDebiteurLorsDesReservationsIndividu(Trim(GunaTextBoxRefClient.Text))
            End If

        Else

            'GunaTextBoxCompteDebiteur.Visible = True
            'GunaTextBoxBC.Visible = True

            GunaDataGridViewEntrepriseDuClient.Visible = True

            Dim TYPE_CLIENT = "ENTREPRISE"
            Dim TYPE_CLIENT_ = "COMPANY"

            Dim query As String = "SELECT NOM_CLIENT From client, compte 
                WHERE NOM_CLIENT Like '%" & GunaTextBoxEntrepriseDuclient.Text & "%' 
                AND TYPE_CLIENT=@TYPE_CLIENT AND client.CODE_CLIENT = compte.CODE_CLIENT AND ETAT_DU_COMPTE=@ETAT_DU_COMPTE AND ETAT_DU_COMPTE=@ETAT_DU_COMPTE
                OR
                NOM_CLIENT Like '%" & GunaTextBoxEntrepriseDuclient.Text & "%' AND TYPE_CLIENT=@TYPE_CLIENT_ AND client.CODE_CLIENT = compte.CODE_CLIENT 
                AND ETAT_DU_COMPTE=@ETAT_DU_COMPTE"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence
            command.Parameters.Add("@TYPE_CLIENT", MySqlDbType.VarChar).Value = TYPE_CLIENT
            command.Parameters.Add("@TYPE_CLIENT_", MySqlDbType.VarChar).Value = TYPE_CLIENT_
            command.Parameters.Add("@ETAT_DU_COMPTE", MySqlDbType.Int64).Value = 1

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()

            adapter.Fill(table)

            If table.Rows.Count > 0 Then
                GunaDataGridViewEntrepriseDuClient.DataSource = table
            Else
                GunaDataGridViewEntrepriseDuClient.Columns.Clear()
                GunaDataGridViewEntrepriseDuClient.Visible = False
            End If

            GunaTextBox11.Text = GunaTextBoxEntrepriseDuclient.Text

            If Trim(GunaTextBoxEntrepriseDuclient.Text).Equals("") Then

                GunaTextBoxCodeEntrepriseDuClient.Clear()
                GunaLabelCodeTarif.Visible = False
                GunaComboBoxCodeTarif.Visible = False
                GunaDataGridViewEntrepriseDuClient.Visible = False

            End If

        End If

    End Sub

    Private Sub GunaDataGridViewEntrepriseDuClient_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewEntrepriseDuClient.CellClick

        GunaDataGridViewEntrepriseDuClient.Visible = False

        If e.RowIndex >= 0 Then

            If Trim(GunaTextBoxEntrepriseDuclient.Text) = "" Then
                GunaTextBoxCompteDebiteur.Visible = False
                GunaTextBoxBC.Visible = False
            Else
                GunaTextBoxCompteDebiteur.Visible = True
                GunaTextBoxBC.Visible = True
            End If

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewEntrepriseDuClient.Rows(e.RowIndex)

            Dim company As DataTable = Functions.getElementByCode(Trim(row.Cells("NOM_CLIENT").Value.ToString), "client", "NOM_CLIENT")

            If company.Rows.Count > 0 Then

                GunaTextBoxEntrepriseDuclient.Text = Trim(company.Rows(0)("NOM_CLIENT"))
                GunaTextBoxCodeEntrepriseDuClient.Text = Trim(company.Rows(0)("CODE_CLIENT"))

                GunaDataGridViewEntrepriseDuClient.Visible = False

                Dim CODE_ENTREPRISE As String = Trim(GunaTextBoxCodeEntrepriseDuClient.Text)
                Dim CODE_TYPE_CEHAMBRE As String = Trim(GunaTextBoxCodeTypeDeChambre.Text)

                'On recherche si l'entreprise associé au client a une tarification
                tarifToDisplay(CODE_ENTREPRISE, CODE_TYPE_CEHAMBRE)

                gestionDesComptesDebiteurLorsDesReservations(CODE_ENTREPRISE)

                If Trim(company.Rows(0)("CODE_ELITE")).Equals("") Then
                    'GunaLabel7.Visible = False
                    'GunaTextBoxCodeElite.Visible = False
                    'GunaTextBoxCodeElite.Text = ""
                Else
                    GunaLabelElite.Visible = True
                    GunaTextBoxCodeElite.Visible = True
                    GunaTextBoxCodeElite.Text = company.Rows(0)("CODE_ELITE")
                End If

            End If

            'connect.closeConnection()


        End If

    End Sub

    Public Sub gestionDesComptesDebiteurLorsDesReservationsIndividu(ByVal CODE_ENTREPRISE As String) 'GESTION DU PLAFONDS DU COMPTE

        '---------------------- GESTION DES COMPTES DEBITEUR ENTREPRISE ASSOCIE A LA RESERVATION ----------------

        'SELECTION DU COMPTE DE L'ENTREPRISE ACTUEL
        Dim compte As DataTable = Functions.getElementByCode(CODE_ENTREPRISE, "compte", "CODE_CLIENT")

        If compte.Rows.Count > 0 Then

            'MessageBox.Show(compte.Rows(0)("NUMERO_COMPTE"))

            If Not Trim(compte.Rows(0)("CODE_CLIENT")).Equals("") Then

                If compte.Rows(0)("ETAT_DU_COMPTE") = 1 Then
                    'COMPTE ACTIF

                    GunaTextBoxCompteDebiteur.Visible = True
                    GunaTextBoxBC.Visible = False

                    Dim ETAT_DU_COMPTE As Double = 0

                    If Double.Parse(compte.Rows(0)("SOLDE_COMPTE")) < 0 Then
                        ETAT_DU_COMPTE = Double.Parse(compte.Rows(0)("PLAFONDS_DU_COMPTE")) - Math.Abs(Double.Parse(compte.Rows(0)("SOLDE_COMPTE")))
                    End If

                    If ETAT_DU_COMPTE >= 0 Then
                        'AU DESSUS  
                        GunaTextBoxCompteDebiteur.BaseColor = Color.Green
                    Else
                        'EN DESSOUS
                        GunaTextBoxCompteDebiteur.BaseColor = Color.Red
                    End If

                    GunaTextBoxCompteDebiteur.Text = compte.Rows(0)("NUMERO_COMPTE")

                End If

            Else
                GunaTextBoxCompteDebiteur.Visible = False
            End If

        Else

        End If

        GunaTextBoxCompteDebiteur.ForeColor = Color.White

        '---------------------- END GESTION DES COMPTES DEBITEUR ENTREPRISE ASSOCIE A LA RESERVATION --------------

    End Sub

    Public Sub gestionDesComptesDebiteurLorsDesReservations(ByVal CODE_ENTREPRISE As String) 'GESTION DU PLAFONDS DU COMPTE

        '---------------------- GESTION DES COMPTES DEBITEUR ENTREPRISE ASSOCIE A LA RESERVATION ----------------

        'SELECTION DU COMPTE DE L'ENTREPRISE ACTUEL
        Dim compte As DataTable = Functions.getElementByCode(CODE_ENTREPRISE, "compte", "CODE_CLIENT")

        If compte.Rows.Count > 0 Then

            If Not Trim(compte.Rows(0)("CODE_CLIENT")).Equals("") Then


                If compte.Rows(0)("ETAT_DU_COMPTE") = 1 Then
                    'COMPTE ACTIF

                    GunaTextBoxCompteDebiteur.Visible = True
                    GunaTextBoxBC.Visible = True

                    Dim ETAT_DU_COMPTE As Double = 0

                    If Double.Parse(compte.Rows(0)("SOLDE_COMPTE")) < 0 Then
                        ETAT_DU_COMPTE = Double.Parse(compte.Rows(0)("PLAFONDS_DU_COMPTE")) - Math.Abs(Double.Parse(compte.Rows(0)("SOLDE_COMPTE")))
                    End If

                    If ETAT_DU_COMPTE >= 0 Then
                        'AU DESSUS  
                        GunaTextBoxCompteDebiteur.BaseColor = Color.Green
                    Else
                        'EN DESSOUS
                        GunaTextBoxCompteDebiteur.BaseColor = Color.Red
                    End If

                    GunaTextBoxCompteDebiteur.Text = compte.Rows(0)("NUMERO_COMPTE")

                Else

                    'GunaTextBoxCompteDebiteur.Text = ""
                    'GunaTextBoxCompteDebiteur.BaseColor = Color.White
                    'COMPTE INACTIF
                    'GunaTextBoxCompteDebiteur.BaseColor = Color.Red
                    'GunaTextBoxCompteDebiteur.Text = compte.Rows(0)("NUMERO_COMPTE") & " (Inactif)"

                End If

            End If

            'GunaTextBoxCompteDebiteur.Text = compte.Rows(0)("NUMERO_COMPTE")
            'GunaTextBoxCompteDebiteur.ForeColor = Color.White

        Else

            'GunaTextBoxCompteDebiteur.Visible = False
            'GunaTextBoxBC.Visible = False

        End If

        If Trim(GunaTextBoxEntrepriseDuclient.Text) = "" Then
            GunaTextBoxCompteDebiteur.Visible = False
            GunaTextBoxBC.Visible = False
        End If

        GunaTextBoxCompteDebiteur.ForeColor = Color.White

        '---------------------- END GESTION DES COMPTES DEBITEUR ENTREPRISE ASSOCIE A LA RESERVATION --------------

    End Sub

    'GESTION DES CHAMPS DE RECHERCHE
    Private Sub GunaButtonArricherReservation_Click(sender As Object, e As EventArgs) Handles GunaButtonArricherReservation.Click

        If GunaComboBoxFiltre.SelectedIndex = -1 Then

            'LES FILTRES

            If Not Trim(GunaTextBoxClient.Text).Equals("") Then
                ReservationList("NOM_CLIENT", Trim(GunaTextBoxClient.Text))
            ElseIf Not Trim(GunaTextBoxNumResa.Text).Equals("") Then
                ReservationList("CODE_RESERVATION", Trim(GunaTextBoxNumResa.Text))
            ElseIf Not Trim(GunaTextBoxParEntreprise.Text).Equals("") Then
                ReservationList("NOM_ENTREPRISE", Trim(GunaTextBoxParEntreprise.Text))
            ElseIf Not Trim(GunaTextBoxSourceResa.Text).Equals("") Then
                ReservationList("SOURCE_RESERVATION", Trim(GunaTextBoxSourceResa.Text))
            ElseIf Not Trim(GunaTextBoxNumGroupe.Text).Equals("") Then
                ReservationList("GROUPE", Trim(GunaTextBoxNumGroupe.Text))
            ElseIf Not Trim(GunaTextBoxTypeChambre.Text).Equals("") Then
                ReservationList("CHAMBRE_ID", Trim(GunaTextBoxTypeChambre.Text))
            Else
                Recherche.RechercherParDate(GunaDataGridViewReservationList, GunaDateTimePickerParDateArrivee.Value, GunaDateTimePickerParDateDepart.Value)
            End If

        ElseIf GunaComboBoxFiltre.SelectedIndex = 0 Then
            ReservationList("entreprise", "NOM_ENTREPRISE")
        ElseIf GunaComboBoxFiltre.SelectedIndex = 1 Then
            ReservationList("groupe", "GROUPE")
        ElseIf GunaComboBoxFiltre.SelectedIndex = 2 Then
            ReservationList("individuelle", "")
        ElseIf GunaComboBoxFiltre.SelectedIndex = 3 Then
            ReservationList("all", "none")
        End If

        If GunaDataGridViewReservationList.Rows.Count > 0 Then
            GunaLabelNbreResa.Text = "(" & GunaDataGridViewReservationList.Rows.Count & ")"
        Else
            GunaLabelNbreResa.Text = "(0)"
        End If
        'We empty the search field field after reservation 
        emptySearchFieldReservation()

    End Sub

    'Nom de client
    Private Sub GunaDataGridViewNameSearch_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewNameSearch.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewNameSearch.Rows(e.RowIndex)

            GunaTextBoxClient.Text = Trim(row.Cells("NOM_PRENOM").Value.ToString())

            GunaDataGridViewNameSearch.Visible = False

        End If

    End Sub

    'Num Rea
    Private Sub GunaDataGridViewNumRea_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewNumRea.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewNumRea.Rows(e.RowIndex)

            GunaTextBoxNumResa.Text = Trim(row.Cells("CODE_RESERVATION").Value.ToString())

            GunaDataGridViewNumRea.Visible = False

        End If

    End Sub

    'Entreprise
    Private Sub GunaDataGridViewEntrepriseSearch_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewEntrepriseSearch.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewEntrepriseSearch.Rows(e.RowIndex)

            GunaTextBoxParEntreprise.Text = Trim(row.Cells("NOM_PRENOM").Value.ToString())

            GunaDataGridViewEntrepriseSearch.Visible = False

        End If

    End Sub

    Private Sub GunaDataGridViewSourceRea_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewSourceRea.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewSourceRea.Rows(e.RowIndex)

            GunaTextBoxSourceResa.Text = Trim(row.Cells("SOURCE_RESERVATION").Value.ToString())

            GunaDataGridViewSourceRea.Visible = False

        End If

    End Sub

    Private Sub GunaDataGridViewGroupe_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewGroupe.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewGroupe.Rows(e.RowIndex)

            GunaTextBoxNumGroupe.Text = Trim(row.Cells("GROUPE").Value.ToString())

            GunaDataGridViewGroupe.Visible = False

        End If

    End Sub

    Private Sub GunaDataGridViewTypeChambre_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewTypeChambre.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewTypeChambre.Rows(e.RowIndex)

            GunaTextBoxTypeChambre.Text = Trim(row.Cells("CHAMBRE_ID").Value.ToString())

            GunaDataGridViewTypeChambre.Visible = False

        End If

    End Sub

    Private Sub showZenlockFormAsync()

        ZenoLockForm.Show()
        ZenoLockForm.TopMost = True

    End Sub

    'Zenlock form from front desk
    Private Sub GunaButtonLectureDeCarte_Click(sender As Object, e As EventArgs) Handles GunaButtonLectureDeCarte.Click

        If True Then

            ZenoLockForm.Close()

            GlobalVariable.zenlockForm = "frontdesk"

            If GlobalVariable.AgenceActuelle.Rows(0)("SERRURES") = 1 Then
                showZenlockFormAsync()
            Else

                If GlobalVariable.actualLanguageValue = 0 Then
                    languageMessage = "The usage of locks is not activated"
                    languageTitle = "Locks Management"
                ElseIf GlobalVariable.actualLanguageValue = 1 Then
                    languageMessage = "L'utilisation des serrures n'est pas activé"
                    languageTitle = "Gestion des serrures"
                End If

                MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

        Else

            If GlobalVariable.actualLanguageValue = 0 Then
                languageMessage = "Please pay atleast one night"
                languageTitle = "Locks Management"
            ElseIf GlobalVariable.actualLanguageValue = 1 Then
                languageMessage = "Bien vouloir effectuer un paiement d'au moins une nuitée"
                languageTitle = "Gestion des serrures"
            End If

            MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

    End Sub

    'Affichage des documents
    Private Sub GunaButton3_Click_2(sender As Object, e As EventArgs) Handles GunaButtonAffichageDesDocuments.Click

        If Not Trim(GunaTextBoxRefClient.Text).Equals("") Then
            ListeDesFacturesEtReglementPourUneReservation()
        Else

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Bien vouloir charger une réservation !!", "Facturation", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("Pleas load a new booking !!", "Billing", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If



        End If

    End Sub

    Public Sub ficheTechniqueDeManifestation()

        GunaTextBoxNoMClient.Text = GunaTextBoxNomPrenom.Text
        GunaTextBox11.Text = GunaTextBoxEntrepriseDuclient.Text
        GunaTextBox12.Text = GunaTextBoxTelClient.Text
        GunaTextBox17.Text = GunaTextBoxClientEmail.Text
        GunaTextBox14.Text = ""

        '---------------------------------------------------------
        'selection de l'evenement a partir du code
        If GunaComboBoxEvenement.SelectedIndex >= 0 Then

            Dim CODE_EVENEMENT As String = GunaComboBoxEvenement.SelectedValue.ToString
            Dim evenement As DataTable = Functions.getElementByCode(CODE_EVENEMENT, "evenement", "CODE_EVENEMENT")

            If evenement.Rows.Count > 0 Then
                GunaTextBox22.Text = evenement.Rows(0)("LIBELLE")
            End If

        End If

        'GunaTextBox24.Text = GlobalVariable.societe.Rows(0)("VILLE")
        GunaTextBox24.Text = GunaTextBoxLibelleTYpe.Text

        GunaTextBox32.Text = GunaTextBoxNbrePersonne.Text

        GunaTextBox27.Text = GunaDateTimePickerArrivee.Value.ToShortDateString

        If Trim(GlobalVariable.codeReservationToUpdate) = "" Then
            GunaCheckBoxVidOui.Checked = True
            GunaCheckBoxSonoOui.Checked = True
            GunaCheckBoxCouvOui.Checked = True
            GunaCheckBoxTableOui.Checked = True
        End If

        Dim salle As DataTable = Functions.getElementByCode(GunaTextBoxNumeroChambre.Text, "chambre", "CODE_CHAMBRE")

        If salle.Rows.Count > 0 Then
            GunaTextBox66.Text = salle.Rows(0)("LIBELLE_CHAMBRE")
        End If

        GunaTextBoxMontantSalleManifest.Text = GunaTextBoxMontantReelSalle.Text

        'MONTANT GLOBAL
        GunaTextBoxMontantGlobal.Text = GunaTextBoxGrandTotal.Text

    End Sub

    Private Sub TabControlGestionReservation_SelectedIndexChanged(sender As Object, e As EventArgs) Handles TabControlGestionReservation.SelectedIndexChanged
        GunaDataGridViewDesFactures.Columns.Clear()
        'GunaGroupBoxStatistiques
        GunaDataGridViewListeDesReglement.Columns.Clear()

        If TabControlGestionReservation.SelectedIndex = 3 Then

            If GlobalVariable.typeChambreOuSalle = "salle" Then
                'If Trim(GlobalVariable.codeReservationToUpdate) = "" Then
                'AINSI L'INITIALISATION DES DE LA FICHE DE MANIFESTATION SE FERA UNIQUEMENT A LA CREATION
                ficheTechniqueDeManifestation()
                'End If
            End If

        ElseIf Not Trim(GlobalVariable.codeReservationToUpdate) = "" Then
            GunaDataGridViewListeDesReglement.Columns.Clear()
            GunaDataGridViewDesFactures.Columns.Clear()
        End If

        If TabControlGestionReservation.SelectedIndex = 1 Then

            'ON NE FACTURE PAS LES CLIENTS QUI NE SONT PAS EN CHAMBRES

            If Not Trim(GlobalVariable.codeReservationToUpdate) = "" Then

                Dim ETAT_RESERVATION As Integer = 1

                Dim resa As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION", ETAT_RESERVATION, "ETAT_RESERVATION")

                If Not resa.Rows.Count > 0 Then

                    TabControlGestionReservation.SelectedIndex = 0

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Vous ne pouvez facturer que les en chambres !!", "Facturation", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    Else
                        MessageBox.Show("You can only bill In house !!", "Billing", MessageBoxButtons.OK, MessageBoxIcon.Information)
                    End If

                End If

            Else

                'TabControlGestionReservation.SelectedIndex = 0

                'If GlobalVariable.actualLanguageValue = 1 Then
                'MessageBox.Show("Vous ne pouvez facturer que les en chambres !!", "Facturation", MessageBoxButtons.OK, MessageBoxIcon.Information)

                'Else
                'MessageBox.Show("You can only bill In house !!", "Billing", MessageBoxButtons.OK, MessageBoxIcon.Information)

                'End If

            End If

        End If

    End Sub

    'Gestion de la clôture
    Private Sub ClôturerToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ClôturerToolStripMenuItem.Click

        Dim CODE_CAISSIER As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

        Dim infoSupCaisse As DataTable = Functions.getElementByCode(CODE_CAISSIER, "caisse", "CODE_UTILISATEUR")

        If infoSupCaisse.Rows.Count > 0 Then

            If infoSupCaisse.Rows(0)("ETAT_CAISSE") = 1 Then

                If GlobalVariable.actualLanguageValue = 0 Then
                    languageTitle = "Impossible to do the night audit"
                    languageMessage = "Please close your main cash box"
                Else
                    languageTitle = "Impossible de cloturer"
                    languageMessage = "Bien vouloir fermer votre caisse"
                End If

                MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else

                CloturerForm.Show()
                CloturerForm.TopMost = True

            End If

        Else

            If GlobalVariable.actualLanguageValue = 0 Then
                languageTitle = "Impossible to do the night audit"
                languageMessage = "Please close your main cash register if you have one"
            Else
                languageTitle = "Impossible de cloturer"
                languageMessage = "Bien vouloir fermer votre caisse si vous disposez d'une"
            End If

            MessageBox.Show(languageMessage, languageTitle, MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

    End Sub

    Private Sub ToolStripMenuItem105_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem105.Click
        FournisseurForm.Show()
    End Sub

    'Affichage du statuts des chambres du dashboard
    Private Sub GunaAdvenceButton1_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton1.Click

        Functions.retablissementDesPictogrammeCorrecteDuDashBoard(GlobalVariable.DateDeTravail)

        GunaGroupBoxRoomStatus.Controls.Clear()
        'PanelGraphiques.Controls.Clear()
        GunaGroupBoxStatistiques.Controls.Clear()
        elementsDesChambres()
        contenuStatistique()
        StatistiquesDesChambres()
        StatusDesChambres(page)

    End Sub

    Private Sub ToolStripMenuItem92_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem92.Click
        MAgasinForm.Show()
        MAgasinForm.TabControl1.SelectedIndex = 2
    End Sub


    'Gestion du switch button icons-graphiques
    Private Sub GunaWinSwitch1_CheckedChanged(sender As Object, e As EventArgs) Handles GunaWinSwitch1.CheckedChanged

        GunaLabel7.Visible = False
        GunaLabel167.Visible = False

        'ROOM ICONS
        If GunaWinSwitch1.Checked Then

            PanelPagination.Visible = True
            PanelGraphiques.Visible = False

            If numberPages > 1 Then

                If page = 1 Then
                    GunaLabel7.Visible = True
                ElseIf page = 2 Then
                    GunaLabel167.Visible = True
                End If

            End If

            StatusDesChambres(page)

        Else

            'GRAPHES ICONS
            PanelPagination.Visible = False
            PanelGraphiques.BringToFront()
            PanelGraphiques.Visible = True

        End If

    End Sub

    ' ------------------ --------------GESTION DES SIESTES ----------------------------------------------
    ' ------------------ --------------GESTION DES SIESTES ----------------------------------------------

    Dim languageMessage As String = ""
    Dim languageTitle As String = ""

    'ACTIVATION DU LOGICIEL
    Private Sub LicenceToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles LicenceToolStripMenuItem.Click

        If GlobalVariable.actualLanguageValue = 0 Then
            languageMessage = "LYTE is activated"
        ElseIf GlobalVariable.actualLanguageValue = 1 Then
            languageMessage = "LYTE est activé"
        End If

        ActivationForm.Close()
        ActivationForm.Show()
        ActivationForm.GunaTextBoxMessage.Text = languageMessage
        ActivationForm.TopMost = True

    End Sub

    'Gestion des siestes et nuites
    Private Sub GunaCheckBoxDayUse_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxDayUse.Click

        If GunaCheckBoxDayUse.Checked Then

            GunaCheckBoxMensuel.Checked = False

            If GlobalVariable.actualLanguageValue = 1 Then
                GunaLabelTotalHeure.Text = "Nombre de heures"
                GunaLabelPrixParNuitee.Text = "Prix par heure"
                GunaLabelPrixSejours.Text = "Prix de la sieste"
                GunaLabelTempsAFaire.Text = "Total heure(s)"
            Else
                GunaLabelTotalHeure.Text = "Number of hours"
                GunaLabelPrixParNuitee.Text = "Price per hour"
                GunaLabelPrixSejours.Text = "Day use price"
                GunaLabelTempsAFaire.Text = "Total hour(s)"
            End If
            GunaLabelTypeDeSejour.Text = "DAY USE"

            GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail

            GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

            Dim DateTimeArrivee As DateTime = CDate(DateTimeArriveeStringFormat).ToLongTimeString
            Dim DateTimeDepart As DateTime = CDate(DateTimeDepartStringFormat).ToLongTimeString

            Dim numberOfHoursToSpend As Integer = 0
            numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            GunaComboBoxHeureDepart.Items.Clear()

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            Else
                GunaTextBoxTempsAFaire.Text = 0
            End If

            GunaComboBoxHeureArrivee.Items.Clear()

            'GunaComboBoxHeureArrivee.Items.Add(CDate(GunaLabelTemps.Text).ToLongTimeString)
            GunaComboBoxHeureArrivee.Items.Add(CDate(StatusBarPanelTime.Text).ToLongTimeString)

            'GunaComboBoxHeureArrivee.SelectedItem = GunaLabelTemps.Text
            GunaComboBoxHeureArrivee.SelectedItem = StatusBarPanelTime.Text

            GunaComboBoxHeureDepart.Items.Add(CDate(GunaComboBoxHeureArrivee.Text).AddHours(1))

            GunaComboBoxHeureDepart.SelectedIndex = 0

        Else

            GunaComboBoxHeureArrivee.Items.Clear()
            GunaComboBoxHeureArrivee.Items.Add("12:00:00")
            GunaComboBoxHeureArrivee.SelectedItem = "12:00:00"

            GunaComboBoxHeureDepart.Items.Clear()
            GunaComboBoxHeureDepart.Items.Add("12:00:00")
            GunaComboBoxHeureDepart.SelectedItem = "12:00:00"

            If GlobalVariable.actualLanguageValue = 1 Then
                GunaLabelTotalHeure.Text = "Nombre de nuitée(s)"
                GunaLabelPrixParNuitee.Text = "Prix par nuitée"
                GunaLabelPrixSejours.Text = "Prix du séjours"

                GunaLabelTypeDeSejour.Text = "COURT SEJOURS"
                GunaLabelTempsAFaire.Text = "Total nuitées"

            Else
                GunaLabelTotalHeure.Text = "Number of days"
                GunaLabelPrixParNuitee.Text = "Price per night"
                GunaLabelPrixSejours.Text = "Price of stay"

                GunaLabelTypeDeSejour.Text = "SHORT STAY"
                GunaLabelTempsAFaire.Text = "Total nights"

            End If

            GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail.AddDays(1)
            GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail

            GunaTextBoxTempsAFaire.Visible = True

        End If

    End Sub

    Private Sub GunaComboBoxHeureDepart_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GunaComboBoxHeureDepart.SelectedIndexChanged

        If GunaCheckBoxDayUse.Checked Then

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

            'Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeArrivee As DateTime = CDate(DateTimeArriveeStringFormat).ToLongTimeString
            'Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeDepart As DateTime = CDate(DateTimeDepartStringFormat).ToLongTimeString

            Dim numberOfHoursToSpend As Integer = 0
            numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            Else
                GunaTextBoxTempsAFaire.Text = 0
            End If

            '-----------------------------

        End If

    End Sub

    Private Sub GunaComboBoxHeureArrivee_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GunaComboBoxHeureArrivee.SelectedIndexChanged

        If GunaCheckBoxDayUse.Checked Then

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

            'Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeArrivee As DateTime = CDate(DateTimeArriveeStringFormat).ToLongTimeString
            'Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeDepart As DateTime = CDate(DateTimeDepartStringFormat).ToLongTimeString

            Dim numberOfHoursToSpend As Integer = 0
            numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            Else
                GunaTextBoxTempsAFaire.Text = 0
            End If

            '-----------------------------

        End If

    End Sub

    ' ------------------ END GESTION DES SIESTE-----------------------------------

    Public Sub ActivationOuDesactivationDeToutLesBoutonsApresUnCheckOUt()

        If Trim(LabelNatureReservation.Text) = "CHECKOUT" Then

            GunaDateTimePickerArrivee.Enabled = False
            GunaComboBoxHeureArrivee.Enabled = False
            GunaDateTimePickerDepart.Enabled = False
            GunaComboBoxHeureDepart.Enabled = False
            GunaCheckBoxDayUse.Enabled = False
            GunaCheckBoxMensuel.Enabled = False
            GunaCheckBoxGratuitee.Enabled = False
            GunaTextBoxTempsAFaire.Enabled = False
            GunaTextBoxCodeTypeDeChambre.Enabled = False
            GunaButtonListeDesCategorieDeChambre.Enabled = False
            GunaTextBoxNomPrenom.Enabled = False
            GunaTextBoxEntrepriseDuclient.Enabled = False
            GunaTextBoxCodeDeGroupe.Enabled = False
            GunaCheckBoxReservationDeGroupe.Enabled = False
            GunaButtonReservation.Enabled = False
            GunaTextBoxNumeroChambre.Enabled = False
            GunaButtonRoomSearchButton.Enabled = False
            GunaComboBoxHeureArrivee.Enabled = False
            GunaComboBoxHeureDepart.Enabled = False


        Else

            GunaComboBoxHeureArrivee.Enabled = True
            GunaComboBoxHeureDepart.Enabled = True

            GunaDateTimePickerArrivee.Enabled = True
            GunaComboBoxHeureArrivee.Enabled = True
            GunaDateTimePickerDepart.Enabled = True
            GunaComboBoxHeureDepart.Enabled = True
            GunaCheckBoxDayUse.Enabled = True
            GunaCheckBoxMensuel.Enabled = True
            GunaTextBoxTempsAFaire.Enabled = True
            GunaTextBoxCodeTypeDeChambre.Enabled = True
            GunaButtonListeDesCategorieDeChambre.Enabled = True
            GunaTextBoxNomPrenom.Enabled = True
            GunaTextBoxEntrepriseDuclient.Enabled = True
            GunaTextBoxCodeDeGroupe.Enabled = True
            GunaCheckBoxReservationDeGroupe.Enabled = True
            GunaButtonReservation.Enabled = True
            GunaTextBoxNumeroChambre.Enabled = True
            GunaButtonRoomSearchButton.Enabled = True


        End If


    End Sub

    'ENSEMBLE DES RAPPORTS DE LA RECEPTION

    Private Sub GunaButtonPromoteur_Click(sender As Object, e As EventArgs) Handles GunaButtonPromoteur.Click

        Me.Cursor = Cursors.WaitCursor

        Functions.RapportDuPromoteur()

        Me.Cursor = Cursors.Default

    End Sub

    'RESERVATIONS
    Private Sub GunaButton10_Click(sender As Object, e As EventArgs) Handles GunaButton10.Click

        GunaComboBoxFiltres.Items.Clear()

        If GlobalVariable.actualLanguageValue = 1 Then

            GunaComboBoxFiltres.Items.Add("Réservations")
            GunaComboBoxFiltres.Items.Add("Checked In")
            GunaComboBoxFiltres.Items.Add("Checked Out")
            GunaComboBoxFiltres.Items.Add("Attendues")
            GunaComboBoxFiltres.Items.Add("No show")
        Else

            GunaComboBoxFiltres.Items.Add("Reservations")
            GunaComboBoxFiltres.Items.Add("Checked In")
            GunaComboBoxFiltres.Items.Add("Checked Out")
            GunaComboBoxFiltres.Items.Add("Expected")
            GunaComboBoxFiltres.Items.Add("No show")

        End If

        GunaLabelRapport.Text = "RESERVATIONS"

        TabControlRapport.SelectedIndex = 3

        GunaComboBoxFiltres.Visible = True

        GunaComboBoxFiltres.SelectedIndex = 0

        GlobalVariable.DocumentToGenerate = "reservations"

    End Sub

    'MAINCOURANTE JOURNALIERE
    Private Sub GunaButtonMainCouranteJOurnaliere_Click(sender As Object, e As EventArgs) Handles GunaButtonMainCouranteJOurnaliere.Click

        GlobalVariable.AncienneMainCourante = False

        GlobalVariable.DocumentToGenerate = "chambre"
        MainCouranteReceptionForm.Show()

        MainCouranteReceptionForm.TopMost = True

    End Sub

    Private Sub GunaButton4_Click(sender As Object, e As EventArgs) Handles GunaButtonMainCouranteCummulee.Click

        GlobalVariable.AncienneMainCourante = True

        MainCouranteReceptionForm.TopMost = True

        GlobalVariable.DocumentToGenerate = "chambre"

        MainCouranteReceptionForm.Show()

    End Sub

    Private Sub GunaButton8_Click_1(sender As Object, e As EventArgs) Handles GunaButton8.Click
        GlobalVariable.DocumentToGenerate = "facture"
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True
        'Functions.RapportFacture()
    End Sub

    Private Sub GunaButton19_Click(sender As Object, e As EventArgs) Handles GunaButton19.Click
        Functions.rapportDesReservationAnnulees()
    End Sub

    'ARRIVEE
    Private Sub GunaButton7_Click_1(sender As Object, e As EventArgs) Handles GunaButton7.Click
        GlobalVariable.DocumentToGenerate = "arrivee"
        Functions.rapportDesArrivees()
    End Sub

    Private Sub GunaButton17_Click(sender As Object, e As EventArgs) Handles GunaButtonCheckOutReservation.Click
        Functions.rapportDesSejoursClotures()
    End Sub

    Private Sub GunaButtonEtatDesChambres_Click(sender As Object, e As EventArgs) Handles GunaButtonEtatDesChambres.Click
        Functions.rapportEtatsDesChambres()
    End Sub

    Private Sub GunaButton11_Click(sender As Object, e As EventArgs) Handles GunaButtonCaisseGlobal.Click
        GlobalVariable.DocumentToGenerate = "SITUATION GLOBAL"
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True
        RapportFacturesForm.GunaDateTimePickerFin.Enabled = False
    End Sub

    Private Sub GunaAdvenceButton3_Click_1(sender As Object, e As EventArgs)
        NotificationsForm.TopMost = True
        NotificationsForm.Show()
    End Sub

    Private Sub GunaLabel12_Click(sender As Object, e As EventArgs)

        NotificationsForm.GunaTextBoxFromWhichWindow.Text = "reception"
        NotificationsForm.GunaLabelNomDuNettoyeur.Text = "BOITE DE RECEPTION : MESSAGES NON LUS"

        NotificationsForm.TopMost = True
        NotificationsForm.Show()

        Dim notifications As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.ConnectedUser.Rows(0)("CATEG_UTILISATEUR"), "notification", "CODE_PROFIL", 0, "ETAT_NOTIFCATION")

        If notifications.Rows.Count > 0 Then

            NotificationsForm.GunaDataGridViewNotification.Columns.Clear()

            NotificationsForm.GunaDataGridViewNotification.DataSource = notifications

            NotificationsForm.GunaDataGridViewNotification.Columns("ID_NOTIFICATION").Visible = False
            NotificationsForm.GunaDataGridViewNotification.Columns("CODE_PROFIL").Visible = False
            NotificationsForm.GunaDataGridViewNotification.Columns("CODE_AGENCE").Visible = False
            NotificationsForm.GunaDataGridViewNotification.Columns("ETAT_NOTIFCATION").Visible = False

        End If

    End Sub

    'Ouvrir fenetre des UNITE DE COMTAGE
    Private Sub ToolStripMenuItem93_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem93.Click
        UniteDeComptageForm.TopMost() = True
        UniteDeComptageForm.Show()
    End Sub

    'gestion des fiches techniques
    Private Sub TicheTechniqueToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles TicheTechniqueToolStripMenuItem.Click
        GlobalVariable.ficheTechnique = "fiche"
        ArticleForm.TopMost() = True
        ArticleForm.Show()
    End Sub

    Public Shared Function SituationDeCaisseEspeces(ByVal DateDeSituation As Date) As DataTable

        Dim getUserQuery = "SELECT * FROM reglement WHERE CODE_CAISSIER = @CODE_CAISSIER AND DATE_REGLEMENT >= '" & DateDeSituation.ToString("yyyy-MM-dd") & "' AND DATE_REGLEMENT <= '" & DateDeSituation.ToString("yyyy-MM-dd") & "' AND ETAT=@ETAT AND MODE_REGLEMENT=@MODE_REGLEMENT ORDER BY DATE_REGLEMENT DESC"

        Dim command As New MySqlCommand(getUserQuery, GlobalVariable.connect)

        command.Parameters.Add("@CODE_CAISSIER", MySqlDbType.VarChar).Value = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

        'If GlobalVariable.actualLanguageValue = 1 Then
        'command.Parameters.Add("@MODE_REGLEMENT", MySqlDbType.VarChar).Value = "Espèce"
        'Else
        command.Parameters.Add("@MODE_REGLEMENT", MySqlDbType.VarChar).Value = "Cash"
        'End If

        command.Parameters.Add("@ETAT", MySqlDbType.Int64).Value = 0

        Dim adapter As New MySqlDataAdapter

        Dim dt As New DataTable()
        'Dim command As New MySqlCommand(query, GlobalVariable.connect)

        adapter.SelectCommand = command
        adapter.Fill(dt)

        Return dt

    End Function

    Public Function SituationDeCaisseJournaliere() As Double

        Dim situationDeCaisse As DataTable = SituationDeCaisseEspeces(GlobalVariable.DateDeTravail)

        Dim TotalFacture As Double = 0

        If situationDeCaisse.Rows.Count > 0 Then
            'On selection l'ensemble des reglements d'un jour donné
            For i = 0 To situationDeCaisse.Rows.Count - 1
                TotalFacture += situationDeCaisse.Rows(i)("MONTANT_VERSE")
            Next

            Dim situationDeCaisseCasDeRemboursement As DataTable = Functions.SituationDeCaisseCasDeRemboursement(GlobalVariable.DateDeTravail)

            Dim TotalRembourse As Double = 0
            'On selection l'ensemble des remboursement d'un jour donné
            If situationDeCaisseCasDeRemboursement.Rows.Count > 0 Then

                For j = 0 To situationDeCaisseCasDeRemboursement.Rows.Count - 1
                    TotalRembourse += situationDeCaisseCasDeRemboursement.Rows(j)("MONTANT_HT")
                Next

                'On soustrait les montant remboursé des montants encaissé
                TotalFacture -= TotalRembourse

            End If

        End If

        Return TotalFacture

    End Function
    'Fermeture de caisse
    Private Sub FermerCaisseToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles FermerCaisseToolStripMenuItem.Click

        GlobalVariable.billetageAPartirDe = "reception"

        Dim encaissementEspeces As Double = SituationDeCaisseJournaliere()

        'ON NE PEUT PAS TRANSFERT DES ENCAISSMENT VIDES

        If encaissementEspeces > 0 Then
            BilletageForm.Show()
            BilletageForm.TopMost = True
        Else
            'FacturationForm.Close()


            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Aucune recette à transférer ", "Transfert de Caisse", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("No fund to be transfered ", "Fund transfer", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

            Dim CODE_UTILISATEUR = GlobalVariable.ConnectedUser(0)("CODE_UTILISATEUR")

            Dim CODE_CAISSE As String = ""

            Dim CAISSE_UTILISATEUR As DataTable = Functions.getElementByCode(CODE_UTILISATEUR, "caisse", "CODE_UTILISATEUR")

            If CAISSE_UTILISATEUR.Rows.Count > 0 Then

                CODE_CAISSE = CAISSE_UTILISATEUR.Rows(0)("CODE_CAISSE")

                FermerCaisseToolStripMenuItem.Visible = False

                OuvrirCaisseToolStripMenuItem.Visible = True

            End If

            Dim ETAT_CAISSE As Integer = 0
            Dim caissier As New Caisse()

            caissier.ouvertureFermetureDeCaisse(CODE_CAISSE, ETAT_CAISSE)


            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Caisse fermée avec succès", "Gestion de caisse", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("Cash box successfully closed", "Cash register", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

            Dim CODE_MAGASIN As String = GlobalVariable.magasinActuel
            Dim SHIFT_VALUE As Integer = GlobalVariable.shiftActuel
            Dim DEBUT_FIN As Integer = 1 'METTRE A JOUR LE STOCK DE FIN

            Functions.inventaireJournalierTextFile(CODE_MAGASIN, SHIFT_VALUE, DEBUT_FIN)

        End If

    End Sub

    'Ouverture de caisse

    Public Sub indicateurDEtatDeCaisse()

        If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("GRANDE_CAISSE") = 1 Then

            Dim CODE_UTILISATEUR As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

            Dim caisse As DataTable = Functions.getElementByCode(CODE_UTILISATEUR, "caisse", "CODE_UTILISATEUR")

            If caisse.Rows.Count > 0 Then

                If caisse.Rows(0)("ETAT_CAISSE") = 0 Then

                    ReglementForm.PanelSituationCaisse.BackColor = Color.Red
                Else
                    ReglementForm.PanelSituationCaisse.BackColor = Color.LightGreen
                End If

            End If

        End If

    End Sub

    Private Sub OuvrirCaisseToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles OuvrirCaisseToolStripMenuItem.Click

        Dim gestionStock As Integer = GlobalVariable.AgenceActuelle.Rows(0)("GERER_STOCK")
        Dim continuer As Boolean = True

        'ON NE DOIT PAS POUVOUR OUVRIR SA CAISSE SI LA GESTION DES STOCKS EST ACTIVE
        'ET QUE L'ON A PAS ENCORE CHOISI SON MAGASIN ET CHOISI UN SHIFT

        If gestionStock = 1 Then

            continuer = False

            'LE SEUL MOYEN D'OUVRIR LA CAISSE C'EST DE CHOISIR UN MAGASIN

            If GlobalVariable.magasinActuel.Equals("") Then
                Functions.magasinActuelEtShiftDunUtilisateur()
            Else
                continuer = True
            End If

        End If

        If continuer Then

            GlobalVariable.fenetreDouvervetureDeCaisse = "reception"

            '1- VERIFICATION DE DROIT DE CAISSE
            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("GRANDE_CAISSE") = 1 Then

                '2- VERIFICATION DE CAISSE

                Dim possedeUneCaisse As Boolean = False

                Dim CODE_UTILISATEUR As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

                possedeUneCaisse = Functions.detentionDeCaisse(CODE_UTILISATEUR)

                If possedeUneCaisse Then
                    passwordVerifivationForm.Show()
                Else

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Vous n'avez pas de caisse", "Gestion Caisse", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                    Else
                        MessageBox.Show("You don't have a cash box", "Cash box management", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                    End If

                End If

            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Vous n'avez pas droit a une caisse", "Gestion Caisse", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                Else
                    MessageBox.Show("You don't have the right to own a cash box", "Cash box Management", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                End If

            End If

        End If

    End Sub

    Public Sub GestionOuvertureDeCaisse()

        Dim CODE_UTILISATEUR = GlobalVariable.ConnectedUser(0)("CODE_UTILISATEUR")

        Dim CODE_CAISSE As String = ""
        Dim CAISSE_UTILISATEUR As DataTable = Functions.getElementByCode(CODE_UTILISATEUR, "caisse", "CODE_UTILISATEUR")

        If CAISSE_UTILISATEUR.Rows.Count > 0 Then

            CODE_CAISSE = CAISSE_UTILISATEUR.Rows(0)("CODE_CAISSE")

            OuvrirCaisseToolStripMenuItem.Visible = False

            FermerCaisseToolStripMenuItem.Visible = True

        End If

        Dim ETAT_CAISSE As Integer = 1
        Dim caissier As New Caisse()

        caissier.ouvertureFermetureDeCaisse(CODE_CAISSE, ETAT_CAISSE)


        If GlobalVariable.actualLanguageValue = 1 Then
            MessageBox.Show("Caisse ouverte avec succès", "Gestion de caisse", MessageBoxButtons.OK, MessageBoxIcon.Information)

        Else
            MessageBox.Show("Cash Box successfully opened", "Cash Box", MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If


    End Sub

    Private Sub PETITEToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles PETITEToolStripMenuItem.Click
        PetiteCaisseForm.Close()
        PetiteCaisseForm.Show()
        PetiteCaisseForm.TopMost = True
    End Sub

    'NE PAS PERMETTRE LE CHECKIN D'UNE CHAMBRE OCCUPEE

    Private Sub chambreOccupeOuPas(ByVal CODE_CHAMBRE As String)

        'On affiche toutes les reserv_conf dont la date saisie est entre la d'entrée et la date de sortie (inclusif)

        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        Dim query As String = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE AND CHAMBRE_ID=@CODE_CHAMBRE ORDER BY CHAMBRE_ID ASC"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
        command.Parameters.Add("@CODE_CHAMBRE", MySqlDbType.VarChar).Value = CODE_CHAMBRE

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()
        adapter.Fill(table)

        If Not table.Rows.Count > 0 Then
            GunaButtonCheckIn.Visible = True
        End If

    End Sub

    Private Sub TimerToRefreshClock_Tick(sender As Object, e As EventArgs) Handles TimerToRefreshClock.Tick

        Dim notifications As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.ConnectedUser.Rows(0)("CATEG_UTILISATEUR"), "notification", "CODE_PROFIL", 0, "ETAT_NOTIFCATION")

        If notifications.Rows.Count > 0 Then
            StatusBarPanelNotification.Text = "(" & notifications.Rows.Count & ")"
            'StatusBarPanelNotification.ForeColor = Color.Red
        Else
            'StatusBarPanelNotification.ForeColor = Color.White
            StatusBarPanelNotification.Text = "(" & 0 & ")"
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------------------------

        'GESTION DES TYPE SALLE OU CHAMBRE
        If GunaRadioButtonChambre.Checked Then
            GlobalVariable.typeChambreOuSalle = "chambre"
        ElseIf GunaRadioButtonSalleFete.Checked Then
            GlobalVariable.typeChambreOuSalle = "salle"
        End If

        '--------------------------------------------------------------------------------------------------------------------------------------------------------

        'STATUT DES CHAMBRES ET SALLES
        'Le statut ne doit être visible que en cas de modification

        If Not GlobalVariable.codeReservationToUpdate = "" Then
            LabelNatureReservation.Visible = True
        Else
            LabelNatureReservation.Visible = False
        End If

        '---------------------------------------------------------------------------------------------------------------------------------------------------------
        'ACTUALISATION DES COMPTES ENTREPRISES


        If Not Trim(GunaTextBoxNomPrenom.Text) = "" Then

            Dim CODE_CLIENT As String = GunaTextBoxRefClient.Text
            gestionDesComptesDebiteurLorsDesReservationsIndividu(CODE_CLIENT)

        End If

        If Not Trim(GunaTextBoxEntrepriseDuclient.Text) = "" Then

            Dim CODE_ENTREPRISE As String = GunaTextBoxCodeEntrepriseDuClient.Text
            gestionDesComptesDebiteurLorsDesReservations(CODE_ENTREPRISE)

        End If

        'RAFRAICHISSEMENT DU SOLDE D'UN CLIENT EN CHAMBRE
        If Not GlobalVariable.codeReservationToUpdate = "" Then

            'Dim solde As Double = Double.Parse(Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate))
            Dim solde As Double = Double.Parse(Functions.SituationDeReservation(GunaLabelNumReservation.Text))
            GunaLabelSolde.Text = Format(solde, "#,##0")

            If 0 > solde Then
                GunaLabelSolde.ForeColor = Color.Red
            ElseIf solde = 0 Then
                GunaLabelSolde.ForeColor = Color.Black
            Else
                GunaLabelSolde.ForeColor = Color.Green
            End If

            If GunaRadioButtonChambre.Checked Then
                totalAReglerPourLeDuSejour()
            End If

        End If

        '-------------------------------------------- BOUTON A IMPRIMER DES DOCUMENTS ------------------------------------------------

        If TabControlHbergement.SelectedIndex = 0 Then

            If GlobalVariable.typeChambreOuSalle = "chambre" Then
                GunaComboBoxImpressionSalle.Visible = False
                GunaComboBoxImpressionChambre.Visible = True
            ElseIf GlobalVariable.typeChambreOuSalle = "salle" Then
                GunaComboBoxImpressionSalle.Visible = True
                GunaComboBoxImpressionChambre.Visible = False
            End If

            ImprimerDocChambreSalle.Visible = True
            GunaButtonEnvoyer.Visible = True

        Else

            GunaComboBoxImpressionSalle.Visible = False
            GunaComboBoxImpressionChambre.Visible = False
            ImprimerDocChambreSalle.Visible = False
            GunaButtonEnvoyer.Visible = False

        End If

        'ON AFFICHE LE CHECKIN EN DATE DE SORTIE POUR LES EN CHAMBRES
        If Not Trim(GlobalVariable.codeReservationToUpdate) = "" Then

            Dim resa As DataTable

            If CDate(GlobalVariable.DateDeTravail).ToShortDateString = GunaDateTimePickerDepart.Value.ToShortDateString Then

                resa = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

                If resa.Rows.Count > 0 Then
                    If resa.Rows(0)("ETAT_RESERVATION") = 1 Then
                        GunaButtonCheckOut.Visible = True
                    Else
                        If resa.Rows(0)("ETAT_RESERVATION") = 0 Then
                            GunaButtonReservation.Enabled = False
                        Else
                            GunaButtonReservation.Enabled = True
                        End If
                        GunaButtonCheckOut.Visible = False
                    End If
                Else
                    GunaButtonCheckOut.Visible = False
                End If

            Else
                GunaButtonCheckOut.Visible = False
            End If

            Dim CODE_CHAMBRE As String = Trim(GunaTextBoxNumeroChambre.Text)

            If CDate(GlobalVariable.DateDeTravail).ToShortDateString = GunaDateTimePickerArrivee.Value.ToShortDateString Then

                resa = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

                If resa.Rows.Count > 0 Then
                    If resa.Rows(0)("ETAT_RESERVATION") = 0 Then
                        GunaButtonCheckIn.Visible = True

                        'ON CONTROLE SI LA CHAMBRE EST DEJA OCCUPE POUR LES RESERVATIONS FUTURS
                        chambreOccupeOuPas(CODE_CHAMBRE)

                    Else
                        If resa.Rows(0)("ETAT_RESERVATION") = 2 Then
                            GunaButtonReservation.Enabled = False
                        Else
                            GunaButtonReservation.Enabled = True
                        End If
                        GunaButtonCheckIn.Visible = False
                    End If
                Else
                    GunaButtonCheckIn.Visible = False
                End If

            Else
                GunaButtonCheckIn.Visible = False
            End If

        Else
            GunaButtonCheckOut.Visible = False
            'GunaButtonCheckIn.Visible = False
        End If

        'Temporaire

        If Not GunaCheckBoxDateFictive.Checked Then

            'GunaLabel38.Text = Convert.ToDateTime(Functions.ObtenirDateDeTravail()).ToShortDateString.ToString
            date_travail.Text = Convert.ToDateTime(Functions.ObtenirDateDeTravail()).ToShortDateString.ToString

            If Not Trim(date_travail.Text) = "" Then

                Dim dateAfficher As String = date_travail.Text
                Dim DateDeTravail As String = Convert.ToDateTime(Functions.ObtenirDateDeTravail()).ToShortDateString.ToString

            End If

        End If

        'If Trim(GunaTextBoxNomPrenom.Text).Equals("") Then
        'GunaButtonCheckIn.Visible = False
        'End If

        reservationButtonToDisplay()

        TimerToRefreshClock.Stop()

    End Sub

    Private Sub GunaButtonListePetitDejeuner_Click(sender As Object, e As EventArgs) Handles GunaButtonListePetitDejeuner.Click
        Dim datePetitDejeuner As Date = GunaDateTimePickerReportsDate.Value.ToShortDateString()
        Functions.listeDesPetitsDejeuner(datePetitDejeuner)
    End Sub

    Private Sub TabControlListeDesDocumentsFacturesEtReglement_SelectedIndexChanged(sender As Object, e As EventArgs) Handles TabControlListeDesDocumentsFacturesEtReglement.SelectedIndexChanged

        GunaDataGridViewDesFactures.Columns.Clear()
        'GunaGroupBoxStatistiques
        GunaDataGridViewListeDesReglement.Columns.Clear()

    End Sub

    Private Sub GunaButton12_Click(sender As Object, e As EventArgs) Handles GunaButtonRapportDesVentes.Click
        RapportFacturesForm.Close()
        GlobalVariable.DocumentToGenerate = "JOURNAL DES VENTES" 'CUMUL JOURNALIER
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True
    End Sub

    'RAPPORT DE LA DST
    Private Sub GunaButtonRapportDSt_Click(sender As Object, e As EventArgs) Handles GunaButtonRapportDSt.Click


        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelRapport.Text = "RAPPORT DST"
        Else
            GunaLabelRapport.Text = "DST REPORT"
        End If

        GlobalVariable.DocumentToGenerate = "rapport dst"
        TabControlRapport.SelectedIndex = 3
    End Sub

    'GESTION DES INSTRUCTIONS DE FACTURATION
    Private Sub GunaCheckBoxPDJFact_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxPDJFact.CheckedChanged

        If GunaCheckBoxPDJFact.Checked Then
            GunaTextBoxPDJInstruc.Visible = True
        Else
            GunaTextBoxPDJInstruc.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBoxBoisson_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxBoisson.CheckedChanged

        If GunaCheckBoxBoisson.Checked Then
            GunaTextBoxBoissonFact.Visible = True
        Else
            GunaTextBoxBoissonFact.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBoxNavette_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxNavette.CheckedChanged

        If GunaCheckBoxNavette.Checked Then
            GunaTextBoxNavetteVal.Visible = True
        Else
            GunaTextBoxNavetteVal.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBoxDinner_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxDinner.CheckedChanged

        If GunaCheckBoxDinner.Checked Then
            GunaTextBoxDinnerInstrucfact.Visible = True
        Else
            GunaTextBoxDinnerInstrucfact.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBoxBlanchisserieFact_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxBlanchisserieFact.CheckedChanged

        If GunaCheckBoxBlanchisserieFact.Checked Then
            GunaTextBoxBlanchFact.Visible = True
        Else
            GunaTextBoxBlanchFact.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBoxSalleConfFact_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxSalleConfFact.CheckedChanged

        If GunaCheckBoxSalleConfFact.Checked Then
            GunaTextBoxSalleConfFact.Visible = True
        Else
            GunaTextBoxSalleConfFact.Visible = False
        End If

    End Sub

    Private Sub resaParTypeOuSource(ByVal NATURE As String)

        If NATURE = "source" Then

        ElseIf NATURE = "type" Then

        End If

        Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reservation WHERE  TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
        'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As DataTable

        adapter.Fill(table)

        Dim query1 As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE  TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
        command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
        'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

        Dim adapter1 As New MySqlDataAdapter(command1)
        Dim table1 As New DataTable()
        adapter1.Fill(table1)

        table.Merge(table1)

    End Sub

    Private Sub autoLoadSourceResaRapport()

        'Loading other 'article families cureently called article type into a combobox
        Dim existQuery As String = "SELECT * From source_reservation ORDER BY SOURCE_RESERVATION ASC"

        Dim command As New MySqlCommand(existQuery, GlobalVariable.connect)

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()
        adapter.Fill(table)

        If table.Rows.Count > 0 Then

            GunaComboBoxSourceResaRapport.DataSource = table

            GunaComboBoxSourceResaRapport.ValueMember = "CODE_SOURCE_RESERVATION"
            GunaComboBoxSourceResaRapport.DisplayMember = "SOURCE_RESERVATION"

        End If

    End Sub

    Private Sub GunaButtonResaParSource_Click(sender As Object, e As EventArgs) Handles GunaButtonResaParSource.Click

        GunaLabelRapport.Text = "RESERVATION PAR SOURCE"

        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        GlobalVariable.DocumentToGenerate = "source"

        autoLoadSourceResaRapport()

        TabControlRapport.SelectedIndex = 3

        GunaDataGridViewRapportDST.Visible = True

        GunaButtonAfficherDst.Visible = False
        GunaButtonImpressionPourDST.Visible = True

    End Sub

    Private Sub GunaButtonResaParTypeResa_Click(sender As Object, e As EventArgs) Handles GunaButtonResaParTypeResa.Click

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelRapport.Text = "RESERVATION PAR TYPE"
        Else
            GunaLabelRapport.Text = "RESERVATIONS BASED ON TYPE"
        End If

        TabControlRapport.SelectedIndex = 3
        GlobalVariable.DocumentToGenerate = "type"
        GunaDataGridViewRapportDST.Visible = False

        GunaButtonAfficherDst.Visible = False
        GunaButtonImpressionPourDST.Visible = True
    End Sub

    Private Sub GunaButtonEvenements_Click(sender As Object, e As EventArgs) Handles GunaButtonEvenements.Click
        GunaLabelRapport.Text = "LISTE DES EVENEMENTS"

        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        TabControlRapport.SelectedIndex = 3
        GlobalVariable.DocumentToGenerate = "evenements"
    End Sub

    'DETAILS DES FACTURES DE DOCUMENTS

    Private Sub GunaDataGridViewDesFactures_CellDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewDesFactures.CellDoubleClick

        GunaDataGridViewDetailsFacture.Columns.Clear()

        If e.RowIndex >= 0 Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewDesFactures.Rows(e.RowIndex)

            Dim CODE_FACTURE As String = row.Cells("CODE").Value.ToString

            DetailDeFacture(CODE_FACTURE)

            GunaTextBoxFactureDeDetail.Text = CODE_FACTURE

            TabControlListeDesDocumentsFacturesEtReglement.SelectedIndex = 2

        End If

    End Sub

    Structure SituationFacture

        Dim dateOperation
        Dim libelleOperation
        Dim Debit
        Dim quantite

    End Structure

    '--------------------------------------------------------------------------------------
    Public Sub DetailDeFacture(ByVal CODE_FACTURE As String)

        'Dim query As String = "SELECT CODE_FACTURE, DATE_FACTURE, LIBELLE_FACTURE, MONTANT_TTC FROM ligne_facture WHERE CODE_FACTURE = @CODE_FACTURE AND ETAT_FACTURE = 1 ORDER BY DATE_FACTURE ASC"
        Dim query As String = "SELECT DATE_FACTURE AS DATE, LIBELLE_FACTURE as 'LIBELLE' , QUANTITE , MONTANT_TTC as 'MONTANT'FROM ligne_facture WHERE CODE_FACTURE = @CODE_FACTURE AND ETAT_FACTURE = 1 ORDER BY DATE_FACTURE ASC"
        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@CODE_FACTURE", MySqlDbType.VarChar).Value = CODE_FACTURE

        Dim adapter As New MySqlDataAdapter(command)
        Dim tableFacture As New DataTable()

        adapter.Fill(tableFacture)

        'Enfin on insere le tout dans notre datagrid
        If (tableFacture.Rows.Count > 0) Then

            GunaDataGridViewDetailsFacture.Columns.Clear()

            GunaDataGridViewDetailsFacture.DataSource = tableFacture

            GunaDataGridViewDetailsFacture.Columns(3).DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewDetailsFacture.Columns(3).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

            'Sorting the elements of situation client
            'GunaDataGridViewDetailsFactures.Sort(GunaDataGridViewDetailsFactures.Columns(1), ListSortDirection.Descending)

        End If

    End Sub

    'IMPRESSION FROM DETAILS
    Private Sub GunaButtonPrintFromDetails_Click(sender As Object, e As EventArgs) Handles GunaButtonPrintFromDetails.Click

        GlobalVariable.DocumentToGenerate = "facture"

        If GunaDataGridViewDetailsFacture.Rows.Count > 0 Then

            Functions.DocumentToPrint(GunaTextBoxFactureDeDetail.Text, "lign_facture", "CODE_FACTURE", GlobalVariable.codeClientToUpdate, GunaLabelNumReservation.Text)

        End If

    End Sub

    'DETAILS DE LA PRISE EN CHARGES

    Private Sub GunaCheckBoxGratuitee_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxGratuitee.CheckedChanged

        If GunaCheckBoxGratuitee.Checked Then
            GunaCheckBoxGratuiteInfo.Checked = True
            TabControlInfoClientSup.SelectedIndex = 3
        Else
            GunaCheckBoxGratuiteInfo.Checked = False
            TabControlInfoClientSup.SelectedIndex = 0
        End If

    End Sub


    Private Sub GunaCheckBoxGratuitee_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxGratuitee.Click

        If GunaCheckBoxGratuitee.Checked Then

            If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows.Count > 0 Then

                If GlobalVariable.DroitAccesDeUtilisateurConnect.Rows(0)("GRATUITEE_HEBERGEMENT") = 1 Then

                    GunaCheckBoxGratuiteInfo.Checked = True
                    TabControlInfoClientSup.SelectedIndex = 3

                Else

                    GunaCheckBoxGratuitee.Checked = False

                    If GlobalVariable.actualLanguageValue = 1 Then
                        MessageBox.Show("Vous n'avez pas le droit necessaire pour effectuer une gratuitée", "Gestion de Gratuitée", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                    Else
                        MessageBox.Show("You d'ont have the necessary right to make it free", "Free", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                    End If

                End If

            Else
                GunaCheckBoxGratuiteInfo.Checked = False
            End If

        Else
            GunaCheckBoxGratuiteInfo.Checked = False
            TabControlInfoClientSup.SelectedIndex = 0
        End If


    End Sub



    Private Sub GunaCheckBoxGratuiteInfo_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxGratuiteInfo.CheckedChanged

        If GunaCheckBoxGratuiteInfo.Checked Then

            GunaLabelQuthoriseePar.Visible = True
            GunaTextBoxAuthoriseePar.Visible = True
            GunaLabelRemarque.Visible = True
            GunaTextBoxRemarque.Visible = True

        Else

            GunaTextBoxMontantAccorde.Text = GunaTextBoxpPrixAffiche.Text
            GunaLabelCodeTarif.Visible = False
            GunaComboBoxCodeTarif.Visible = False
            GunaLabelQuthoriseePar.Visible = False
            GunaTextBoxAuthoriseePar.Visible = False
            GunaLabelRemarque.Visible = False
            GunaTextBoxRemarque.Visible = False

            GunaTextBoxAuthoriseePar.Clear()
            GunaTextBoxRemarque.Clear()

        End If

    End Sub

    Private Sub GunaCheckBoxDejeuner_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxDejeuner.CheckedChanged

        If GunaCheckBoxDejeuner.Checked Then
            GunaTextBoxDejeuener.Visible = True
        Else
            GunaTextBoxDejeuener.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBoxLogement_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxLogement.CheckedChanged

        If GunaCheckBoxLogement.Checked Then
            GunaTextBoxLogement.Visible = True
        Else
            GunaTextBoxLogement.Visible = False
        End If

    End Sub

    Private Sub gestionDelaPriseEnChargeDeLaReservation(Optional ByVal CODE_RESERVATION As String = "")

        If Not Trim(CODE_RESERVATION) = "" Then 'SI LE CODE DE RESA EXISTE

            'MessageBox.Show(CODE_RESERVATION)

            'AFFICHAGE DES INFORMATION DE PRISSE EN CHARGE 
            'MAIS AVANT, 
            'ON RECHERCHE SI LA RESA EST INSCRITE DANS LA TABLE DES GRATUITEES
            Dim resaPriseEnCharge As DataTable = Functions.getElementByCode(CODE_RESERVATION, "prise_en_charge_resa", "CODE_RESERVATION")

            If resaPriseEnCharge.Rows.Count > 0 Then
                'SI OUI
                GunaCheckBoxLogement.Checked = True
                GunaTextBoxLogement.Text = Format(resaPriseEnCharge.Rows(0)("LOGEMENT"), "#,##0")

                GunaCheckBoxSalleConfFact.Checked = True
                GunaTextBoxSalleConfFact.Text = Format(resaPriseEnCharge.Rows(0)("SALLE_CONFERENCE"), "#,##0")

                GunaCheckBoxDejeuner.Checked = True
                GunaTextBoxDejeuener.Text = Format(resaPriseEnCharge.Rows(0)("DEJEUNER"), "#,##0")

                GunaCheckBoxDinner.Checked = True
                GunaTextBoxDinnerInstrucfact.Text = Format(resaPriseEnCharge.Rows(0)("DINER"), "#,##0")

                GunaCheckBoxPDJFact.Checked = True
                GunaTextBoxPDJInstruc.Text = Format(resaPriseEnCharge.Rows(0)("PETIT_DEJEUNER"), "#,##0")

                GunaCheckBoxBoisson.Checked = True
                GunaTextBoxBoissonFact.Text = Format(resaPriseEnCharge.Rows(0)("BOISSONS"), "#,##0")

                GunaCheckBoxNavette.Checked = True
                GunaTextBoxNavetteVal.Text = Format(resaPriseEnCharge.Rows(0)("NAVETTE"), "#,##0")

                GunaCheckBoxBlanchisserieFact.Checked = True
                GunaTextBoxBlanchFact.Text = Format(resaPriseEnCharge.Rows(0)("BLANCHISSERIE"), "#,##0")

            End If

        Else

            'INSERTION DES INFORMATIONS DE PRISSE EN CHARGE 

            If GunaTextBoxLogement.Text = "" Then
                GunaTextBoxLogement.Text = 0
            End If

            If GunaTextBoxSalleConfFact.Text = "" Then
                GunaTextBoxSalleConfFact.Text = 0
            End If

            If GunaTextBoxDejeuener.Text = "" Then
                GunaTextBoxDejeuener.Text = 0
            End If

            If GunaTextBoxDinnerInstrucfact.Text = "" Then
                GunaTextBoxDinnerInstrucfact.Text = 0
            End If

            If GunaTextBoxPDJInstruc.Text = "" Then
                GunaTextBoxPDJInstruc.Text = 0
            End If

            If GunaTextBoxBoissonFact.Text = "" Then
                GunaTextBoxBoissonFact.Text = 0
            End If

            If GunaTextBoxNavetteVal.Text = "" Then
                GunaTextBoxNavetteVal.Text = 0
            End If

            If GunaTextBoxBlanchFact.Text = "" Then
                GunaTextBoxBlanchFact.Text = 0
            End If

            If Not Trim(GunaTextBoxBC.Text) = "" Then

                Dim PETIT_DEJEUNER As Double = Double.Parse(GunaTextBoxPDJInstruc.Text)
                Dim DEJEUNER As Double = Double.Parse(GunaTextBoxDejeuener.Text)
                Dim DINER As Double = Double.Parse(GunaTextBoxDinnerInstrucfact.Text)
                Dim LOGEMENT As Double = Double.Parse(GunaTextBoxLogement.Text)
                Dim BOISSONS As Double = Double.Parse(GunaTextBoxBoissonFact.Text)
                Dim NAVETTE As Double = Double.Parse(GunaTextBoxNavetteVal.Text)
                Dim BLANCHISSERIE As Double = Double.Parse(GunaTextBoxBlanchFact.Text)
                Dim SALLE_CONFERENCE As Double = Double.Parse(GunaTextBoxSalleConfFact.Text)
                Dim CODE_RESERVATION_NEW As String = GunaLabelNumReservation.Text

                Dim AUTHORISATION As String = ""
                Dim REMARQUE As String = ""

                Dim DATE_PRISE_EN_CHARGE As Date = GlobalVariable.DateDeTravail
                Dim TABLE As String = "prise_en_charge_resa"

                Dim reservation As New Reservation()

                'PERMET LA MISE A JOURS EN CAS D'EXITENCE SINON NOUVELLE AJOUT
                Functions.DeleteElementByCode(CODE_RESERVATION_NEW, TABLE, "CODE_RESERVATION")

                reservation.insertionInformationPriseEnChargeResa(PETIT_DEJEUNER, DEJEUNER, DINER, LOGEMENT, BOISSONS, NAVETTE, BLANCHISSERIE, SALLE_CONFERENCE, CODE_RESERVATION_NEW, DATE_PRISE_EN_CHARGE, TABLE, AUTHORISATION, REMARQUE)

                'EFFACEMENT DES CHAMPS APRES INSERTION
                nettoyageDesInfoPriseEnCharge()

            End If

        End If

    End Sub

    Public Sub nettoyageDesInfoPriseEnCharge()

        GunaTextBoxLogement.Text = 0
        GunaTextBoxSalleConfFact.Text = 0
        GunaTextBoxDejeuener.Text = 0
        GunaTextBoxDinnerInstrucfact.Text = 0
        GunaTextBoxPDJInstruc.Text = 0
        GunaTextBoxBoissonFact.Text = 0
        GunaTextBoxNavetteVal.Text = 0
        GunaTextBoxBlanchFact.Text = 0

        GunaCheckBoxLogement.Checked = False
        GunaCheckBoxDejeuner.Checked = False
        GunaCheckBoxPDJFact.Checked = False
        GunaCheckBoxDinner.Checked = False
        GunaCheckBoxBoisson.Checked = False
        GunaCheckBoxNavette.Checked = False
        GunaCheckBoxBlanchisserieFact.Checked = False
        GunaCheckBoxSalleConfFact.Checked = False


    End Sub

    Public Sub nettoyageDesGratuitees()

        GunaTextBoxLogementGrat.Text = 0
        GunaTextBoxSalleConfGrat.Text = 0
        GunaTextBoxDejeunerGrat.Text = 0
        GunaTextBoxDinerGrat.Text = 0
        GunaTextBoxPDJGrat.Text = 0
        GunaTextBoxBoissonGrat.Text = 0
        GunaTextBoxNavetteGrat.Text = 0
        GunaTextBoxBlanchiGrat.Text = 0

        GunaTextBoxAuthoriseePar.Clear()
        GunaTextBoxRemarque.Clear()

        GunaCheckBoxlogementGrat.Checked = False

        GunaCheckBox8.Checked = False
        GunaCheckBox6.Checked = False
        GunaCheckBox4.Checked = False
        GunaCheckBox7.Checked = False
        GunaCheckBox5.Checked = False
        GunaCheckBox3.Checked = False
        GunaCheckBox1.Checked = False

        GunaCheckBoxGratuitee.Checked = False

    End Sub

    Private Sub GunaCheckBox2_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxlogementGrat.CheckedChanged
        'LOGEMENT
        If GunaCheckBoxlogementGrat.Checked Then
            GunaTextBoxLogementGrat.Visible = True
        Else
            GunaTextBoxLogementGrat.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBox8_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBox8.CheckedChanged
        'PDJ
        If GunaCheckBox8.Checked Then
            GunaTextBoxPDJGrat.Visible = True
        Else
            GunaTextBoxPDJGrat.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBox6_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBox6.CheckedChanged
        'DEJEUNER
        If GunaCheckBox6.Checked Then
            GunaTextBoxDejeunerGrat.Visible = True
        Else
            GunaTextBoxDejeunerGrat.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBox4_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBox4.CheckedChanged

        'DINER
        If GunaCheckBox4.Checked Then
            GunaTextBoxDinerGrat.Visible = True
        Else
            GunaTextBoxDinerGrat.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBox7_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBox7.CheckedChanged
        'BOISSONS
        If GunaCheckBox7.Checked Then
            GunaTextBoxBoissonGrat.Visible = True
        Else
            GunaTextBoxBoissonGrat.Visible = False
        End If
    End Sub

    Private Sub GunaCheckBox5_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBox5.CheckedChanged
        'NAVETTE
        If GunaCheckBox5.Checked Then
            GunaTextBoxNavetteGrat.Visible = True
        Else
            GunaTextBoxNavetteGrat.Visible = False
        End If
    End Sub

    Private Sub GunaCheckBox3_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBox3.CheckedChanged
        'BLANCHISSERIE
        If GunaCheckBox3.Checked Then
            GunaTextBoxBlanchiGrat.Visible = True
        Else
            GunaTextBoxBlanchiGrat.Visible = False
        End If

    End Sub

    Private Sub GunaCheckBox1_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBox1.CheckedChanged
        'SALLE DE CONFERENCE
        If GunaCheckBox1.Checked Then
            GunaTextBoxSalleConfGrat.Visible = True
        Else
            GunaTextBoxSalleConfGrat.Visible = False
        End If

    End Sub

    'DETAILS DES GRATUITES

    Private Sub gestionDelaGratuiteeDeLaReservation(Optional ByVal CODE_RESERVATION As String = "")

        'AFFICHAGE OU MODIFICATION DES ELEMENTS PRIS EN CHARGES

        If Not Trim(CODE_RESERVATION) = "" Then 'SI LE CODE DE RESA EXISTE

            '1- AFFICHAGE DES ELEMENTS PRIS EN CHARGES

            'AFFICHAGE DES INFORMATION DE PRISSE EN CHARGE 
            'MAIS AVANT, 
            'ON RECHERCHE SI LA RESA EST INSCRITE DANS LA TABLE DES GRATUITEES
            Dim resaGratuitee As DataTable = Functions.getElementByCode(CODE_RESERVATION, "gratuitee_de_resa", "CODE_RESERVATION")

            If resaGratuitee.Rows.Count > 0 Then
                'SI OUI
                If resaGratuitee.Rows(0)("ETAT") = 1 Then
                    GunaCheckBoxGratuitee.Checked = True
                Else
                    GunaCheckBoxGratuitee.Checked = False
                End If

                If resaGratuitee.Rows(0)("ETAT") = 1 Then

                    GunaCheckBoxlogementGrat.Checked = True
                    GunaTextBoxLogementGrat.Text = Format(resaGratuitee.Rows(0)("LOGEMENT"), "#,##0")

                    GunaCheckBox1.Checked = True
                    GunaTextBoxSalleConfGrat.Text = Format(resaGratuitee.Rows(0)("SALLE_CONFERENCE"), "#,##0")

                    GunaCheckBox6.Checked = True
                    GunaTextBoxDejeunerGrat.Text = Format(resaGratuitee.Rows(0)("DEJEUNER"), "#,##0")

                    GunaCheckBox4.Checked = True
                    GunaTextBoxDinerGrat.Text = Format(resaGratuitee.Rows(0)("DINER"), "#,##0")

                    GunaCheckBox8.Checked = True
                    GunaTextBoxPDJGrat.Text = Format(resaGratuitee.Rows(0)("PETIT_DEJEUNER"), "#,##0")

                    GunaCheckBox7.Checked = True
                    GunaTextBoxBoissonGrat.Text = Format(resaGratuitee.Rows(0)("BOISSONS"), "#,##0")

                    GunaCheckBox5.Checked = True
                    GunaTextBoxNavetteGrat.Text = Format(resaGratuitee.Rows(0)("NAVETTE"), "#,##0")

                    GunaCheckBox3.Checked = True
                    GunaTextBoxBlanchiGrat.Text = Format(resaGratuitee.Rows(0)("BLANCHISSERIE"), "#,##0")

                    GunaTextBoxAuthoriseePar.Text = resaGratuitee.Rows(0)("AUTHORISATION")

                    GunaTextBoxRemarque.Text = resaGratuitee.Rows(0)("REMARQUE")

                    affectationDuPrixDelaGratuiteeDeLaReservation()

                End If

            End If

        Else

            '2- INSERTION DES MONTANTS DES ELEMENTS PRIS EN CHARGES

            'INSERTION DES INFORMATIONS DE PRISSE EN CHARGE 
            If GunaTextBoxLogementGrat.Text = "" Then
                GunaTextBoxLogementGrat.Text = 0
            End If

            If GunaTextBoxSalleConfGrat.Text = "" Then
                GunaTextBoxSalleConfGrat.Text = 0
            End If

            If GunaTextBoxDejeunerGrat.Text = "" Then
                GunaTextBoxDejeunerGrat.Text = 0
            End If

            If GunaTextBoxDinerGrat.Text = "" Then
                GunaTextBoxDinerGrat.Text = 0
            End If

            If GunaTextBoxPDJGrat.Text = "" Then
                GunaTextBoxPDJGrat.Text = 0
            End If

            If GunaTextBoxBoissonGrat.Text = "" Then
                GunaTextBoxBoissonGrat.Text = 0
            End If

            If GunaTextBoxNavetteGrat.Text = "" Then
                GunaTextBoxNavetteGrat.Text = 0
            End If

            If GunaTextBoxBlanchiGrat.Text = "" Then
                GunaTextBoxBlanchiGrat.Text = 0
            End If

            Dim ETAT As Integer = 0

            If GunaCheckBoxGratuitee.Checked Then

                ETAT = 1

                Dim PETIT_DEJEUNER As Double = Double.Parse(GunaTextBoxPDJGrat.Text)
                Dim DEJEUNER As Double = Double.Parse(GunaTextBoxDejeunerGrat.Text)
                Dim DINER As Double = Double.Parse(GunaTextBoxDinerGrat.Text)
                Dim LOGEMENT As Double = Double.Parse(GunaTextBoxLogementGrat.Text)
                Dim BOISSONS As Double = Double.Parse(GunaTextBoxBoissonGrat.Text)
                Dim NAVETTE As Double = Double.Parse(GunaTextBoxNavetteGrat.Text)
                Dim BLANCHISSERIE As Double = Double.Parse(GunaTextBoxBlanchiGrat.Text)
                Dim SALLE_CONFERENCE As Double = Double.Parse(GunaTextBoxSalleConfGrat.Text)
                Dim CODE_RESERVATION_NEW As String = GunaLabelNumReservation.Text

                Dim AUTHORISATION As String = GunaTextBoxAuthoriseePar.Text
                Dim REMARQUE As String = GunaTextBoxRemarque.Text

                Dim DATE_PRISE_EN_CHARGE As Date = GlobalVariable.DateDeTravail
                Dim TABLE As String = "gratuitee_de_resa" ' CONTIENT LE MONTANT DES ELEMETS PRIS EN CHARGES

                Dim reservation As New Reservation()

                'PERMET LA MISE A JOURS EN CAS D'EXITENCE SINON NOUVELLE AJOUT
                Functions.DeleteElementByCode(CODE_RESERVATION_NEW, TABLE, "CODE_RESERVATION")

                reservation.insertionInformationPriseEnChargeResa(PETIT_DEJEUNER, DEJEUNER, DINER, LOGEMENT, BOISSONS, NAVETTE, BLANCHISSERIE, SALLE_CONFERENCE, CODE_RESERVATION_NEW, DATE_PRISE_EN_CHARGE, TABLE, AUTHORISATION, REMARQUE, ETAT)

                'EFFACEMENT DES CHAMPS APRES INSERTION
                nettoyageDesGratuitees()

            End If

            Functions.updateOfFields("gratuitee_de_resa", "ETAT", ETAT, "CODE_RESERVATION", CODE_RESERVATION, 1)

        End If

    End Sub

    Private Sub affectationDuPrixDelaGratuiteeDeLaReservation()

        If GunaCheckBoxGratuitee.Checked Then

            Dim tarif As DataTable = Functions.getElementByCode("GRATUITEE", "tarif", "LIBELLE_TARIF")

            If tarif.Rows.Count > 0 Then

                If Not Trim(GunaTextBoxAuthoriseePar.Text).Equals("") Then

                    GunaComboBoxCodeTarif.DataSource = tarif
                    GunaComboBoxCodeTarif.ValueMember = "CODE_TARIF"
                    GunaComboBoxCodeTarif.DisplayMember = "LIBELLE_TARIF"

                    GunaComboBoxCodeTarif.SelectedValue = tarif.Rows(0)("CODE_TARIF")

                    GunaComboBoxCodeTarif.Visible = True
                    GunaLabelCodeTarif.Visible = True
                    GunaTextBoxMontantAccorde.Text = 0

                Else
                    GunaTextBoxMontantAccorde.Text = GunaTextBoxpPrixAffiche.Text
                    GunaComboBoxCodeTarif.Visible = False
                    GunaLabelCodeTarif.Visible = False
                End If

            End If

        Else

        End If

    End Sub

    Private Sub remplissageDelaGratuitee()

        If GunaCheckBoxGratuitee.Checked Then

            Dim tarif As DataTable = Functions.getElementByCode("GRATUITEE", "tarif", "LIBELLE_TARIF")

            If tarif.Rows.Count > 0 Then

                If Not Trim(GunaTextBoxAuthoriseePar.Text).Equals("") Then

                    GunaComboBoxCodeTarif.DataSource = tarif
                    GunaComboBoxCodeTarif.ValueMember = "CODE_TARIF"
                    GunaComboBoxCodeTarif.DisplayMember = "LIBELLE_TARIF"

                    GunaComboBoxCodeTarif.SelectedValue = tarif.Rows(0)("CODE_TARIF")

                    GunaComboBoxCodeTarif.Visible = True
                    GunaLabelCodeTarif.Visible = True
                    GunaTextBoxMontantAccorde.Text = 0

                Else
                    GunaTextBoxMontantAccorde.Text = GunaTextBoxpPrixAffiche.Text
                    GunaComboBoxCodeTarif.Visible = False
                    GunaLabelCodeTarif.Visible = False
                End If

            End If

        Else

        End If

    End Sub

    'AFFICHAGE DES INFORMATIONS DE GRATUITEES
    Private Sub GunaTextBoxAuthoriseePar_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxAuthoriseePar.TextChanged
        affectationDuPrixDelaGratuiteeDeLaReservation()
    End Sub

    Private Sub CUISINEToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles CUISINEToolStripMenuItem.Click

        Me.Cursor = Cursors.WaitCursor

        MainWindowCuisineForm.Show()
        ArticleForm.Show()

        ArticleForm.Location = New Point(90, 110)
        ArticleForm.TopMost = True

        Me.Close()

        Me.Cursor = Cursors.Default

    End Sub

    Private Sub verificationDesSoldes(ByVal DateDebut As Date)

        Dim query4 As String = "SELECT CODE_RESERVATION AS 'RESERVATION', CHAMBRE_ID AS 'CHAMBRE', reserve_conf.NOM_CLIENT As 'NOM & PRENOM', SOLDE_RESERVATION AS 'SOLDE', DATE_ENTTRE As 'DATE ARRIVEE', DATE_SORTIE As 'DATE DEPART', main_courante_journaliere.MONTANT_ACCORDE AS 'TARIF ACCORDE', source_reservation.SOURCE_RESERVATION AS SOURCE  FROM reserve_conf, source_reservation, main_courante_journaliere WHERE DATE_MAIN_COURANTE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_MAIN_COURANTE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND main_courante_journaliere.NUM_RESERVATION = reserve_conf.CODE_RESERVATION  AND DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND reserve_conf.TYPE=@TYPE AND reserve_conf.SOURCE_RESERVATION = source_reservation.CODE_SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

        Dim command4 As New MySqlCommand(query4, GlobalVariable.connect)
        command4.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

        Dim adapter4 As New MySqlDataAdapter(command4)
        Dim tableArrivee As New DataTable()
        adapter4.Fill(tableArrivee)

        If GunaDataGridViewRapportDST.Rows.Count > 0 Then
            GunaDataGridViewRapportDST.Rows.Clear()
        Else

            If GunaDataGridViewRapportDST.Columns.Count > 0 Then
                GunaDataGridViewRapportDST.Columns.Clear()
            End If
        End If

        GunaDataGridViewRapportDST.DataSource = Nothing

        GunaDataGridViewRapportDST.Columns.Clear()

        If GlobalVariable.actualLanguageValue = 1 Then

            GunaDataGridViewRapportDST.Columns.Add("CHAMBRE", "CHAMBRE")
            GunaDataGridViewRapportDST.Columns.Add("NOM", "NOM")
            GunaDataGridViewRapportDST.Columns.Add("ARRIVEE", "ARRIVEE")
            GunaDataGridViewRapportDST.Columns.Add("DEPART", "DEPART")
            GunaDataGridViewRapportDST.Columns.Add("NUITEES", "NUITEES")
            GunaDataGridViewRapportDST.Columns.Add("TARIF_ACCORDE", "TARIF ACCORDE")
            GunaDataGridViewRapportDST.Columns.Add("DEBIT", "DEBIT")
            GunaDataGridViewRapportDST.Columns.Add("CREDIT", "CREDIT")
            GunaDataGridViewRapportDST.Columns.Add("SOLDE", "SOLDE")
            GunaDataGridViewRapportDST.Columns.Add("SOURCE", "SOURCE")

        Else

            GunaDataGridViewRapportDST.Columns.Add("ROOM", "ROOM")
            GunaDataGridViewRapportDST.Columns.Add("NAMES", "NAMES")
            GunaDataGridViewRapportDST.Columns.Add("ARRIVAL", "ARRIVAL")
            GunaDataGridViewRapportDST.Columns.Add("DEPART", "DEPART")
            GunaDataGridViewRapportDST.Columns.Add("NIGHTS", "NIGHTS")
            GunaDataGridViewRapportDST.Columns.Add("GRANTED_AMOUNT", "GRANTED AMOUNT")
            GunaDataGridViewRapportDST.Columns.Add("DEBIT", "DEBIT")
            GunaDataGridViewRapportDST.Columns.Add("CREDIT", "CREDIT")
            GunaDataGridViewRapportDST.Columns.Add("BALANCE", "BALANCE")
            GunaDataGridViewRapportDST.Columns.Add("SOURCE", "SOURCE")

        End If


        Dim NUITEE As Integer = 0
        Dim DEBIT As Double = 0
        Dim CREDIT As Double = 0
        Dim ARRIVE As Date
        Dim DEPART As Date
        Dim CODE_RESERVATION As String = ""

        Dim SOLDE As Double = 0

        If tableArrivee.Rows.Count > 0 Then

            For j = 0 To tableArrivee.Rows.Count - 1

                CODE_RESERVATION = tableArrivee.Rows(j)("RESERVATION")
                ARRIVE = CDate(tableArrivee.Rows(j)("DATE ARRIVEE")).ToShortDateString
                DEPART = CDate(tableArrivee.Rows(j)("DATE DEPART")).ToShortDateString
                'CType((GunaDateTimePickerDepart.Value - GunaDateTimePickerArrivee.Value).TotalDays, Int32)
                NUITEE = CType((DEPART - ARRIVE).TotalDays, Int32)

                Dim query04 As String = "SELECT * FROM ligne_facture WHERE DATE_FACTURE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND  DATE_FACTURE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND CODE_RESERVATION = @CODE_RESERVATION"

                Dim command04 As New MySqlCommand(query04, GlobalVariable.connect)
                command04.Parameters.Add("@CODE_RESERVATION", MySqlDbType.VarChar).Value = CODE_RESERVATION

                Dim adapter04 As New MySqlDataAdapter(command04)
                Dim infoSupConsoResa As New DataTable()
                adapter04.Fill(infoSupConsoResa)

                DEBIT = 0
                For k = 0 To infoSupConsoResa.Rows.Count - 1
                    DEBIT += infoSupConsoResa.Rows(k)("MONTANT_TTC")
                Next

                Dim query004 As String = "SELECT * FROM reglement WHERE DATE_REGLEMENT <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_REGLEMENT >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND CODE_RESERVATION =@CODE_RESERVATION"

                Dim command004 As New MySqlCommand(query004, GlobalVariable.connect)
                command004.Parameters.Add("@CODE_RESERVATION", MySqlDbType.VarChar).Value = CODE_RESERVATION

                Dim adapter004 As New MySqlDataAdapter(command004)
                Dim infoSupRegResa As New DataTable()
                adapter004.Fill(infoSupRegResa)

                CREDIT = 0
                For k = 0 To infoSupRegResa.Rows.Count - 1
                    CREDIT += infoSupRegResa.Rows(k)("MONTANT_VERSE")
                Next

                SOLDE = CREDIT - DEBIT
                GunaDataGridViewRapportDST.Rows.Add(tableArrivee.Rows(j)("CHAMBRE"), tableArrivee.Rows(j)("NOM & PRENOM"), CDate(ARRIVE).ToShortDateString, CDate(DEPART).ToShortDateString, NUITEE, Format(tableArrivee.Rows(j)("TARIF ACCORDE"), "#,##0"), Format(DEBIT, "#,##0"), Format(CREDIT, "#,##0"), Format(tableArrivee.Rows(j)("SOLDE"), "#,##0"), tableArrivee.Rows(j)("SOURCE"))

            Next

            GunaButtonImpressionPourDST.Visible = True
        Else
            GunaButtonImpressionPourDST.Visible = False
        End If

    End Sub

    Private Sub GunaButtonEnChambre_Click_1(sender As Object, e As EventArgs) Handles GunaButtonEnChambre.Click

        Dim DateDebut As Date = GunaDateTimePickerDu.Value.ToShortDateString

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelRapport.Text = "VERIFICTION DES SOLDES"
        Else
            GunaLabelRapport.Text = "BALANCE VERIFICATION"
        End If

        GlobalVariable.DocumentToGenerate = "verification solde"
        TabControlRapport.SelectedIndex = 3

    End Sub

    Private Sub GunaButtonMatieres_Click(sender As Object, e As EventArgs) Handles GunaButtonMatieres.Click
        Dim MainWindow As New MainWindow()
        MainWindow.TabControlHbergement.SelectedIndex = 2
        GlobalVariable.typeArticle = "matiere"
        ArticleForm.TopMost() = True
        ArticleForm.Show()
    End Sub

    Private Sub GunaAdvenceButtonImpression_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonImpression.Click

        If GunaDataGridViewResaDashBoard.Rows.Count > 0 Then
            Impression.rapportDesReservationDuDashBoard(GunaLabel51.Text)
        Else
            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Aucune réservation à imprimer !!", "Impression des réservations", MessageBoxButtons.OK, MessageBoxIcon.Question)

            Else
                MessageBox.Show("No booking to print !!", "Print booking", MessageBoxButtons.OK, MessageBoxIcon.Question)

            End If



        End If

    End Sub

    Private Sub GunaButtonStatJournaliere_Click(sender As Object, e As EventArgs) Handles GunaButtonStatJournaliere.Click

        RapportFacturesForm.Close()

        GlobalVariable.DocumentToGenerate = "FICHE STATISTIQUE JOURNALIERE"

        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True

    End Sub

    Private Sub TabControlRapport_SelectedIndexChanged(sender As Object, e As EventArgs) Handles TabControlRapport.SelectedIndexChanged

        If TabControlRapport.SelectedIndex = 3 Then

            GunaDataGridViewRapportDST.Columns.Clear()

            If GlobalVariable.DocumentToGenerate = "source" Then

                GunaPanelSourceResa.Visible = True

            Else
                GunaPanelSourceResa.Visible = False
            End If

        End If

        GunaDateTimePickerDu.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerAu.Value = GlobalVariable.DateDeTravail

        If GlobalVariable.DocumentToGenerate = "source" Or GlobalVariable.DocumentToGenerate = "type" Then
            GunaButtonAfficherDst.Visible = False
            GunaButtonImpressionPourDST.Visible = True
        Else
            GunaButtonAfficherDst.Visible = True
            GunaButtonImpressionPourDST.Visible = False
        End If

        If GlobalVariable.DocumentToGenerate = "ecart de prix" Or GlobalVariable.DocumentToGenerate = "verification solde" Then
            GunaDateTimePickerAu.Enabled = False
        Else
            GunaDateTimePickerAu.Enabled = True
        End If

        If GlobalVariable.DocumentToGenerate = "reservations" Or GlobalVariable.DocumentToGenerate = "bloc notes" Then
            GunaComboBoxFiltres.Visible = True
        Else
            GunaComboBoxFiltres.Visible = False
        End If



    End Sub

    'RAPPORT DES ATTENDUES
    Private Sub GunaButton4_Click_1(sender As Object, e As EventArgs) Handles GunaButton4.Click
        GlobalVariable.DocumentToGenerate = "attendue"
        Functions.rapportDesArrivees()
    End Sub

    Private Sub ToolStripMenuItem124_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem124.Click
        CahierDeConsigneForm.Show()
    End Sub

    Private Sub GunaTextBoxNbrePersonne_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNbrePersonne.TextChanged

        If GlobalVariable.typeChambreOuSalle = "salle" Then

            GunaTextBox35.Text = GunaTextBoxNbrePersonne.Text
            GunaTextBox30.Text = GunaTextBoxNbrePersonne.Text
            GunaTextBox25.Text = GunaTextBoxNbrePersonne.Text
            GunaTextBox13.Text = GunaTextBoxNbrePersonne.Text
            GunaTextBoxQteGouter.Text = GunaTextBoxNbrePersonne.Text
            GunaTextBoxCocktail.Text = GunaTextBoxNbrePersonne.Text

        End If

    End Sub

    Private Sub TypeDévènementToolStripMenuItemEvent_Click(sender As Object, e As EventArgs) Handles TypeDévènementToolStripMenuItemEvent.Click

        EvenementForm.Show()
        EvenementForm.BringToFront()

        'TypeDévènementToolStripMenuItemEvent

    End Sub

    Private Sub GunaTextBoxMateriel_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxMateriel.TextChanged

        'Dim montantDeco As Double = 0

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")
        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub

    Private Sub GunaTextBoxAutres_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxAutres.TextChanged

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        'montanTotalDeLocationSalle(nombreDeJourTotal)
        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub

    Private Sub GunaCheckBoxVidOui_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxVidOui.CheckedChanged
        If GunaCheckBoxVidOui.Checked Then
            GunaCheckBoxVidNon.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBoxVidNon_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxVidNon.CheckedChanged
        If GunaCheckBoxVidNon.Checked Then
            GunaCheckBoxVidOui.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBoxSonoOui_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxSonoOui.CheckedChanged
        If GunaCheckBoxSonoOui.Checked Then
            GunaCheckBoxSonoNon.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBoxSonoNon_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxSonoNon.CheckedChanged
        If GunaCheckBoxSonoNon.Checked Then
            GunaCheckBoxSonoOui.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBoxCouvOui_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxCouvOui.CheckedChanged
        If GunaCheckBoxCouvOui.Checked Then
            GunaCheckBoxCouvNon.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBoxCouvNon_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxCouvNon.CheckedChanged
        If GunaCheckBoxCouvNon.Checked Then
            GunaCheckBoxCouvOui.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBoxTableOui_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxTableOui.CheckedChanged
        If GunaCheckBoxTableOui.Checked Then
            GunaCheckBoxTableNon.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBoxTableNon_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxTableNon.CheckedChanged
        If GunaCheckBoxTableNon.Checked Then
            GunaCheckBoxTableOui.Checked = False
        End If
    End Sub

    'CLOISONNEMENT
    Private Sub GunaCheckBox2_CheckedChanged_1(sender As Object, e As EventArgs) Handles GunaCheckBox2.CheckedChanged
        If GunaCheckBox2.Checked Then
            GunaCheckBox9.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBox9_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBox9.CheckedChanged
        If GunaCheckBox9.Checked Then
            GunaCheckBox2.Checked = False
        End If
    End Sub

    'AMENAGEMENT

    Private Sub GunaCheckBoxU_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxU.CheckedChanged

        If GunaCheckBoxU.Checked Then
            GunaCheckBoxEcole.Checked = False
            GunaCheckBoxTheatre.Checked = False
            GunaCheckBoxRectangle.Checked = False
            GunaCheckBoxCocktail.Checked = False
            GunaCheckBoxBanquet.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBoxEcole_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxEcole.CheckedChanged
        If GunaCheckBoxEcole.Checked Then
            GunaCheckBoxTheatre.Checked = False
            GunaCheckBoxRectangle.Checked = False
            GunaCheckBoxCocktail.Checked = False
            GunaCheckBoxBanquet.Checked = False
            GunaCheckBoxU.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBox12_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxTheatre.CheckedChanged
        If GunaCheckBoxTheatre.Checked Then
            GunaCheckBoxEcole.Checked = False
            GunaCheckBoxRectangle.Checked = False
            GunaCheckBoxCocktail.Checked = False
            GunaCheckBoxBanquet.Checked = False
            GunaCheckBoxU.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBox13_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxRectangle.CheckedChanged
        If GunaCheckBoxRectangle.Checked Then
            GunaCheckBoxTheatre.Checked = False
            GunaCheckBoxEcole.Checked = False
            GunaCheckBoxCocktail.Checked = False
            GunaCheckBoxBanquet.Checked = False
            GunaCheckBoxU.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBox14_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxCocktail.CheckedChanged
        If GunaCheckBoxCocktail.Checked Then
            GunaCheckBoxTheatre.Checked = False
            GunaCheckBoxRectangle.Checked = False
            GunaCheckBoxEcole.Checked = False
            GunaCheckBoxBanquet.Checked = False
            GunaCheckBoxU.Checked = False
        End If
    End Sub

    Private Sub GunaCheckBox15_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxBanquet.CheckedChanged
        If GunaCheckBoxBanquet.Checked Then
            GunaCheckBoxTheatre.Checked = False
            GunaCheckBoxRectangle.Checked = False
            GunaCheckBoxCocktail.Checked = False
            GunaCheckBoxEcole.Checked = False
            GunaCheckBoxU.Checked = False
        End If
    End Sub

    Private Sub GunaTextBoxPrixGouter_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxPrixGouter.TextChanged

        If Trim(GunaTextBoxPrixGouter.Text) = "" Then
            GunaTextBoxPrixGouter.Text = 0
        End If

        If Trim(GunaTextBoxQteGouter.Text) = "" Then
            GunaTextBoxQteGouter.Text = 0
        End If

        GunaTextBoxPrixTotalGouter.Text = Format(Double.Parse(GunaTextBoxPrixGouter.Text) * Integer.Parse(GunaTextBoxQteGouter.Text), "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")
        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub

    Private Sub GunaTextBoxCocktail_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxCocktail.TextChanged

        If Trim(GunaTextBoxCocktail.Text) = "" Then
            GunaTextBoxCocktail.Text = 0
        End If

        If Trim(GunaTextBoxPUCocktail.Text) = "" Then
            GunaTextBoxPUCocktail.Text = 0
        End If

        GunaTextBox7.Text = Format(Double.Parse(GunaTextBoxPUCocktail.Text) * Integer.Parse(GunaTextBoxCocktail.Text), "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")
        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub

    Private Sub GunaTextBox5_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxPUCocktail.TextChanged

        If Trim(GunaTextBoxCocktail.Text) = "" Then
            GunaTextBoxCocktail.Text = 0
        End If

        If Trim(GunaTextBoxPUCocktail.Text) = "" Then
            GunaTextBoxPUCocktail.Text = 0
        End If

        GunaTextBox7.Text = Format(Double.Parse(GunaTextBoxPUCocktail.Text) * Integer.Parse(GunaTextBoxCocktail.Text), "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        montanTotalDeLocationSalle(nombreDeJourTotal)

    End Sub

    Private Sub GunaTextBox60_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxMontantEauPetiteBouteille.TextChanged

        If Trim(GunaTextBoxMontantEauPetiteBouteille.Text) = "" Then
            GunaTextBoxMontantEauPetiteBouteille.Text = 0
        End If

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")
        montanTotalDeLocationSalle(nombreDeJourTotal)

    End Sub

    Private Sub GunaTextBox62_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox62.TextChanged
        If Trim(GunaTextBox62.Text) = "" Then
            GunaTextBox62.Text = 0
        End If

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

        montanTotalDeLocationSalle(nombreDeJourTotal)

    End Sub

    Private Sub GunaTextBox59_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox59.TextChanged
        If Trim(GunaTextBox59.Text) = "" Then
            GunaTextBox59.Text = 0
        End If

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

        montanTotalDeLocationSalle(nombreDeJourTotal)

    End Sub

    Private Sub GunaTextBox64_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox64.TextChanged
        If Trim(GunaTextBox64.Text) = "" Then
            GunaTextBox64.Text = 0
        End If

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        'GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

        montanTotalDeLocationSalle(nombreDeJourTotal)

    End Sub

    Private Sub GunaTextBox68_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox68.TextChanged
        If Trim(GunaTextBox68.Text) = "" Then
            GunaTextBox68.Text = 0
        End If

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub

    Private Sub GunaTextBox61_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox61.TextChanged
        If Trim(GunaTextBox61.Text) = "" Then
            GunaTextBox61.Text = 0
        End If

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub

    Private Sub GunaTextBox57_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox57.TextChanged
        If Trim(GunaTextBox57.Text) = "" Then
            GunaTextBox57.Text = 0
        End If

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub

    Private Sub GunaTextBoxDroitDeBouchon_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxDroitDeBouchon.TextChanged
        If Trim(GunaTextBoxDroitDeBouchon.Text) = "" Then
            GunaTextBoxDroitDeBouchon.Text = 0
        End If

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)

        montanTotalDeLocationSalle(nombreDeJourTotal)
    End Sub

    Private Sub GunaTextBoxGrandTotal_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxGrandTotal.TextChanged

        If GlobalVariable.typeChambreOuSalle = "salle" Then
            GunaTextBoxMontantGlobal.Text = GunaTextBoxGrandTotal.Text
        Else
            GunaTextBoxMontantGlobal.Text = 0
        End If

    End Sub

    '------------------------- GESTION DES DAY USES --------------------------------------------------------
    Private Sub GunaComboBoxHeureArrivee_Click(sender As Object, e As EventArgs) Handles GunaComboBoxHeureArrivee.Click


        If GlobalVariable.actualLanguageValue = 1 Then
            TimePickerForm.GunaLabelTitreHeure.Text = "HEURE D'ARRIVEE"

        Else
            TimePickerForm.GunaLabelTitreHeure.Text = "ARRIVAL TIME"

        End If

        TimePickerForm.Show()
        TimePickerForm.Location = New Point(165, 250)
        TimePickerForm.TopMost = True

    End Sub

    Private Sub GunaComboBoxHeureDepart_Click(sender As Object, e As EventArgs) Handles GunaComboBoxHeureDepart.Click

        If GlobalVariable.actualLanguageValue = 1 Then
            TimePickerForm.GunaLabelTitreHeure.Text = "HEURE DE DEPART"

        Else
            TimePickerForm.GunaLabelTitreHeure.Text = "DEPARTURE TIME"

        End If


        TimePickerForm.Show()
        TimePickerForm.Location = New Point(410, 250)
        TimePickerForm.TopMost = True

    End Sub

    Private Sub GunaTextBoxTotal_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxTotal.TextChanged

        If GunaTextBoxTotal.Text = "" Then
            GunaTextBoxTotal.Text = 0
        End If

        If GunaTextBoxprixRepas.Text = "" Then
            GunaTextBoxprixRepas.Text = 0
        End If

        If GunaTextBoxTempsAFaire.Text = "" Then
            GunaTextBoxTempsAFaire.Text = 0
        End If

        If GunaTextBoxServiceEtProduitSup.Text = "" Then
            GunaTextBoxServiceEtProduitSup.Text = 0
        End If

        GunaTextBoxMontantARegler.Text = Format(Double.Parse(GunaTextBoxTotal.Text) + Double.Parse(GunaTextBoxprixRepas.Text) + Double.Parse(GunaTextBoxServiceEtProduitSup.Text), "#,##0")

    End Sub

    Private Sub GunaTextBoxprixRepas_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxprixRepas.TextChanged
        If GunaTextBoxTotal.Text = "" Then
            GunaTextBoxTotal.Text = 0
        End If

        If GunaTextBoxprixRepas.Text = "" Then
            GunaTextBoxprixRepas.Text = 0
        End If

        If GunaTextBoxTempsAFaire.Text = "" Then
            GunaTextBoxTempsAFaire.Text = 0
        End If

        If GunaTextBoxServiceEtProduitSup.Text = "" Then
            GunaTextBoxServiceEtProduitSup.Text = 0
        End If

        GunaTextBoxMontantARegler.Text = Format(Double.Parse(GunaTextBoxTotal.Text) + Double.Parse(GunaTextBoxprixRepas.Text) + Double.Parse(GunaTextBoxServiceEtProduitSup.Text), "#,##0")
    End Sub

    Private Sub GunaTextBoxServiceEtProduitSup_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxServiceEtProduitSup.TextChanged
        If GunaTextBoxTotal.Text = "" Then
            GunaTextBoxTotal.Text = 0
        End If

        If GunaTextBoxprixRepas.Text = "" Then
            GunaTextBoxprixRepas.Text = 0
        End If

        If GunaTextBoxTempsAFaire.Text = "" Then
            GunaTextBoxTempsAFaire.Text = 0
        End If

        If GunaTextBoxServiceEtProduitSup.Text = "" Then
            GunaTextBoxServiceEtProduitSup.Text = 0
        End If

        GunaTextBoxMontantARegler.Text = Format(Double.Parse(GunaTextBoxTotal.Text) + Double.Parse(GunaTextBoxprixRepas.Text) + Double.Parse(GunaTextBoxServiceEtProduitSup.Text), "#,##0")
    End Sub

    Private Sub GunaComboBoxHeureCafe_Click(sender As Object, e As EventArgs) Handles GunaComboBoxHeureCafe.Click
        TimePickerForm.GunaLabelTitreHeure.Text = "HEURE PAUSE CAFE"
        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        TimePickerForm.Show()
        TimePickerForm.Location = New Point(865, 374)
        TimePickerForm.TopMost = True
    End Sub

    Private Sub GunaComboBoxHeureDej_Click(sender As Object, e As EventArgs) Handles GunaComboBoxHeureDej.Click
        TimePickerForm.GunaLabelTitreHeure.Text = "HEURE PAUSE DEJEUNER"
        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If


        TimePickerForm.Show()
        TimePickerForm.Location = New Point(865, 400)
        TimePickerForm.TopMost = True
    End Sub

    Private Sub GunaComboBoxHeureDiner_Click(sender As Object, e As EventArgs) Handles GunaComboBoxHeureDiner.Click
        TimePickerForm.GunaLabelTitreHeure.Text = "HEURE PAUSE DINER"

        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If


        TimePickerForm.Show()
        TimePickerForm.Location = New Point(865, 426)
        TimePickerForm.TopMost = True
    End Sub

    Private Sub GunaComboBoxHeureGouter_Click(sender As Object, e As EventArgs) Handles GunaComboBoxHeureGouter.Click
        TimePickerForm.GunaLabelTitreHeure.Text = "HEURE DU GOUTER"

        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        TimePickerForm.Show()
        TimePickerForm.Location = New Point(865, 478)
        TimePickerForm.TopMost = True
    End Sub

    Private Sub GunaComboBoxHeureCocktail_Click(sender As Object, e As EventArgs) Handles GunaComboBoxHeureCocktail.Click
        TimePickerForm.GunaLabelTitreHeure.Text = "HEURE DU COCKTAIL"

        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        TimePickerForm.Show()
        TimePickerForm.Location = New Point(865, 503)
        TimePickerForm.TopMost = True
    End Sub

    Private Sub GunaTextBoxClientEmail_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxClientEmail.TextChanged
        GunaTextBox17.Text = GunaTextBoxClientEmail.Text

        If Trim(GunaTextBoxClientEmail.Text).Equals("") Then
            GunaRadioButtonEmailNon.Checked = True
        Else
            If GunaTextBoxClientEmail.Text.Length <= 10 Then
                GunaRadioButtonEmailNon.Checked = True
            End If
        End If

    End Sub

    Private Sub FicheTechniqueToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles FicheTechniqueToolStripMenuItem.Click
        GlobalVariable.ficheTechnique = "fiche"
        ArticleForm.TopMost() = True
        ArticleForm.Show()
        ArticleForm.TabControlArticle.SelectedIndex = 3
    End Sub

    Private Sub GunaButtonCaisseJournalier_Click(sender As Object, e As EventArgs) Handles GunaButtonCaisseJournalier.Click
        Dim CODE_CAISSIER As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
        Functions.DocumentToPrintSituation(CODE_CAISSIER, "reglement", "CODE_CAISSIER", GlobalVariable.DateDeTravail)
    End Sub

    Private Sub GunaButtonVenteShift_Click(sender As Object, e As EventArgs) Handles GunaButtonVenteShift.Click

        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        GlobalVariable.DocumentToGenerate = "JOURNAL DES VENTES SHIFT"
        Dim ligneFacture As New LigneFacture()
        Dim CODE_CAISSIER As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
        Dim dtParentCategory As DataTable = ligneFacture.ListeDesCategoriesDArticleVendus(DateDebut, DateFin, CODE_CAISSIER)

        Impression.journalDesVentes(dtParentCategory, DateDebut, DateFin)

    End Sub

    Private Sub GunaButtonMainCouranteEvents_Click(sender As Object, e As EventArgs) Handles GunaButtonMainCouranteEvents.Click
        GlobalVariable.AncienneMainCourante = False
        GlobalVariable.DocumentToGenerate = "salle"
        MainCouranteReceptionForm.TopMost = True
        MainCouranteReceptionForm.Show()

    End Sub

    Private Sub GunaButtonMainCouranteCumulEvents_Click(sender As Object, e As EventArgs) Handles GunaButtonMainCouranteCumulEvents.Click

        GlobalVariable.AncienneMainCourante = True
        GlobalVariable.DocumentToGenerate = "salle"

        MainCouranteReceptionForm.TopMost = True
        MainCouranteReceptionForm.Show()

    End Sub

    Private Sub GunaButtonRapportDayUse_Click(sender As Object, e As EventArgs) Handles GunaButtonRapportDayUse.Click

        GlobalVariable.DocumentToGenerate = "day use"
        GunaLabelRapport.Text = "LISTE DES SIESTES"
        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        TabControlRapport.SelectedIndex = 3

    End Sub

    'GSETION DES DEPENSE 

    'SOUS FAMILLE DEPENSE
    Private Sub SousFamilleDépenseToolStripMenuItem_Click(sender As Object, e As EventArgs)
        GlobalVariable.typeFamilleOuSousFamilleDepense = "sous famille"
        DepenseFamilyForm.Show()
    End Sub

    'FAMILLE DEPENSE
    Private Sub FamilleDepenseToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles FamilleDepenseToolStripMenuItem.Click
        DepenseFamilyForm.Close()
        DepenseFamilyForm.Show()
        DepenseFamilyForm.TopMost = True
    End Sub

    Private Sub GunaButton13_Click(sender As Object, e As EventArgs) Handles GunaButton13.Click
        RapportFacturesForm.Close()
        GlobalVariable.DocumentToGenerate = "JOURNAL DES VENTES PERIODIQUE"
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True
    End Sub

    Private Sub GunaButton14_Click(sender As Object, e As EventArgs) Handles GunaButton14.Click
        RapportFacturesForm.Close()
        GlobalVariable.DocumentToGenerate = "SITUATION DE CAISSE PERIODIQUE"
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True
    End Sub

    Private Sub GunaButton15_Click(sender As Object, e As EventArgs) Handles GunaButton15.Click
        RapportFacturesForm.Close()
        GlobalVariable.DocumentToGenerate = "SITUATION MENSUEL DE L'ETABLISSEMENT"
        RapportFacturesForm.GunaComboBoxMagasins.Visible = False
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True
    End Sub

    Private Sub GunaButton12_Click_1(sender As Object, e As EventArgs) Handles GunaButton12.Click
        RapportFacturesForm.Close()
        GlobalVariable.DocumentToGenerate = "FICHE D'INVENTAIRE JOURNALIERE BAR"
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True
    End Sub

    Private Sub GunaButton11_Click_1(sender As Object, e As EventArgs) Handles GunaButton11.Click
        RapportFacturesForm.Close()
        GlobalVariable.DocumentToGenerate = "FICHE DE VENTILATION BAR-RESTAURANT"
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True
    End Sub

    Private Sub BanqueToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles BanqueToolStripMenuItem.Click
        BankForm.Close()
        BankForm.Show()
        BankForm.TopMost = True
    End Sub

    'TIMER_ POUR LA GESTION DE L'HORLOGE
    Private Sub Timer1_Tick(sender As Object, e As EventArgs) Handles Timer1.Tick

        'GunaLabelTemps.Text = Now().ToLongTimeString()
        StatusBarPanelTime.Text = Now().ToLongTimeString()

        If Not GunaCheckBoxDayUse.Checked Then

            If GlobalVariable.ReservationToUpdate IsNot Nothing Then

                If GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then

                    If GlobalVariable.ReservationToUpdate.Rows(0)("CHECKIN") = "OUI" And GlobalVariable.ReservationToUpdate.Rows(0)("ETAT_RESERVATION") = 1 Then

                        Dim DATE_FIN_SEJOUR As Date = GunaDateTimePickerDepart.Value.ToShortDateString()
                        Dim DATE_DEBUT_SEJOUR As Date = GlobalVariable.DateDeTravail.ToShortDateString()

                        Dim numberOfDaysDiferrence As Integer = CType((DATE_FIN_SEJOUR - DATE_DEBUT_SEJOUR).TotalDays, Int32)

                        If numberOfDaysDiferrence = 0 Then
                            GunaButtonCheckOut.Visible = True
                        Else
                            GunaButtonCheckOut.Visible = False
                        End If
                    Else
                        GunaButtonCheckOut.Visible = False
                    End If

                Else
                    GunaButtonCheckOut.Visible = False
                End If

            Else
                GunaButtonCheckOut.Visible = False
            End If

        End If

    End Sub

    Private Sub GunaButton1_Click_1(sender As Object, e As EventArgs) Handles GunaButton1.Click

        GlobalVariable.DocumentToGenerate = "INVENTAIRE DES VENTES"

        RapportFacturesForm.Close()
        RapportFacturesForm.GunaCheckBoxParFamille.Visible = True

        RapportFacturesForm.TopMost = True
        RapportFacturesForm.Show()

        If GlobalVariable.actualLanguageValue = 1 Then
            RapportFacturesForm.GunaLabelGeneral.Text = "INVENTAIRE DES VENTES"
        Else
            RapportFacturesForm.GunaLabelGeneral.Text = "SALES INVENTORY"
        End If

    End Sub

    Private Sub BonApprovisionnementToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles BonApprovisionnementToolStripMenuItem.Click
        BonApprovisionnementForm.Show()
        BonApprovisionnementForm.TopMost = True
        RapportFacturesForm.BringToFront()
    End Sub

    Private Sub ToolStripMenuItem131_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem131.Click

        GlobalVariable.DocumentToGenerate = "MOUCHARDS"
        RapportFacturesForm.GunaTextBoxCodeResa.Text = ""
        RapportFacturesForm.GunaCheckBoxPropResa.Checked = True
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True

    End Sub

    Private Sub GunaTextBoxBC_validated(sender As Object, e As EventArgs) Handles GunaTextBoxBC.Validated

        If Trim(GunaTextBoxBC.Text) = "" Then
            TabControlInfoClientSup.SelectedIndex = 0
        Else
            TabControlInfoClientSup.SelectedIndex = 2
        End If

    End Sub

    Private Sub UploaderToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles UploaderToolStripMenuItem.Click
        LoadData.Show()
        LoadData.TopMost = True
    End Sub

    Private Sub GunaButton16_Click(sender As Object, e As EventArgs) Handles GunaButton16.Click

        Me.Cursor = Cursors.WaitCursor

        GunaPanelDisponibilite.Visible = True
        GunaPanelDisponibilite.BringToFront()

        DisponibiliteEtTarifs(GunaDateTimePickerDispoDebut.Value.ToShortDateString, GunaDateTimePickerDispoFin.Value.ToShortDateString)

        Me.Cursor = Cursors.Default

    End Sub

    Private Sub GunaButtonEditionDeMasse_Click(sender As Object, e As EventArgs) Handles GunaButtonEditionDeMasse.Click

        editionDeMasseForm.Show()
        editionDeMasseForm.TopMost = True

    End Sub

    Private Sub GunaButtonAfficherPlanning_Click(sender As Object, e As EventArgs) Handles GunaButtonAfficherPlanning.Click

        planningReservation(GunaDateTimePickerPlanningDebut.Value, GunaDateTimePickerPlanningFin.Value)

    End Sub

    Private Sub legendeEnCodificationColour(ByVal dateDebut As Date, ByVal dateFin As Date)

        GunaShadowPanelBottomPanel.Controls.Clear()

        '---------------------------------- SELECTION DES DISTINCTS ----------------------------------------------------------------------------------------------

        'SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC

        Dim dateDeTravail As Date = GlobalVariable.DateDeTravail.ToShortDateString

        Dim query101 As String = "SELECT DISTINCT SOURCE_RESERVATION FROM reserve_conf WHERE DATE_ENTTRE <= '" & dateDeTravail.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & dateDeTravail.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY CHAMBRE_ID ASC"

        Dim command101 As New MySqlCommand(query101, GlobalVariable.connect)
        command101.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

        Dim adapter101 As New MySqlDataAdapter(command101)
        Dim distinctSource As New DataTable()
        adapter101.Fill(distinctSource)

        Dim query201 As String = "SELECT DISTINCT SOURCE_RESERVATION FROM reservation WHERE DATE_ENTTRE >= '" & dateDeTravail.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & dateDeTravail.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION= 0 ORDER BY CHAMBRE_ID ASC"

        Dim command201 As New MySqlCommand(query201, GlobalVariable.connect)
        command201.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

        Dim adapter201 As New MySqlDataAdapter(command201)
        Dim distinctSource01 As New DataTable()
        adapter201.Fill(distinctSource01)

        distinctSource.Merge(distinctSource01)

        '-----------------------------------------------------------------------------
        '----------------------------------------------------------------------------

        If distinctSource.Rows.Count > 0 Then

            '--------------------------------- GENERATION DYNAMIQUE DES LEGENDES ---------------------------------

            Dim xValue As Integer = 50
            Dim yValue As Integer = 10  '578

            Dim nombre As Integer = 0

            For i = 0 To distinctSource.Rows.Count - 1

                nombre = 0

                Dim infoSupSourceResa As DataTable = Functions.getElementByCode(distinctSource.Rows(i)("SOURCE_RESERVATION"), "source_reservation", "CODE_SOURCE_RESERVATION")

                If infoSupSourceResa.Rows.Count > 0 Then

                    '------------------------------------------------------------------------------------------------------------
                    '1- COMPTAGE DU NOMBRE DE CHAQUE SOURCE DE RESERVATION

                    Dim query01 As String = "SELECT * FROM reserve_conf WHERE DATE_ENTTRE <= '" & dateDeTravail.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & dateDeTravail.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE AND SOURCE_RESERVATION=@CODE_SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

                    Dim command01 As New MySqlCommand(query01, GlobalVariable.connect)
                    command01.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
                    command01.Parameters.Add("@CODE_SOURCE_RESERVATION", MySqlDbType.VarChar).Value = infoSupSourceResa.Rows(0)("CODE_SOURCE_RESERVATION")

                    Dim adapter01 As New MySqlDataAdapter(command01)
                    Dim enChambre As New DataTable()
                    adapter01.Fill(enChambre)

                    Dim query02 As String = "SELECT * FROM reservation WHERE DATE_ENTTRE >= '" & dateDeTravail.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & dateDeTravail.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION= 0 AND SOURCE_RESERVATION=@CODE_SOURCE_RESERVATION ORDER BY CHAMBRE_ID ASC"

                    Dim command02 As New MySqlCommand(query02, GlobalVariable.connect)
                    command02.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
                    command02.Parameters.Add("@CODE_SOURCE_RESERVATION", MySqlDbType.VarChar).Value = infoSupSourceResa.Rows(0)("CODE_SOURCE_RESERVATION")
                    command02.Parameters.Add("@DAY_USE", MySqlDbType.Int64).Value = 0 ' ON NE TRAITE PAS LES DAY USE

                    Dim adapter02 As New MySqlDataAdapter(command02)
                    Dim resa As New DataTable()
                    adapter02.Fill(resa)

                    enChambre.Merge(resa)

                    nombre = enChambre.Rows.Count
                    '------------------------------------------------------------------------------------------------------------

                    '2- DETERMINONS LA COULEUR A UTILISER

                    Dim colorString As String = infoSupSourceResa.Rows(0)("COULEUR")
                    Dim colorForeString As String = infoSupSourceResa.Rows(0)("COULEUR_FONT")

                    Dim paramCouleur() As String

                    Dim legendeColor As Color
                    Dim resaForeColor As Color

                    If Trim(colorString.ToString).Equals("") Then
                        legendeColor = Color.FromArgb(255, 64, 0, 128)
                    Else

                        paramCouleur = Functions.returningColorFromString(colorString)

                        If paramCouleur(1).Equals("") Then
                            legendeColor = Color.FromName(paramCouleur(0))
                        Else
                            legendeColor = Color.FromArgb(Integer.Parse(paramCouleur(0)), Integer.Parse(paramCouleur(1)), Integer.Parse(paramCouleur(2)), Integer.Parse(paramCouleur(3)))
                        End If

                    End If

                    If Trim(colorForeString.ToString).Equals("") Then
                        resaForeColor = Color.FromArgb(255, 64, 0, 128)
                    Else

                        paramCouleur = Functions.returningColorFromString(colorForeString)

                        If paramCouleur(1).Equals("") Then
                            resaForeColor = Color.FromName(paramCouleur(0))
                        Else
                            resaForeColor = Color.FromArgb(Integer.Parse(paramCouleur(0)), Integer.Parse(paramCouleur(1)), Integer.Parse(paramCouleur(2)), Integer.Parse(paramCouleur(3)))
                        End If

                    End If

                    Dim customPanel As New Panel
                    customPanel.Text = "Test" & m
                    customPanel.Name = "a" & m
                    customPanel.Location = New Point(xValue, yValue)

                    customPanel.BackColor = legendeColor

                    customPanel.ForeColor = resaForeColor
                    'customPanel.Size = New Size(75, 103)
                    customPanel.Size = New Size(180, 20)
                    customPanel.Anchor = AnchorStyles.None

                    Dim customLabel As New Label

                    customLabel.AutoSize = True
                    customLabel.Font = New System.Drawing.Font("Segoe UI", 9.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))

                    customLabel.Name = "customLabel"
                    customLabel.Size = New System.Drawing.Size(67, 80)
                    customLabel.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
                    customLabel.TabIndex = 4

                    Dim customLabelValue As New Label

                    customLabelValue.AutoSize = True
                    customLabelValue.Font = New System.Drawing.Font("Segoe UI", 10.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
                    customLabelValue.Location = New System.Drawing.Point(5, 0)
                    customLabelValue.Name = "customLabelValue"
                    customLabelValue.Size = New System.Drawing.Size(67, 81)
                    customLabelValue.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
                    customLabelValue.TabIndex = 4

                    customLabel.Location = New System.Drawing.Point(10, 25)
                    customLabelValue.Text = infoSupSourceResa.Rows(0)("SOURCE_RESERVATION") & " (" & nombre & ")"

                    'customPanel.Controls.Add(customLabel)
                    customPanel.Controls.Add(customLabelValue)

                    GunaShadowPanelBottomPanel.Controls.Add(customPanel)
                    'GunaShadowPanelBOttomPanel.Controls.Add(customPanel)

                    xValue = xValue + 220

                    If i > 0 Then

                        If i Mod 5 = 0 Then

                            xValue = 50
                            yValue += 28

                        End If

                    End If

                End If

            Next

            '---------------------------------- END GENERATION DYNAMIQUE DES LEGENDES ----------------------------

        End If

    End Sub

    '*************************************************** GESTION DES RACCOURCIS CLAVIER *************************************************************

    Private Sub RaccourcisClavierToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles RaccourcisClavierToolStripMenuItem.Click

        Me.Cursor = Cursors.WaitCursor

        GunaPanelDisponibilite.Show()
        GunaPanelDisponibilite.BringToFront()

        firstCell = True
        secondCell = True

        GunaDateTimePickerDispoDebut.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDispoFin.Value = GlobalVariable.DateDeTravail.AddDays(31)

        GunaPanelDisponibilite.Visible = True
        GunaPanelDisponibilite.BringToFront()

        DisponibiliteEtTarifs(GunaDateTimePickerDispoDebut.Value.ToShortDateString, GunaDateTimePickerDispoFin.Value.ToShortDateString)

        Me.Cursor = Cursors.Default


    End Sub

    Private Sub NouvelleRéservationToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles NouvelleRéservationToolStripMenuItem.Click

        Me.Cursor = Cursors.WaitCursor

        GunaTextBoxMontantAccorde.Enabled = True

        VidageDesChampsPourNouvelleReservation()

        TabControlHbergement.SelectedIndex = 0

        GunaLabelNumReservation.Visible = True
        GunaLabelNumReservation.Text = Functions.GeneratingRandomCodeWithSpecifications("reserve_conf", "RESA")

        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

        Me.Cursor = Cursors.Default

    End Sub

    Private Sub PlanningToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles PlanningToolStripMenuItem.Click

        Me.Cursor = Cursors.WaitCursor

        firstCell = True
        secondCell = True

        'GunaShadowPanelReception.Show()
        'GunaShadowPanelReception.BringToFront()

        GunaDateTimePickerPlanningDebut.Value = GlobalVariable.DateDeTravail.ToShortDateString
        GunaDateTimePickerPlanningFin.Value = GlobalVariable.DateDeTravail.AddDays(10).ToShortDateString

        PanelPlanning.Show()
        PanelPlanning.BringToFront()

        planningReservation(GunaDateTimePickerPlanningDebut.Value, GunaDateTimePickerPlanningFin.Value)

        Me.Cursor = Cursors.Default

    End Sub

    Private Sub CheckOutToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles CheckOutToolStripMenuItem.Click

        Me.Cursor = Cursors.WaitCursor

        'GunaShadowPanelReception.Show()
        'GunaShadowPanelReception.BringToFront()

        PanelTableauDeBords.Hide()
        TabControlHbergement.SelectedIndex = 4
        PanelEnregistrement.Show()
        PanelPlanning.Hide()

        Me.Cursor = Cursors.Default

    End Sub

    Private Sub AttenduesToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles AttenduesToolStripMenuItem.Click

        Me.Cursor = Cursors.WaitCursor

        'GunaShadowPanelReception.Show()
        'GunaShadowPanelReception.BringToFront()

        TabControlHbergement.SelectedIndex = 2
        PanelTableauDeBords.Hide()
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()
        PanelPlanning.Hide()

        Me.Cursor = Cursors.Default

    End Sub

    Private Sub EnChambreToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles EnChambreToolStripMenuItem.Click

        Me.Cursor = Cursors.WaitCursor

        TabControlHbergement.SelectedIndex = 3
        PanelTableauDeBords.Hide()
        PanelEnregistrement.BringToFront()
        PanelEnregistrement.Show()
        PanelPlanning.Hide()

        Me.Cursor = Cursors.Default

    End Sub


    'RECUPERATION PRIX DE LA RESERVATION DANS UN FICHIER TEXT

    Private Sub GunaButtonTarifAppliquable_Click(sender As Object, e As EventArgs) Handles GunaButtonTarifAppliquable.Click

        TarificationDeReservationForm.Show()
        TarificationDeReservationForm.TopMost = True

    End Sub

    'EN CAS DE CHANGEMENT DE TARIFICATION CONTENU DANS LE DROPDOWN 

    Private Sub GunaComboBoxCodeTarif_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GunaComboBoxCodeTarif.SelectedIndexChanged

    End Sub

    Private Sub GunaButton5_Click(sender As Object, e As EventArgs) Handles GunaButton5.Click

        GlobalVariable.DocumentToGenerate = "JOURNAL PETITE CAISSE"

        SynthesePetiteCaisseForm.Show()
        SynthesePetiteCaisseForm.TopMost = True

        ''RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True

    End Sub

    Private Sub GunaButtonPreference_Click(sender As Object, e As EventArgs) Handles GunaButtonPreference.Click

        If Not Trim(GunaTextBoxRefClient.Text).Equals("") Then

            If Not Trim(GunaTextBoxNomPrenom.Text).Equals("") Then

                PreferenceDuClientForm.Show()
                PreferenceDuClientForm.TopMost = True

                PreferenceDuClientForm.GunaLabelNomDuClient.Text = GunaTextBoxNomPrenom.Text

            End If

        Else
            ClientForm.Show()
            ClientForm.TopMost = True

            historiqueApartirDuCardex()

            ClientForm.TabControl1.SelectedIndex = 3
        End If

    End Sub

    Private Sub GunaButton18_Click(sender As Object, e As EventArgs) Handles GunaButtonFactures.Click

        ClientForm.Show()
        ClientForm.TopMost = True

        historiqueApartirDuCardex()

        ClientForm.TabControl1.SelectedIndex = 2
        ClientForm.TabControl2.SelectedIndex = 0

    End Sub

    Private Sub GunaButtonSejours_Click(sender As Object, e As EventArgs) Handles GunaButtonSejours.Click

        ClientForm.Show()
        ClientForm.TopMost = True

        historiqueApartirDuCardex()

        ClientForm.TabControl1.SelectedIndex = 2
        ClientForm.TabControl2.SelectedIndex = 1

    End Sub

    '------------------------ GESTION TIME PICKER ----------------------------------------------------------

    'HISTORIQUES A PARTIR DU CARDEX

    Public Sub historiqueApartirDuCardex()

        Dim INDICE_DE_COMPTE As Integer = 0

        ClientForm.AutoLoadBanque()

        ClientForm.GunaDateTimePickerDebutClientForm.Value = GlobalVariable.DateDeTravail
        ClientForm.GunaDateTimePickerFinClientForm.Value = GlobalVariable.DateDeTravail

        ClientForm.GunaComboBoxTypeDeFiltre.SelectedIndex = 1

        ClientForm.GunaTextBoxMontantVerse.Text = 0
        '---------------------------------------- CONTENT OF REGLEMENTFORM COMING FROM THE FRONTDESK ---------------------------------

        'We initialise the content of reglementForm with information coming from the frontdesk: Solde-SistuationClient-Reglement

        'Setting a value for the paiment mode on load
        ClientForm.GunaComboBoxModeReglementPratique.SelectedIndex = 0

        ClientForm.GunaComboBoxNatureOperation.SelectedIndex = 0

        Dim CodeClient As String = GunaTextBoxRefClient.Text
        ClientForm.GunaTextBoxCodeEntreprise.Text = GunaTextBoxRefClient.Text

        'On rempli la description du client pour des eventuelles modifications

        Dim client As DataTable = Functions.getElementByCode(CodeClient, "client", "CODE_CLIENT")

        If client.Rows.Count > 0 Then

            If True Then

                ClientForm.GunaTextBoxCodeClient.Text = client.Rows(0)("CODE_CLIENT")
                ClientForm.GunaTextBoxNomRaisonSociale.Text = client.Rows(0)("NOM_CLIENT")
                ClientForm.GunaTextBoxPrenom.Text = client.Rows(0)("PRENOMS")
                ClientForm.GunaTextBox12.Text = client.Rows(0)("ADRESSE")
                ClientForm.MaskedTextBoxTelephone.Text = client.Rows(0)("TELEPHONE")
                ClientForm.GunaDateTimePicker1.Value = client.Rows(0)("DATE_DE_NAISSANCE")
                ClientForm.GunaTextBox6.Text = client.Rows(0)("LIEU_DE_NAISSANCE")
                ClientForm.GunaTextBoxNomDeJeunneFille.Text = client.Rows(0)("NOM_JEUNE_FILLE")
                ClientForm.GunaTextBoxFax.Text = client.Rows(0)("FAX")
                ClientForm.GunaTextBoxEmail.Text = client.Rows(0)("EMAIL")
                ClientForm.GunaTextBoxNationalite.Text = client.Rows(0)("NATIONALITE")
                ClientForm.GunaComboBoxPays.SelectedValue = client.Rows(0)("PAYS_RESIDENCE")
                'GUnaTextBoxNumCompteReal.Text = client.Rows(0)("NUM_COMPTE_COLLECTIF")
                ClientForm.GunaComboBoxTypeClient.SelectedValue = client.Rows(0)("TYPE_CLIENT")
                ClientForm.GunaTextBoxSiteWeb.Text = client.Rows(0)("SITE_INTERNET")
                ClientForm.GunaTextBoxProfession.Text = client.Rows(0)("PROFESSION")
                ClientForm.GunaTextBoxCni.Text = client.Rows(0)("CNI")
                'GunaComboBoxVille.SelectedValue = client.Rows(0)("VILLE_DE_RESIDENCE")
                ClientForm.GunaTextBox5.Text = client.Rows(0)("VILLE_DE_RESIDENCE")
                ClientForm.GunaComboBoxModeReglement.SelectedItem = client.Rows(0)("CODE_MODE_PAIEMENT")
                ClientForm.GunaComboBoxModeTransport.SelectedItem = client.Rows(0)("MODE_TRANSPORT")
                ClientForm.GunaTextBoxNumVehicule.Text = client.Rows(0)("NUM_VEHICULE")

                ClientForm.GunaTextBoxMarqueVehicule.Text = client.Rows(0)("MARQUE_VEHICULE")

                ClientForm.GunaTextBoxEntreprise.Text = client.Rows(0)("CODE_ENTREPRISE")

                'LE NUMERO DE COMPTE N'EXISTE PAS DONC NUMERO DE COMPTE PROVIENT DES INFOS DU CLIENT
                ClientForm.GUnaTextBoxNumCompteReal.Text = client.Rows(0)("NUM_COMPTE")

                'ATTRIBUTION DES INFORMATION DE COMPTE FINANCE

            End If

            Dim compte As DataTable = Functions.getElementByCode(ClientForm.GunaTextBoxCodeClient.Text, "compte", "CODE_CLIENT")

            If compte.Rows.Count > 0 Then

                If Not Trim(compte.Rows(0)("NUMERO_COMPTE")) = "" Then
                    'LE NUMERO DE COMPTE EXISTE
                    ClientForm.GUnaTextBoxNumCompteReal.Text = Trim(compte.Rows(0)("NUMERO_COMPTE")) ' NUMERO DE COMPTE
                Else
                    ClientForm.GUnaTextBoxNumCompteReal.Text = Trim(Functions.GeneratingRandomCodeAccountNumber("compte", INDICE_DE_COMPTE))
                End If

                ClientForm.GunaTextBoxIntituleDeCompte.Text = Trim(compte.Rows(0)("INTITULE")) ' INTITULE DE COMPTE

                ClientForm.GunaTextBoxPersonneAContacter.Text = Trim(compte.Rows(0)("PERSONNE_A_CONTACTER")) ' INTITULE DE COMPTE
                ClientForm.GunaTextBoxContactPourPaiement.Text = Trim(compte.Rows(0)("CONTACT_PAIEMENT")) ' INTITULE DE COMPTE
                ClientForm.GunaTextBoxAdresseDeFacturation.Text = Trim(compte.Rows(0)("ADRESSE_DE_FACTURATION")) ' INTITULE DE COMPTE

                If compte.Rows(0)("PLAFONDS_DU_COMPTE") >= 0 Then
                    ClientForm.GunaTextBoxMontantPlafondsDuCompte.Text = Format(compte.Rows(0)("PLAFONDS_DU_COMPTE"), "#,##0.00")
                Else
                    ClientForm.GunaTextBoxMontantPlafondsDuCompte.Text = 0
                End If

                If compte.Rows(0)("DELAI_DE_PAIEMENT") >= 0 Then
                    ClientForm.NumericUpDownDelaiDePaiement.Text = Trim(compte.Rows(0)("DELAI_DE_PAIEMENT"))
                Else
                    ClientForm.NumericUpDownDelaiDePaiement.Text = 0
                End If

                If compte.Rows(0)("ETAT_DU_COMPTE") = 1 Then
                    ClientForm.GunaCheckBoxActivationDesactivationDuCompte.Checked = True
                Else
                    ClientForm.GunaCheckBoxActivationDesactivationDuCompte.Checked = False
                End If

            Else

                ClientForm.GUnaTextBoxNumCompteReal.Text = Trim(Functions.GeneratingRandomCodeAccountNumber("compte", INDICE_DE_COMPTE))

            End If

            '---
            '-----------------------------------------------------------------------------------------------------------------------------------
            If client.Rows.Count > 0 Then

                '----------------------------------------------------------

                If Not Trim(ClientForm.GunaTextBoxEntreprise.Text).Equals("") Then

                    Dim infoSupEntreprise As DataTable = Functions.getElementByCode(ClientForm.GunaTextBoxEntreprise.Text, "client", "CODE_CLIENT")
                    If infoSupEntreprise.Rows.Count > 0 Then
                        ClientForm.GunaTextBoxCompanyName.Text = infoSupEntreprise.Rows(0)("NOM_PRENOM")
                    Else
                        ClientForm.GunaTextBoxEntreprise.Clear()
                    End If

                End If


                Functions.AffectingTitleToAForm(ClientForm.GunaTextBoxNomRaisonSociale.Text + " " + ClientForm.GunaTextBoxPrenom.Text, ClientForm.GunaLabelTitreForm)

                'AssignACompanyToClient()

                'ONT CHARGENT LES DONNEES DES TARIF DU CLIENT

                Dim tarifs As New Tarifs

                ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Clear()

                If tarifs.SelectionDesForfaitsDuClient(client.Rows(0)("CODE_CLIENT")).Rows.Count > 0 Then
                    ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.DataSource = tarifs.SelectionDesForfaitsDuClient(client.Rows(0)("CODE_CLIENT"))
                End If

                If ClientForm.GunaComboBoxTypeDeFiltre.SelectedItem = "Entreprise" Or ClientForm.GunaComboBoxTypeDeFiltre.SelectedItem = "Individuel" Then

                    'Dim client As DataTable = Functions.getElementByCode(CodeClient, "client", "CODE_CLIENT")

                    If client.Rows.Count > 0 Then

                        ClientForm.GunaTextBoxNomRaisonSociale.Text = client.Rows(0)("NOM_PRENOM")

                        'Dim compte As DataTable = Functions.getElementByCode(Trim(CodeClient), "compte", "CODE_CLIENT")

                        If compte.Rows.Count > 0 Then

                            GunaTextBoxCompteDebiteur.Text = compte.Rows(0)("NUMERO_COMPTE")

                            ClientForm.GunaTextBoxSoldeCompte.Text = Format(compte.Rows(0)("SOLDE_COMPTE"), "#,##0")
                            'GunaTextBoxPersonneAContacter.Text = compte.Rows(0)("PERSONNE_A_CONTACTER")
                            'GunaTextBoxContactPaiement.Text = compte.Rows(0)("CONTACT_PAIEMENT")
                            'GunaTextBoxAdressePaiement.Text = compte.Rows(0)("ADRESSE_DE_FACTURATION")
                            'GunaTextBoxDelaiPaiement.Text = compte.Rows(0)("DELAI_DE_PAIEMENT")

                            'GunaTextBoxPlafonds.Text = Format(compte.Rows(0)("PLAFONDS_DU_COMPTE"), "#,##0")

                        End If

                        Dim factures As DataTable = Functions.getElementByCode(CodeClient, "facture", "CODE_CLIENT")

                        If factures.Rows.Count > 0 Then

                            Dim ChiffresAffaire As Double = 0

                            For j = 0 To factures.Rows.Count - 1
                                ChiffresAffaire += factures.Rows(j)("MONTANT_TTC")
                            Next

                            ClientForm.GunaTextBoxChiffreAffaire.Text = Format(ChiffresAffaire, "#,##0")

                        End If

                        ClientForm.GunaTextBoxAPayer.Text = 0

                        ClientForm.GunaTextBoxSolde.Text = 0

                        ClientForm.GunaTextBoxMontantVerse.Text = 0

                        If ClientForm.GunaComboBoxNatureOperation.SelectedIndex >= 0 Then
                            ClientForm.GunaTextBoxReference.Text = ClientForm.GunaComboBoxNatureOperation.SelectedItem & " " & Trim(ClientForm.GunaTextBoxNomRaisonSociale.Text) & " " & Date.Now()
                        End If

                        ClientForm.situationDuClientEntreprise(CodeClient)

                    End If

                End If

            End If

            '-----------------------------------------------------------------------------------------------------------------------------------



            'ON rempli les entetes du datagrid des tarif pour éviterqu'il ne se répète
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.BringToFront()
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("ID_TARIF_PRIX", "ID")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("CODE_TARIF", "CODE APPLIQUE")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("TYPE_TARIF", "TYPE TARIF")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("CODE_TYPE", "CODE TYPE")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF_ENCOURS", "PRIX ENCOURS")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF1", "PRIX 1")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF2", "PRIX 2")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF3", "PRIX 3")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF4", "PRIX 4")
            ClientForm.GunaDataGridViewTarifsAuquelOnAEffecteDesPrix.Columns.Add("PRIX_TARIF5", "PRIX 5")


            If GlobalVariable.actualLanguageValue = 1 Then
                ClientForm.GunaButtonEnregistrerClient.Text = "Sauvegarder"

            Else
                ClientForm.GunaButtonEnregistrerClient.Text = "Update"

            End If

        End If

    End Sub

    Private Sub GunaButtonCoChambrier_Click(sender As Object, e As EventArgs) Handles GunaButtonCoChambrier.Click

        CoChambrierForm.Show()
        CoChambrierForm.TopMost = True

    End Sub

    Private Sub GunaComboBoxFiltre_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GunaComboBoxFiltre.SelectedIndexChanged

        If GunaComboBoxFiltre.SelectedIndex >= 0 Then
            GunaCheckBoxUtiliserFiltre.Checked = False
        Else
            GunaCheckBoxUtiliserFiltre.Checked = True
        End If

    End Sub

    Private Sub GunaCheckBoxUtiliserFiltre_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxUtiliserFiltre.CheckedChanged

        If GunaCheckBoxUtiliserFiltre.Checked Then
            If GunaComboBoxFiltre.SelectedIndex >= 0 Then
                GunaComboBoxFiltre.SelectedIndex = -1
            End If
        End If

    End Sub

    Private Sub ChangerMagasinToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ChangerMagasinToolStripMenuItem.Click
        ChoixDuMagasinForm.Close()
        ChoixDuMagasinForm.Show()
        ChoixDuMagasinForm.TopMost() = True
        ChoixDuMagasinForm.BringToFront()
    End Sub

    Private Sub GunaButton18_Click_1(sender As Object, e As EventArgs) Handles GunaButton18.Click

        ArticleFamilyForm.Close()

        GlobalVariable.typeFamilleOuSousFamille = "sous famille"

        Dim MainWindow As New MainWindow()
        MainWindow.TabControlHbergement.SelectedIndex = 2
        ArticleFamilyForm.Show()
        ArticleFamilyForm.TopMost = True

    End Sub

    Private Sub GunaButton20_Click(sender As Object, e As EventArgs) Handles GunaButton20.Click

        ArticleFamilyForm.Close()

        GlobalVariable.typeFamilleOuSousFamille = "famille"

        Dim MainWindow As New MainWindow()
        MainWindow.TabControlHbergement.SelectedIndex = 2
        ArticleFamilyForm.Show()
        ArticleFamilyForm.TopMost = True

    End Sub

    Private Sub GunaButtonNoShow_Click(sender As Object, e As EventArgs) Handles GunaButtonNoShow.Click

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelRapport.Text = "NO SHOW & ANNULATION"
        Else
            GunaLabelRapport.Text = "NO SHOW & CANCELATION"
        End If

        GlobalVariable.DocumentToGenerate = "no show"

        TabControlRapport.SelectedIndex = 3

    End Sub

    Private Sub GunaButtonTopPeoducers_Click(sender As Object, e As EventArgs) Handles GunaButtonTopPeoducers.Click

        Dim dateDesTravaux As DataTable = Functions.allTableFields("cloture")

        GunaDateTimePickerDateDebut.Visible = True
        GunaComboBoxIndivuelCompany.Visible = False

        If dateDesTravaux.Rows.Count > 0 Then
            GunaDateTimePickerDateDebut.Value = CDate(dateDesTravaux.Rows(0)("DATE_DE_TRAVAIL")).ToShortDateString
        End If

        GunaDateTimePickerDateFin.Visible = True
        GunaDateTimePickerDateFin.Value = GlobalVariable.DateDeTravail

        GunaDataGridViewAutresRapports.Columns.Clear()

        GunaLabelAutreRapports.Text = "TOP PRODUCERS"

        GunaComboBoxIndivuelCompany.Visible = True
        GunaComboBoxIndivuelCompany.Items.Clear()
        If GlobalVariable.actualLanguageValue = 1 Then
            GunaComboBoxIndivuelCompany.Items.Add("Entreprise")
            GunaComboBoxIndivuelCompany.Items.Add("Individuel")
        Else
            GunaComboBoxIndivuelCompany.Items.Add("Company")
            GunaComboBoxIndivuelCompany.Items.Add("Individual")
        End If

        GunaComboBoxIndivuelCompany.SelectedIndex = 0

        GlobalVariable.DocumentToGenerate = "top producers"

        GunaButtonImprimer.Visible = False

        TabControlRapport.SelectedIndex = 1

    End Sub

    Private Sub GunaButton3_Click_3(sender As Object, e As EventArgs) Handles GunaButton3.Click

        Dim DateDebut As Date = GunaDateTimePickerDateDebut.Value.ToShortDateString
        Dim DateFin As Date = GunaDateTimePickerDateFin.Value.ToShortDateString

        If GlobalVariable.DocumentToGenerate = "top producers" Then

            Dim entreprise As DataTable
            Dim TYPE_CLIENT As String = ""

            If GunaComboBoxIndivuelCompany.SelectedIndex = 0 Then

                If GlobalVariable.actualLanguageValue = 1 Then
                    TYPE_CLIENT = "ENTREPRISE"
                Else
                    TYPE_CLIENT = "COMPANY"
                End If

            Else

                If GlobalVariable.actualLanguageValue = 1 Then
                    TYPE_CLIENT = "INDIVIDUEL"
                Else
                    TYPE_CLIENT = "INDIVIDUAL"
                End If

            End If

            Dim existQuery As String = ""

            GunaDataGridViewAutresRapports.Columns.Clear()

            If GlobalVariable.actualLanguageValue = 0 Then

                GunaDataGridViewAutresRapports.Columns.Add("RANK", "RANK")
                GunaDataGridViewAutresRapports.Columns.Add(TYPE_CLIENT, TYPE_CLIENT)
                GunaDataGridViewAutresRapports.Columns.Add("SALES FIGURES", "SALES FIGURES")

                existQuery = "SELECT client.NOM_CLIENT AS " & TYPE_CLIENT & ", Sum(MONTANT_TTC) AS 'CA' from facture, client WHERE TYPE_CLIENT =@TYPE_CLIENT AND DATE_FACTURE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_FACTURE <= '" & DateFin.ToString("yyyy-MM-dd") & "' AND facture.CODE_CLIENT = client.CODE_CLIENT GROUP BY facture.CODE_CLIENT ORDER BY 'CA' ASC"

            Else

                GunaDataGridViewAutresRapports.Columns.Add("RANG", "RANG")
                GunaDataGridViewAutresRapports.Columns.Add(TYPE_CLIENT, TYPE_CLIENT)
                GunaDataGridViewAutresRapports.Columns.Add("CHIFFRES D'AFFAIRES", "CHIFFRES D'AFFAIRES")

                existQuery = "SELECT client.NOM_CLIENT AS " & TYPE_CLIENT & ", Sum(MONTANT_TTC) AS 'CA' from facture, client WHERE TYPE_CLIENT =@TYPE_CLIENT AND DATE_FACTURE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_FACTURE <= '" & DateFin.ToString("yyyy-MM-dd") & "' AND facture.CODE_CLIENT = client.CODE_CLIENT GROUP BY facture.CODE_CLIENT ORDER BY CA DESC"

            End If

            Dim command As New MySqlCommand(existQuery, GlobalVariable.connect)
            command.Parameters.Add("@TYPE_CLIENT", MySqlDbType.VarChar).Value = TYPE_CLIENT

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If table.Rows.Count > 0 Then

                GunaButtonImprimer.Visible = True

                For i = 0 To table.Rows.Count - 1
                    If table.Rows(i)("CA") > 0 Then
                        GunaDataGridViewAutresRapports.Rows.Add(i + 1, table.Rows(i)(0), table.Rows(i)("CA"))
                    End If
                Next

                GunaDataGridViewAutresRapports.Columns(2).DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewAutresRapports.Columns(2).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

            Else
                GunaButtonImprimer.Visible = False
            End If

        ElseIf GlobalVariable.DocumentToGenerate = "debiteurs" Then

            Dim TYPE_CLIENT As String = ""

            If GunaComboBoxIndivuelCompany.SelectedIndex = 0 Then
                TYPE_CLIENT = "INDIVIDUEL"
            Else
                TYPE_CLIENT = "ENTREPRISE"
            End If

            Dim query11 As String = "SELECT DISTINCT CODE_CLIENT FROM facture WHERE ETAT_FACTURE = 1 ORDER BY DATE_FACTURE DESC"

            Dim command11 As New MySqlCommand(query11, GlobalVariable.connect)
            command11.Parameters.Add("@TYPE_CLIENT", MySqlDbType.VarChar).Value = TYPE_CLIENT

            Dim adapter11 As New MySqlDataAdapter(command11)

            Dim clientFacture As New DataTable()

            adapter11.Fill(clientFacture)

            GunaDataGridViewAutresRapports.Columns.Clear()

            If clientFacture.Rows.Count > 0 Then

                GunaDataGridViewAutresRapports.Columns.Add("NOM_CLIENT", "NOM CLIENT")
                GunaDataGridViewAutresRapports.Columns.Add("DEBIT", "DEBIT")
                GunaDataGridViewAutresRapports.Columns.Add("CREDIT", "CREDIT")
                GunaDataGridViewAutresRapports.Columns.Add("SOLDE", "SOLDE")

                GunaButtonImprimer.Visible = True

                Dim CREDIT As Double = 0
                Dim DEBIT As Double = 0

                Dim SOLDE As Double = 0
                Dim TOTALSOLDE As Double = 0
                Dim TOTALCREDIT As Double = 0
                Dim TOTALDEBIT As Double = 0

                Dim GrandtotalFactureClient As Double = 0
                Dim GrandtotalReglement As Double = 0

                For k = 0 To clientFacture.Rows.Count - 1

                    Dim CODE_CLIENT As String = clientFacture.Rows(k)("CODE_CLIENT")

                    'Dim infoClient As DataTable = Functions.GetAllElementsOnTwoConditions(CODE_CLIENT, "client", "CODE_CLIENT", "ENTREPRISE", "TYPE_CLIENT")
                    Dim infoClient As DataTable = Functions.GetAllElementsOnTwoConditions(CODE_CLIENT, "client", "CODE_CLIENT", TYPE_CLIENT, "TYPE_CLIENT")

                    If infoClient.Rows.Count > 0 Then

                        Dim query2 As String = "SELECT CODE_FACTURE As REFERENCE, DATE_FACTURE AS DATE, LIBELLE_FACTURE AS LIBELLE, MONTANT_TTC AS MONTANT, MONTANT_AVANCE AS 'MONTANT SOLDE', AVANCE,LETTRAGE  FROM facture WHERE ETAT_FACTURE = 1 AND CODE_CLIENT=@CODE_CLIENT ORDER BY DATE_FACTURE DESC"
                        Dim command2 As New MySqlCommand(query2, GlobalVariable.connect)
                        command2.Parameters.Add("@CODE_CLIENT", MySqlDbType.VarChar).Value = CODE_CLIENT

                        Dim adapter2 As New MySqlDataAdapter(command2)

                        Dim tableFacture As New DataTable()

                        adapter2.Fill(tableFacture)

                        Dim query03 As String = "SELECT REF_REGLEMENT, MODE_REGLEMENT ,NUM_REGLEMENT, MONTANT_VERSE, DATE_REGLEMENT, MODE_REGLEMENT, CODE_MODE , LETTRAGE FROM reglement WHERE CODE_CLIENT = @CODE_CLIENT ORDER BY DATE_REGLEMENT DESC"
                        Dim command03 As New MySqlCommand(query03, GlobalVariable.connect)

                        command03.Parameters.Add("@CODE_CLIENT", MySqlDbType.VarChar).Value = CODE_CLIENT
                        'command3.Parameters.Add("@CODE_RESERVATION", MySqlDbType.VarChar).Value = CODE_RESERVATION

                        Dim adapter03 As New MySqlDataAdapter(command03)
                        Dim tableReglement As New DataTable()

                        adapter03.Fill(tableReglement)

                        Dim totalFactureClient As Double = 0
                        Dim totalReglement As Double = 0

                        For j = 0 To tableFacture.Rows.Count - 1
                            totalFactureClient += tableFacture.Rows(j)("MONTANT")
                            'totalReglement += tableFacture.Rows(j)("AVANCE")
                        Next

                        For l = 0 To tableReglement.Rows.Count - 1
                            totalReglement += tableReglement.Rows(l)("MONTANT_VERSE")
                        Next

                        GrandtotalFactureClient += totalFactureClient
                        GrandtotalReglement += totalReglement

                        GunaDataGridViewAutresRapports.Rows.Add(infoClient.Rows(0)("NOM_CLIENT"), Format(totalFactureClient, "#,##0"), Format(totalReglement, "#,##0"), Format(totalReglement - totalFactureClient, "#,##0"))

                    End If

                Next

            End If
            ' --------------------------------------------- GESTION DES MODES DE REGLEMENTS ----------------------------------------------------------------

        ElseIf GlobalVariable.DocumentToGenerate = "navette" Then

            Dim query As String = ""
            Dim query01 As String = ""

            Dim TYPE_DE_TRAJET As String = GunaComboBoxIndivuelCompany.SelectedItem

            If GunaComboBoxIndivuelCompany.SelectedIndex = 0 Then 'PICK UP

                query = "SELECT NOM_CLIENT AS CLIENT, `COMPANIE` AS 'COMPAGNIE / COMMENTAIRE', `VOL`, `TYPE_DE_TRAJET` AS 'TYPE DE TRAJET', `NBRE_PERSONNE` AS PAX, `DEPART` AS 'DEPART', `AUTRE_DEPART` AS 'AUTRE DEPART', `DATE_DEPART` As 'DATE DEPART', `HEURE_DEPART` AS 'HEURE DEPART', `ARRIVER` AS 'ARRIVEE', `AUTRE_ARRIVE` AS 'AUTRE ARRIVEE', 
                                             `DATE_ARRIVEE` AS 'DATE ARRIVEE', `HEURE_ARRIVEE` as 'HEURE ARRIVEE' FROM `navette`, `reserve_conf` 
                                                WHERE TYPE_DE_TRAJET =@TYPE_DE_TRAJET AND navette.CODE_RESERVATION = reserve_conf.CODE_RESERVATION AND navette.DATE_CREATION >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND navette.DATE_CREATION <= '" & DateFin.ToString("yyyy-MM-dd") & "' "


                query01 = "SELECT NOM_CLIENT AS CLIENT, `COMPANIE` AS 'COMPAGNIE / COMMENTAIRE', `VOL`, `TYPE_DE_TRAJET` AS 'TYPE DE TRAJET', `NBRE_PERSONNE` AS PAX, `DEPART` AS 'DEPART', `AUTRE_DEPART` AS 'AUTRE DEPART', `DATE_DEPART` As 'DATE DEPART', `HEURE_DEPART` AS 'HEURE DEPART', `ARRIVER` AS 'ARRIVEE', `AUTRE_ARRIVE` AS 'AUTRE ARRIVEE', 
                                             `DATE_ARRIVEE` AS 'DATE ARRIVEE', `HEURE_ARRIVEE` as 'HEURE ARRIVEE' FROM `navette`, `reservation` 
                                                WHERE TYPE_DE_TRAJET =@TYPE_DE_TRAJET AND navette.CODE_RESERVATION = reservation.CODE_RESERVATION AND navette.DATE_CREATION >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND navette.DATE_CREATION <= '" & DateFin.ToString("yyyy-MM-dd") & "' "

            ElseIf GunaComboBoxIndivuelCompany.SelectedIndex = 1 Then 'DROP OFF

                query = "SELECT NOM_CLIENT AS CLIENT, `COMPANIE` AS 'COMPAGNIE / COMMENTAIRE', `VOL`, `TYPE_DE_TRAJET` AS 'TYPE DE TRAJET', `NBRE_PERSONNE` AS PAX, `DEPART` AS 'DEPART', `AUTRE_DEPART` AS 'AUTRE DEPART', `DATE_DEPART` As 'DATE DEPART', `HEURE_DEPART` AS 'HEURE DEPART', `ARRIVER` AS 'ARRIVEE', `AUTRE_ARRIVE` AS 'AUTRE ARRIVEE', 
                                             `DATE_ARRIVEE` AS 'DATE ARRIVEE', `HEURE_ARRIVEE` as 'HEURE ARRIVEE' FROM `navette`, `reserve_conf` 
                                                WHERE TYPE_DE_TRAJET =@TYPE_DE_TRAJET AND navette.CODE_RESERVATION = reserve_conf.CODE_RESERVATION AND navette.DATE_CREATION >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND navette.DATE_CREATION <= '" & DateFin.ToString("yyyy-MM-dd") & "' "


                query01 = "SELECT NOM_CLIENT AS CLIENT, `COMPANIE` AS 'COMPAGNIE / COMMENTAIRE', `VOL`, `TYPE_DE_TRAJET` AS 'TYPE DE TRAJET', `NBRE_PERSONNE` AS PAX, `DEPART` AS 'DEPART', `AUTRE_DEPART` AS 'AUTRE DEPART', `DATE_DEPART` As 'DATE DEPART', `HEURE_DEPART` AS 'HEURE DEPART', `ARRIVER` AS 'ARRIVEE', `AUTRE_ARRIVE` AS 'AUTRE ARRIVEE', 
                                             `DATE_ARRIVEE` AS 'DATE ARRIVEE', `HEURE_ARRIVEE` as 'HEURE ARRIVEE' FROM `navette`, `reservation` 
                                                WHERE TYPE_DE_TRAJET =@TYPE_DE_TRAJET AND navette.CODE_RESERVATION = reservation.CODE_RESERVATION AND navette.DATE_CREATION >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND navette.DATE_CREATION <= '" & DateFin.ToString("yyyy-MM-dd") & "' "

            ElseIf GunaComboBoxIndivuelCompany.SelectedIndex = 2 Then 'PICK UP / DROP OFF

                query = "SELECT NOM_CLIENT AS CLIENT, `COMPANIE` AS 'COMPAGNIE / COMMENTAIRE', `VOL`, `TYPE_DE_TRAJET` AS 'TYPE DE TRAJET', `NBRE_PERSONNE` AS PAX, `DEPART` AS 'DEPART', `AUTRE_DEPART` AS 'AUTRE DEPART', `DATE_DEPART` As 'DATE DEPART', `HEURE_DEPART` AS 'HEURE DEPART', `ARRIVER` AS 'ARRIVEE', `AUTRE_ARRIVE` AS 'AUTRE ARRIVEE', 
                                             `DATE_ARRIVEE` AS 'DATE ARRIVEE', `HEURE_ARRIVEE` as 'HEURE ARRIVEE' FROM `navette`, `reserve_conf` 
                                                WHERE TYPE_DE_TRAJET =@TYPE_DE_TRAJET AND navette.CODE_RESERVATION = reserve_conf.CODE_RESERVATION AND navette.DATE_CREATION >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND navette.DATE_CREATION <= '" & DateFin.ToString("yyyy-MM-dd") & "' "


                query01 = "SELECT NOM_CLIENT AS CLIENT, `COMPANIE` AS 'COMPAGNIE / COMMENTAIRE', `VOL`, `TYPE_DE_TRAJET` AS 'TYPE DE TRAJET', `NBRE_PERSONNE` AS PAX, `DEPART` AS 'DEPART', `AUTRE_DEPART` AS 'AUTRE DEPART', `DATE_DEPART` As 'DATE DEPART', `HEURE_DEPART` AS 'HEURE DEPART', `ARRIVER` AS 'ARRIVEE', `AUTRE_ARRIVE` AS 'AUTRE ARRIVEE', 
                                             `DATE_ARRIVEE` AS 'DATE ARRIVEE', `HEURE_ARRIVEE` as 'HEURE ARRIVEE' FROM `navette`, `reservation` 
                                                WHERE TYPE_DE_TRAJET =@TYPE_DE_TRAJET AND navette.CODE_RESERVATION = reservation.CODE_RESERVATION AND navette.DATE_CREATION >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND navette.DATE_CREATION <= '" & DateFin.ToString("yyyy-MM-dd") & "' "
            ElseIf GunaComboBoxIndivuelCompany.SelectedIndex = 3 Then 'COURSE
                query = "SELECT NOM_CLIENT AS CLIENT, `COMPANIE` AS 'COMPAGNIE / COMMENTAIRE', `VOL`, `TYPE_DE_TRAJET` AS 'TYPE DE TRAJET', `NBRE_PERSONNE` AS PAX, `DEPART` AS 'DEPART', `AUTRE_DEPART` AS 'AUTRE DEPART', `DATE_DEPART` As 'DATE DEPART', `HEURE_DEPART` AS 'HEURE DEPART', `ARRIVER` AS 'ARRIVEE', `AUTRE_ARRIVE` AS 'AUTRE ARRIVEE', 
                                             `DATE_ARRIVEE` AS 'DATE ARRIVEE', `HEURE_ARRIVEE` as 'HEURE ARRIVEE' FROM `navette`, `reserve_conf` 
                                                WHERE TYPE_DE_TRAJET =@TYPE_DE_TRAJET AND navette.CODE_RESERVATION = reserve_conf.CODE_RESERVATION AND navette.DATE_CREATION >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND navette.DATE_CREATION <= '" & DateFin.ToString("yyyy-MM-dd") & "' "


                query01 = "SELECT NOM_CLIENT AS CLIENT, `COMPANIE` AS 'COMPAGNIE / COMMENTAIRE', `VOL`, `TYPE_DE_TRAJET` AS 'TYPE DE TRAJET', `NBRE_PERSONNE` AS PAX, `DEPART` AS 'DEPART', `AUTRE_DEPART` AS 'AUTRE DEPART', `DATE_DEPART` As 'DATE DEPART', `HEURE_DEPART` AS 'HEURE DEPART', `ARRIVER` AS 'ARRIVEE', `AUTRE_ARRIVE` AS 'AUTRE ARRIVEE', 
                                             `DATE_ARRIVEE` AS 'DATE ARRIVEE', `HEURE_ARRIVEE` as 'HEURE ARRIVEE' FROM `navette`, `reservation` 
                                                WHERE TYPE_DE_TRAJET =@TYPE_DE_TRAJET AND navette.CODE_RESERVATION = reservation.CODE_RESERVATION AND navette.DATE_CREATION >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND navette.DATE_CREATION <= '" & DateFin.ToString("yyyy-MM-dd") & "' "

            Else 'TOUTES

                query = "SELECT NOM_CLIENT AS CLIENT, `COMPANIE` AS 'COMPAGNIE / COMMENTAIRE', `VOL`, `TYPE_DE_TRAJET` AS 'TYPE DE TRAJET', `NBRE_PERSONNE` AS PAX, `DEPART` AS 'DEPART', `AUTRE_DEPART` AS 'AUTRE DEPART', `DATE_DEPART` As 'DATE DEPART', `HEURE_DEPART` AS 'HEURE DEPART', `ARRIVER` AS 'ARRIVEE', `AUTRE_ARRIVE` AS 'AUTRE ARRIVEE', 
                                             `DATE_ARRIVEE` AS 'DATE ARRIVEE', `HEURE_ARRIVEE` as 'HEURE ARRIVEE' FROM `navette`, `reserve_conf` 
                                                WHERE navette.CODE_RESERVATION = reserve_conf.CODE_RESERVATION"


                query01 = "SELECT NOM_CLIENT AS CLIENT, `COMPANIE` AS 'COMPAGNIE / COMMENTAIRE', `VOL`, `TYPE_DE_TRAJET` AS 'TYPE DE TRAJET', `NBRE_PERSONNE` AS PAX, `DEPART` AS 'DEPART', `AUTRE_DEPART` AS 'AUTRE DEPART', `DATE_DEPART` As 'DATE DEPART', `HEURE_DEPART` AS 'HEURE DEPART', `ARRIVER` AS 'ARRIVEE', `AUTRE_ARRIVE` AS 'AUTRE ARRIVEE', 
                                             `DATE_ARRIVEE` AS 'DATE ARRIVEE', `HEURE_ARRIVEE` as 'HEURE ARRIVEE' FROM `navette`, `reservation` 
                                                WHERE navette.CODE_RESERVATION = reservation.CODE_RESERVATION"

            End If


            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE_DE_TRAJET", MySqlDbType.VarChar).Value = TYPE_DE_TRAJET

            Dim adapter As New MySqlDataAdapter(command)
            Dim navette As New DataTable()
            adapter.Fill(navette)

            Dim command01 As New MySqlCommand(query01, GlobalVariable.connect)
            command01.Parameters.Add("@TYPE_DE_TRAJET", MySqlDbType.VarChar).Value = TYPE_DE_TRAJET

            Dim adapter01 As New MySqlDataAdapter(command01)
            Dim navette01 As New DataTable()
            adapter01.Fill(navette01)

            navette.Merge(navette01)

            GunaDataGridViewAutresRapports.Columns.Clear()

            If navette.Rows.Count > 0 Then

                GunaButtonImprimer.Visible = True
                GunaDataGridViewAutresRapports.DataSource = navette

            Else
                GunaButtonImprimer.Visible = False
            End If

        End If

    End Sub

    Private Sub GunaButtonImprimer_Click(sender As Object, e As EventArgs) Handles GunaButtonImprimer.Click

        If GlobalVariable.DocumentToGenerate = "top producers" Then
            Impression.topProducers(GunaDataGridViewAutresRapports, GunaDateTimePickerDateDebut.Value.ToShortDateString, GunaDateTimePickerDateFin.Value.ToShortDateString)
        ElseIf GlobalVariable.DocumentToGenerate = "debiteurs" Then
            Impression.debiteurs(GunaDataGridViewAutresRapports, GunaDateTimePickerDateDebut.Value.ToShortDateString, GunaDateTimePickerDateFin.Value.ToShortDateString)
        ElseIf GlobalVariable.DocumentToGenerate = "navette" Then
            Impression.navette(GunaDataGridViewAutresRapports, GunaDateTimePickerDateDebut.Value.ToShortDateString, GunaDateTimePickerDateFin.Value.ToShortDateString, GunaComboBoxIndivuelCompany.SelectedIndex)
        End If

    End Sub

    Private Sub GunaCheckBoxDateFictive_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxDateFictive.Click

        If GunaCheckBoxDateFictive.Checked Then
            GunaDateTimePickerDateDeTravailFictif.Visible = True
            GlobalVariable.DateDeTravail = GunaDateTimePickerDateDeTravailFictif.Value.ToShortDateString
        Else
            GunaDateTimePickerDateDeTravailFictif.Visible = False
            GlobalVariable.DateDeTravail = Functions.ObtenirDateDeTravail()
            date_travail.Text = GlobalVariable.DateDeTravail
            GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail
        End If

    End Sub

    Private Sub GunaDateTimePickerDateDeTravailFictif_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerDateDeTravailFictif.ValueChanged

        If GunaCheckBoxDateFictive.Checked Then
            GunaDateTimePickerDateDeTravailFictif.Visible = True
            GlobalVariable.DateDeTravail = GunaDateTimePickerDateDeTravailFictif.Value.ToShortDateString
            date_travail.Text = GlobalVariable.DateDeTravail
            GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail
        End If

    End Sub

    Private Sub GunaButton21_Click(sender As Object, e As EventArgs) Handles GunaButton21.Click

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelRapport.Text = "ECARTS TARIFAIRES"
        Else
            GunaLabelRapport.Text = "DISCOUNT CONTROL"
        End If

        GlobalVariable.DocumentToGenerate = "ecart de prix"
        TabControlRapport.SelectedIndex = 3

    End Sub

    Private Sub GunaButton22_Click(sender As Object, e As EventArgs) Handles GunaButton22.Click

        GunaComboBoxIndivuelCompany.Visible = False
        Dim dateDesTravaux As DataTable = Functions.allTableFields("cloture")

        GunaDateTimePickerDateDebut.Visible = True

        If dateDesTravaux.Rows.Count > 0 Then
            GunaDateTimePickerDateDebut.Value = CDate(dateDesTravaux.Rows(0)("DATE_DE_TRAVAIL")).ToShortDateString
        End If

        GunaDateTimePickerDateFin.Visible = True
        GunaDateTimePickerDateFin.Value = GlobalVariable.DateDeTravail

        GunaDataGridViewAutresRapports.Columns.Clear()

        If GlobalVariable.actualLanguageValue = 1 Then
            GunaLabelAutreRapports.Text = "LISTE DES DEBITEURS"
        Else
            GunaLabelAutreRapports.Text = "LIST OF DEBTORS"
        End If

        GunaComboBoxIndivuelCompany.Visible = True

        GunaComboBoxIndivuelCompany.Items.Clear()
        GunaComboBoxIndivuelCompany.Items.Add("Individuel")
        GunaComboBoxIndivuelCompany.Items.Add("Entreprise")

        GunaComboBoxIndivuelCompany.SelectedIndex = 0

        GlobalVariable.DocumentToGenerate = "debiteurs"

        GunaButtonImprimer.Visible = False

        TabControlRapport.SelectedIndex = 1

    End Sub

    Private Sub GunaComboBoxFiltres_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GunaComboBoxFiltres.SelectedIndexChanged

        GunaDataGridViewRapportDST.Columns.Clear()

        If GunaComboBoxFiltres.SelectedIndex = 3 Then
            If GlobalVariable.DocumentToGenerate = "reservations" Then
                'GunaDateTimePickerAu.Enabled = False
            End If
        Else
            GunaDateTimePickerAu.Enabled = True
        End If

        GunaButtonImpressionPourDST.Visible = False

    End Sub

    Private Sub GunaButton23_Click(sender As Object, e As EventArgs) Handles GunaButton23.Click

        GunaComboBoxFiltres.Items.Clear()

        If GlobalVariable.actualLanguageValue = 1 Then

            GunaComboBoxFiltres.Items.Add("Comptoir")
            GunaComboBoxFiltres.Items.Add("Transfert en chambre")
            GunaComboBoxFiltres.Items.Add("Offres")
            GunaComboBoxFiltres.Items.Add("Transfert vers compte")
            GunaComboBoxFiltres.Items.Add("Bloc notes")
            GunaComboBoxFiltres.Items.Add("Ventes en salle")

            GunaLabelRapport.Text = "LISTE DES BLOC NOTES"

        Else

            GunaComboBoxFiltres.Items.Add("Walk In")
            GunaComboBoxFiltres.Items.Add("Transferred to Room")
            GunaComboBoxFiltres.Items.Add("Offer")
            GunaComboBoxFiltres.Items.Add("Transfert to Account")
            GunaComboBoxFiltres.Items.Add("Receipt")
            GunaComboBoxFiltres.Items.Add("Events Sales")

            GunaLabelRapport.Text = "LIST OF RECEIPTS"

        End If

        GlobalVariable.DocumentToGenerate = "bloc notes"

        TabControlRapport.SelectedIndex = 3

        GunaComboBoxFiltres.Visible = True

        GunaComboBoxFiltres.SelectedIndex = 0

    End Sub

    Private Sub GunaComboBoxHeureNavette_Click(sender As Object, e As EventArgs) Handles GunaComboBoxHeureDepartNavette.Click
        TimePickerForm.GunaLabelTitreHeure.Text = "HEURE DE DEPART NAVETTE"

        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        TimePickerForm.Show()
        TimePickerForm.Location = New Point(300, 200)
        TimePickerForm.TopMost = True
    End Sub

    Private Sub GunaComboBox6_Click(sender As Object, e As EventArgs) Handles GunaComboBoxHeureNavetteArrivee.Click
        TimePickerForm.GunaLabelTitreHeure.Text = "HEURE D'ARRIVER NAVETTE"

        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        TimePickerForm.Show()
        TimePickerForm.Location = New Point(300, 200)
        TimePickerForm.TopMost = True
    End Sub

    Private Sub GunaComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GunaComboBoxLieuDepart.SelectedIndexChanged

        If GunaComboBoxLieuDepart.SelectedIndex = 2 Then
            GunaTextBox8.Visible = True
        Else
            GunaTextBox8.Visible = False
        End If

    End Sub

    Private Sub GunaComboBox5_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GunaComboBoxLieuArrive.SelectedIndexChanged

        If GunaComboBoxLieuArrive.SelectedIndex = 2 Then
            GunaTextBox6.Visible = True
        Else
            GunaTextBox6.Visible = False
        End If

    End Sub

    Private Sub masquerPickOffNavette(ByVal type As Integer)

        If type = 2 Or type = 3 Then

            'GunaLabel152.Visible = False
            'GunaComboBoxLieuArrive.Visible = False
            'GunaTextBox6.Visible = False
            GunaDateTimePicker2.Visible = True
            GunaComboBoxHeureNavetteArrivee.Visible = True

            If type = 2 Then
                GunaLabel151.Text = "Compagnie"
                If GlobalVariable.actualLanguageValue = 1 Then

                Else

                End If
                GunaTextBoxVol.Visible = True
                GunaLabel164.Visible = True
            Else
                GunaLabel151.Text = "Comment"
                If GlobalVariable.actualLanguageValue = 1 Then

                Else

                End If
                GunaTextBoxVol.Visible = False
                GunaLabel164.Visible = False
            End If

        Else

            GunaTextBoxVol.Visible = True
            GunaLabel164.Visible = True
            GunaLabel151.Text = "Comment"
            If GlobalVariable.actualLanguageValue = 1 Then

            Else

            End If
            'GunaLabel152.Visible = True
            'GunaComboBoxLieuArrive.Visible = True
            GunaDateTimePicker2.Visible = False
            GunaComboBoxHeureNavetteArrivee.Visible = False

        End If

    End Sub

    Private Sub gestionDesNavettes(ByVal operation As Integer, ByVal CODE_RESERVATION As String)

        Dim resa As New Reservation()

        Dim COMPANIE As String = GunaTextBoxCompagnie.Text
        Dim VOL As String = GunaTextBoxVol.Text

        Dim TYPE_DE_TRAJET As String = ""
        Dim INDEX_TYPE_DE_TRAJET As Integer = 0

        If GunaComboBoxTypeDeTrajet.SelectedIndex >= 0 Then
            TYPE_DE_TRAJET = GunaComboBoxTypeDeTrajet.SelectedItem
            INDEX_TYPE_DE_TRAJET = GunaComboBoxTypeDeTrajet.SelectedIndex
        End If

        Dim NBRE_PERSONNE As Integer = 0

        If Not Trim(GunaTextBox34.Text).Equals("") Then
            NBRE_PERSONNE = GunaTextBox34.Text
        End If

        Dim DEPART As String = ""
        Dim AUTRE_DEPART As String = ""
        Dim DATE_DEPART As Date
        Dim HEURE_DEPART As String = ""

        If GunaComboBoxLieuDepart.SelectedIndex >= 0 Then

            DEPART = GunaComboBoxLieuDepart.SelectedItem

            AUTRE_DEPART = GunaTextBox8.Text

            DATE_DEPART = GunaDateTimePicker1.Value.ToShortDateString()

            If GunaComboBoxHeureDepartNavette.Items.Count > 0 Then
                HEURE_DEPART = GunaComboBoxHeureDepartNavette.SelectedItem
            End If

        End If

        Dim ARRIVER As String = ""
        Dim AUTRE_ARRIVE As String = ""
        Dim HEURE_ARRIVEE As String = ""
        Dim DATE_ARRIVEE As Date

        If GunaComboBoxLieuArrive.SelectedIndex >= 0 Then

            ARRIVER = GunaComboBoxLieuArrive.SelectedItem

            AUTRE_ARRIVE = GunaTextBox6.Text

            If INDEX_TYPE_DE_TRAJET = 2 Or INDEX_TYPE_DE_TRAJET = 3 Then
                DATE_ARRIVEE = GunaDateTimePicker2.Value.ToShortDateString()

                If GunaComboBoxHeureNavetteArrivee.Items.Count > 0 Then
                    HEURE_ARRIVEE = GunaComboBoxHeureNavetteArrivee.SelectedItem
                End If
            End If

        End If

        Dim DATE_CREATION As Date = GlobalVariable.DateDeTravail.ToShortDateString()

        If operation = 0 Then 'INSERTION DANS LA BASE DE DONNEE

            If Not Trim(COMPANIE).Equals("") Then

                resa.insertionDesNavettes(CODE_RESERVATION, COMPANIE, VOL, TYPE_DE_TRAJET, NBRE_PERSONNE, DEPART, AUTRE_DEPART, ARRIVER, AUTRE_ARRIVE, DATE_DEPART, HEURE_ARRIVEE, DATE_ARRIVEE, HEURE_DEPART, DATE_CREATION)

                GunaComboBoxLieuArrive.SelectedIndex = -1
                GunaComboBoxLieuDepart.SelectedIndex = -1
                GunaComboBoxTypeDeTrajet.SelectedIndex = -1
                GunaComboBoxHeureNavetteArrivee.SelectedIndex = -1
                GunaComboBoxHeureDepartNavette.SelectedIndex = -1

            End If

        ElseIf operation = 1 Then 'MISE A JOURS DE LA BASE DE DONNEE

            If Not Trim(COMPANIE).Equals("") Then

                Dim infoSupNavette As DataTable = Functions.getElementByCode(CODE_RESERVATION, "navette", "CODE_RESERVATION")

                If infoSupNavette.Rows.Count > 0 Then

                    resa.UpdateDesNavettes(CODE_RESERVATION, COMPANIE, VOL, TYPE_DE_TRAJET, NBRE_PERSONNE, DEPART, AUTRE_DEPART, ARRIVER, AUTRE_ARRIVE, DATE_DEPART, HEURE_ARRIVEE, DATE_ARRIVEE, HEURE_DEPART, DATE_CREATION)

                    GunaComboBoxLieuArrive.SelectedIndex = -1
                    GunaComboBoxLieuDepart.SelectedIndex = -1
                    GunaComboBoxTypeDeTrajet.SelectedIndex = -1
                    GunaComboBoxHeureNavetteArrivee.SelectedIndex = -1
                    GunaComboBoxHeureDepartNavette.SelectedIndex = -1

                Else

                    resa.insertionDesNavettes(CODE_RESERVATION, COMPANIE, VOL, TYPE_DE_TRAJET, NBRE_PERSONNE, DEPART, AUTRE_DEPART, ARRIVER, AUTRE_ARRIVE, DATE_DEPART, HEURE_ARRIVEE, DATE_ARRIVEE, HEURE_DEPART, DATE_CREATION)

                    GunaComboBoxLieuArrive.SelectedIndex = -1
                    GunaComboBoxLieuDepart.SelectedIndex = -1
                    GunaComboBoxTypeDeTrajet.SelectedIndex = -1
                    GunaComboBoxHeureNavetteArrivee.SelectedIndex = -1
                    GunaComboBoxHeureDepartNavette.SelectedIndex = -1

                    GunaLabelNbreDeNavette.Text = "(" & Functions.alerteNavette() & ")"

                End If


            End If

        ElseIf operation = 2 Then 'AFFICHAGE DES INFORMATION DE LA NAVETTE

            Dim infoSupNavette As DataTable = Functions.getElementByCode(CODE_RESERVATION, "navette", "CODE_RESERVATION")

            If infoSupNavette.Rows.Count > 0 Then

                GunaTextBoxCompagnie.Text = infoSupNavette.Rows(0)("COMPANIE")
                GunaTextBoxVol.Text = infoSupNavette.Rows(0)("VOL")
                GunaTextBox34.Text = infoSupNavette.Rows(0)("NBRE_PERSONNE")

                GunaComboBoxTypeDeTrajet.SelectedItem = infoSupNavette.Rows(0)("TYPE_DE_TRAJET")

                GunaComboBoxLieuDepart.SelectedItem = infoSupNavette.Rows(0)("DEPART")
                GunaTextBox8.Text = infoSupNavette.Rows(0)("AUTRE_DEPART")

                If infoSupNavette.Rows(0)("DATE_DEPART").ToShortDateString() <= GunaDateTimePicker1.MaxDate And infoSupNavette.Rows(0)("DATE_DEPART").ToShortDateString() >= GunaDateTimePicker1.MinDate Then
                    GunaDateTimePicker1.Value = infoSupNavette.Rows(0)("DATE_DEPART").ToShortDateString()
                Else
                    GunaDateTimePicker1.Value = GlobalVariable.DateDeTravail.ToShortDateString()
                End If

                GunaComboBoxHeureDepartNavette.Items.Clear()
                GunaComboBoxHeureDepartNavette.Items.Add(infoSupNavette.Rows(0)("HEURE_DEPART"))
                GunaComboBoxHeureDepartNavette.SelectedItem = infoSupNavette.Rows(0)("HEURE_DEPART")

                GunaComboBoxLieuArrive.SelectedItem = infoSupNavette.Rows(0)("ARRIVER")
                GunaTextBox6.Text = infoSupNavette.Rows(0)("AUTRE_ARRIVE")

                If infoSupNavette.Rows(0)("DATE_ARRIVEE").ToShortDateString() <= GunaDateTimePicker2.MaxDate And infoSupNavette.Rows(0)("DATE_ARRIVEE").ToShortDateString() >= GunaDateTimePicker2.MinDate Then
                    GunaDateTimePicker2.Value = infoSupNavette.Rows(0)("DATE_ARRIVEE").ToShortDateString()
                Else
                    GunaDateTimePicker2.Value = GlobalVariable.DateDeTravail.ToShortDateString()
                End If

                GunaComboBoxHeureNavetteArrivee.Items.Clear()
                GunaComboBoxHeureNavetteArrivee.Items.Add(infoSupNavette.Rows(0)("HEURE_ARRIVEE"))
                GunaComboBoxHeureNavetteArrivee.SelectedItem = infoSupNavette.Rows(0)("HEURE_ARRIVEE")

            End If

        End If

    End Sub

    Private Sub GunaButton24_Click(sender As Object, e As EventArgs) Handles GunaButton24.Click

        GunaDateTimePickerDateDebut.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDateFin.Value = GlobalVariable.DateDeTravail.AddDays(1)

        GunaLabelAutreRapports.Text = "NAVETTES"

        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        GlobalVariable.DocumentToGenerate = "navette"
        GunaComboBoxIndivuelCompany.Visible = True

        GunaComboBoxIndivuelCompany.Items.Clear()
        GunaComboBoxIndivuelCompany.Items.Add("Pick Up")
        GunaComboBoxIndivuelCompany.Items.Add("Drop Off")
        GunaComboBoxIndivuelCompany.Items.Add("Pick Up / Drop Off")
        GunaComboBoxIndivuelCompany.Items.Add("Course")
        GunaComboBoxIndivuelCompany.Items.Add("Toutes")

        GunaComboBoxIndivuelCompany.SelectedIndex = 0
        TabControlRapport.SelectedIndex = 1

    End Sub

    Private Sub GunaComboBox1_SelectedIndexChanged_1(sender As Object, e As EventArgs) Handles GunaComboBoxIndivuelCompany.SelectedIndexChanged
        GunaDataGridViewAutresRapports.Columns.Clear()
        GunaButtonImprimer.Visible = False
    End Sub

    Private Sub GunaButton25_Click(sender As Object, e As EventArgs) Handles GunaButton25.Click

        PanelRapports.BringToFront()
        PanelRapports.Show()

        'Raports de la réception
        TabControlRapport.SelectedIndex = 0

        GunaDateTimePickerDateDebut.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDateFin.Value = GlobalVariable.DateDeTravail.AddDays(1)

        GunaLabelAutreRapports.Text = "NAVETTES"
        GlobalVariable.DocumentToGenerate = "navette"
        GunaComboBoxIndivuelCompany.Visible = True
        GunaComboBoxIndivuelCompany.SelectedIndex = 0
        TabControlRapport.SelectedIndex = 1

    End Sub

    Private Sub GunaComboBoxTypeDeTrajet_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GunaComboBoxTypeDeTrajet.SelectedIndexChanged

        masquerPickOffNavette(GunaComboBoxTypeDeTrajet.SelectedIndex)

    End Sub

    Private Sub GunaRadioButtonSalleFete_CheckedChanged(sender As Object, e As EventArgs) Handles GunaRadioButtonSalleFete.CheckedChanged

        If GunaRadioButtonSalleFete.Checked Then
            GunaComboBoxTypeDeDocSalle.Visible = True
            GunaComboBoxTypeDeDocSalle.SelectedIndex = 0
        Else
            GunaComboBoxTypeDeDocSalle.Visible = False
        End If

    End Sub

    Private Sub GunaRadioButtonWhatsAppOui_CheckedChanged(sender As Object, e As EventArgs) Handles GunaRadioButtonWhatsAppOui.CheckedChanged

        If GunaRadioButtonWhatsAppOui.Checked Then

            If Trim(GunaTextBoxTelClient.Text).Equals("") Or GunaTextBoxTelClient.Text.Length < 13 Then
                GunaRadioButtonWhatsAppOui.Checked = False
                GunaRadioButtonWhatsAppNon.Checked = True
            End If

        End If


    End Sub

    Private Sub GunaRadioButtonMailOui_CheckedChanged(sender As Object, e As EventArgs) Handles GunaRadioButtonMailOui.CheckedChanged

        If GunaRadioButtonMailOui.Checked Then


            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Bien vouloir saisir une adresse email valide", "Envoyer un document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("Pleas type in a valide email ", "Send document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

            If Trim(GunaTextBoxClientEmail.Text).Equals("") Then
                GunaRadioButtonEmailNon.Checked = True
            Else
                If GunaTextBoxClientEmail.Text.Length <= 10 Then
                    GunaRadioButtonEmailNon.Checked = True
                End If
            End If

        End If

    End Sub

    Private Sub EMAILToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles EMAILToolStripMenuItem.Click

        GlobalVariable.DocumentToGenerate = "facture"

        Dim WHATSAPP_OU_EMAIL As Integer = 1

        Dim EMAIL As String = GlobalVariable.ClientToUpdate.Rows(0)("EMAIL")

        If Not Trim(EMAIL).Equals("") And EMAIL.Length >= 10 Then

            Dim args As ArgumentType = New ArgumentType()

            args.action = 7

            backGroundWorkerToCall(args)

        Else
            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Addresse Electronique invalide", "Envoyer un document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("Invalid email addresse", "Send document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If


        End If

    End Sub

    Private Sub WHATSAPPToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles WHATSAPPToolStripMenuItem.Click

        GlobalVariable.DocumentToGenerate = "facture"


        Dim TELEPHONE As String = GlobalVariable.ClientToUpdate.Rows(0)("TELEPHONE")

        If Not Trim(TELEPHONE).Equals("") And TELEPHONE.Length >= 13 Then
            Dim args As ArgumentType = New ArgumentType()
            args.action = 6
            backGroundWorkerToCall(args)
        Else

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Numéro de téléphone invalide", "Envoyer un document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("Invalid phone number ", "Send document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If


        End If

    End Sub

    Private Sub EMAILToolStripMenuItem1_Click(sender As Object, e As EventArgs) Handles EMAILToolStripMenuItem1.Click

        GlobalVariable.DocumentToGenerate = "reglement"

        Dim WHATSAPP_OU_EMAIL As Integer = 1

        Dim EMAIL As String = GlobalVariable.ClientToUpdate.Rows(0)("EMAIL")


        If Not Trim(EMAIL).Equals("") And EMAIL.Length >= 10 Then

            Dim args As ArgumentType = New ArgumentType()

            args.action = 9

            backGroundWorkerToCall(args)

        Else
            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Adresse Electronique invalide", "Envoyer un document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("iinvalid email addresse", "Send document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

        End If

    End Sub

    Private Sub WHATSAPPToolStripMenuItem1_Click(sender As Object, e As EventArgs) Handles WHATSAPPToolStripMenuItem1.Click

        GlobalVariable.DocumentToGenerate = "reglement"

        Dim WHATSAPP_OU_EMAIL As Integer = 0

        Dim TELEPHONE As String = GlobalVariable.ClientToUpdate.Rows(0)("TELEPHONE")

        If Not Trim(TELEPHONE).Equals("") And TELEPHONE.Length >= 13 Then

            Dim args As ArgumentType = New ArgumentType()

            args.action = 8

            backGroundWorkerToCall(args)

        Else

            If GlobalVariable.actualLanguageValue = 1 Then
                MessageBox.Show("Numéro de téléphone invalide", "Envoyer un document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            Else
                MessageBox.Show("invalid phone number", "Send document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

        End If

    End Sub

    Private Sub GunaButton26_Click(sender As Object, e As EventArgs) Handles GunaButton26.Click

        BackgroundWorker4.RunWorkerAsync()

    End Sub

    Private Sub documentToBeSendUsingBackGroundWorker(ByVal args As ArgumentType)

        If args.action = 0 Then
            Functions.ultrMessageSimpleText(args.whatsAppMessage, args.mobile_number)
        ElseIf args.action = 1 Then
            'SALLE CONFIRMATION
            RapportApresCloture.GenerationDeConfirmationReservation(args.CODE_RESERVATAION, args.NOM_PRENOM, args.ARRIVAL, args.DEPART, args.TEMP_A_FAIRE, args.TYPE_CHAMBRE, args.NUM_CHAMBRE, args.MONTANT_PAR_NUITEE, args.HEURE_ARRIVEE, args.HEURE_DEPART, args.TYPE_CHAMBRE_SALLE, args.EMAIL, args.TELEPHONE_CLIENT, args.WHATSAPP_OU_EMAIL)
        ElseIf args.action = 2 Then

            'DEVIS ESTIMATIF
            RapportApresCloture.devisEstimatifDeSalleDeFete(args.CODE_RESERVATAION, args.NOM_PRENOM, args.ARRIVAL, args.DEPART, args.TEMP_A_FAIRE, args.TYPE_CHAMBRE, args.NUM_CHAMBRE, args.MONTANT_PAR_NUITEE, args.HEURE_ARRIVEE, args.HEURE_DEPART, args.TYPE_CHAMBRE_SALLE, args.EMAIL, args.TELEPHONE_CLIENT, args.WHATSAPP_OU_EMAIL)
        ElseIf args.action = 3 Then
            'CHAMBRE CONFIRMATION
            RapportApresCloture.GenerationDeConfirmationReservation(args.CODE_RESERVATAION, args.NOM_PRENOM, args.ARRIVAL, args.DEPART, args.TEMP_A_FAIRE, args.TYPE_CHAMBRE, args.NUM_CHAMBRE, args.MONTANT_PAR_NUITEE, args.HEURE_ARRIVEE, args.HEURE_DEPART, args.TYPE_CHAMBRE_SALLE, args.EMAIL, args.TELEPHONE_CLIENT, args.WHATSAPP_OU_EMAIL)
        ElseIf args.action = 4 Then
            'FICHE DE POLICE
            RapportApresCloture.GenerationDeFicheDePolice(args.CODE_RESERVATAION, args.NOM_PRENOM, args.ARRIVAL, args.DEPART, args.TEMP_A_FAIRE, args.TYPE_CHAMBRE, args.NUM_CHAMBRE, args.MONTANT_PAR_NUITEE, args.HEURE_ARRIVEE, args.HEURE_DEPART, args.TYPE_CHAMBRE_SALLE, args.EMAIL, args.WHATSAPP_OU_EMAIL)

        ElseIf args.action = 5 Then
            'CONTRAT DE LOCATION SALLE
            RapportApresCloture.contratDeLocationDeSalleDeFete(args.CODE_RESERVATAION, args.NOM_PRENOM, args.ARRIVAL, args.DEPART, args.TEMP_A_FAIRE, args.TYPE_CHAMBRE, args.NUM_CHAMBRE, args.MONTANT_PAR_NUITEE, args.HEURE_ARRIVEE, args.HEURE_DEPART, args.TYPE_CHAMBRE_SALLE, args.EMAIL, args.TELEPHONE_CLIENT, args.WHATSAPP_OU_EMAIL)

        ElseIf args.action = 6 Or args.action = 7 Then

            Dim WHATSAPP_OU_EMAIL As Integer = 0

            If args.action = 7 Then
                WHATSAPP_OU_EMAIL = 1
            End If

            Functions.DocumentFactureToSend(GunaDataGridViewDesFactures.CurrentRow.Cells("CODE").Value.ToString, "lign_facture", "CODE_FACTURE", GlobalVariable.codeClientToUpdate, GunaLabelNumReservation.Text, WHATSAPP_OU_EMAIL)

        ElseIf args.action = 8 Or args.action = 9 Then

            Dim WHATSAPP_OU_EMAIL As Integer = 0

            If args.action = 9 Then
                WHATSAPP_OU_EMAIL = 1
            End If

            Functions.DocumentFactureToSend(GunaDataGridViewListeDesReglement.CurrentRow.Cells("CODE").Value.ToString, "reglement", "NUM_REGLEMENT", GlobalVariable.codeClientToUpdate, GunaLabelNumReservation.Text, WHATSAPP_OU_EMAIL)

        End If

    End Sub

    Private Sub BackgroundWorker1_DoWork(sender As Object, e As DoWorkEventArgs) Handles BackgroundWorker1.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker2_DoWork(sender As Object, e As DoWorkEventArgs) Handles BackgroundWorker2.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker3_DoWork(sender As Object, e As DoWorkEventArgs) Handles BackgroundWorker3.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker4_DoWork(sender As Object, e As DoWorkEventArgs) Handles BackgroundWorker4.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker5_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker5.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker6_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker6.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker7_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker7.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker8_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker8.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker9_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker9.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker10_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker10.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    '-----------------------------------

    Private Sub BackgroundWorker11_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker11.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker12_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker12.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker13_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker13.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker14_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker14.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker15_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker15.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker16_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker16.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker17_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker17.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker18_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker18.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker19_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker19.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub BackgroundWorker20_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker20.DoWork

        Dim args As ArgumentType = e.Argument

        documentToBeSendUsingBackGroundWorker(args)

    End Sub

    Private Sub backGroundWorkerToCall(ByVal args As ArgumentType)

        If Not BackgroundWorker1.IsBusy Then
            BackgroundWorker1.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker2.IsBusy Then
            BackgroundWorker2.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker3.IsBusy Then
            BackgroundWorker3.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker4.IsBusy Then
            BackgroundWorker4.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker5.IsBusy Then
            BackgroundWorker5.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker6.IsBusy Then
            BackgroundWorker6.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker7.IsBusy Then
            BackgroundWorker7.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker8.IsBusy Then
            BackgroundWorker8.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker9.IsBusy Then
            BackgroundWorker9.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker10.IsBusy Then
            BackgroundWorker10.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker11.IsBusy Then
            BackgroundWorker11.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker12.IsBusy Then
            BackgroundWorker12.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker13.IsBusy Then
            BackgroundWorker13.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker14.IsBusy Then
            BackgroundWorker14.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker15.IsBusy Then
            BackgroundWorker15.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker16.IsBusy Then
            BackgroundWorker16.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker17.IsBusy Then
            BackgroundWorker17.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker18.IsBusy Then
            BackgroundWorker18.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker19.IsBusy Then
            BackgroundWorker19.RunWorkerAsync(args)
        ElseIf Not BackgroundWorker20.IsBusy Then
            BackgroundWorker20.RunWorkerAsync(args)
        End If

    End Sub

    Private Sub ToolStripMenuItem4_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem4.Click

        GlobalVariable.typeArticle = "materiels"
        ArticleForm.TopMost() = True
        ArticleForm.Show()

    End Sub

    Private Sub GunaButtonRapportAutomatique_Click(sender As Object, e As EventArgs) Handles GunaButtonRapportAutomatique.Click

        RenvoiRapportForm.Show()
        RenvoiRapportForm.TopMost = True
        RenvoiRapportForm.GunaDateTimePickerDateMainCouranteJournaliere.Value = CDate(GlobalVariable.DateDeTravail).AddDays(-1)

    End Sub

    Private Sub GunaButtonTraces_Click(sender As Object, e As EventArgs) Handles GunaButtonTraces.Click

        GlobalVariable.DocumentToGenerate = "MOUCHARDS"

        RapportFacturesForm.GunaTextBoxCodeResa.Text = GunaLabelNumReservation.Text
        RapportFacturesForm.GunaCheckBoxPropResa.Checked = False
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True

    End Sub

    Private Sub GunaCheckBoxToutesLesSource_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxToutesLesSource.CheckedChanged

        If GunaCheckBoxToutesLesSource.Checked Then
            GunaComboBoxSourceResaRapport.DataSource = Nothing
        Else
            autoLoadSourceResaRapport()
        End If

    End Sub

    Private Sub GunaButton27_Click(sender As Object, e As EventArgs) Handles GunaButton27.Click

        GlobalVariable.DocumentToGenerate = "HEBERGEMENT"

        If GlobalVariable.actualLanguageValue = 1 Then
            RapportFacturesForm.GunaLabelGeneral.Text = "CHIFFRE D'AFFAIRES PAR SERVICE"
        Else
            RapportFacturesForm.GunaLabelGeneral.Text = "SALES REVENUE PER DEPARTMENT"
        End If

        RapportFacturesForm.GunaCheckBoxPropResa.Checked = False
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True

    End Sub

    Private Sub GunaCheckBoxReservationDeGroupe_CheckedChanged(sender As Object, e As EventArgs) Handles GunaCheckBoxReservationDeGroupe.CheckedChanged

        If Not Trim(GlobalVariable.codeReservationToUpdate).Equals("") Then
            If GunaCheckBoxReservationDeGroupe.Checked Then
                GunaButtonSynthese.Visible = True
            Else
                GunaButtonSynthese.Visible = False
            End If
        End If

    End Sub

    Private Sub GunaButtonSynthese_Click(sender As Object, e As EventArgs) Handles GunaButtonSynthese.Click

        FabricationDeProformaForm.Show()
        FabricationDeProformaForm.TopMost = True

    End Sub

    Private Sub GunaButtonHebergement_Click(sender As Object, e As EventArgs) Handles GunaButtonHebergement.Click

        FabricationDeProformaForm.Show()
        FabricationDeProformaForm.TopMost = True

    End Sub

    Private Sub VisiteurToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles VisiteurToolStripMenuItem.Click

        RegisterForm.Show()
        RegisterForm.TopMost = True

    End Sub

    Private Sub TabPage2_Click(sender As Object, e As EventArgs) Handles TabPage2.Click

    End Sub

    Private Sub GunaButtonStatDashBoard_Click(sender As Object, e As EventArgs) Handles GunaButtonStatDashBoard.Click

        GlobalVariable.DocumentToGenerate = "STATISTQIUES DU DASHBOARD"

        RapportFacturesForm.GunaLabelGeneral.Text = "STATISTQIUES DU DASHBOARD"
        RapportFacturesForm.GunaCheckBoxPropResa.Checked = False
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True

    End Sub

    Private Sub PlanningToolStripMenuItem1_Click(sender As Object, e As EventArgs) Handles PlanningToolStripMenuItem1.Click

        PlanningHebdomadaireDuPersonnelForm.Show()
        PlanningHebdomadaireDuPersonnelForm.TopMost = True

    End Sub

    Private Sub GunaButtonPrixMoyens_Click(sender As Object, e As EventArgs) Handles GunaButtonPrixMoyens.Click

        GlobalVariable.DocumentToGenerate = "STATISTQIUES DES PRIX MOYENS"

        RapportFacturesForm.GunaLabelGeneral.Text = "STATISTQIUES DES PRIX MOYENS"

        RapportFacturesForm.GunaCheckBoxPropResa.Checked = False
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True

    End Sub

    Private Sub GunaButtonProductionReceptionnists_Click(sender As Object, e As EventArgs) Handles GunaButtonProductionReceptionnists.Click

        GlobalVariable.DocumentToGenerate = "PRODUCTIVITE DES RECEPTIONNISTES"

        RapportFacturesForm.GunaLabelGeneral.Text = "PRODUCTIVITE DES RECEPTIONNISTES"
        RapportFacturesForm.GunaCheckBoxPropResa.Checked = False
        RapportFacturesForm.GunaButtonAfficher.Visible = False
        RapportFacturesForm.GunaButtonImprimer.Visible = True
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True

    End Sub

    Private Sub GunaAdvenceButtonVisite_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonVisite.Click
        RegisterForm.Show()
        RegisterForm.TopMost = True
    End Sub

    Private Sub GunaButton29_Click(sender As Object, e As EventArgs) Handles GunaButton29.Click
        BrowserForm.Show()
        BrowserForm.TopMost = True
    End Sub

    Private Sub GunaButtonRapportNonDayUse_Click(sender As Object, e As EventArgs) Handles GunaButtonRapportNonDayUse.Click

        GlobalVariable.DocumentToGenerate = "non day use"
        GunaLabelRapport.Text = "LISTE DES SEJOURS"

        If GlobalVariable.actualLanguageValue = 1 Then

        Else

        End If

        TabControlRapport.SelectedIndex = 3

    End Sub

    Private Sub ClubEliteToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ClubEliteToolStripMenuItem.Click

        If GlobalVariable.AgenceActuelle.Rows.Count > 0 Then

            If GlobalVariable.AgenceActuelle.Rows(0)("CLUB_ELITE") = 1 Then
                EliteClubForm.Show()
                EliteClubForm.TopMost = True
            Else
                If GlobalVariable.actualLanguageValue = 1 Then
                    MessageBox.Show("Le programme de Fidélité n'est pas activé", "Club Elite", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Else
                    MessageBox.Show("The fidelity program is not actif", "Elite Club", MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
            End If

        End If

    End Sub

    Private Sub GunaTextBoxCodeElite_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxCodeElite.TextChanged

        If Trim(GunaTextBoxCodeElite.Text).Equals("") Then

            GunaLabelCodeTarif.Visible = False
            GunaComboBoxCodeEliteMember.Visible = False

            If GlobalVariable.typeChambreOuSalle = "chambre" Then
                GunaTextBoxMontantAccorde.Text = GunaTextBoxpPrixAffiche.Text
            Else
                GunaTextBoxMontantReelSalle.Text = GunaTextBoxMontantAfficherSalle.Text
            End If

        Else

            If GlobalVariable.AgenceActuelle.Rows(0)("CLUB_ELITE") = 1 Then
                gestionReductionClubElite()
            End If

        End If

    End Sub

    Public Sub gestionReductionClubElite()

        If Not Trim(GunaTextBoxCodeElite.Text).Equals("") Then

            Dim CODE_CLIENT As String = GunaTextBoxRefClient.Text
            Dim CODE_ELITE As String = GunaTextBoxCodeElite.Text
            Dim elite As New ClubElite()
            Dim dt As DataTable = elite.infoDuCodeElite(CODE_ELITE)

            Dim MEMBRE As String = ""

            If dt.Rows.Count > 0 Then

                MEMBRE = dt.Rows(0)("MEMBRE")
                GunaComboBoxCodeEliteMember.Visible = True
                GunaLabelCodeTarif.Visible = True
                GunaLabelCodeTarif.Text = "ELITE"
                GunaComboBoxCodeEliteMember.DataSource = Nothing
                GunaComboBoxCodeEliteMember.DataSource = dt
                GunaComboBoxCodeEliteMember.ValueMember = "TYPE_MEMBRE"
                GunaComboBoxCodeEliteMember.DisplayMember = "TYPE_MEMBRE"

                If GlobalVariable.ReservationToUpdate Is Nothing Then

                    Dim MONTANT_ACCORDE As Double = 0

                    If GlobalVariable.typeChambreOuSalle = "chambre" Then
                        If Not Trim(GunaTextBoxMontantAccorde.Text).Equals("") Then
                            MONTANT_ACCORDE = GunaTextBoxMontantAccorde.Text
                        End If
                    Else
                        If Not Trim(GunaTextBoxMontantReelSalle.Text).Equals("") Then
                            MONTANT_ACCORDE = GunaTextBoxMontantReelSalle.Text
                        End If
                    End If

                    Dim DISCOUNT As Double = MONTANT_ACCORDE - ((dt.Rows(0)("REDUCTION_ACCORDEE") / 100) * MONTANT_ACCORDE)

                    If GlobalVariable.typeChambreOuSalle = "chambre" Then
                        GunaTextBoxMontantAccorde.Text = Format(DISCOUNT, "#,##0")
                    Else
                        GunaTextBoxMontantReelSalle.Text = Format(DISCOUNT, "#,##0")
                    End If

                End If

                If MEMBRE = "SILVER" Then
                    GunaComboBoxCodeEliteMember.BaseColor = Color.Silver
                    GunaComboBoxCodeEliteMember.ForeColor = Color.White
                ElseIf MEMBRE = "GOLD" Then
                    GunaComboBoxCodeEliteMember.BaseColor = Color.Gold
                    GunaComboBoxCodeEliteMember.ForeColor = Color.White
                ElseIf MEMBRE = "PLATINUM" Then
                    GunaComboBoxCodeEliteMember.BaseColor = Color.DarkSlateGray
                    GunaComboBoxCodeEliteMember.ForeColor = Color.White
                End If

            End If

        End If

    End Sub


    Private Sub GunaAdvenceButton2_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton2.Click

        ClientForm.Show()
        ClientForm.TabControl1.SelectedIndex = 5

    End Sub

    Private Sub GunaAdvenceButton3_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton3.Click, GunaAdvenceButtonHospitality.Click

        ClientForm.Show()
        ClientForm.TabControl1.SelectedIndex = 5

    End Sub

    Private Sub GunaButtonPeriodicAccommodationReport_Click(sender As Object, e As EventArgs) Handles GunaButtonPeriodicAccommodationReport.Click

        RapportFacturesForm.Close()
        GlobalVariable.DocumentToGenerate = "PERIODIC ACCOMMODATION REPORT"
        RapportFacturesForm.GunaComboBoxMagasins.Visible = False
        RapportFacturesForm.Show()
        RapportFacturesForm.TopMost = True

        If GlobalVariable.actualLanguageValue = 1 Then
            RapportFacturesForm.GunaLabelGeneral.Text = "CHIFFRE D'AFFAIRES HEBERGEMENT"
        Else
            RapportFacturesForm.GunaLabelGeneral.Text = "PERIODIC ACCOMMODATION SALES REVENUE"
        End If

    End Sub

    Dim page As Integer = 1
    Dim numberPages As Integer = 0

    Private Sub GunaLabel7_Click(sender As Object, e As EventArgs) Handles GunaLabel7.Click

        GunaLabel167.Visible = True
        GunaLabel7.Visible = False
        page = 2
        StatusDesChambres(page)

    End Sub

    Private Sub GunaLabel167_Click(sender As Object, e As EventArgs) Handles GunaLabel167.Click
        GunaLabel167.Visible = False
        GunaLabel7.Visible = True
        page = 1
        StatusDesChambres(page)
    End Sub

    Private Sub GunaButton17_Click_1(sender As Object, e As EventArgs) Handles GunaButton17.Click

        Dim CODE_CHAMBRE As String = ""
        Dim COMMENTAIRE As String = ""
        Dim ETAT_CHAMBRE_NOTE As String = ""
        Dim COD_PERSONNEL As String = ""
        Dim NOM_COMPLET_PERSONNEL As String = ""
        Dim DATE_CREATION As Date = GunaDateTimePickerReportsDate.Value.ToShortDateString()

        Dim query_ As String = "Select * FROM `nettoyage` WHERE DATE_CREATION <= '" & DATE_CREATION.ToString("yyyy-MM-dd") & "' AND DATE_CREATION >='" & DATE_CREATION.ToString("yyyy-MM-dd") & "'"
        Dim command_ As New MySqlCommand(query_, GlobalVariable.connect)

        Dim adapter_ As New MySqlDataAdapter(command_)
        Dim chambreExist As New DataTable()

        adapter_.Fill(chambreExist)

        If Not chambreExist.Rows.Count > 0 Then

            Dim query As String = "SELECT * FROM `chambre` WHERE `ETAT_CHAMBRE_NOTE` LIKE '%sale%' AND TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"
            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

            Dim adapter As New MySqlDataAdapter(command)
            Dim chambre As New DataTable()

            adapter.Fill(chambre)

            Dim service As New ServicesEtage()

            If chambre.Rows.Count > 0 Then

                For i = 0 To chambre.Rows.Count - 1

                    CODE_CHAMBRE = chambre.Rows(i)("CODE_CHAMBRE")
                    COMMENTAIRE = COMMENTAIRE
                    ETAT_CHAMBRE_NOTE = chambre.Rows(i)("ETAT_CHAMBRE_NOTE")

                    service.insertNettoyage(CODE_CHAMBRE, COMMENTAIRE, ETAT_CHAMBRE_NOTE, COD_PERSONNEL, NOM_COMPLET_PERSONNEL, DATE_CREATION)

                Next

            End If

        End If

        Dim Query1 As String = "SELECT DISTINCT `COD_PERSONNEL`, `NOM_COMPLET_PERSONNEL` FROM `nettoyage` WHERE DATE_CREATION <= '" & DATE_CREATION.ToString("yyyy-MM-dd") & "' AND DATE_CREATION >='" & DATE_CREATION.ToString("yyyy-MM-dd") & "' ORDER BY NOM_COMPLET_PERSONNEL ASC"

        Dim command1 = New MySqlCommand(Query1, GlobalVariable.connect)
        'command1.Parameters.Add("@STATUTS", MySqlDbType.Int64).Value = STATUTS
        command1.Parameters.Add("@COD_PERSONNEL", MySqlDbType.VarChar).Value = COD_PERSONNEL

        Dim adapter1 As New MySqlDataAdapter(command1)
        Dim dt As New DataTable()

        adapter1.Fill(dt)
        Dim typeDerapport As Integer = 0
        If dt.Rows.Count > 0 Then
            Impression.planningDeNettoyageShort(dt, typeDerapport, DATE_CREATION, DATE_CREATION)
        End If

    End Sub

    Private Sub GunaAdvenceButton7_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton7.Click
        DepotGarantieForm.Show()
        DepotGarantieForm.TopMost = True
    End Sub

    Private Sub GunaCheckBoxMensuel_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxMensuel.Click

        If GunaCheckBoxMensuel.Checked Then

            GunaCheckBoxDayUse.Checked = False

            GunaComboBoxHeureArrivee.Items.Clear()
            'GunaComboBoxHeureArrivee.Items.Add(CDate(GunaLabelTemps.Text).ToLongTimeString)
            GunaComboBoxHeureArrivee.Items.Add(CDate(StatusBarPanelTime.Text).ToLongTimeString)
            'GunaComboBoxHeureArrivee.SelectedItem = GunaLabelTemps.Text
            GunaComboBoxHeureArrivee.SelectedItem = StatusBarPanelTime.Text

            GunaComboBoxHeureDepart.Items.Clear()
            GunaComboBoxHeureDepart.Items.Add("12:00:00")
            GunaComboBoxHeureDepart.SelectedItem = "12:00:00"

            If GlobalVariable.actualLanguageValue = 1 Then
                GunaLabelTotalHeure.Text = "Nombre de Jour"
                GunaLabelPrixParNuitee.Text = "Prix Mensuel"
                GunaLabelPrixSejours.Text = "Total Mensuel"
                GunaLabelTempsAFaire.Text = "Total jour(s)"
                GunaLabelTypeDeSejour.Text = "MENSUEL"
            Else
                GunaLabelTotalHeure.Text = "Number of Days"
                GunaLabelPrixParNuitee.Text = "Monthly price"
                GunaLabelPrixSejours.Text = "Total Monthly"
                GunaLabelTempsAFaire.Text = "Total Months(s)"
                GunaLabelTypeDeSejour.Text = "MONTHLY"
            End If

            GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail.AddDays(1)
            GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail

            GunaTextBoxTempsAFaire.Visible = True

        Else

            GunaComboBoxHeureArrivee.Items.Clear()
            GunaComboBoxHeureArrivee.Items.Add("12:00:00")
            GunaComboBoxHeureArrivee.SelectedItem = "12:00:00"

            GunaComboBoxHeureDepart.Items.Clear()
            GunaComboBoxHeureDepart.Items.Add("12:00:00")
            GunaComboBoxHeureDepart.SelectedItem = "12:00:00"

            If GlobalVariable.actualLanguageValue = 1 Then

                GunaLabelTotalHeure.Text = "Nombre de nuitée(s)"
                GunaLabelPrixParNuitee.Text = "Prix par nuitée"
                GunaLabelPrixSejours.Text = "Prix du séjours"

                GunaLabelTypeDeSejour.Text = "COURT SEJOURS"
                GunaLabelTempsAFaire.Text = "Total nuitées"

            Else

                GunaLabelTotalHeure.Text = "Number of night(s)"
                GunaLabelPrixParNuitee.Text = "Price per night"
                GunaLabelPrixSejours.Text = "Price of stay"

                GunaLabelTypeDeSejour.Text = "SHORT STAY"
                GunaLabelTempsAFaire.Text = "Total nights"

            End If

            GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail.AddDays(1)
            GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail

            GunaTextBoxTempsAFaire.Visible = True

        End If

    End Sub

    Private Sub PictureBox2_MouseHover(sender As Object, e As EventArgs)

        If GunaPanelMainMenu.Visible Then
            GunaPanelMainMenu.Visible = False
        Else
            GunaPanelMainMenu.Visible = True
        End If

    End Sub

    Public Sub menuGeneration()

        Dim xValue As Integer = 0

        Dim yValue As Integer = 0

        Dim panelColor As Color = Color.White
        Dim menus As List(Of String)

        menus.Add("RECEPTION")
        menus.Add("RESERVATION")
        menus.Add("SERVICE ETAGE")
        menus.Add("BAR-RESTAURANT")
        menus.Add("CUISINE")
        menus.Add("SERVICE ETAGE")
        menus.Add("COMPTABILITE")
        menus.Add("ECONOMAT")

        If menus IsNot Nothing Then

            If menus.Count > 0 Then

                For i As Integer = 0 To menus.Count

                    Dim nomArticle As String = ""
                    Dim codeArticle As String = ""

                    Dim toolTip As New ToolTip()

                    Dim buttonColor As Color = panelColor
                    Dim textColor As Color = Color.White
                    Dim ClientInRoom As DataTable

                    textColor = Color.Black

                    Dim customPanel As New Panel
                    customPanel.Text = "Test" & i
                    customPanel.Name = "a" & i
                    customPanel.Location = New Point(12 + xValue, 5 + yValue)
                    customPanel.BackColor = buttonColor
                    customPanel.ForeColor = textColor
                    'customPanel.Size = New Size(75, 103)
                    customPanel.Size = New Size(145, 25)
                    customPanel.Anchor = AnchorStyles.None

                    Dim customLabel As New Label

                    customLabel.AutoSize = True
                    customLabel.Font = New System.Drawing.Font("Segoe UI", 7.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
                    customLabel.Location = New System.Drawing.Point(5, 35)
                    customLabel.Name = "customLabel"
                    customLabel.Size = New System.Drawing.Size(108, 20)
                    customLabel.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
                    customLabel.TabIndex = 4

                    customLabel.Text = menus(i)

                    customPanel.Controls.Add(customLabel)

                    '-----------------------------------------------------------------------------------------------------

                    Dim customButton As New Button

                    'customButton.AnimationHoverSpeed = 0.07!
                    'customButton.AnimationSpeed = 0.03!
                    customButton.FlatStyle = FlatStyle.Flat
                    customButton.BackColor = buttonColor
                    'customButton.BorderColor = System.Drawing.Color.Black
                    customButton.DialogResult = System.Windows.Forms.DialogResult.None
                    'customButton.FocusedColor = System.Drawing.Color.Empty
                    customButton.Font = New System.Drawing.Font("Segoe UI", 10.0!)
                    customButton.ForeColor = System.Drawing.Color.White

                    'End If
                    customButton.Image = Nothing
                    customButton.Font = New System.Drawing.Font("Segoe UI", 8.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
                    'customButton.ImageSize = New System.Drawing.Size(52, 52)
                    customButton.Location = New System.Drawing.Point(0, 0)
                    customButton.Name = menus(i)
                    customButton.Size = New System.Drawing.Size(145, 25)
                    customButton.TabIndex = 3
                    customButton.Text = menus(i)
                    customButton.TextAlign = System.Drawing.ContentAlignment.TopCenter

                    'POUR CHACUNE DES CHAMBRES ON POSE UN EVENEMENT DE TYPE CLICK

                    AddHandler customButton.Click, AddressOf onClick
                    AddHandler customPanel.Click, AddressOf onClick

                    customPanel.Controls.Add(customButton)

                    GunaPanelMainMenu.Controls.Add(customPanel)

                    toolTip.ShowAlways = True

                    toolTip.UseFading = True
                    toolTip.UseAnimation = True
                    toolTip.IsBalloon = True
                    toolTip.AutoPopDelay = 5000

                    xValue = xValue + 150

                    If (i + 1) Mod 9 = 0 Then
                        xValue = 0
                        yValue = yValue + 30
                    End If

                Next

            End If


        End If

    End Sub

    Private Sub onClick(ByVal sender As Object, ByVal e As System.EventArgs)

    End Sub

    Private Sub GunaImageButton3_Click(sender As Object, e As EventArgs) Handles GunaImageButton3.Click
        GunaPanelMainMenu.Visible = False
    End Sub

    Private Sub MenuStripMainMenu_Click(sender As Object, e As EventArgs) Handles MenuStripMainMenu.Click
        If GunaPanelMainMenu.Visible Then
            GunaPanelMainMenu.Visible = False
        Else
            GunaPanelMainMenu.Visible = True
        End If
    End Sub

    Private Sub GunaAdvenceButton4_Click_1(sender As Object, e As EventArgs) Handles GunaAdvenceButtonBar.Click
        GlobalVariable.typeDeClientAFacturer = "comptoir"

        BarRestaurantForm.Show()

        Me.Close()
    End Sub

    Private Sub GunaAdvenceButton8_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonEtage.Click
        GlobalVariable.typeChambreOuSalle = "chambre"
        MainWindowServiceEtageForm.Show()
        Me.Close()
    End Sub

    Private Sub GunaAdvenceButton10_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonCompt.Click
        MainWindowComptabiliteForm.Visible = True
        Me.Close()
    End Sub

    Private Sub GunaAdvenceButton11_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonEco.Click
        MainWindowEconomat.Show()
        Me.Close()
    End Sub

    Private Sub GunaAdvenceButton12_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonTech.Click
        MainWindowTechnique.Show()
        Me.Close()
    End Sub

    Private Sub GunaAdvenceButton9_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonCuis.Click

        Me.Cursor = Cursors.WaitCursor

        MainWindowCuisineForm.Show()
        ArticleForm.Show()

        ArticleForm.Location = New Point(90, 110)
        ArticleForm.TopMost = True

        Me.Close()

        Me.Cursor = Cursors.Default

    End Sub

End Class
